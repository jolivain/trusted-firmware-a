{
  "comments": [
    {
      "key": {
        "uuid": "b17ff3f2_0c2815bb",
        "filename": "Makefile",
        "patchSetId": 11
      },
      "lineNbr": 988,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2020-02-19T14:43:54Z",
      "side": 1,
      "message": "Add ${Q} in front of the line for silent builds?",
      "range": {
        "startLine": 988,
        "startChar": 1,
        "endLine": 988,
        "endChar": 25
      },
      "revId": "85526cd101c80d7541f7d14eceb1990d946be34a",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f13c54e2_a20fa2b0",
        "filename": "Makefile",
        "patchSetId": 11
      },
      "lineNbr": 988,
      "author": {
        "id": 1000102
      },
      "writtenOn": "2020-02-20T08:29:30Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b17ff3f2_0c2815bb",
      "range": {
        "startLine": 988,
        "startChar": 1,
        "endLine": 988,
        "endChar": 25
      },
      "revId": "85526cd101c80d7541f7d14eceb1990d946be34a",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c633c983_d28f1d24",
        "filename": "Makefile",
        "patchSetId": 11
      },
      "lineNbr": 991,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2020-02-19T14:43:54Z",
      "side": 1,
      "message": "I am little bit confused by this line, I can\u0027t get my head around how moving the generated makefile in the build directory will affect the rest of the makefile rules. My worry is that all rules depend on ${SPTOOLPATH}/sp_gen.mk, i.e. they expect the makefile to be in the source directory... I am sure you\u0027ve tested it but the flow just doesn\u0027t appear clearly in my mind.\n\nWe don\u0027t necessarily need to move this makefile at all IMO. Even if it\u0027s a generated file, I think it might be clearer to keep it along the sptool sources to visualize what\u0027s going on more easily. But I don\u0027t feel strongly about it.",
      "range": {
        "startLine": 991,
        "startChar": 1,
        "endLine": 991,
        "endChar": 55
      },
      "revId": "85526cd101c80d7541f7d14eceb1990d946be34a",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "00d02528_38b153e4",
        "filename": "Makefile",
        "patchSetId": 11
      },
      "lineNbr": 991,
      "author": {
        "id": 1000102
      },
      "writtenOn": "2020-02-19T17:26:30Z",
      "side": 1,
      "message": "sp_gen.mk file appends FIP_ARGS,FDT_SOURCES and SPTOOL_ARGS variables and in the later build stages these variables are used instead of the file itself.\nSo it is safe to move or even delete this file.\n\nThe only reason not to keep inside is the keep the tree clean.",
      "parentUuid": "c633c983_d28f1d24",
      "range": {
        "startLine": 991,
        "startChar": 1,
        "endLine": 991,
        "endChar": 55
      },
      "revId": "85526cd101c80d7541f7d14eceb1990d946be34a",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1e7ca366_c0c1fff0",
        "filename": "Makefile",
        "patchSetId": 11
      },
      "lineNbr": 991,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2020-02-20T08:31:01Z",
      "side": 1,
      "message": "I see, thanks for the explanation.\n\nStill, I\u0027ve tried to run this patch locally and I\u0027ve noticed that the python script is invoked every time I invoke \u0027make sp\u0027, even if I don\u0027t change anything (source files, SP layout file, partition manifest). Is that necessary? Can we not do a better job at dependency handling so that GNU make does nothing if we change nothing?",
      "parentUuid": "00d02528_38b153e4",
      "range": {
        "startLine": 991,
        "startChar": 1,
        "endLine": 991,
        "endChar": 55
      },
      "revId": "85526cd101c80d7541f7d14eceb1990d946be34a",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "eac5362c_05a0826b",
        "filename": "Makefile",
        "patchSetId": 11
      },
      "lineNbr": 991,
      "author": {
        "id": 1000102
      },
      "writtenOn": "2020-02-20T12:20:18Z",
      "side": 1,
      "message": "With the updated patch GNU make will keep track of SP_MK_GEN and SP_LAYOUT_FILE and sp_gen.mk won\u0027t be generated every time.\nAlso, i have generated this file in output directory so no need to move them around.\n\nOnly thing which does not look clean is to specifically creating BUILD_PLAT directory, if you have idea about generating it in another way please let me know.",
      "parentUuid": "1e7ca366_c0c1fff0",
      "range": {
        "startLine": 991,
        "startChar": 1,
        "endLine": 991,
        "endChar": 55
      },
      "revId": "85526cd101c80d7541f7d14eceb1990d946be34a",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "964cdb6b_bdea2a9f",
        "filename": "Makefile",
        "patchSetId": 11
      },
      "lineNbr": 991,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2020-02-20T14:22:22Z",
      "side": 1,
      "message": "\u003e With the updated patch GNU make will keep track of SP_MK_GEN and SP_LAYOUT_FILE and sp_gen.mk won\u0027t be generated every time.\n\u003e Also, i have generated this file in output directory so no need to move them around.\n\nGreat, thanks!\n\n\u003e Only thing which does not look clean is to specifically creating BUILD_PLAT directory, if you have idea about generating it in another way please let me know.\n\nI guess you could use order-only prerequisite, just like we do for blx directories:\nhttp://git.trustedfirmware.org/TF-A/trusted-firmware-a.git/tree/make_helpers/build_macros.mk#n420\n\nI tried the following line:\n\n $(BUILD_PLAT)/sp_gen.mk: ${SP_MK_GEN} ${SP_LAYOUT_FILE} | ${BUILD_PLAT}\n\nand it seems to work fine for me.\n\nAlthough you\u0027ve removed most of the unneeded steps, it seems like the sptool is still invoked every time. Second time I invoke \u0027make sp\u0027, I still get the following output:\n\n Including services/std_svc/spmd/spmd.mk\n make CPPFLAGS\u003d\"-DVERSION\u003d\u0027\\\"v2.2(release):v2.2-711-g6ea99a3-dirty\\\"\u0027\" --no-print-directory -C tools/sptool\n make[1]: Nothing to be done for \u0027all\u0027.\n mkdir -p  \"./build/fvp/release/bl2u\"\n tools/sptool/sptool -i /tmp/sp1.bin:build/fvp/release/fdts/sp1.dtb -o build/fvp/release/SP1.pkg\n\n Loaded SP Manifest file build/fvp/release/fdts/sp1.dtb (1327 bytes)\n Loaded SP Image file /tmp/sp1.bin (5 bytes)\n Writing SP Manifest at offset 0x18 (1327 bytes)\n Writing SP Image at offset 0x1000 (5 bytes)\n Writing package header\n\n sptool: Built Secure Partition blob build/fvp/release/SP1.pkg\n\n Built SP Images successfully\n\nAny chance we could further improve this and reinvoke sptool only when some of the SP binaries or DTBs are more recent than the SP package?",
      "parentUuid": "eac5362c_05a0826b",
      "range": {
        "startLine": 991,
        "startChar": 1,
        "endLine": 991,
        "endChar": 55
      },
      "revId": "85526cd101c80d7541f7d14eceb1990d946be34a",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b3b482a7_54d0cc51",
        "filename": "Makefile",
        "patchSetId": 11
      },
      "lineNbr": 1007,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2020-02-19T14:43:54Z",
      "side": 1,
      "message": "Do you need that line, given that line 991 moves the file to ${BUILD_PLAT}, which is already removed at line 1006?",
      "range": {
        "startLine": 1007,
        "startChar": 1,
        "endLine": 1007,
        "endChar": 45
      },
      "revId": "85526cd101c80d7541f7d14eceb1990d946be34a",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "226de6d7_5b197e54",
        "filename": "Makefile",
        "patchSetId": 11
      },
      "lineNbr": 1007,
      "author": {
        "id": 1000102
      },
      "writtenOn": "2020-02-20T08:29:30Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b3b482a7_54d0cc51",
      "range": {
        "startLine": 1007,
        "startChar": 1,
        "endLine": 1007,
        "endChar": 45
      },
      "revId": "85526cd101c80d7541f7d14eceb1990d946be34a",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    }
  ]
}