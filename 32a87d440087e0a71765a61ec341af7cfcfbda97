{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "bd158843_149100f4",
        "filename": "plat/intel/soc/common/bl2_plat_mem_params_desc.c",
        "patchSetId": 1
      },
      "lineNbr": 92,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2023-12-19T16:20:11Z",
      "side": 1,
      "message": "Continuing the discussion from the previous review [here](https://review.trustedfirmware.org/c/TF-A/trusted-firmware-a/+/24626/comment/22299cb7_9331dbd3/)...\n\nYou said:\n\u003e You are right. NT_FW_CONFIG shall be set to executable which will be implemented in a new patch which we yet to upstream. At the moment, since we have yet to fully done testing on silicon board (Done on Simics), thus we put it as non-executable.\n\n`NT_FW_CONFIG` is traditionally a configuration data file so it is normally **not** executable. Are you saying that eventually you will need it to be executable on your platform? Why so?\n\nWhat still confuses me is this `.next_handoff_image_id \u003d NT_FW_CONFIG_ID,` line... It is saying that after executing BL33 - which is the Linux kernel in this case, execution should be passed to `NT_FW_CONFIG_ID` - which is Linux device tree file in this case. It does not make sense to me to execute Linux device tree file, it just needs loading for the Linux kernel to find it at the appropriate location.",
      "range": {
        "startLine": 92,
        "startChar": 2,
        "endLine": 92,
        "endChar": 43
      },
      "revId": "32a87d440087e0a71765a61ec341af7cfcfbda97",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "39c2f4a5_90d540ef",
        "filename": "plat/intel/soc/common/bl2_plat_mem_params_desc.c",
        "patchSetId": 1
      },
      "lineNbr": 92,
      "author": {
        "id": 1000742
      },
      "writtenOn": "2024-01-09T03:15:50Z",
      "side": 1,
      "message": "hi Sandrine, \n\nAs you mentioned, this is DTB. DTB is just a config file and ATF is just loading it into DDR. There shall be no execution needed. \n\n\nThus, currently we set this NT_FW_CONFIG_ID to non-executable and tested working on Simics platform. What we worry is once we test it on the silicon board and it required us to update to executable then we will have a new patch on it. This is what we are not sure but by right it shouldn\u0027t set to \"EXECUTABLE\".",
      "parentUuid": "bd158843_149100f4",
      "range": {
        "startLine": 92,
        "startChar": 2,
        "endLine": 92,
        "endChar": 43
      },
      "revId": "32a87d440087e0a71765a61ec341af7cfcfbda97",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "19e2c101_35709131",
        "filename": "plat/intel/soc/common/bl2_plat_mem_params_desc.c",
        "patchSetId": 1
      },
      "lineNbr": 92,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2024-01-10T12:51:35Z",
      "side": 1,
      "message": "I feel there is a misunderstanding here... Let me try to clarify what I have in mind.\n\nI am **not** challenging line 99, I think it\u0027s correct this way. As you said, the following lines are correctly saying that `NT_FW_CONFIG` image is **not** executable:\n\n```\n\t\t.image_id \u003d NT_FW_CONFIG_ID,\n\t\tSET_STATIC_PARAM_HEAD(ep_info, PARAM_IMAGE_BINARY,\n\t\t\tVERSION_2, entry_point_info_t,\n\t\t\tNON_SECURE | NON_EXECUTABLE),\n```\n\nThis is fine and should not be changed.\n\nHowever, line 92 (quoted below) is incorrect IMO:\n```\n\t\t.next_handoff_image_id \u003d NT_FW_CONFIG_ID,\n```\nThis is inconsistent with setting the `NT_FW_CONFIG` image as non-executable at line 99.\n\nIn summary, I think line 99 should be kept as is, but line 92 above should be changed into:\n\n```\n\t\t.next_handoff_image_id \u003d INVALID_IMAGE_ID,\n```",
      "parentUuid": "39c2f4a5_90d540ef",
      "range": {
        "startLine": 92,
        "startChar": 2,
        "endLine": 92,
        "endChar": 43
      },
      "revId": "32a87d440087e0a71765a61ec341af7cfcfbda97",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2846de09_82cd1c2a",
        "filename": "plat/intel/soc/common/bl2_plat_mem_params_desc.c",
        "patchSetId": 1
      },
      "lineNbr": 92,
      "author": {
        "id": 1000742
      },
      "writtenOn": "2024-01-16T03:45:31Z",
      "side": 1,
      "message": "Hi Sandrine, \n\nSorry that I misunderstood previously. \n\nLine 92 will only executed when \"ARM_LINUX_KERNEL_AS_BL33 \u003d 1\". This is to allow for ATF direct boot Linux which we need to tell that the next image is DTB. \n\nHowever for other cases (U-boot-\u003eATF BL31-\u003eLinux boot or ATF-\u003eZephyr boot). This line is not needed where ARM_LINUX_KERNEL_AS_BL33 build option will be \"0\" and it will skip from line 92 to 107. Thus the code will execute line 109 which is .next_handoff_image_id \u003d INVALID_IMAGE_ID.\n\nIn short, for ATF-\u003eLinux boot, we need image_id \u003d BL31_IMAGE_ID for BL31.bin, BL33_IMAGE_ID for Linux Image and NT_FW_CONFIG_ID for Linux DTB. After that we will point next_handoff_image_id \u003d INVALID_IMAGE_ID in line 106.",
      "parentUuid": "19e2c101_35709131",
      "range": {
        "startLine": 92,
        "startChar": 2,
        "endLine": 92,
        "endChar": 43
      },
      "revId": "32a87d440087e0a71765a61ec341af7cfcfbda97",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b576e11a_70990e9b",
        "filename": "plat/intel/soc/common/bl2_plat_mem_params_desc.c",
        "patchSetId": 1
      },
      "lineNbr": 92,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2024-01-19T10:08:10Z",
      "side": 1,
      "message": "Hi Benjamin,\n\nI understand the 2 boot sequences you described. And I understand that the NT_FW_CONFIG DTB / Linux DTB file only needs loading in the TF-A-\u003eLinux boot flow case (ARM_LINUX_KERNEL_AS_BL33\u003d1).\n\nWhat I am trying to convey is that the `.next_handoff_image_id` field is *not* involved in image *loading*. As the code stands, the NT_FW_CONFIG DTB / Linux DTB file *will be* loaded, no matter the value you assign to `bl2_mem_params_descs[BL33_IMAGE_ID].next_handoff_image_id` at line 92. The `.next_handoff_image_id` field is only involved in image *execution*. As the Linux DTB file is not something we need to *execute*, we should set `bl2_mem_params_descs[BL33_IMAGE_ID].next_handoff_image_id` to `INVALID_IMAGE_ID`.\n\nWould you mind changing line 92 as I suggest and run tests at your end? It should boot just fine.\n\nThat being said, I understand that it also just boots fine with the current code. Line 92 is only wrong from a logical / design perspective but it\u0027s not functionally wrong, for the reasons I tried to describe earlier.\n\nTherefore, I won\u0027t delay this patch any further and I\u0027ll just merge it as is. If I\u0027ve convinced you to change line 92 this time and you want to follow my suggestion then please feel free to submit another path to this effect.\n\nBest regards,\nSandrine",
      "parentUuid": "2846de09_82cd1c2a",
      "range": {
        "startLine": 92,
        "startChar": 2,
        "endLine": 92,
        "endChar": 43
      },
      "revId": "32a87d440087e0a71765a61ec341af7cfcfbda97",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    }
  ],
  "submitRequirementResults": []
}