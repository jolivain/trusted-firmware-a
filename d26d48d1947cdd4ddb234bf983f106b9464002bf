{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "25fd8038_339c4e1a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 22
      },
      "lineNbr": 31,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2023-06-27T08:54:30Z",
      "side": 1,
      "message": "this seems problematic. We should set EEL2 as default for all the contexts.",
      "range": {
        "startLine": 30,
        "startChar": 37,
        "endLine": 31,
        "endChar": 48
      },
      "revId": "d26d48d1947cdd4ddb234bf983f106b9464002bf",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "53b9b762_00b9c670",
        "filename": "/COMMIT_MSG",
        "patchSetId": 22
      },
      "lineNbr": 31,
      "author": {
        "id": 1000883
      },
      "writtenOn": "2023-06-27T12:31:59Z",
      "side": 1,
      "message": "okay but why? EEL2 is currently *not* set for all contexts, so does this patch need to change this?\n\nEEL2 only matters for Secure world as far as I can tell. It enables SEL2 and allows access to ICC_SRE_EL2 when SCR_EL3.NS\u003d0. When SCR_EL3.NS\u003d1 it has absolutely no effect - so it doesn\u0027t matter whether it\u0027s set for the NS/R EL2. And I put guards around the problematic parts (like ICC_SRE_EL2) to make sure it doesn\u0027t matter.",
      "parentUuid": "25fd8038_339c4e1a",
      "range": {
        "startLine": 30,
        "startChar": 37,
        "endLine": 31,
        "endChar": 48
      },
      "revId": "d26d48d1947cdd4ddb234bf983f106b9464002bf",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "41b41482_380a683d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 22
      },
      "lineNbr": 31,
      "author": {
        "id": 1000883
      },
      "writtenOn": "2023-09-22T13:47:10Z",
      "side": 1,
      "message": "discussed offline, will keep it as-is and introduce in a different patch",
      "parentUuid": "53b9b762_00b9c670",
      "range": {
        "startLine": 30,
        "startChar": 37,
        "endLine": 31,
        "endChar": 48
      },
      "revId": "d26d48d1947cdd4ddb234bf983f106b9464002bf",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c409b81a_82adf8a0",
        "filename": "/COMMIT_MSG",
        "patchSetId": 22
      },
      "lineNbr": 31,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2023-09-27T14:49:44Z",
      "side": 1,
      "message": "I think this has unintended effects for the case of BL2 running at S-EL1.\nS-EL2 traps might happen while BL2 executes and end up in a crash because S-EL2 is empty (or no VBAR_EL2 set).\nExample of CNTPCT_EL0 accessed from SEL1 traps when CNTHCTL_EL2.EL1PCTEN as default. BL2 accesses the EL1 physical counter.",
      "parentUuid": "41b41482_380a683d",
      "range": {
        "startLine": 30,
        "startChar": 37,
        "endLine": 31,
        "endChar": 48
      },
      "revId": "d26d48d1947cdd4ddb234bf983f106b9464002bf",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a26ef52d_a38997c2",
        "filename": "/COMMIT_MSG",
        "patchSetId": 22
      },
      "lineNbr": 31,
      "author": {
        "id": 1000883
      },
      "writtenOn": "2023-09-29T10:52:55Z",
      "side": 1,
      "message": "This is curious as we currently run with both configurations. Any config without RME support will be set my way (only secure world gets EEL2) and anything with RME will be set Soby\u0027s way (everyone gets EEL2). Both seem to be working fine. I think my way caters for the case you\u0027re pointing out, but Soby pointed out that other pieces of hardware far from the CPU might get confused if we routinely toggle EEL2. I\u0027m not sure what the answer is here...",
      "parentUuid": "c409b81a_82adf8a0",
      "range": {
        "startLine": 30,
        "startChar": 37,
        "endLine": 31,
        "endChar": 48
      },
      "revId": "d26d48d1947cdd4ddb234bf983f106b9464002bf",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "887a8577_51dc653b",
        "filename": "/COMMIT_MSG",
        "patchSetId": 22
      },
      "lineNbr": 31,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2023-09-29T11:37:00Z",
      "side": 1,
      "message": "I\u0027m fine with the general idea of enabling EEL2 once in all contexts for the run-time and avoid flipping the bit on world switch.\nBut I sense there are cases where we should avoid it e.g. boot time for BL2 (or other S-EL1 payloads) and perhaps configurations like the SPM-MM and EL3 SPMC. For the latter, it may happen to run on SEL2-enabled hardware (through not provisioned by an image).\n\u003e This is curious as we currently run with both configurations. \nWhat I can say at least is that this is most probably the reason for the test failures:\nhttps://ci.trustedfirmware.org/job/tf-a-ci-gateway/49217/\nhttps://ci.trustedfirmware.org/job/tf-a-ci-gateway/49205/",
      "parentUuid": "a26ef52d_a38997c2",
      "range": {
        "startLine": 30,
        "startChar": 37,
        "endLine": 31,
        "endChar": 48
      },
      "revId": "d26d48d1947cdd4ddb234bf983f106b9464002bf",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ee1a599e_6b25ff71",
        "filename": "lib/el3_runtime/aarch64/context_mgmt.c",
        "patchSetId": 22
      },
      "lineNbr": 1060,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2023-06-27T08:54:30Z",
      "side": 1,
      "message": "This seems problematic. scr_el3 should have the EEL2 and NS/S bit set early to avoid this issue.",
      "revId": "d26d48d1947cdd4ddb234bf983f106b9464002bf",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3d2baa3e_7773ea37",
        "filename": "lib/el3_runtime/aarch64/context_mgmt.c",
        "patchSetId": 22
      },
      "lineNbr": 1060,
      "author": {
        "id": 1000883
      },
      "writtenOn": "2023-06-27T12:31:59Z",
      "side": 1,
      "message": "why is this problematic? As things stand, EEL2/NS bits are not set as you describe. Setting the NS bit would be a piece of root context, which is the entire point of this patch - preparation for it. Once we get to it, we should be able to factor this setting into it and remove it from here.",
      "parentUuid": "ee1a599e_6b25ff71",
      "revId": "d26d48d1947cdd4ddb234bf983f106b9464002bf",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "aa09832b_6f3e99d7",
        "filename": "lib/el3_runtime/aarch64/context_mgmt.c",
        "patchSetId": 22
      },
      "lineNbr": 1060,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2023-06-27T14:47:35Z",
      "side": 1,
      "message": "In the ENABLE_RME is set, all the contexts will have EEL2 bit set. The sequence for scr programming is a read-modify-write so all the values set at reset will persist. I think EEL2 is a system wide setting that should not be modified at runtime. It may have various IP impacts outside CPU as well so not favour of programming it only for secure.",
      "parentUuid": "3d2baa3e_7773ea37",
      "revId": "d26d48d1947cdd4ddb234bf983f106b9464002bf",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7a647f67_0c810f00",
        "filename": "lib/el3_runtime/aarch64/context_mgmt.c",
        "patchSetId": 22
      },
      "lineNbr": 1060,
      "author": {
        "id": 1000883
      },
      "writtenOn": "2023-06-27T16:08:52Z",
      "side": 1,
      "message": "Can you point me to any information on this? Why is RME so special? Why will it have \"IP impacts outside CPU\"? I would like to consider these.\n\n\u003e The sequence for scr programming is a read-modify-write so all the values set at reset will persist\n\nThis is the part which this patch changes. I want to disentangle this, as with all other registers I\u0027ve touched in this series.",
      "parentUuid": "aa09832b_6f3e99d7",
      "revId": "d26d48d1947cdd4ddb234bf983f106b9464002bf",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0c972ee3_4b06d58c",
        "filename": "lib/el3_runtime/aarch64/context_mgmt.c",
        "patchSetId": 22
      },
      "lineNbr": 1060,
      "author": {
        "id": 1000883
      },
      "writtenOn": "2023-09-22T13:47:10Z",
      "side": 1,
      "message": "discussed offline, will keep it as-is and introduce in a different patch",
      "parentUuid": "7a647f67_0c810f00",
      "revId": "d26d48d1947cdd4ddb234bf983f106b9464002bf",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    }
  ]
}