{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "28bead8c_0ecc34e7",
        "filename": "include/plat/common/platform.h",
        "patchSetId": 14
      },
      "lineNbr": 415,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2022-07-18T07:25:54Z",
      "side": 1,
      "message": "nit: remove",
      "range": {
        "startLine": 415,
        "startChar": 16,
        "endLine": 415,
        "endChar": 17
      },
      "revId": "fe6e56c74c572b84a2e4edaadf105e07e231d503",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7eba71f8_425f2f7b",
        "filename": "include/plat/common/platform.h",
        "patchSetId": 14
      },
      "lineNbr": 415,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2022-07-18T09:43:22Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "28bead8c_0ecc34e7",
      "range": {
        "startLine": 415,
        "startChar": 16,
        "endLine": 415,
        "endChar": 17
      },
      "revId": "fe6e56c74c572b84a2e4edaadf105e07e231d503",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "889b366f_27d2ad6c",
        "filename": "include/plat/common/platform.h",
        "patchSetId": 14
      },
      "lineNbr": 415,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2022-07-20T16:01:49Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "7eba71f8_425f2f7b",
      "range": {
        "startLine": 415,
        "startChar": 16,
        "endLine": 415,
        "endChar": 17
      },
      "revId": "fe6e56c74c572b84a2e4edaadf105e07e231d503",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1a2f5310_5bebfce2",
        "filename": "include/plat/common/platform.h",
        "patchSetId": 14
      },
      "lineNbr": 417,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2022-07-18T07:25:54Z",
      "side": 1,
      "message": "remove, or move in above header description ?",
      "range": {
        "startLine": 417,
        "startChar": 0,
        "endLine": 417,
        "endChar": 48
      },
      "revId": "fe6e56c74c572b84a2e4edaadf105e07e231d503",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "32f34468_1d8d17c2",
        "filename": "include/plat/common/platform.h",
        "patchSetId": 14
      },
      "lineNbr": 417,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2022-07-18T09:43:22Z",
      "side": 1,
      "message": "This comment is very much specific to the platform APIs listed in this patch. In subsequent patch [1], I moved this to separate file where all platform APIs related to DRTM are listed and these APIs are shown in the group with appropriate group header comment.\nDo you think I should create a plat_drtm.h file in this patch itself, or leave this comment as it is in this patch?\n\n[1]: https://review.trustedfirmware.org/c/TF-A/trusted-firmware-a/+/15499/13/include/plat/common/plat_drtm.h",
      "parentUuid": "1a2f5310_5bebfce2",
      "range": {
        "startLine": 417,
        "startChar": 0,
        "endLine": 417,
        "endChar": 48
      },
      "revId": "fe6e56c74c572b84a2e4edaadf105e07e231d503",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4da9540e_632e6cba",
        "filename": "include/plat/common/platform.h",
        "patchSetId": 14
      },
      "lineNbr": 417,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2022-07-20T16:01:49Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "32f34468_1d8d17c2",
      "range": {
        "startLine": 417,
        "startChar": 0,
        "endLine": 417,
        "endChar": 48
      },
      "revId": "fe6e56c74c572b84a2e4edaadf105e07e231d503",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0a278fa4_1305af81",
        "filename": "plat/arm/board/fvp/fvp_drtm_dma_prot.c",
        "patchSetId": 14
      },
      "lineNbr": 18,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2022-07-18T07:25:54Z",
      "side": 1,
      "message": "nit: capital",
      "range": {
        "startLine": 18,
        "startChar": 3,
        "endLine": 18,
        "endChar": 4
      },
      "revId": "fe6e56c74c572b84a2e4edaadf105e07e231d503",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2c5ceaf3_05035803",
        "filename": "plat/arm/board/fvp/fvp_drtm_dma_prot.c",
        "patchSetId": 14
      },
      "lineNbr": 18,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2022-07-18T09:43:22Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "0a278fa4_1305af81",
      "range": {
        "startLine": 18,
        "startChar": 3,
        "endLine": 18,
        "endChar": 4
      },
      "revId": "fe6e56c74c572b84a2e4edaadf105e07e231d503",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "23c4e86c_29f7147e",
        "filename": "plat/arm/board/fvp/fvp_drtm_dma_prot.c",
        "patchSetId": 14
      },
      "lineNbr": 26,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2022-07-18T07:25:54Z",
      "side": 1,
      "message": "Does it imply GPU is part of system\u0027s TCB?",
      "range": {
        "startLine": 26,
        "startChar": 4,
        "endLine": 26,
        "endChar": 41
      },
      "revId": "fe6e56c74c572b84a2e4edaadf105e07e231d503",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dadeda45_8c3fa1f9",
        "filename": "plat/arm/board/fvp/fvp_drtm_dma_prot.c",
        "patchSetId": 14
      },
      "lineNbr": 26,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2022-07-18T09:43:22Z",
      "side": 1,
      "message": "Yes, it does imply NHPs are part of TCB.",
      "parentUuid": "23c4e86c_29f7147e",
      "range": {
        "startLine": 26,
        "startChar": 4,
        "endLine": 26,
        "endChar": 41
      },
      "revId": "fe6e56c74c572b84a2e4edaadf105e07e231d503",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1e96c278_51d7520a",
        "filename": "plat/arm/board/fvp/fvp_drtm_dma_prot.c",
        "patchSetId": 14
      },
      "lineNbr": 26,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2022-07-19T08:25:48Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "dadeda45_8c3fa1f9",
      "range": {
        "startLine": 26,
        "startChar": 4,
        "endLine": 26,
        "endChar": 41
      },
      "revId": "fe6e56c74c572b84a2e4edaadf105e07e231d503",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c0609bf2_958cbe05",
        "filename": "plat/arm/board/fvp/fvp_drtm_dma_prot.c",
        "patchSetId": 14
      },
      "lineNbr": 38,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2022-07-18T07:25:54Z",
      "side": 1,
      "message": "this expression resolves to an integer so it\u0027d be preferable to provide a boolean expresion e.g.\n\n return (arm_config.flags \u0026 ARM_CONFIG_FVP_HAS_SMMUV3) \u003d\u003d 0;\n\n\nBeyond that, is it the right condition to infer the platform has peripherals not sitting behind an SMMU. E.g. FVP implements an SMMU controlled by the PE but AFAIK only has a test engine upstream to it. So a peripheral like UART might be DMA capable but not under control of the SMMU and hence unmanaged despite presence of an SMMU.",
      "range": {
        "startLine": 38,
        "startChar": 10,
        "endLine": 38,
        "endChar": 54
      },
      "revId": "fe6e56c74c572b84a2e4edaadf105e07e231d503",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9f9cf4e6_867a64e4",
        "filename": "plat/arm/board/fvp/fvp_drtm_dma_prot.c",
        "patchSetId": 14
      },
      "lineNbr": 38,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2022-07-18T09:43:22Z",
      "side": 1,
      "message": "\u003e  return (arm_config.flags \u0026 ARM_CONFIG_FVP_HAS_SMMUV3) \u003d\u003d 0;\nAck\n\n\u003e So a peripheral like UART might be DMA capable but not under control of the SMMU and hence unmanaged despite presence of an SMMU.\nIt is very much the bare minimum check we have performed in the FVP. Assumed that SMMU is behind all peripherals supported by FVP. @Lucian do you recall intention behind this check?",
      "parentUuid": "c0609bf2_958cbe05",
      "range": {
        "startLine": 38,
        "startChar": 10,
        "endLine": 38,
        "endChar": 54
      },
      "revId": "fe6e56c74c572b84a2e4edaadf105e07e231d503",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e4860261_37fb5745",
        "filename": "plat/arm/board/fvp/fvp_drtm_dma_prot.c",
        "patchSetId": 14
      },
      "lineNbr": 38,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2022-07-19T08:25:48Z",
      "side": 1,
      "message": "\u003e Assumed that SMMU is behind all peripherals supported by FVP\nI don\u0027t believe this is the case, the FVP implements a single SMMU instance controlled by the PE and only a single loopback test peripheral upstream to it. Therefore, most if not all peripherals (excluding ones part of a subsystem like GPU), when DMA-capable, are NOT sitting behind an SMMU. Thus I\u0027m questioning if this is the right condition (\u0027is an SMMU is implemented\u0027) to answer \u0027is the platform implementing unmanaged peripherals\u0027 ?",
      "parentUuid": "9f9cf4e6_867a64e4",
      "range": {
        "startLine": 38,
        "startChar": 10,
        "endLine": 38,
        "endChar": 54
      },
      "revId": "fe6e56c74c572b84a2e4edaadf105e07e231d503",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "213cdc91_61c6e002",
        "filename": "plat/arm/board/fvp/fvp_drtm_dma_prot.c",
        "patchSetId": 14
      },
      "lineNbr": 38,
      "author": {
        "id": 1000621
      },
      "writtenOn": "2022-07-19T09:41:40Z",
      "side": 1,
      "message": "Hi,\n\nThis is code from the PoC part of DRTM spec development, so may be crude or idealised.  As mentioned in the comments, info on whether unmanaged peripherals exist did not seem to be readily available, except for whether an SMMU exists or not.  Hence I adopted a simple model that assumes if the SMMU exists then all peripherals are behind it.\n\nIf unmanaged peripherals exists, as per the useful comments from Olivier, then the DRTM service refuses to load, so returning \"true\" is not an option.  In this case, an investigation should be carried out to determine whether the peripherals can be trusted.  If they can be trusted, then they can be moved to the \"Non-host platforms\" category, for example by listing them in the comments under plat_has_non_host_platforms().\n\nTaking a step back, the intention behind these hooks which act a bit like a physical \"checklist\", is for the platform porter to consider the spec requirements and reason about the platform\u0027s suitability for DRTM.  It may be that this process should not entail any runtime code, since real platforms are likely fixed, or the relevant properties are fixed.  An alternative may be to document this process part of the TF-A documentation.",
      "parentUuid": "e4860261_37fb5745",
      "range": {
        "startLine": 38,
        "startChar": 10,
        "endLine": 38,
        "endChar": 54
      },
      "revId": "fe6e56c74c572b84a2e4edaadf105e07e231d503",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c3553456_aa60d1a3",
        "filename": "plat/arm/board/fvp/fvp_drtm_dma_prot.c",
        "patchSetId": 14
      },
      "lineNbr": 38,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2022-07-19T09:43:29Z",
      "side": 1,
      "message": "If the SMMU is not behind the DMA-capable peripherals then can those be treated as non-host-platforms and we need to trust them? non-host-platforms defined as below in the specification -\n\nA peripheral or controller in a system that has no DMA-protections and cannot be restricted from reading or writing the DCE or DLME.",
      "parentUuid": "e4860261_37fb5745",
      "range": {
        "startLine": 38,
        "startChar": 10,
        "endLine": 38,
        "endChar": 54
      },
      "revId": "fe6e56c74c572b84a2e4edaadf105e07e231d503",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b4667b3d_baf63c19",
        "filename": "plat/arm/board/fvp/fvp_drtm_dma_prot.c",
        "patchSetId": 14
      },
      "lineNbr": 60,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2022-07-18T07:25:54Z",
      "side": 1,
      "message": "Should this be relocated to TF-A\u0027s SMMU driver?",
      "range": {
        "startLine": 41,
        "startChar": 0,
        "endLine": 60,
        "endChar": 1
      },
      "revId": "fe6e56c74c572b84a2e4edaadf105e07e231d503",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "86bd611f_ab7c9ff4",
        "filename": "plat/arm/board/fvp/fvp_drtm_dma_prot.c",
        "patchSetId": 14
      },
      "lineNbr": 60,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2022-07-18T09:43:22Z",
      "side": 1,
      "message": "Yes, I think it makes sense to move this to SMMU driver. \n(We have created these plat-APIs specifically for DRTM as there are no other consumers for these APIs apart from DRTM service).",
      "parentUuid": "b4667b3d_baf63c19",
      "range": {
        "startLine": 41,
        "startChar": 0,
        "endLine": 60,
        "endChar": 1
      },
      "revId": "fe6e56c74c572b84a2e4edaadf105e07e231d503",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "20d37146_b7b607af",
        "filename": "plat/arm/board/fvp/fvp_drtm_dma_prot.c",
        "patchSetId": 14
      },
      "lineNbr": 60,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2022-07-18T12:27:33Z",
      "side": 1,
      "message": "Further thinking, there is no functionality part in this function to move these APIs to TF-A SMMU driver. In other words, these APIs are gathering information from the platform only and not doing anything specific SMMU operation.\nIf I want to move these to TF-A SMMU driver then I still need to introduce some platform APIs to retrieve details from the platform. I prefer let it be like this for now.\nPlease let me know what do you think?",
      "parentUuid": "86bd611f_ab7c9ff4",
      "range": {
        "startLine": 41,
        "startChar": 0,
        "endLine": 60,
        "endChar": 1
      },
      "revId": "fe6e56c74c572b84a2e4edaadf105e07e231d503",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "55d4117a_f01909e2",
        "filename": "plat/arm/board/fvp/fvp_drtm_dma_prot.c",
        "patchSetId": 14
      },
      "lineNbr": 60,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2022-07-19T08:25:48Z",
      "side": 1,
      "message": "Ok to leave as this, I\u0027m still thinking platform details about the system SMMU topology may be confined to the SMMU driver that it may expose to other entities like DRTM.",
      "parentUuid": "20d37146_b7b607af",
      "range": {
        "startLine": 41,
        "startChar": 0,
        "endLine": 60,
        "endChar": 1
      },
      "revId": "fe6e56c74c572b84a2e4edaadf105e07e231d503",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    }
  ]
}