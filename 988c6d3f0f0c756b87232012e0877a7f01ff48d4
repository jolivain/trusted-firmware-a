{
  "comments": [
    {
      "key": {
        "uuid": "c03242aa_178809a2",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2019-04-10T13:49:32Z",
      "side": 1,
      "message": "As a disclaimer, I am not a SMMUv3 expert, my comments are based on a quick read-through of the SMMUv3 specification so I might have got this wrong.\n\nAFAIU, this patch only affects transactions on the *secure* interface, it does not configure anything for transactions on the non-secure interface. If that is correct, I think it would be worth  clarifying here.\n\nAlso, if I am not mistaken, \"disable\" here is a bit misleading. The SMMU_S_CR0.SMMUEN bit is cleared at reset so in a sense transactions are already disabled (although they bypass the SMMU) so this might sound confusing. Perhaps use the word \"abort\" instead?\n\nIn short, I suggest the following commit title:\n\n Abort incoming DMA transactions on SMMU secure interface\n\nFinally, I would like to better understand the consequences of this patch. Without this patch, what would happen if an I/O device issued a DMA request on the secure interface of the SMMU? My understanding is that it would bypass the SMMU, which means that the address would not be translated at all. Is that correct? What does that imply?\n\nThis patch is fundamentally changing the behaviour of the SMMU. I was initially worried that some platforms might rely on the bypass behaviour and would suddenly break if transactions were aborted now ; but it looks like FVP is the only (upstream) platform using this driver so I guess we\u0027re fine.",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 32
      },
      "revId": "988c6d3f0f0c756b87232012e0877a7f01ff48d4",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cc8aea53_84a692c9",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 7,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2019-04-10T14:07:34Z",
      "side": 1,
      "message": "On further thoughts, I think the consequences of this patch are slightly more nuanced. The SMMU_S_GBPA.ABORT bit seems to reset to an implementation defined value so I guess that the effect of this patch will differ from one platform to another (on some platforms, this bit might reset to 1, in which case this patch does not change anything). Is that correct?",
      "parentUuid": "c03242aa_178809a2",
      "range": {
        "startLine": 7,
        "startChar": 0,
        "endLine": 7,
        "endChar": 32
      },
      "revId": "988c6d3f0f0c756b87232012e0877a7f01ff48d4",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6d9f6ac9_2b277c28",
        "filename": "drivers/arm/smmu/smmu_v3.c",
        "patchSetId": 1
      },
      "lineNbr": 64,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2019-04-10T13:49:32Z",
      "side": 1,
      "message": "(minor) Perhaps consider encapsulating this line into a static inline helper function, as this is the pattern used throughout this driver.",
      "range": {
        "startLine": 64,
        "startChar": 0,
        "endLine": 64,
        "endChar": 67
      },
      "revId": "988c6d3f0f0c756b87232012e0877a7f01ff48d4",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6f8a0f7f_e2168cc0",
        "filename": "drivers/arm/smmu/smmu_v3.c",
        "patchSetId": 1
      },
      "lineNbr": 64,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2019-04-10T13:49:32Z",
      "side": 1,
      "message": "I think mmio_write_32() might be more appropriate than mmio_setbits_32() here. I think we want to fully initialize this register rather than just updating the ABORT bit. This seems safe to me, given that there\u0027s only RES0 fields in the SMMU_S_GBPA register, there\u0027s no RES1 as far as I can see.",
      "range": {
        "startLine": 64,
        "startChar": 1,
        "endLine": 64,
        "endChar": 16
      },
      "revId": "988c6d3f0f0c756b87232012e0877a7f01ff48d4",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "17ab817c_468d318a",
        "filename": "drivers/arm/smmu/smmu_v3.c",
        "patchSetId": 1
      },
      "lineNbr": 64,
      "author": {
        "id": 1000105
      },
      "writtenOn": "2019-04-10T14:14:49Z",
      "side": 1,
      "message": "The current pattern defines 4 inline functions which aren\u0027t used anywhere else in the source code and are actually mmio_write_32() \u0026 mmio_read_32() calls.\nAlso it is not clear why all functions have __init attribute but smmuv3_inval_pending() doesn\u0027t.",
      "parentUuid": "6d9f6ac9_2b277c28",
      "range": {
        "startLine": 64,
        "startChar": 0,
        "endLine": 64,
        "endChar": 67
      },
      "revId": "988c6d3f0f0c756b87232012e0877a7f01ff48d4",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1a0c537f_706241c5",
        "filename": "drivers/arm/smmu/smmu_v3.c",
        "patchSetId": 1
      },
      "lineNbr": 64,
      "author": {
        "id": 1000105
      },
      "writtenOn": "2019-04-10T14:14:49Z",
      "side": 1,
      "message": "\".. given that there\u0027s only RES0 fields in the SMMU_S_GBPA register\" This is not correct.\nAll the fields in SMMU_S_GBPA except [31]Update \"reset to an IMPLEMENTATION DEFINED values\", so the current implementation doesn\u0027t change their values.",
      "parentUuid": "6f8a0f7f_e2168cc0",
      "range": {
        "startLine": 64,
        "startChar": 1,
        "endLine": 64,
        "endChar": 16
      },
      "revId": "988c6d3f0f0c756b87232012e0877a7f01ff48d4",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fe38cefb_625530b6",
        "filename": "drivers/arm/smmu/smmu_v3.c",
        "patchSetId": 1
      },
      "lineNbr": 64,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2019-04-10T15:09:23Z",
      "side": 1,
      "message": "\u003e The current pattern defines 4 inline functions which aren\u0027t used anywhere else in the source code and are actually mmio_write_32() \u0026 mmio_read_32() calls.\n\nYes. I\u0027m not sure what was the motivation for writing the code this way, I guess it\u0027s down to personal preference. I\u0027m just saying that we might want to follow the existing structure for consistency.\n\n\u003e Also it is not clear why all functions have __init attribute but smmuv3_inval_pending() doesn\u0027t.\n\nYes, that is a good question. We should investigate after this patch.",
      "parentUuid": "17ab817c_468d318a",
      "range": {
        "startLine": 64,
        "startChar": 0,
        "endLine": 64,
        "endChar": 67
      },
      "revId": "988c6d3f0f0c756b87232012e0877a7f01ff48d4",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9ab7a900_9ca459ab",
        "filename": "drivers/arm/smmu/smmu_v3.c",
        "patchSetId": 1
      },
      "lineNbr": 64,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2019-04-10T15:09:23Z",
      "side": 1,
      "message": "Right, I had missed that, thanks.",
      "parentUuid": "1a0c537f_706241c5",
      "range": {
        "startLine": 64,
        "startChar": 1,
        "endLine": 64,
        "endChar": 16
      },
      "revId": "988c6d3f0f0c756b87232012e0877a7f01ff48d4",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    }
  ]
}