{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "c4271feb_d6b0c594",
        "filename": "/COMMIT_MSG",
        "patchSetId": 15
      },
      "lineNbr": 0,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2023-02-13T13:21:18Z",
      "side": 1,
      "message": "As you hint to in the commit message, BL2_AT_EL3 support as it exists today is twofold:\n1. It\u0027s about running BL2 at EL3.\n2. It\u0027s also about BL2 being the *first* TF-A image running on the target after some proprietary Boot ROM code has handed over to it.\n\n2. has consequences on the behaviour of early BL2 code, which has to take on some of the responsibilities which usually fall on BL1 - e.g handling the warm boot mailbox, running the CPU reset code, errata reporting, ...\n\nIMO, the current BL2_AT_EL3 name correctly conveys 1. but not enough 2. So I agree about renaming it, but I think we should choose something that encompasses both 1. and 2.\n\nAlso, I am uncomfortable with the idea of decoupling BL2_AT_EL3 from ENABLE_RME in the first place. Amongst those of our partners who use BL2_AT_EL3\u003d1 option today, I could imagine that some of them will want to add RME support into their existing (2-world) boot ROMs solutions, because it might be simpler for them than switching to TF-A BL1. Although we do not support ENABLE_RME + BL2_AT_EL3 (as in requirement 2. above) combination today in TF-A upstream, I don\u0027t think we should rule that out.\n\nSo rather than decoupling them, I think we should have a build-time error message that tells the user that ENABLE_RME\u003d1 + BL2_AT_EL3\u003d1 config is not supported (I don\u0027t think it is, right?). And optionally we could rename BL2_AT_EL3 into something that better conveys 2. (although I don\u0027t have any good suggestions right now), just for clarity.\n\nNote: The rest of my comments in this review assume that we are going with the changes as you propose. IOW they are not aligned with the text above.",
      "revId": "32fa427682e7817d6848e28f356b065b46982565",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4250870c_d3724da4",
        "filename": "/COMMIT_MSG",
        "patchSetId": 15
      },
      "lineNbr": 0,
      "author": {
        "id": 1000102
      },
      "writtenOn": "2023-02-13T14:40:54Z",
      "side": 1,
      "message": "@Sandrine, Just to confirm my understanding, when you say BL2_AT_EL3 in RME context you mean BL2 as Boot ROM code? As i understand the RME currently expects BL2 to run at EL3 Exception level.\n\nComing to your points 1 \u0026 2, am i correct in re-phrasing as below\n1. BL2 running at EL3 exception level\n2. BL2 running as BootRoM\n\nCan we use BL2_RUNNING_AT_EL3(1) and BL2_AS_BOOT_ROM(2). Valid combinations would be \nBL2_AS_BOOT_ROM mandates enabling BL2_RUNNING_AT_EL3 \nENABLE_RME mandates BL2_RUNNING_AT_EL3\nStop the build if BL2_RUNNING_AT_EL3 with ENABLE_RME is enabled.",
      "parentUuid": "c4271feb_d6b0c594",
      "revId": "32fa427682e7817d6848e28f356b065b46982565",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "eb9788a9_db869fae",
        "filename": "/COMMIT_MSG",
        "patchSetId": 15
      },
      "lineNbr": 0,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2023-02-14T08:46:47Z",
      "side": 1,
      "message": "\u003e @Sandrine, Just to confirm my understanding, when you say BL2_AT_EL3 in RME context you mean BL2 as Boot ROM code? As i understand the RME currently expects BL2 to run at EL3 Exception level.\n\nNo, I don\u0027t mean BL2 as Boot ROM code. I mean BL2 as the first *TF-A* image in the bootflow, but not as the first image. IOW, at power up execution starts into a proprietary, non-TF-A Boot ROM image, which then hands over to TF-A BL2 (built with BL2_AT_EL3\u003d1). Both the proprietay Boot ROM and TF-A (mutable) BL2 image run at EL3.\n\nYes, Arm CCA currently expects BL2 to run at EL3. That is a requirement of Arm CCA security model. In fact, it expects all root firmware (Boot ROM + mutable boot firmware + runtime firmware) to run into root world, i.e. EL3.\n\n\u003e Coming to your points 1 \u0026 2, am i correct in re-phrasing as below\n\u003e 1. BL2 running at EL3 exception level\n\u003e 2. BL2 running as BootRoM\n\nYes about 1. No about 2. As I tried to explain above, BL2 would *not* be a ROM image, but rather a mutable one which runs after the Boot ROM. That is the original use case of BL2_AT_EL3 build flag AFAIK. Maybe the original commit message will help explaining that better / in another way:\n\nhttps://git.trustedfirmware.org/TF-A/trusted-firmware-a.git/commit/?id\u003db1d27b484f4172542eca074fdac42ffd13736a0f\n\nPerhaps the confusion comes from the fact that on FVP, when using BL2_AT_EL3, BL2 *is* the first image to run. But AFAIU this was a testing artefact. See the commit message here, where we explain that we do not have non-TF-A Boot ROM and so we emulate this through model parameters that load BL2 in memory (something that the boot ROM would normally do):\n\nhttps://git.trustedfirmware.org/TF-A/trusted-firmware-a.git/commit/?id\u003d81528dbcf12882fae1d9a6e43b17f8e2abce32d9\n\n\u003e Can we use BL2_RUNNING_AT_EL3(1) and BL2_AS_BOOT_ROM(2). Valid combinations would be \n\u003e BL2_AS_BOOT_ROM mandates enabling BL2_RUNNING_AT_EL3 \n\u003e ENABLE_RME mandates BL2_RUNNING_AT_EL3\n\u003e Stop the build if BL2_RUNNING_AT_EL3 with ENABLE_RME is enabled.\n\nBL2_AS_BOOT_ROM would not be a good name, for the reasons I mentioned above. It should rather be the opposite. Even though I don\u0027t like this name, let\u0027s just say we call is BL2_WITHOUT_TFA_BL1. Then I think the valid combinations would be:\n\nBL2_WITHOUT_TFA_BL1 mandates BL2_RUNNING_AT_EL3.\nENABLE_RME mandates BL2_RUNNING_AT_EL3 (Arm CCA security requirement).\nStop the build if ENABLE_RME and BL2_WITHOUT_TFA_BL1 are both enabled (because that\u0027s not something we support right now, but maybe we will one day).\n\nDoes that help?",
      "parentUuid": "4250870c_d3724da4",
      "revId": "32fa427682e7817d6848e28f356b065b46982565",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e75a79f5_bb601ffa",
        "filename": "/COMMIT_MSG",
        "patchSetId": 15
      },
      "lineNbr": 0,
      "author": {
        "id": 1000102
      },
      "writtenOn": "2023-02-14T10:52:35Z",
      "side": 1,
      "message": "Thanks Sandrine, its now all clear.\n\nI think we are happy with the first name BL2_RUNNING_AT_EL3 for second one, does BL2_AS_TFA_ENTRY_POINT looks good?",
      "parentUuid": "eb9788a9_db869fae",
      "revId": "32fa427682e7817d6848e28f356b065b46982565",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "11a05e84_4d1049f3",
        "filename": "/COMMIT_MSG",
        "patchSetId": 15
      },
      "lineNbr": 0,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2023-02-14T12:33:09Z",
      "side": 1,
      "message": "Yes, I think BL2_AS_TFA_ENTRY_POINT is reasonably good :)",
      "parentUuid": "e75a79f5_bb601ffa",
      "revId": "32fa427682e7817d6848e28f356b065b46982565",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2ce79e12_0f820a1a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 15
      },
      "lineNbr": 0,
      "author": {
        "id": 1000279
      },
      "writtenOn": "2023-02-15T15:27:11Z",
      "side": 1,
      "message": "All points agreed.\nRenamed BL2_AT_EL3 to BL2_AS_ENTRY_POINT\nBL2_RUNNING_AT_EL3 define added.\nCompilation error with both BL2_AS_ENTRY_POINT\u003d1 and ENABLE_RME\u003d1 added to the Makefile",
      "parentUuid": "11a05e84_4d1049f3",
      "revId": "32fa427682e7817d6848e28f356b065b46982565",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "58ed7c2e_aacfc6da",
        "filename": "/COMMIT_MSG",
        "patchSetId": 15
      },
      "lineNbr": 0,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2023-02-16T08:37:36Z",
      "side": 1,
      "message": "\u003e Renamed BL2_AT_EL3 to BL2_AS_ENTRY_POINT\n\nActually we agreed on BL2_AS_TFA_ENTRY_POINT. The \"TFA\" part of the name is very important because it emphasizes that BL2 is the first image *from the TF-A project* to be executed on the target, but there is one other image which gets executed before that. The latter image is the entry point in my view, not TF-A BL2.\n\nIf this build option name does not make it clear enough, we should try to find something else.",
      "parentUuid": "2ce79e12_0f820a1a",
      "revId": "32fa427682e7817d6848e28f356b065b46982565",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9518f8e6_bb9765ea",
        "filename": "/COMMIT_MSG",
        "patchSetId": 15
      },
      "lineNbr": 10,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2023-02-13T13:21:18Z",
      "side": 1,
      "message": "Chris said this should be a footer, i.e. should be moved towards the end of the commit message. I don\u0027t know whether putting it at the start of the commit message like that will cause an issue with the changelog generation. Could you please double-check? Or can somebody answer this question off the top of their head?",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 11
      },
      "revId": "32fa427682e7817d6848e28f356b065b46982565",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "60240a95_833bf9bb",
        "filename": "/COMMIT_MSG",
        "patchSetId": 15
      },
      "lineNbr": 10,
      "author": {
        "id": 1000206
      },
      "writtenOn": "2023-02-13T14:13:39Z",
      "side": 1,
      "message": "Sandrine\u0027s right - for this to be picked up correctly it needs to be a footer.",
      "parentUuid": "9518f8e6_bb9765ea",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 11
      },
      "revId": "32fa427682e7817d6848e28f356b065b46982565",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ad8cb9c2_bf331fb2",
        "filename": "/COMMIT_MSG",
        "patchSetId": 15
      },
      "lineNbr": 10,
      "author": {
        "id": 1000279
      },
      "writtenOn": "2023-02-15T15:27:11Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "60240a95_833bf9bb",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 11
      },
      "revId": "32fa427682e7817d6848e28f356b065b46982565",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1a89f794_08a9a56c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 15
      },
      "lineNbr": 13,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2023-02-13T13:21:18Z",
      "side": 1,
      "message": "I suppose you meant BL1, not EL1?\n\nSuggest rewording the sentence as:\n\nHowever, this name is primarily meant to be used for 2 world systems, and caters for platforms where BL2 needs to execute at the highest exception level without any dependancy on TF-A BL1. This enables platforms which already have a non-TF-A Boot ROM to directly load and execute BL2  without need for BL1.",
      "range": {
        "startLine": 13,
        "startChar": 27,
        "endLine": 13,
        "endChar": 30
      },
      "revId": "32fa427682e7817d6848e28f356b065b46982565",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5cbd0691_5f7023b3",
        "filename": "/COMMIT_MSG",
        "patchSetId": 15
      },
      "lineNbr": 13,
      "author": {
        "id": 1000279
      },
      "writtenOn": "2023-02-15T15:27:11Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1a89f794_08a9a56c",
      "range": {
        "startLine": 13,
        "startChar": 27,
        "endLine": 13,
        "endChar": 30
      },
      "revId": "32fa427682e7817d6848e28f356b065b46982565",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c60529bd_89e8eadc",
        "filename": "Makefile",
        "patchSetId": 15
      },
      "lineNbr": 0,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2023-02-13T13:21:18Z",
      "side": 1,
      "message": "I think we need a warning message (or even an error message) to flag usages of BL2_AT_EL3. This could say something like, \"Warning: BL2_AT_EL3 option is deprecated and will have no effect going forward. Please use BL2_AT_EL3_TWO_WORLD or ENABLE_RME instead.\" I would like this change to be obvious for whoever attempts to compile TF-A with this build option renaming.",
      "revId": "32fa427682e7817d6848e28f356b065b46982565",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    }
  ]
}