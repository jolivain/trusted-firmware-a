{
  "comments": [
    {
      "key": {
        "uuid": "cd98fee9_7c10dc9a",
        "filename": "plat/arm/board/fvp/fvp_bl31_setup.c",
        "patchSetId": 14
      },
      "lineNbr": 24,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2020-06-24T10:19:39Z",
      "side": 1,
      "message": "I was looking at this function documentation in the porting guide and noticed it still says:\n\n arg1 - Points to load address of SOC_FW_CONFIG if present\n\nIf I am not mistaken, this is no longer the case. bl31_early_platform_setup2() now receives the load address of the FW_CONFIG file in arg1 (at least when BL31 is not the first image to run). Could you please confirm whether the doc is indeed wrong/out-dated and fix it if needed?",
      "range": {
        "startLine": 24,
        "startChar": 1,
        "endLine": 24,
        "endChar": 64
      },
      "revId": "536f872af7a53519deb9bec92359b2b73bee8c7a",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e73b93c9_4621e1d4",
        "filename": "plat/arm/board/fvp/fvp_bl31_setup.c",
        "patchSetId": 14
      },
      "lineNbr": 24,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2020-06-24T11:31:44Z",
      "side": 1,
      "message": "Currently, this change is being done only for ARM FVP platforms and seems like not common change to land in porting guide. \nCan I put this as note separately in porting-guide that arg1 - Points to load address of FW_CONFIG in case of ARM FVP platform?",
      "parentUuid": "cd98fee9_7c10dc9a",
      "range": {
        "startLine": 24,
        "startChar": 1,
        "endLine": 24,
        "endChar": 64
      },
      "revId": "536f872af7a53519deb9bec92359b2b73bee8c7a",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "62fddf6b_a02b1db8",
        "filename": "plat/arm/board/fvp/fvp_bl31_setup.c",
        "patchSetId": 14
      },
      "lineNbr": 24,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2020-06-24T14:30:57Z",
      "side": 1,
      "message": "We need to update porting guide for the documentation of this function \u0027bl2_early_platform_setup2\u0027 also which incorrectly mentions.about the usage of arg0 \narg0 - Points to load address of HW_CONFIG if present\n\nBetter will push one more document patch which fixes arg usage in BL2 and BL31 early setup function.",
      "parentUuid": "e73b93c9_4621e1d4",
      "range": {
        "startLine": 24,
        "startChar": 1,
        "endLine": 24,
        "endChar": 64
      },
      "revId": "536f872af7a53519deb9bec92359b2b73bee8c7a",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "de252054_8169e0e4",
        "filename": "plat/arm/board/fvp/fvp_bl31_setup.c",
        "patchSetId": 14
      },
      "lineNbr": 24,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2020-06-25T08:59:48Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "62fddf6b_a02b1db8",
      "range": {
        "startLine": 24,
        "startChar": 1,
        "endLine": 24,
        "endChar": 64
      },
      "revId": "536f872af7a53519deb9bec92359b2b73bee8c7a",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f96f9cf2_7532daee",
        "filename": "plat/arm/board/fvp/fvp_bl31_setup.c",
        "patchSetId": 14
      },
      "lineNbr": 26,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2020-06-24T10:19:39Z",
      "side": 1,
      "message": "If I am not mistaken, bl31_early_platform_setup2() runs before the MMU is enabled. It doesn\u0027t sound like a good idea to me to parse device trees with the MMU off (and thus caches off), this is likely to be very slow... Could we delay this and move this code later in the boot flow?",
      "range": {
        "startLine": 26,
        "startChar": 1,
        "endLine": 26,
        "endChar": 35
      },
      "revId": "536f872af7a53519deb9bec92359b2b73bee8c7a",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7764cd48_6b70ae40",
        "filename": "plat/arm/board/fvp/fvp_bl31_setup.c",
        "patchSetId": 14
      },
      "lineNbr": 26,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2020-06-24T11:31:44Z",
      "side": 1,
      "message": "I thought of moving this in code later (after MMU ON) but then I checked in BL2 code where fconf_populate gets called in setup function only (may be with some intention) Ref:plat/arm/common/arm_bl2_setup.c and hence did changes in BL31 on similar lines.\n\nAgree with your explanation. We need to do changes in both BL2 and Bl31. Are you seeing any harm apart from cache stuff to retain this call as it is now?",
      "parentUuid": "f96f9cf2_7532daee",
      "range": {
        "startLine": 26,
        "startChar": 1,
        "endLine": 26,
        "endChar": 35
      },
      "revId": "536f872af7a53519deb9bec92359b2b73bee8c7a",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c31b6244_4e1df26b",
        "filename": "plat/arm/board/fvp/fvp_bl31_setup.c",
        "patchSetId": 14
      },
      "lineNbr": 26,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2020-06-25T08:59:48Z",
      "side": 1,
      "message": "\u003e I thought of moving this in code later (after MMU ON) but then I checked in BL2 code where fconf_populate gets called in setup function only (may be with some intention) Ref:plat/arm/common/arm_bl2_setup.c and hence did changes in BL31 on similar lines.\n\nYou\u0027re right, there is the same issue in BL2! Well spotted!\n\n\u003e Agree with your explanation. We need to do changes in both BL2 and Bl31. Are you seeing any harm apart from cache stuff to retain this call as it is now?\n\nNo, I don\u0027t see any harm with the code right now, apart from the fact it\u0027s executed with the D-cache off. But that\u0027s a pretty big deal IMO! And it just sounds even more wrong to me here because arm_bl31_early_platform_setup() below doesn\u0027t even use the hardware and SoC config files, so we\u0027re taking a performance penalty parsing the firmware config file just to retrieve some information that won\u0027t even be used...\n\nAs you say, this needs to be reworked in the near future. For the time being, I guess it\u0027s OK to keep the code as is, as it does the job from a functional point of view.",
      "parentUuid": "7764cd48_6b70ae40",
      "range": {
        "startLine": 26,
        "startChar": 1,
        "endLine": 26,
        "endChar": 35
      },
      "revId": "536f872af7a53519deb9bec92359b2b73bee8c7a",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "96ff496b_59f976e6",
        "filename": "plat/arm/board/fvp/fvp_bl31_setup.c",
        "patchSetId": 14
      },
      "lineNbr": 34,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2020-06-25T03:33:17Z",
      "side": 1,
      "message": "Also, \u0027arm_bl31_early_platform_setup\u0027 function expect \u0027soc_fw_config\u0027 address as argument and hence \u0027soc_fw_config\u0027 address need to be retrieved at earliest i.e. before MMU on as per current architecture of the code.\n\nIMO, we need to re-architect this code so that we can delay \u0027fconf_populate\u0027 after MMU gets ON. Let me know your thoughts?",
      "range": {
        "startLine": 34,
        "startChar": 1,
        "endLine": 34,
        "endChar": 30
      },
      "revId": "536f872af7a53519deb9bec92359b2b73bee8c7a",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5658f124_20c8c514",
        "filename": "plat/arm/board/fvp/fvp_bl31_setup.c",
        "patchSetId": 14
      },
      "lineNbr": 34,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2020-06-25T08:59:48Z",
      "side": 1,
      "message": "\u003e Also, \u0027arm_bl31_early_platform_setup\u0027 function expect \u0027soc_fw_config\u0027 address as argument and hence \u0027soc_fw_config\u0027 address need to be retrieved at earliest i.e. before MMU on as per current architecture of the code.\n\nAgree, arm_bl31_early_platform_setup() expects \u0027soc_fw_config\u0027 address as argument but does not even use it...\n\n\u003e IMO, we need to re-architect this code so that we can delay \u0027fconf_populate\u0027 after MMU gets ON. Let me know your thoughts?\n\nYes, I agree, let\u0027s investigate this once this patch stack is merged.",
      "parentUuid": "96ff496b_59f976e6",
      "range": {
        "startLine": 34,
        "startChar": 1,
        "endLine": 34,
        "endChar": 30
      },
      "revId": "536f872af7a53519deb9bec92359b2b73bee8c7a",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3b31f3a2_dff97ad9",
        "filename": "plat/arm/common/arm_image_load.c",
        "patchSetId": 14
      },
      "lineNbr": 151,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2020-06-24T10:19:39Z",
      "side": 1,
      "message": "Is that not a duplicate of get_bl_params_node_index() (see common/desc_image_load.c)? It looks very similar.",
      "range": {
        "startLine": 151,
        "startChar": 0,
        "endLine": 151,
        "endChar": 73
      },
      "revId": "536f872af7a53519deb9bec92359b2b73bee8c7a",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d56f8050_120423c1",
        "filename": "plat/arm/common/arm_image_load.c",
        "patchSetId": 14
      },
      "lineNbr": 151,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2020-06-24T11:31:44Z",
      "side": 1,
      "message": "Thanks for pointing this out. I will remove this and use existing one.\nSomehow I referred this BL1 API: bl1_plat_get_image_desc to create similar one for BL2.",
      "parentUuid": "3b31f3a2_dff97ad9",
      "range": {
        "startLine": 151,
        "startChar": 0,
        "endLine": 151,
        "endChar": 73
      },
      "revId": "536f872af7a53519deb9bec92359b2b73bee8c7a",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    }
  ]
}