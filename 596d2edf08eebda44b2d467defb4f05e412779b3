{
  "comments": [
    {
      "key": {
        "uuid": "a30ea399_c0c57588",
        "filename": "lib/psci/psci_system_off.c",
        "patchSetId": 1
      },
      "lineNbr": 17,
      "author": {
        "id": 1000098
      },
      "writtenOn": "2019-10-24T20:06:05Z",
      "side": 1,
      "message": "Hi Sandeep, \nThanks for the patch. I was wondering if you can put an assertion in this function to make sure the current CPU is the last man standing. \nassert(psci_is_last_on_cpu() \u003d\u003d 1U);",
      "revId": "596d2edf08eebda44b2d467defb4f05e412779b3",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cea21bd6_0f3366c8",
        "filename": "lib/psci/psci_system_off.c",
        "patchSetId": 1
      },
      "lineNbr": 17,
      "author": {
        "id": 1000119
      },
      "writtenOn": "2019-10-25T06:53:25Z",
      "side": 1,
      "message": "In case of linux (reboot) the secondary cores are not using PSCI\nbut they just wait in \"YIELD\" once IPI_CPU_STOP is triggered.\nSo system_off/system_reset/system_reset2 are invoked from the boot cpu but the other cores are not expected to be in sane state. ie. this is not the last core in psci view.\n\nHowever I am not sure if system_off/system_reset/system_reset2 were deliberately designed not to do a graceful power down sequence Or if it can have any side effect because the other cores and clusters are still alive(cluster DVM on, SMP bit on, caches on .. and in YIELD) ?",
      "parentUuid": "a30ea399_c0c57588",
      "revId": "596d2edf08eebda44b2d467defb4f05e412779b3",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8f182311_03650d53",
        "filename": "lib/psci/psci_system_off.c",
        "patchSetId": 1
      },
      "lineNbr": 17,
      "author": {
        "id": 1000098
      },
      "writtenOn": "2019-10-25T15:06:20Z",
      "side": 1,
      "message": "Section 5.10.3 of PSCI spec states that other cores must be in a known(sane) state. It also suggests using CPU_OFF on other cores to make sure they are in a known state. \nSection 5.10.1 states that SYSTEM_OFF must completely remove the power from highest level. Hence any other core or cluster will also be shutdown. \nI am not familiar with IPI_CPU_STOP and with the Power management kernel in Linux. It seems logical to turn off secondary cores before SYSTEM_OFF because SYSTEM_OFF is going to shutdown the entire system and any later start must be a cold boot from PSCI view. \nLet me know if you disagree.",
      "parentUuid": "cea21bd6_0f3366c8",
      "revId": "596d2edf08eebda44b2d467defb4f05e412779b3",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "45726f30_031c1d7a",
        "filename": "lib/psci/psci_system_off.c",
        "patchSetId": 1
      },
      "lineNbr": 17,
      "author": {
        "id": 1000119
      },
      "writtenOn": "2019-10-25T16:25:15Z",
      "side": 1,
      "message": "psci_system_off and psci_system_reset/reset2 are used by\nlinux to do a shutdown and yes the later start is a cold\nboot. But what linux assumes is the secondary cores can be\nabruptly switched off without any issues in case of \nreboot/poweroff.\nI understand a clean shutdown on many core server systems\nwill increase the reboot time significantly which is why\nits not acceptable by community.\nIn case you want to see some details here:\nhttps://lkml.org/lkml/2019/1/18/16\n\nSecondly, lets assume one of the secondary core is\nstuck(eg: I masked) and not responding to IPI_CPU_STOP. it\nwont do a psci call to powerdown self.\nand when the boot cpu (last core) invokes psci_sys_off,\nfrom psci perspective its not the last core.",
      "parentUuid": "8f182311_03650d53",
      "revId": "596d2edf08eebda44b2d467defb4f05e412779b3",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9e9867a6_f2070226",
        "filename": "lib/psci/psci_system_off.c",
        "patchSetId": 1
      },
      "lineNbr": 18,
      "author": {
        "id": 1000119
      },
      "writtenOn": "2019-10-25T16:25:15Z",
      "side": 1,
      "message": "Why I made this patch is I think from PSCI perspective sys_off and sys_reset should do a proper power down sequence for the last core and cluster. However it cant possibly do anything for the other cores.(especially the hung core case)",
      "revId": "596d2edf08eebda44b2d467defb4f05e412779b3",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "dd9304b6_717ac5bf",
        "filename": "lib/psci/psci_system_off.c",
        "patchSetId": 1
      },
      "lineNbr": 30,
      "author": {
        "id": 1000098
      },
      "writtenOn": "2019-10-24T20:06:05Z",
      "side": 1,
      "message": "psci_do_pwrdown_sequence((unsigned int) PLAT_MAX_PWR_LVL);",
      "revId": "596d2edf08eebda44b2d467defb4f05e412779b3",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a9b580ed_70fb707c",
        "filename": "lib/psci/psci_system_off.c",
        "patchSetId": 1
      },
      "lineNbr": 30,
      "author": {
        "id": 1000119
      },
      "writtenOn": "2019-10-25T06:53:25Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "dd9304b6_717ac5bf",
      "revId": "596d2edf08eebda44b2d467defb4f05e412779b3",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "29c97822_f885985e",
        "filename": "lib/psci/psci_system_off.c",
        "patchSetId": 1
      },
      "lineNbr": 50,
      "author": {
        "id": 1000098
      },
      "writtenOn": "2019-10-24T20:06:05Z",
      "side": 1,
      "message": "same as above.",
      "revId": "596d2edf08eebda44b2d467defb4f05e412779b3",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a4466555_873ee7b6",
        "filename": "lib/psci/psci_system_off.c",
        "patchSetId": 1
      },
      "lineNbr": 50,
      "author": {
        "id": 1000119
      },
      "writtenOn": "2019-10-25T06:53:25Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "29c97822_f885985e",
      "revId": "596d2edf08eebda44b2d467defb4f05e412779b3",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b1a6d33f_0e97dac0",
        "filename": "lib/psci/psci_system_off.c",
        "patchSetId": 1
      },
      "lineNbr": 83,
      "author": {
        "id": 1000119
      },
      "writtenOn": "2019-10-25T06:53:25Z",
      "side": 1,
      "message": "I missed to add it here as well.",
      "revId": "596d2edf08eebda44b2d467defb4f05e412779b3",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": false
    }
  ]
}