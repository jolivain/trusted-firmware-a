{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "6efa7ed4_446a86fc",
        "filename": "plat/arm/board/fvp/fdts/optee_sp_manifest.dts",
        "patchSetId": 1
      },
      "lineNbr": 25,
      "author": {
        "id": 1000114
      },
      "writtenOn": "2022-04-12T22:45:36Z",
      "side": 1,
      "message": "this is the problem i have in short :) i dont want the dts file to change if the sptool changes :) this is entirely avoidable.",
      "range": {
        "startLine": 25,
        "startChar": 22,
        "endLine": 25,
        "endChar": 28
      },
      "revId": "2a9e767c45e6dcaa3c6f3e8bb42d173b444d036f",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "cf56285e_6f43b73a",
        "filename": "plat/arm/board/fvp/fdts/optee_sp_manifest.dts",
        "patchSetId": 1
      },
      "lineNbr": 25,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2022-04-20T07:06:07Z",
      "side": 1,
      "message": "Please let\u0027s defer to an improvement on top of this patchstack.\nScope of current patchstack is introducing the FF-A v1.1 boot protocol. It doesn\u0027t functionally change the existing build flow.",
      "parentUuid": "6efa7ed4_446a86fc",
      "range": {
        "startLine": 25,
        "startChar": 22,
        "endLine": 25,
        "endChar": 28
      },
      "revId": "2a9e767c45e6dcaa3c6f3e8bb42d173b444d036f",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "106d3730_d1259c1d",
        "filename": "plat/arm/board/fvp/fdts/optee_sp_manifest.dts",
        "patchSetId": 1
      },
      "lineNbr": 25,
      "author": {
        "id": 1000114
      },
      "writtenOn": "2022-04-20T17:59:39Z",
      "side": 1,
      "message": "wait, dont all existing SPs have to go and change their entrypoint offset now and hence their layout? i dont see how existing SPs that dont use the boot protocol can remain unchanged...",
      "parentUuid": "cf56285e_6f43b73a",
      "range": {
        "startLine": 25,
        "startChar": 22,
        "endLine": 25,
        "endChar": 28
      },
      "revId": "2a9e767c45e6dcaa3c6f3e8bb42d173b444d036f",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ce3949ee_e8bacddd",
        "filename": "plat/arm/board/fvp/fdts/optee_sp_manifest.dts",
        "patchSetId": 1
      },
      "lineNbr": 25,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2022-04-20T18:34:30Z",
      "side": 1,
      "message": "Hi Raghu,\n\u003e all existing SPs\nCan you advise about which *existing* SPs? In which context and build environment?\nRealistically any SP willing to use FF-A v1.1 features will have to be rebuilt, right?\nThis is what happens with build flows consuming tip of upstream components. I\u0027m not sure about which kind of (binary) compatibility issue we\u0027re dealing with here.\nThe argument is that this patch stack introducing the boot protocol is not drastically changing how manifests are consumed by the build flow since early days. And somehow it preserves the legacy. Admittedly for this patch stack values in test partition manifests change, but the manifest format is unchanged right (apart by adding the necessary/required boot protocol node!) ?\nPartitions manifests in the test env. are very fluid and changes happened several times (upstream again) by introducing/removing new fields for test needs and also following spec changes (e.g. managed-exit field, adding/removing mem regions, adding device region interrupt lists, etc.) \nCan you advise of a solution fulfilling the three queries/bullets mentioned here? https://review.trustedfirmware.org/c/TF-A/trusted-firmware-a/+/14507/comment/8a900a84_3a1722eb/\nAnd why an improvement cannot be implemented on top of this patch stack, with the deliberate intent to enhance the build flow (which again is not the scope of this patch stack)?",
      "parentUuid": "106d3730_d1259c1d",
      "range": {
        "startLine": 25,
        "startChar": 22,
        "endLine": 25,
        "endChar": 28
      },
      "revId": "2a9e767c45e6dcaa3c6f3e8bb42d173b444d036f",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8865778b_5c9994ab",
        "filename": "plat/arm/board/fvp/fdts/optee_sp_manifest.dts",
        "patchSetId": 1
      },
      "lineNbr": 25,
      "author": {
        "id": 1000114
      },
      "writtenOn": "2022-04-20T19:20:02Z",
      "side": 1,
      "message": "Right, the test Sps can change all day long, im thinking company internal sps or SPs already in production. There are many such SPs, and there may be many independent teams. An update to hafnium and TF-A should not mean SP developers have to go rebuild the SPs and change layout. Now, if we update hafnium and tfa to this SP tool, we have to fork the old SP tool separately and continue to support that. For SPs that dont use the boot info protocol, i dont want anything to change. None of our SPs use boot info at the moment, and we may not use it in the future either.\nTF-A and hafnium have to be independent of SPs, thats the whole point of FFA...So saying SPs have to be recompiled because hafnium or tf-a got updated does not work. Backward compatibility has to be maintained. Also update to packaging, should not result in changes to hafnium code and again, the code and data strcutures need to be backward compatible..This is a general statement, the spec itself has to be backward compatible and cannot break things that are already in the field..\nAs for alternate solution that meet your 3 bullets, i already mentioned we should dynamically calculate and patch image offsets. To solve the issue of breaking changes, Effectively, we need to make the sp pkg layout backward compatible and extensible. It is not today, but given new things will get added, we need to be a little more careful about how we dont break existing packages..We need to bump versoin the sp pkg header structure and have hafnium deal with both versions of sp pkg..We can also treat the boot info page as an addition field in sp-pkg_header in say version 2 of the structure, as opposed to hafnium assuming it is the same as load address..that would also help not break existing SPs..\n\nWe can do it as an improvement, but i was worried by your comment that it does not change existing functionality. it seems like it does..do you agree?",
      "parentUuid": "ce3949ee_e8bacddd",
      "range": {
        "startLine": 25,
        "startChar": 22,
        "endLine": 25,
        "endChar": 28
      },
      "revId": "2a9e767c45e6dcaa3c6f3e8bb42d173b444d036f",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b24dd755_5637442e",
        "filename": "plat/arm/board/fvp/fdts/optee_sp_manifest.dts",
        "patchSetId": 1
      },
      "lineNbr": 25,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2022-05-04T05:20:58Z",
      "side": 1,
      "message": "Hi Raghu,\nI believe this discussion progressed separately since 2 weeks, just for the sake of clarifying current thread, added few comments below:\n\u003e None of our SPs use boot info at the moment, and we may not use it in the future either. TF-A and hafnium have to be independent of SPs, thats the whole point of FFA.\nOne of the motivation for the boot protocol as it is today is to pass the SP manifest address at boot time. This was expressed as a miss some time ago on the ML. Without it, an non-FFA/impdef trick has to be added either to Hafnium upstream code and/or SPs.\n\n\u003e Backward compatibility has to be maintained.\nJoao added this change to Hafnium\u0027s patch stack, hopefully it addresses immediate concerns:\nhttps://review.trustedfirmware.org/c/hafnium/hafnium/+/14998\n\n\u003e i already mentioned we should dynamically calculate and patch image offsets. \nAgreed to resolve this specific issue as new changes following current patch stack.",
      "parentUuid": "8865778b_5c9994ab",
      "range": {
        "startLine": 25,
        "startChar": 22,
        "endLine": 25,
        "endChar": 28
      },
      "revId": "2a9e767c45e6dcaa3c6f3e8bb42d173b444d036f",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    }
  ]
}