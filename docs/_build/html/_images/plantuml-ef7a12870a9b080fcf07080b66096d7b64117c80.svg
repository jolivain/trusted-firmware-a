<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1002px" preserveAspectRatio="none" style="width:1011px;height:1002px;" version="1.1" viewBox="0 0 1011 1002" width="1011px" zoomAndPan="magnify"><defs><filter height="300%" id="f1pqarv01i7jv6" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f1pqarv01i7jv6)" height="276.4609" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="427" y="248.2266"/><rect fill="#FFFFFF" filter="url(#f1pqarv01i7jv6)" height="182.9297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="427" y="662.0234"/><rect fill="#FFFFFF" filter="url(#f1pqarv01i7jv6)" height="861.0547" style="stroke: #000000; stroke-width: 2.0;" width="624" x="298" y="84.4297"/><rect fill="#FFFFFF" filter="url(#f1pqarv01i7jv6)" height="829.9219" style="stroke: #000000; stroke-width: 2.0;" width="604" x="308" y="108.5625"/><rect fill="#FFFFFF" filter="url(#f1pqarv01i7jv6)" height="315.5938" style="stroke: #000000; stroke-width: 2.0;" width="560" x="342" y="202.0938"/><rect fill="#FFFFFF" height="413.7969" style="stroke: none; stroke-width: 1.0;" width="604" x="308" y="524.6875"/><rect fill="#FFFFFF" filter="url(#f1pqarv01i7jv6)" height="315.5938" style="stroke: #000000; stroke-width: 2.0;" width="584" x="318" y="615.8906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="431.5" x2="431.5" y1="38.2969" y2="962.4844"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="847" x2="847" y1="38.2969" y2="962.4844"/><rect fill="#FEFECE" filter="url(#f1pqarv01i7jv6)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="370.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="377.5" y="22.9951">arm_io_storage</text><rect fill="#FEFECE" filter="url(#f1pqarv01i7jv6)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="119" x="370.5" y="961.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="105" x="377.5" y="981.4795">arm_io_storage</text><rect fill="#FEFECE" filter="url(#f1pqarv01i7jv6)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="86" x="802" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="809" y="22.9951">io_storage</text><rect fill="#FEFECE" filter="url(#f1pqarv01i7jv6)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="86" x="802" y="961.4844"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="72" x="809" y="981.4795">io_storage</text><rect fill="#FFFFFF" filter="url(#f1pqarv01i7jv6)" height="276.4609" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="427" y="248.2266"/><rect fill="#FFFFFF" filter="url(#f1pqarv01i7jv6)" height="182.9297" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="427" y="662.0234"/><polygon fill="#A80036" points="420,65.2969,430,69.2969,420,73.2969,424,69.2969" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3" x2="426" y1="69.2969" y2="69.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="405" x="10" y="64.3638">plat_get_image_source(image_id, &amp;dev_handle, &amp;image_spec)</text><rect fill="none" height="861.0547" style="stroke: #000000; stroke-width: 2.0;" width="624" x="298" y="84.4297"/><polygon fill="#EEEEEE" points="298,84.4297,584,84.4297,584,91.4297,574,101.4297,298,101.4297,298,84.4297" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="241" x="313" y="97.4966">init and check device (image_id)</text><rect fill="none" height="829.9219" style="stroke: #000000; stroke-width: 2.0;" width="604" x="308" y="108.5625"/><polygon fill="#EEEEEE" points="308,108.5625,372,108.5625,372,115.5625,362,125.5625,308,125.5625,308,108.5625" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="323" y="121.6294">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="173" x="387" y="120.7729">[image_id = BL2_IMAGE_ID]</text><polygon fill="#FBFB77" filter="url(#f1pqarv01i7jv6)" points="339,130.6953,339,185.6953,521,185.6953,521,140.6953,511,130.6953,339,130.6953" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="511" x2="511" y1="130.6953" y2="140.6953"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="521" x2="511" y1="140.6953" y2="140.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="161" x="345" y="147.7622">get BL2_IMAGE_ID policy:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="345" y="162.895">- fip_dev_handle</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="73" x="345" y="178.0278">- open_fip()</text><rect fill="none" height="315.5938" style="stroke: #000000; stroke-width: 2.0;" width="560" x="342" y="202.0938"/><polygon fill="#EEEEEE" points="342,202.0938,412,202.0938,412,209.0938,402,219.0938,342,219.0938,342,202.0938" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="357" y="215.1606">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="109" x="427" y="214.3042">[policy-&gt;check()]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="479" y1="235.3594" y2="235.3594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="479" x2="479" y1="235.3594" y2="248.3594"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="438" x2="479" y1="248.3594" y2="248.3594"/><polygon fill="#A80036" points="448,244.3594,438,248.3594,448,252.3594,444,248.3594" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="444" y="230.2935">open_fip(spec)</text><polygon fill="#A80036" points="835,278.3594,845,282.3594,835,286.3594,839,282.3594" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="437" x2="841" y1="282.3594" y2="282.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="444" y="277.4263">io_dev_init(fip_dev_handle, FIP_IMAGE_ID)</text><rect fill="#FFFFFF" filter="url(#f1pqarv01i7jv6)" height="40.2656" style="stroke: #000000; stroke-width: 2.0;" width="151" x="799" y="290.4922"/><polygon fill="#EEEEEE" points="799,290.4922,865,290.4922,865,297.4922,855,307.4922,799,307.4922,799,290.4922" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="812" y="304.5591">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="143" x="805" y="323.5591">dev_init() on fip device</text><polygon fill="#A80036" points="835,352.7578,845,356.7578,835,360.7578,839,356.7578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="437" x2="841" y1="356.7578" y2="356.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="338" x="444" y="351.8247">io_open(fip_dev_handle, spec, &amp;local_image_handle)</text><rect fill="#FFFFFF" filter="url(#f1pqarv01i7jv6)" height="40.2656" style="stroke: #000000; stroke-width: 2.0;" width="152" x="799" y="364.8906"/><polygon fill="#EEEEEE" points="799,364.8906,865,364.8906,865,371.8906,855,381.8906,799,381.8906,799,364.8906" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="812" y="378.9575">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="805" y="397.9575">io_open() on fip device</text><polygon fill="#A80036" points="835,427.1563,845,431.1563,835,435.1563,839,431.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="437" x2="841" y1="431.1563" y2="431.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="444" y="426.2231">io_close(local_image_handle)</text><rect fill="#FFFFFF" filter="url(#f1pqarv01i7jv6)" height="40.2656" style="stroke: #000000; stroke-width: 2.0;" width="153" x="799" y="439.2891"/><polygon fill="#EEEEEE" points="799,439.2891,865,439.2891,865,446.2891,855,456.2891,799,456.2891,799,439.2891" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="812" y="453.356">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="145" x="805" y="472.356">io_close() on fip device</text><polygon fill="#FBFB77" filter="url(#f1pqarv01i7jv6)" points="362,489.5547,501,489.5547,511,500.5547,501,512.5547,362,512.5547,352,500.5547,362,489.5547" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="364" y="505.6216">fip_dev_handle ready</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="308" x2="912" y1="525.6875" y2="525.6875"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="169" x="313" y="535.8979">[image_id = FIP_IMAGE_ID]</text><polygon fill="#FBFB77" filter="url(#f1pqarv01i7jv6)" points="342,544.4922,342,599.4922,518,599.4922,518,554.4922,508,544.4922,342,544.4922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="508" x2="508" y1="544.4922" y2="554.4922"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="518" x2="508" y1="554.4922" y2="554.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="348" y="561.5591">get FIP_IMAGE_ID policy:</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="348" y="576.6919">- memmap_dev_handle</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="121" x="348" y="591.8247">- open_memmap()</text><rect fill="none" height="315.5938" style="stroke: #000000; stroke-width: 2.0;" width="584" x="318" y="615.8906"/><polygon fill="#EEEEEE" points="318,615.8906,388,615.8906,388,622.8906,378,632.8906,318,632.8906,318,615.8906" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="333" y="628.9575">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="109" x="403" y="628.1011">[policy-&gt;check()]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="479" y1="649.1563" y2="649.1563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="479" x2="479" y1="649.1563" y2="662.1563"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="438" x2="479" y1="662.1563" y2="662.1563"/><polygon fill="#A80036" points="448,658.1563,438,662.1563,448,666.1563,444,662.1563" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="142" x="444" y="644.0903">open_memmap(spec)</text><polygon fill="#A80036" points="835,692.1563,845,696.1563,835,700.1563,839,696.1563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="437" x2="841" y1="696.1563" y2="696.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="262" x="444" y="691.2231">io_dev_init(memmap_dev_handle, NULL)</text><rect fill="#FFFFFF" filter="url(#f1pqarv01i7jv6)" height="40.2656" style="stroke: #000000; stroke-width: 2.0;" width="199" x="799" y="704.2891"/><polygon fill="#EEEEEE" points="799,704.2891,865,704.2891,865,711.2891,855,721.2891,799,721.2891,799,704.2891" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="812" y="718.356">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="191" x="805" y="737.356">dev_init() on memmap device</text><polygon fill="#A80036" points="835,766.5547,845,770.5547,835,774.5547,839,770.5547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="437" x2="841" y1="770.5547" y2="770.5547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="386" x="444" y="765.6216">io_open(memmap_dev_handle, spec, &amp;local_image_handle)</text><rect fill="#FFFFFF" filter="url(#f1pqarv01i7jv6)" height="40.2656" style="stroke: #000000; stroke-width: 2.0;" width="200" x="799" y="778.6875"/><polygon fill="#EEEEEE" points="799,778.6875,865,778.6875,865,785.6875,855,795.6875,799,795.6875,799,778.6875" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="812" y="792.7544">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="192" x="805" y="811.7544">io_open() on memmap device</text><polygon fill="#A80036" points="835,840.9531,845,844.9531,835,848.9531,839,844.9531" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="432" x2="841" y1="844.9531" y2="844.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="187" x="439" y="840.02">io_close(local_image_handle)</text><rect fill="#FFFFFF" filter="url(#f1pqarv01i7jv6)" height="40.2656" style="stroke: #000000; stroke-width: 2.0;" width="201" x="799" y="853.0859"/><polygon fill="#EEEEEE" points="799,853.0859,865,853.0859,865,860.0859,855,870.0859,799,870.0859,799,853.0859" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="21" x="812" y="867.1528">ref</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="805" y="886.1528">io_close() on memmap device</text><polygon fill="#FBFB77" filter="url(#f1pqarv01i7jv6)" points="338,903.3516,525,903.3516,535,914.3516,525,926.3516,338,926.3516,328,914.3516,338,903.3516" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="340" y="919.4185">memmap_dev_handle ready</text><!--
@startuml

participant arm_io_storage
participant io_storage

 -> arm_io_storage : plat_get_image_source(image_id, &dev_handle, &image_spec)

group init and check device (image_id)

alt image_id = BL2_IMAGE_ID
note over arm_io_storage
	get BL2_IMAGE_ID policy:
	- fip_dev_handle
	- open_fip()
end note
opt policy->check()
	arm_io_storage -> arm_io_storage : open_fip(spec)
	activate arm_io_storage
	arm_io_storage -> io_storage : io_dev_init(fip_dev_handle, FIP_IMAGE_ID)
	ref over io_storage : dev_init() on fip device

	arm_io_storage -> io_storage : io_open(fip_dev_handle, spec, &local_image_handle)
	ref over io_storage : io_open() on fip device

	arm_io_storage -> io_storage : io_close(local_image_handle)
	ref over io_storage : io_close() on fip device

	hnote over arm_io_storage
		fip_dev_handle ready
	end note
end opt
deactivate arm_io_storage

else image_id = FIP_IMAGE_ID
activate arm_io_storage
note over arm_io_storage
	get FIP_IMAGE_ID policy:
	- memmap_dev_handle
	- open_memmap()
end note
opt policy->check()
	arm_io_storage -> arm_io_storage : open_memmap(spec)
	activate arm_io_storage
	arm_io_storage -> io_storage : io_dev_init(memmap_dev_handle, NULL)
	ref over io_storage : dev_init() on memmap device

	arm_io_storage -> io_storage : io_open(memmap_dev_handle, spec, &local_image_handle)
	ref over io_storage : io_open() on memmap device

	arm_io_storage -> io_storage : io_close(local_image_handle)
	ref over io_storage : io_close() on memmap device

	hnote over arm_io_storage
		memmap_dev_handle ready
	end note
	deactivate arm_io_storage
end  opt
deactivate arm_io_storage
end alt

end group
@enduml

PlantUML version 1.2017.15(Mon Jul 03 17:45:34 BST 2017)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.9.1+1-Ubuntu-0ubuntu1.18.04
Operating System: Linux
OS Version: 4.15.0-124-generic
Default Encoding: UTF-8
Language: en
Country: GB
--></g></svg>