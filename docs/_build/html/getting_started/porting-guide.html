

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>7. Porting Guide &mdash; Trusted Firmware-A  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="8. PSCI Library Integration guide for Armv8-A AArch32 systems" href="psci-lib-integration-guide.html" />
    <link rel="prev" title="6. Image Terminology" href="image-terminology.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Trusted Firmware-A
          

          
            
            <img src="../_static/TrustedFirmware-Logo_standard-white.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about/features.html">1. Feature Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../about/features.html#current-features">1.1. Current features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../about/features.html#still-to-come">1.2. Still to come</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../about/release-information.html">2. Release Processes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../about/release-information.html#project-release-cadence">2.1. Project Release Cadence</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../about/release-information.html#upcoming-releases">2.1.1. Upcoming Releases</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../about/release-information.html#removal-of-deprecated-interfaces">2.2. Removal of Deprecated Interfaces</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../about/maintainers.html">3. Project Maintenance</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../about/maintainers.html#maintainers">3.1. Maintainers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../about/maintainers.html#code-owners">3.2. Code owners</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../about/maintainers.html#core-code">3.2.1. Core Code</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/maintainers.html#drivers-libraries-and-framework-code">3.2.2. Drivers, Libraries and Framework Code</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/maintainers.html#platform-ports">3.2.3. Platform Ports</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/maintainers.html#secure-payloads-and-dispatchers">3.2.4. Secure Payloads and Dispatchers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/maintainers.html#tools">3.2.5. Tools</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../about/contact.html">4. Support &amp; Contact</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../about/contact.html#mailing-lists">4.1. Mailing Lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="../about/contact.html#open-tech-forum-call">4.2. Open Tech Forum Call</a></li>
<li class="toctree-l3"><a class="reference internal" href="../about/contact.html#issue-tracker">4.3. Issue Tracker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../about/contact.html#arm-licensees">4.4. Arm Licensees</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../about/acknowledgements.html">5. Contributor Acknowledgements</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Getting Started</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="prerequisites.html">1. Prerequisites</a><ul>
<li class="toctree-l3"><a class="reference internal" href="prerequisites.html#build-host">1.1. Build Host</a></li>
<li class="toctree-l3"><a class="reference internal" href="prerequisites.html#toolchain">1.2. Toolchain</a></li>
<li class="toctree-l3"><a class="reference internal" href="prerequisites.html#software-and-libraries">1.3. Software and Libraries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="prerequisites.html#package-installation-linux">1.3.1. Package Installation (Linux)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="prerequisites.html#supporting-files">1.4. Supporting Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="prerequisites.html#getting-the-tf-a-source">1.5. Getting the TF-A Source</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="docs-build.html">2. Building Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="docs-build.html#prerequisites">2.1. Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="docs-build.html#building-rendered-documentation">2.2. Building rendered documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="docs-build.html#building-rendered-documentation-from-a-container">2.3. Building rendered documentation from a container</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tools-build.html">3. Building Supporting Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tools-build.html#building-and-using-the-fip-tool">3.1. Building and using the FIP tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="tools-build.html#building-the-certificate-generation-tool">3.2. Building the Certificate Generation Tool</a><ul>
<li class="toctree-l4"><a class="reference internal" href="tools-build.html#building-the-firmware-encryption-tool">3.2.1. Building the Firmware Encryption Tool</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="initial-build.html">4. Performing an Initial Build</a></li>
<li class="toctree-l2"><a class="reference internal" href="build-options.html">5. Build Options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="build-options.html#common-build-options">5.1. Common build options</a></li>
<li class="toctree-l3"><a class="reference internal" href="build-options.html#gicv3-driver-options">5.2. GICv3 driver options</a></li>
<li class="toctree-l3"><a class="reference internal" href="build-options.html#debugging-options">5.3. Debugging options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="image-terminology.html">6. Image Terminology</a><ul>
<li class="toctree-l3"><a class="reference internal" href="image-terminology.html#general-notes">6.1. General Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="image-terminology.html#trusted-firmware-images">6.2. Trusted Firmware Images</a><ul>
<li class="toctree-l4"><a class="reference internal" href="image-terminology.html#ap-boot-rom-ap-bl1">6.2.1. AP Boot ROM: <code class="docutils literal notranslate"><span class="pre">AP_BL1</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="image-terminology.html#ap-ram-firmware-ap-bl2">6.2.2. AP RAM Firmware: <code class="docutils literal notranslate"><span class="pre">AP_BL2</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="image-terminology.html#el3-runtime-firmware-ap-bl31">6.2.3. EL3 Runtime Firmware: <code class="docutils literal notranslate"><span class="pre">AP_BL31</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="image-terminology.html#secure-el1-payload-sp-ap-bl32">6.2.4. Secure-EL1 Payload (SP): <code class="docutils literal notranslate"><span class="pre">AP_BL32</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="image-terminology.html#ap-normal-world-firmware-ap-bl33">6.2.5. AP Normal World Firmware: <code class="docutils literal notranslate"><span class="pre">AP_BL33</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="image-terminology.html#other-ap-3rd-level-images-ap-bl3-xxx">6.2.6. Other AP 3rd level images: <code class="docutils literal notranslate"><span class="pre">AP_BL3_XXX</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="image-terminology.html#scp-boot-rom-scp-bl1-previously-bl0">6.2.7. SCP Boot ROM: <code class="docutils literal notranslate"><span class="pre">SCP_BL1</span></code> (previously <code class="docutils literal notranslate"><span class="pre">BL0</span></code>)</a></li>
<li class="toctree-l4"><a class="reference internal" href="image-terminology.html#scp-ram-firmware-scp-bl2-previously-bl3-0">6.2.8. SCP RAM Firmware: <code class="docutils literal notranslate"><span class="pre">SCP_BL2</span></code> (previously <code class="docutils literal notranslate"><span class="pre">BL3-0</span></code>)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="image-terminology.html#firmware-update-fwu-images">6.3. Firmware Update (FWU) Images</a><ul>
<li class="toctree-l4"><a class="reference internal" href="image-terminology.html#ap-firmware-update-boot-rom-ap-ns-bl1u">6.3.1. AP Firmware Update Boot ROM: <code class="docutils literal notranslate"><span class="pre">AP_NS_BL1U</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="image-terminology.html#ap-firmware-update-config-ap-bl2u">6.3.2. AP Firmware Update Config: <code class="docutils literal notranslate"><span class="pre">AP_BL2U</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="image-terminology.html#scp-firmware-update-config-scp-bl2u-previously-bl2-u0">6.3.3. SCP Firmware Update Config: <code class="docutils literal notranslate"><span class="pre">SCP_BL2U</span></code> (previously <code class="docutils literal notranslate"><span class="pre">BL2-U0</span></code>)</a></li>
<li class="toctree-l4"><a class="reference internal" href="image-terminology.html#ap-firmware-updater-ap-ns-bl2u-previously-bl3-u">6.3.4. AP Firmware Updater: <code class="docutils literal notranslate"><span class="pre">AP_NS_BL2U</span></code> (previously <code class="docutils literal notranslate"><span class="pre">BL3-U</span></code>)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="image-terminology.html#other-processor-firmware-images">6.4. Other Processor Firmware Images</a><ul>
<li class="toctree-l4"><a class="reference internal" href="image-terminology.html#mcp-boot-rom-mcp-bl1">6.4.1. MCP Boot ROM: <code class="docutils literal notranslate"><span class="pre">MCP_BL1</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="image-terminology.html#mcp-ram-firmware-mcp-bl2">6.4.2. MCP RAM Firmware: <code class="docutils literal notranslate"><span class="pre">MCP_BL2</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">7. Porting Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">7.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#common-modifications">7.2. Common modifications</a></li>
<li class="toctree-l3"><a class="reference internal" href="#common-mandatory-modifications">7.3. Common mandatory modifications</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#file-platform-def-h-mandatory">7.3.1. File : platform_def.h [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#file-plat-macros-s-mandatory">7.3.2. File : plat_macros.S [mandatory]</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#handling-reset">7.4. Handling Reset</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-get-my-entrypoint-mandatory-when-programmable-reset-address-0">7.4.1. Function : plat_get_my_entrypoint() [mandatory when PROGRAMMABLE_RESET_ADDRESS == 0]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-secondary-cold-boot-setup-mandatory-when-cold-boot-single-cpu-0">7.4.2. Function : plat_secondary_cold_boot_setup() [mandatory when COLD_BOOT_SINGLE_CPU == 0]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-is-my-cpu-primary-mandatory-when-cold-boot-single-cpu-0">7.4.3. Function : plat_is_my_cpu_primary() [mandatory when COLD_BOOT_SINGLE_CPU == 0]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-platform-mem-init-mandatory">7.4.4. Function : platform_mem_init() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-get-rotpk-info">7.4.5. Function: plat_get_rotpk_info()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-get-nv-ctr">7.4.6. Function: plat_get_nv_ctr()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-set-nv-ctr">7.4.7. Function: plat_set_nv_ctr()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-set-nv-ctr2">7.4.8. Function: plat_set_nv_ctr2()</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#common-mandatory-function-modifications">7.5. Common mandatory function modifications</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-my-core-pos">7.5.1. Function : plat_my_core_pos()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-core-pos-by-mpidr">7.5.2. Function : plat_core_pos_by_mpidr()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-get-mbedtls-heap-when-trusted-board-boot-1">7.5.3. Function : plat_get_mbedtls_heap() [when TRUSTED_BOARD_BOOT == 1]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-get-enc-key-info-when-fw-enc-status-0-or-1">7.5.4. Function : plat_get_enc_key_info() [when FW_ENC_STATUS == 0 or 1]</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#common-optional-modifications">7.6. Common optional modifications</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-set-my-stack">7.6.1. Function : plat_set_my_stack()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-get-my-stack">7.6.2. Function : plat_get_my_stack()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-report-exception">7.6.3. Function : plat_report_exception()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-reset-handler">7.6.4. Function : plat_reset_handler()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-disable-acp">7.6.5. Function : plat_disable_acp()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-error-handler">7.6.6. Function : plat_error_handler()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-panic-handler">7.6.7. Function : plat_panic_handler()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-get-bl-image-load-info">7.6.8. Function : plat_get_bl_image_load_info()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-get-next-bl-params">7.6.9. Function : plat_get_next_bl_params()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-get-stack-protector-canary">7.6.10. Function : plat_get_stack_protector_canary()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-flush-next-bl-params">7.6.11. Function : plat_flush_next_bl_params()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-log-get-prefix">7.6.12. Function : plat_log_get_prefix()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-get-soc-version">7.6.13. Function : plat_get_soc_version()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-get-soc-revision">7.6.14. Function : plat_get_soc_revision()</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-is-smccc-feature-available">7.6.15. Function : plat_is_smccc_feature_available()</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#modifications-specific-to-a-boot-loader-stage">7.7. Modifications specific to a Boot Loader stage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#boot-loader-stage-1-bl1">7.8. Boot Loader Stage 1 (BL1)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#function-bl1-early-platform-setup-mandatory">7.8.1. Function : bl1_early_platform_setup() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl1-plat-arch-setup-mandatory">7.8.2. Function : bl1_plat_arch_setup() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl1-platform-setup-mandatory">7.8.3. Function : bl1_platform_setup() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl1-plat-sec-mem-layout-mandatory">7.8.4. Function : bl1_plat_sec_mem_layout() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl1-plat-prepare-exit-optional">7.8.5. Function : bl1_plat_prepare_exit() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl1-plat-set-ep-info-optional">7.8.6. Function : bl1_plat_set_ep_info() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl1-plat-get-next-image-id-optional">7.8.7. Function : bl1_plat_get_next_image_id() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl1-plat-get-image-desc-optional">7.8.8. Function : bl1_plat_get_image_desc() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl1-plat-handle-pre-image-load-optional">7.8.9. Function : bl1_plat_handle_pre_image_load() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl1-plat-handle-post-image-load-optional">7.8.10. Function : bl1_plat_handle_post_image_load() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl1-plat-fwu-done-optional">7.8.11. Function : bl1_plat_fwu_done() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl1-plat-mem-check-mandatory">7.8.12. Function : bl1_plat_mem_check() [mandatory]</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#boot-loader-stage-2-bl2">7.9. Boot Loader Stage 2 (BL2)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#function-bl2-early-platform-setup2-mandatory">7.9.1. Function : bl2_early_platform_setup2() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl2-plat-arch-setup-mandatory">7.9.2. Function : bl2_plat_arch_setup() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl2-platform-setup-mandatory">7.9.3. Function : bl2_platform_setup() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl2-plat-handle-pre-image-load-optional">7.9.4. Function : bl2_plat_handle_pre_image_load() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl2-plat-handle-post-image-load-optional">7.9.5. Function : bl2_plat_handle_post_image_load() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl2-plat-preload-setup-optional">7.9.6. Function : bl2_plat_preload_setup [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-try-next-boot-source-optional">7.9.7. Function : plat_try_next_boot_source() [optional]</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#boot-loader-stage-2-bl2-at-el3">7.10. Boot Loader Stage 2 (BL2) at EL3</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#function-bl2-el3-early-platform-setup-mandatory">7.10.1. Function : bl2_el3_early_platform_setup() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl2-el3-plat-arch-setup-mandatory">7.10.2. Function : bl2_el3_plat_arch_setup() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl2-el3-plat-prepare-exit-optional">7.10.3. Function : bl2_el3_plat_prepare_exit() [optional]</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#fwu-boot-loader-stage-2-bl2u">7.11. FWU Boot Loader Stage 2 (BL2U)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#function-bl2u-early-platform-setup-mandatory">7.11.1. Function : bl2u_early_platform_setup() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl2u-plat-arch-setup-mandatory">7.11.2. Function : bl2u_plat_arch_setup() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl2u-platform-setup-mandatory">7.11.3. Function : bl2u_platform_setup() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl2u-plat-handle-scp-bl2u-optional">7.11.4. Function : bl2u_plat_handle_scp_bl2u() [optional]</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#boot-loader-stage-3-1-bl31">7.12. Boot Loader Stage 3-1 (BL31)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#function-bl31-early-platform-setup2-mandatory">7.12.1. Function : bl31_early_platform_setup2() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl31-plat-arch-setup-mandatory">7.12.2. Function : bl31_plat_arch_setup() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl31-platform-setup-mandatory">7.12.3. Function : bl31_platform_setup() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl31-plat-runtime-setup-optional">7.12.4. Function : bl31_plat_runtime_setup() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl31-plat-get-next-image-ep-info-mandatory">7.12.5. Function : bl31_plat_get_next_image_ep_info() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-bl31-plat-enable-mmu-optional">7.12.6. Function : bl31_plat_enable_mmu [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-init-apkey-optional">7.12.7. Function : plat_init_apkey [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-get-syscnt-freq2-mandatory">7.12.8. Function : plat_get_syscnt_freq2() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-arm-set-twedel-scr-el3-optional">7.12.9. Function : plat_arm_set_twedel_scr_el3() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#define-plat-percpu-bakery-lock-size-optional">7.12.10. #define : PLAT_PERCPU_BAKERY_LOCK_SIZE [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#sdei-porting-requirements">7.12.11. SDEI porting requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="#trng-porting-requirements">7.12.12. TRNG porting requirements</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#power-state-coordination-interface-in-bl31">7.13. Power State Coordination Interface (in BL31)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-psci-stat-accounting-start-optional">7.13.1. Function : plat_psci_stat_accounting_start() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-psci-stat-accounting-stop-optional">7.13.2. Function : plat_psci_stat_accounting_stop() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-psci-stat-get-residency-optional">7.13.3. Function : plat_psci_stat_get_residency() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-get-target-pwr-state-optional">7.13.4. Function : plat_get_target_pwr_state() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-get-power-domain-tree-desc-mandatory">7.13.5. Function : plat_get_power_domain_tree_desc() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-setup-psci-ops-mandatory">7.13.6. Function : plat_setup_psci_ops() [mandatory]</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#interrupt-management-framework-in-bl31">7.14. Interrupt Management framework (in BL31)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-interrupt-type-to-line-mandatory">7.14.1. Function : plat_interrupt_type_to_line() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-ic-get-pending-interrupt-type-mandatory">7.14.2. Function : plat_ic_get_pending_interrupt_type() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-ic-get-pending-interrupt-id-mandatory">7.14.3. Function : plat_ic_get_pending_interrupt_id() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-ic-acknowledge-interrupt-mandatory">7.14.4. Function : plat_ic_acknowledge_interrupt() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-ic-end-of-interrupt-mandatory">7.14.5. Function : plat_ic_end_of_interrupt() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-ic-get-interrupt-type-mandatory">7.14.6. Function : plat_ic_get_interrupt_type() [mandatory]</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#crash-reporting-mechanism-in-bl31">7.15. Crash Reporting mechanism (in BL31)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-crash-console-init-mandatory">7.15.1. Function : plat_crash_console_init [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-crash-console-putc-mandatory">7.15.2. Function : plat_crash_console_putc [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-crash-console-flush-mandatory">7.15.3. Function : plat_crash_console_flush [mandatory]</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#external-abort-handling-and-ras-support">7.16. External Abort handling and RAS Support</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-ea-handler">7.16.1. Function : plat_ea_handler</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-handle-uncontainable-ea">7.16.2. Function : plat_handle_uncontainable_ea</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-handle-double-fault">7.16.3. Function : plat_handle_double_fault</a></li>
<li class="toctree-l4"><a class="reference internal" href="#function-plat-handle-el3-ea">7.16.4. Function : plat_handle_el3_ea</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#build-flags">7.17. Build flags</a></li>
<li class="toctree-l3"><a class="reference internal" href="#platform-include-paths">7.18. Platform include paths</a></li>
<li class="toctree-l3"><a class="reference internal" href="#c-library">7.19. C Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="#storage-abstraction-layer">7.20. Storage abstraction layer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="psci-lib-integration-guide.html">8. PSCI Library Integration guide for Armv8-A AArch32 systems</a><ul>
<li class="toctree-l3"><a class="reference internal" href="psci-lib-integration-guide.html#generic-call-sequence-for-psci-library-interface-aarch32">8.1. Generic call sequence for PSCI Library interface (AArch32)</a></li>
<li class="toctree-l3"><a class="reference internal" href="psci-lib-integration-guide.html#psci-cpu-context-management">8.2. PSCI CPU context management</a></li>
<li class="toctree-l3"><a class="reference internal" href="psci-lib-integration-guide.html#psci-library-interface">8.3. PSCI Library Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="psci-lib-integration-guide.html#interface-psci-setup">8.3.1. Interface : psci_setup()</a></li>
<li class="toctree-l4"><a class="reference internal" href="psci-lib-integration-guide.html#interface-psci-prepare-next-non-secure-ctx">8.3.2. Interface : psci_prepare_next_non_secure_ctx()</a></li>
<li class="toctree-l4"><a class="reference internal" href="psci-lib-integration-guide.html#interface-psci-register-spd-pm-hook">8.3.3. Interface : psci_register_spd_pm_hook()</a></li>
<li class="toctree-l4"><a class="reference internal" href="psci-lib-integration-guide.html#interface-psci-smc-handler">8.3.4. Interface : psci_smc_handler()</a></li>
<li class="toctree-l4"><a class="reference internal" href="psci-lib-integration-guide.html#interface-psci-warmboot-entrypoint">8.3.5. Interface : psci_warmboot_entrypoint()</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="psci-lib-integration-guide.html#el3-runtime-software-dependencies">8.4. EL3 Runtime Software dependencies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="psci-lib-integration-guide.html#general-dependencies">8.4.1. General dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="psci-lib-integration-guide.html#cpu-context-management-api">8.4.2. CPU Context management API</a></li>
<li class="toctree-l4"><a class="reference internal" href="psci-lib-integration-guide.html#platform-api">8.4.3. Platform API</a></li>
<li class="toctree-l4"><a class="reference internal" href="psci-lib-integration-guide.html#secure-payload-power-management-callback">8.4.4. Secure payload power management callback</a></li>
<li class="toctree-l4"><a class="reference internal" href="psci-lib-integration-guide.html#cpu-operations">8.4.5. CPU operations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="rt-svc-writers-guide.html">9. EL3 Runtime Service Writer’s Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="rt-svc-writers-guide.html#introduction">9.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="rt-svc-writers-guide.html#owning-entities-call-types-and-function-ids">9.2. Owning Entities, Call Types and Function IDs</a></li>
<li class="toctree-l3"><a class="reference internal" href="rt-svc-writers-guide.html#getting-started">9.3. Getting started</a></li>
<li class="toctree-l3"><a class="reference internal" href="rt-svc-writers-guide.html#registering-a-runtime-service">9.4. Registering a runtime service</a></li>
<li class="toctree-l3"><a class="reference internal" href="rt-svc-writers-guide.html#initializing-a-runtime-service">9.5. Initializing a runtime service</a></li>
<li class="toctree-l3"><a class="reference internal" href="rt-svc-writers-guide.html#handling-runtime-service-requests">9.6. Handling runtime service requests</a></li>
<li class="toctree-l3"><a class="reference internal" href="rt-svc-writers-guide.html#services-that-contain-multiple-sub-services">9.7. Services that contain multiple sub-services</a></li>
<li class="toctree-l3"><a class="reference internal" href="rt-svc-writers-guide.html#secure-el1-payload-dispatcher-service-spd">9.8. Secure-EL1 Payload Dispatcher service (SPD)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Processes &amp; Policies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../process/security.html">1. Security Handling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../process/security.html#security-disclosures">1.1. Security Disclosures</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/security.html#found-a-security-issue">1.2. Found a Security Issue?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/security.html#attribution">1.3. Attribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/security.html#security-advisories">1.4. Security Advisories</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../process/platform-compatibility-policy.html">2. Platform Compatibility Policy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../process/platform-compatibility-policy.html#introduction">2.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/platform-compatibility-policy.html#id1">2.2. Platform compatibility policy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../process/coding-style.html">3. Coding Style</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#file-encoding">3.1. File Encoding</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#language">3.2. Language</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#c-language-standard">3.3. C Language Standard</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#misra-compliance">3.4. MISRA Compliance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#indentation">3.5. Indentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#spacing">3.6. Spacing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#line-length">3.7. Line Length</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#blank-lines">3.8. Blank Lines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#braces">3.9. Braces</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-style.html#opening-brace-placement">3.9.1. Opening Brace Placement</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-style.html#conditional-statement-bodies">3.9.2. Conditional Statement Bodies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#naming">3.10. Naming</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-style.html#functions">3.10.1. Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-style.html#local-variables-and-parameters">3.10.2. Local Variables and Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-style.html#preprocessor-macros">3.10.3. Preprocessor Macros</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#function-attributes">3.11. Function Attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#alignment">3.12. Alignment</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-style.html#switch-statement-alignment">3.12.1. Switch Statement Alignment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-style.html#pointer-alignment">3.12.2. Pointer Alignment</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#comments">3.13. Comments</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#headers-and-inclusion">3.14. Headers and inclusion</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-style.html#header-guards">3.14.1. Header guards</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-style.html#include-statement-ordering">3.14.2. Include statement ordering</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-style.html#include-statement-variants">3.14.3. Include statement variants</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#typedefs">3.15. Typedefs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-style.html#avoid-anonymous-typedefs-of-structs-enums-in-headers">3.15.1. Avoid anonymous typedefs of structs/enums in headers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../process/coding-guidelines.html">4. Coding Guidelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-guidelines.html#automatic-editor-configuration">4.1. Automatic Editor Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-guidelines.html#automatic-compliance-checking">4.2. Automatic Compliance Checking</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-guidelines.html#ignored-checkpatch-warnings">4.2.1. Ignored Checkpatch Warnings</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-guidelines.html#performance-considerations">4.3. Performance considerations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-guidelines.html#avoid-printf-and-use-logging-macros">4.3.1. Avoid printf and use logging macros</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-guidelines.html#use-const-data-where-possible">4.3.2. Use const data where possible</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-guidelines.html#libc-functions-that-are-banned-or-to-be-used-with-caution">4.4. Libc functions that are banned or to be used with caution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-guidelines.html#error-handling-and-robustness">4.5. Error handling and robustness</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-guidelines.html#using-cassert-to-check-for-compile-time-data-errors">4.5.1. Using CASSERT to check for compile time data errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-guidelines.html#using-assert-to-check-for-programming-errors">4.5.2. Using assert() to check for programming errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-guidelines.html#handling-integration-errors">4.5.3. Handling integration errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-guidelines.html#handling-recoverable-errors">4.5.4. Handling recoverable errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-guidelines.html#handling-unrecoverable-errors">4.5.5. Handling unrecoverable errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-guidelines.html#handling-critical-unresponsiveness">4.5.6. Handling critical unresponsiveness</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-guidelines.html#use-of-built-in-c-and-libc-data-types">4.6. Use of built-in <em>C</em> and <em>libc</em> data types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-guidelines.html#favor-c-language-over-assembly-language">4.7. Favor C language over assembly language</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../process/contributing.html">5. Contributor’s Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../process/contributing.html#getting-started">5.1. Getting Started</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/contributing.html#making-changes">5.2. Making Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/contributing.html#submitting-changes">5.3. Submitting Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/contributing.html#binary-components">5.4. Binary Components</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../process/code-review-guidelines.html">6. Code Review Guidelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../process/code-review-guidelines.html#why-do-we-do-code-reviews">6.1. Why do we do code reviews?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/code-review-guidelines.html#good-practices">6.2. Good practices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/code-review-guidelines.html#guidelines-for-patch-contributors">6.3. Guidelines for patch contributors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/code-review-guidelines.html#guidelines-for-all-reviewers">6.4. Guidelines for all reviewers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/code-review-guidelines.html#guidelines-for-code-owners">6.5. Guidelines for code owners</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/code-review-guidelines.html#guidelines-for-maintainers">6.6. Guidelines for maintainers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../process/faq.html">7. Frequently-Asked Questions (FAQ)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../process/faq.html#how-do-i-update-my-changes">7.1. How do I update my changes?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/faq.html#how-long-will-my-changes-take-to-merge-into-integration">7.2. How long will my changes take to merge into <code class="docutils literal notranslate"><span class="pre">integration</span></code>?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/faq.html#how-long-will-it-take-for-my-changes-to-go-from-integration-to-master">7.3. How long will it take for my changes to go from <code class="docutils literal notranslate"><span class="pre">integration</span></code> to <code class="docutils literal notranslate"><span class="pre">master</span></code>?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/faq.html#what-are-these-strange-comments-in-my-changes">7.4. What are these strange comments in my changes?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../process/security-hardening.html">8. Secure Development Guidelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../process/security-hardening.html#security-considerations">8.1. Security considerations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../process/security-hardening.html#do-not-leak-secrets-to-the-normal-world">8.1.1. Do not leak secrets to the normal world</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/security-hardening.html#handling-denial-of-service-attacks">8.1.2. Handling Denial of Service attacks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/security-hardening.html#preventing-secure-world-timing-information-leakage-via-pmu-counters">8.1.3. Preventing Secure-world timing information leakage via PMU counters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../process/security-hardening.html#build-options">8.2. Build options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../components/index.html">Components</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../components/spd/index.html">1. Secure Payload Dispatcher (SPD)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/spd/optee-dispatcher.html">1.1. OP-TEE Dispatcher</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/spd/tlk-dispatcher.html">1.2. Trusted Little Kernel (TLK) Dispatcher</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/spd/tlk-dispatcher.html#trusted-little-kernel-tlk">1.2.1. Trusted Little Kernel (TLK)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/spd/tlk-dispatcher.html#build-tlk">1.2.2. Build TLK</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/spd/tlk-dispatcher.html#input-parameters-to-tlk">1.2.3. Input parameters to TLK</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/spd/trusty-dispatcher.html">1.3. Trusty Dispatcher</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/spd/trusty-dispatcher.html#boot-parameters">1.3.1. Boot parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/spd/trusty-dispatcher.html#supported-platforms">1.3.2. Supported platforms</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/arm-sip-service.html">2. Arm SiP Services</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/arm-sip-service.html#performance-measurement-framework-pmf">2.1. Performance Measurement Framework (PMF)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/arm-sip-service.html#execution-state-switching-service">2.2. Execution State Switching service</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/arm-sip-service.html#arm-sip-svc-exe-state-switch">2.2.1. <code class="docutils literal notranslate"><span class="pre">ARM_SIP_SVC_EXE_STATE_SWITCH</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/arm-sip-service.html#debugfs-interface">2.3. DebugFS interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/arm-sip-service.html#mount">2.3.1. MOUNT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/arm-sip-service.html#open">2.3.2. OPEN</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/arm-sip-service.html#close">2.3.3. CLOSE</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/arm-sip-service.html#read">2.3.4. READ</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/arm-sip-service.html#seek">2.3.5. SEEK</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/arm-sip-service.html#bind">2.3.6. BIND</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/arm-sip-service.html#stat">2.3.7. STAT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/arm-sip-service.html#init">2.3.8. INIT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/arm-sip-service.html#version">2.3.9. VERSION</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/debugfs-design.html">3. Debug FS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/debugfs-design.html#overview">3.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/debugfs-design.html#virtual-filesystem">3.2. Virtual filesystem</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/debugfs-design.html#namespace">3.2.1. Namespace</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/debugfs-design.html#p-interface">3.2.2. 9p interface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/debugfs-design.html#smc-interface">3.3. SMC interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/debugfs-design.html#security-considerations">3.4. Security considerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/debugfs-design.html#limitations">3.5. Limitations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/debugfs-design.html#applications">3.6. Applications</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/exception-handling.html">4. Exception Handling Framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/exception-handling.html#introduction">4.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/exception-handling.html#the-role-of-exception-handling-framework">4.2. The role of Exception Handling Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/exception-handling.html#interrupt-handling">4.3. Interrupt handling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/exception-handling.html#partitioning-priority-levels">4.3.1. Partitioning priority levels</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/exception-handling.html#programming-priority">4.3.2. Programming priority</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/exception-handling.html#registering-handler">4.4. Registering handler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/exception-handling.html#interrupt-handling-example">4.5. Interrupt handling example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/exception-handling.html#activating-and-deactivating-priorities">4.6. Activating and Deactivating priorities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/exception-handling.html#transition-of-priority-levels">4.7. Transition of priority levels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/exception-handling.html#effect-on-smc-calls">4.8. Effect on SMC calls</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/exception-handling.html#build-time-flow">4.9. Build-time flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/exception-handling.html#run-time-flow">4.10. Run-time flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/exception-handling.html#interrupt-prioritisation-considerations">4.11. Interrupt Prioritisation Considerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/exception-handling.html#limitations">4.12. Limitations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/fconf/index.html">5. Firmware Configuration Framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/fconf/index.html#introduction">5.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/fconf/index.html#accessing-properties">5.2. Accessing properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/fconf/index.html#defining-properties">5.3. Defining properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/fconf/index.html#loading-the-property-device-tree">5.4. Loading the property device tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/fconf/index.html#populating-the-properties">5.5. Populating the properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/fconf/index.html#namespace-guidance">5.6. Namespace guidance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/fconf/index.html#properties-binding-information">5.7. Properties binding information</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/fconf/fconf_properties.html">5.7.1. DTB binding for FCONF properties</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/firmware-update.html">6. Firmware Update (FWU)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/firmware-update.html#introduction">6.1. Introduction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/firmware-update.html#scope">6.1.1. Scope</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/firmware-update.html#fwu-overview">6.2. FWU Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/firmware-update.html#image-identification">6.3. Image Identification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/firmware-update.html#fwu-state-machine">6.4. FWU State Machine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/firmware-update.html#bl1-smc-interface">6.5. BL1 SMC Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/firmware-update.html#bl1-smc-call-count">6.5.1. BL1_SMC_CALL_COUNT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/firmware-update.html#bl1-smc-uid">6.5.2. BL1_SMC_UID</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/firmware-update.html#bl1-smc-version">6.5.3. BL1_SMC_VERSION</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/firmware-update.html#bl1-smc-run-image">6.5.4. BL1_SMC_RUN_IMAGE</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/firmware-update.html#fwu-smc-image-copy">6.5.5. FWU_SMC_IMAGE_COPY</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/firmware-update.html#fwu-smc-image-auth">6.5.6. FWU_SMC_IMAGE_AUTH</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/firmware-update.html#fwu-smc-image-execute">6.5.7. FWU_SMC_IMAGE_EXECUTE</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/firmware-update.html#fwu-smc-image-resume">6.5.8. FWU_SMC_IMAGE_RESUME</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/firmware-update.html#fwu-smc-sec-image-done">6.5.9. FWU_SMC_SEC_IMAGE_DONE</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/firmware-update.html#fwu-smc-update-done">6.5.10. FWU_SMC_UPDATE_DONE</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/firmware-update.html#fwu-smc-image-reset">6.5.11. FWU_SMC_IMAGE_RESET</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/measured_boot/index.html">7. Measured Boot Driver (MBD)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/measured_boot/index.html#properties-binding-information">7.1. Properties binding information</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/measured_boot/event_log.html">7.1.1. DTB binding for Event Log properties</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/platform-interrupt-controller-API.html">8. Platform Interrupt Controller API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-unsigned-int-plat-ic-get-running-priority-void-optional">8.1. Function: unsigned int plat_ic_get_running_priority(void); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-int-plat-ic-is-spi-unsigned-int-id-optional">8.2. Function: int plat_ic_is_spi(unsigned int id); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-int-plat-ic-is-ppi-unsigned-int-id-optional">8.3. Function: int plat_ic_is_ppi(unsigned int id); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-int-plat-ic-is-sgi-unsigned-int-id-optional">8.4. Function: int plat_ic_is_sgi(unsigned int id); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-unsigned-int-plat-ic-get-interrupt-active-unsigned-int-id-optional">8.5. Function: unsigned int plat_ic_get_interrupt_active(unsigned int id); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-void-plat-ic-enable-interrupt-unsigned-int-id-optional">8.6. Function: void plat_ic_enable_interrupt(unsigned int id); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-void-plat-ic-disable-interrupt-unsigned-int-id-optional">8.7. Function: void plat_ic_disable_interrupt(unsigned int id); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-void-plat-ic-set-interrupt-priority-unsigned-int-id-unsigned-int-priority-optional">8.8. Function: void plat_ic_set_interrupt_priority(unsigned int id, unsigned int priority); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-int-plat-ic-has-interrupt-type-unsigned-int-type-optional">8.9. Function: int plat_ic_has_interrupt_type(unsigned int type); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-void-plat-ic-set-interrupt-type-unsigned-int-id-unsigned-int-type-optional">8.10. Function: void plat_ic_set_interrupt_type(unsigned int id, unsigned int type); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-void-plat-ic-raise-el3-sgi-int-sgi-num-u-register-t-target-optional">8.11. Function: void plat_ic_raise_el3_sgi(int sgi_num, u_register_t target); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-void-plat-ic-set-spi-routing-unsigned-int-id-unsigned-int-routing-mode-u-register-t-mpidr-optional">8.12. Function: void plat_ic_set_spi_routing(unsigned int id, unsigned int routing_mode, u_register_t mpidr); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-void-plat-ic-set-interrupt-pending-unsigned-int-id-optional">8.13. Function: void plat_ic_set_interrupt_pending(unsigned int id); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-void-plat-ic-clear-interrupt-pending-unsigned-int-id-optional">8.14. Function: void plat_ic_clear_interrupt_pending(unsigned int id); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-unsigned-int-plat-ic-set-priority-mask-unsigned-int-id-optional">8.15. Function: unsigned int plat_ic_set_priority_mask(unsigned int id); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-unsigned-int-plat-ic-get-interrupt-id-unsigned-int-raw-optional">8.16. Function: unsigned int plat_ic_get_interrupt_id(unsigned int raw); [optional]</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/ras.html">9. Reliability, Availability, and Serviceability (RAS) Extensions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/ras.html#overview">9.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/ras.html#platform-apis">9.2. Platform APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/ras.html#registering-ras-error-records">9.3. Registering RAS error records</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/ras.html#standard-error-record-helpers">9.3.1. Standard Error Record helpers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/ras.html#registering-ras-interrupts">9.4. Registering RAS interrupts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/ras.html#double-fault-handling">9.5. Double-fault handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/ras.html#engaging-the-ras-framework">9.6. Engaging the RAS framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/ras.html#interaction-with-exception-handling-framework">9.7. Interaction with Exception Handling Framework</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/romlib-design.html">10. Library at ROM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/romlib-design.html#introduction">10.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/romlib-design.html#index-file">10.2. Index file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/romlib-design.html#wrapper-functions">10.3. Wrapper functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/romlib-design.html#script">10.4. Script</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/romlib-design.html#patching-of-functions-in-library-at-rom">10.5. Patching of functions in library at ROM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/romlib-design.html#memory-impact">10.6. Memory impact</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/romlib-design.html#build-library-at-rom">10.7. Build library at ROM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/sdei.html">11. SDEI: Software Delegated Exception Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/sdei.html#introduction">11.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/sdei.html#defining-events">11.2. Defining events</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/sdei.html#event-flags">11.2.1. Event flags</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/sdei.html#event-definition-example">11.3. Event definition example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/sdei.html#configuration-within-exception-handling-framework">11.4. Configuration within Exception Handling Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/sdei.html#determining-client-el">11.5. Determining client EL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/sdei.html#explicit-dispatch-of-events">11.6. Explicit dispatch of events</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/sdei.html#conditions-for-event-dispatch">11.6.1. Conditions for event dispatch</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/sdei.html#porting-requirements">11.7. Porting requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/sdei.html#note-on-writing-sdei-event-handlers">11.8. Note on writing SDEI event handlers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/secure-partition-manager.html">12. Secure Partition Manager</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/secure-partition-manager.html#acronyms">12.1. Acronyms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/secure-partition-manager.html#foreword">12.2. Foreword</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#terminology">12.2.1. Terminology</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#support-for-legacy-platforms">12.2.2. Support for legacy platforms</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/secure-partition-manager.html#sample-reference-stack">12.3. Sample reference stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/secure-partition-manager.html#tf-a-build-options">12.4. TF-A build options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/secure-partition-manager.html#boot-process">12.5. Boot process</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#loading-hafnium-and-secure-partitions-in-the-secure-world">12.5.1. Loading Hafnium and Secure Partitions in the secure world</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#booting-through-tf-a">12.5.2. Booting through TF-A</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/secure-partition-manager.html#hafnium-in-the-secure-world">12.6. Hafnium in the secure world</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#general-considerations">12.6.1. General considerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#parsing-sp-partition-manifests">12.6.2. Parsing SP partition manifests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#passing-boot-data-to-the-sp">12.6.3. Passing boot data to the SP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#sp-boot-order">12.6.4. SP Boot order</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#boot-phases">12.6.5. Boot phases</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#mandatory-interfaces">12.6.6. Mandatory interfaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#direct-messaging">12.6.7. Direct messaging</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#memory-management">12.6.8. Memory management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#interrupt-management">12.6.9. Interrupt management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#power-management">12.6.10. Power management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#sp-notification">12.6.11. SP notification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/secure-partition-manager.html#references">12.7. References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/secure-partition-manager-mm.html">13. Secure Partition Manager (MM)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/secure-partition-manager-mm.html#foreword">13.1. Foreword</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/secure-partition-manager-mm.html#background">13.2. Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/secure-partition-manager-mm.html#introduction">13.3. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/secure-partition-manager-mm.html#description">13.4. Description</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager-mm.html#building-tf-a-with-secure-partition-support">13.4.1. Building TF-A with Secure Partition support</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager-mm.html#describing-secure-partition-resources">13.4.2. Describing Secure Partition resources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager-mm.html#accessing-secure-partition-services">13.4.3. Accessing Secure Partition services</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager-mm.html#exchanging-data-with-the-secure-partition">13.4.4. Exchanging data with the Secure Partition</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/secure-partition-manager-mm.html#runtime-model-of-the-secure-partition">13.5. Runtime model of the Secure Partition</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager-mm.html#interface-with-spm">13.5.1. Interface with SPM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager-mm.html#miscellaneous-interfaces">13.5.2. Miscellaneous interfaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager-mm.html#secure-partition-initialisation">13.5.3. Secure Partition Initialisation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager-mm.html#runtime-event-delegation">13.5.4. Runtime Event Delegation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager-mm.html#secure-partition-memory-management">13.5.5. Secure Partition Memory Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager-mm.html#error-codes">13.5.6. Error Codes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/psa-ffa-manifest-binding.html">14. PSA FF-A manifest binding to device tree</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/psa-ffa-manifest-binding.html#version-1-0">14.1. Version 1.0</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/psa-ffa-manifest-binding.html#partition-properties">14.1.1. Partition Properties</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/psa-ffa-manifest-binding.html#memory-regions">14.2. Memory Regions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/psa-ffa-manifest-binding.html#device-regions">14.3. Device Regions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html">15. Translation (XLAT) Tables Library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#about-version-1-and-version-2">15.1. About version 1 and version 2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#design-concepts-and-interfaces">15.2. Design concepts and interfaces</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#mmap-regions">15.2.1. <cite>mmap</cite> regions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#translation-context">15.2.2. Translation Context</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#static-and-dynamic-memory-regions">15.2.3. Static and dynamic memory regions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#library-apis">15.3. Library APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#library-limitations">15.4. Library limitations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#implementation-details">15.5. Implementation details</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#code-structure">15.5.1. Code structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#from-mmap-regions-to-translation-tables">15.5.2. From mmap regions to translation tables</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#the-memory-mapping-algorithm">15.5.3. The memory mapping algorithm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#tlb-maintenance-operations">15.5.4. TLB maintenance operations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/cot-binding.html">16. Chain of trust bindings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/cot-binding.html#cot">16.1. cot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/cot-binding.html#manifests-and-certificate-node-bindings-definition">16.2. Manifests and Certificate node bindings definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/cot-binding.html#images-and-image-node-bindings-definition">16.3. Images and Image node bindings definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/cot-binding.html#non-volatile-counter-node-binding-definition">16.4. non-volatile counter node binding definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/cot-binding.html#future-update-to-chain-of-trust-binding">16.5. Future update to chain of trust binding</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../design/index.html">System Design</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../design/alt-boot-flows.html">1. Alternative Boot Flows</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../design/alt-boot-flows.html#el3-payloads-alternative-boot-flow">1.1. EL3 payloads alternative boot flow</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../design/alt-boot-flows.html#booting-an-el3-payload">1.1.1. Booting an EL3 payload</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../design/alt-boot-flows.html#preloaded-bl33-alternative-boot-flow">1.2. Preloaded BL33 alternative boot flow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../design/auth-framework.html">2. Authentication Framework &amp; Chain of Trust</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../design/auth-framework.html#framework-design">2.1. Framework design</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../design/auth-framework.html#chain-of-trust">2.1.1. Chain of Trust</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/auth-framework.html#image-types">2.1.2. Image types</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/auth-framework.html#component-responsibilities">2.1.3. Component responsibilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/auth-framework.html#authentication-methods">2.1.4. Authentication methods</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../design/auth-framework.html#specifying-a-chain-of-trust">2.2. Specifying a Chain of Trust</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../design/auth-framework.html#describing-the-image-parsing-methods">2.2.1. Describing the image parsing methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/auth-framework.html#describing-the-authentication-method-s">2.2.2. Describing the authentication method(s)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/auth-framework.html#storing-authentication-parameters">2.2.3. Storing Authentication parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/auth-framework.html#describing-an-image-in-a-cot">2.2.4. Describing an image in a CoT</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../design/auth-framework.html#implementation-example">2.3. Implementation example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../design/auth-framework.html#the-tbbr-cot">2.3.1. The TBBR CoT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/auth-framework.html#the-image-parser-library">2.3.2. The image parser library</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/auth-framework.html#the-cryptographic-library">2.3.3. The cryptographic library</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../design/cpu-specific-build-macros.html">3. Arm CPU Specific Build Macros</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../design/cpu-specific-build-macros.html#security-vulnerability-workarounds">3.1. Security Vulnerability Workarounds</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design/cpu-specific-build-macros.html#cpu-errata-workarounds">3.2. CPU Errata Workarounds</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design/cpu-specific-build-macros.html#dsu-errata-workarounds">3.3. DSU Errata Workarounds</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design/cpu-specific-build-macros.html#cpu-specific-optimizations">3.4. CPU Specific optimizations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../design/firmware-design.html">4. Firmware Design</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../design/firmware-design.html#cold-boot">4.1. Cold boot</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#dynamic-configuration-during-cold-boot">4.1.1. Dynamic Configuration during cold boot</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#bl1">4.1.2. BL1</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#bl2">4.1.3. BL2</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#running-bl2-at-el3-execution-level">4.1.4. Running BL2 at EL3 execution level</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#aarch64-bl31">4.1.5. AArch64 BL31</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#using-alternative-trusted-boot-firmware-in-place-of-bl1-bl2-aarch64-only">4.1.6. Using alternative Trusted Boot Firmware in place of BL1 &amp; BL2 (AArch64 only)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#aarch32-el3-runtime-software-entrypoint-interface">4.1.7. AArch32 EL3 Runtime Software entrypoint interface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../design/firmware-design.html#el3-runtime-services-framework">4.2. EL3 runtime services framework</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#registration">4.2.1. Registration</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#initialization">4.2.2. Initialization</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#handling-an-smc">4.2.3. Handling an SMC</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../design/firmware-design.html#exception-handling-framework">4.3. Exception Handling Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design/firmware-design.html#power-state-coordination-interface">4.4. Power State Coordination Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design/firmware-design.html#secure-el1-payloads-and-dispatchers">4.5. Secure-EL1 Payloads and Dispatchers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#initializing-a-bl32-image">4.5.1. Initializing a BL32 Image</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../design/firmware-design.html#crash-reporting-in-bl31">4.6. Crash Reporting in BL31</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design/firmware-design.html#guidelines-for-reset-handlers">4.7. Guidelines for Reset Handlers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design/firmware-design.html#configuring-secure-interrupts">4.8. Configuring secure interrupts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design/firmware-design.html#cpu-specific-operations-framework">4.9. CPU specific operations framework</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#cpu-specific-reset-handling">4.9.1. CPU specific Reset Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#cpu-specific-power-down-sequence">4.9.2. CPU specific power down sequence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#cpu-specific-register-reporting-during-crash">4.9.3. CPU specific register reporting during crash</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#cpu-errata-status-reporting">4.9.4. CPU errata status reporting</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../design/firmware-design.html#memory-layout-of-bl-images">4.10. Memory layout of BL images</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#linker-scripts-and-symbols">4.10.1. Linker scripts and symbols</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#how-to-choose-the-right-base-addresses-for-each-bootloader-stage-image">4.10.2. How to choose the right base addresses for each bootloader stage image</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../design/firmware-design.html#firmware-image-package-fip">4.11. Firmware Image Package (FIP)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#firmware-image-package-layout">4.11.1. Firmware Image Package layout</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#firmware-image-package-creation-tool">4.11.2. Firmware Image Package creation tool</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#loading-from-a-firmware-image-package-fip">4.11.3. Loading from a Firmware Image Package (FIP)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../design/firmware-design.html#use-of-coherent-memory-in-tf-a">4.12. Use of coherent memory in TF-A</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#disabling-the-use-of-coherent-memory-in-tf-a">4.12.1. Disabling the use of coherent memory in TF-A</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#coherent-memory-usage-in-psci-implementation">4.12.2. Coherent memory usage in PSCI implementation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#bakery-lock-data">4.12.3. Bakery lock data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#non-functional-impact-of-removing-coherent-memory">4.12.4. Non Functional Impact of removing coherent memory</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../design/firmware-design.html#isolating-code-and-read-only-data-on-separate-memory-pages">4.13. Isolating code and read-only data on separate memory pages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design/firmware-design.html#publish-and-subscribe-framework">4.14. Publish and Subscribe Framework</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#publish-and-subscribe-example">4.14.1. Publish and Subscribe Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#reclaiming-the-bl31-initialization-code">4.14.2. Reclaiming the BL31 initialization code</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../design/firmware-design.html#performance-measurement-framework">4.15. Performance Measurement Framework</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#timestamp-identifier-format">4.15.1. Timestamp identifier format</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#registering-a-pmf-service">4.15.2. Registering a PMF service</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#capturing-a-timestamp">4.15.3. Capturing a timestamp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#retrieving-a-timestamp">4.15.4. Retrieving a timestamp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#pmf-code-structure">4.15.5. PMF code structure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../design/firmware-design.html#armv8-a-architecture-extensions">4.16. Armv8-A Architecture Extensions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#armv8-1-a">4.16.1. Armv8.1-A</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#armv8-2-a">4.16.2. Armv8.2-A</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#armv8-3-a">4.16.3. Armv8.3-A</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#armv8-5-a">4.16.4. Armv8.5-A</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/firmware-design.html#armv7-a">4.16.5. Armv7-A</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../design/firmware-design.html#code-structure">4.17. Code Structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../design/interrupt-framework-design.html">5. Interrupt Management Framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../design/interrupt-framework-design.html#concepts">5.1. Concepts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../design/interrupt-framework-design.html#interrupt-types">5.1.1. Interrupt types</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/interrupt-framework-design.html#routing-model">5.1.2. Routing model</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/interrupt-framework-design.html#valid-routing-models">5.1.3. Valid routing models</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/interrupt-framework-design.html#mapping-of-interrupt-type-to-signal">5.1.4. Mapping of interrupt type to signal</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../design/interrupt-framework-design.html#assumptions-in-interrupt-management-framework">5.2. Assumptions in Interrupt Management Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design/interrupt-framework-design.html#software-components">5.3. Software components</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design/interrupt-framework-design.html#interrupt-registration">5.4. Interrupt registration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../design/interrupt-framework-design.html#el3-runtime-firmware">5.4.1. EL3 runtime firmware</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/interrupt-framework-design.html#secure-payload-dispatcher">5.4.2. Secure payload dispatcher</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/interrupt-framework-design.html#test-secure-payload-dispatcher-behavior">5.4.3. Test secure payload dispatcher behavior</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/interrupt-framework-design.html#secure-payload">5.4.4. Secure payload</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/interrupt-framework-design.html#test-secure-payload-behavior">5.4.5. Test secure payload behavior</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../design/interrupt-framework-design.html#interrupt-handling">5.5. Interrupt handling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../design/interrupt-framework-design.html#id4">5.5.1. EL3 runtime firmware</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/interrupt-framework-design.html#id5">5.5.2. Secure payload dispatcher</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/interrupt-framework-design.html#secure-payload-interrupt-handling">5.5.3. Secure payload interrupt handling</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../design/interrupt-framework-design.html#other-considerations">5.6. Other considerations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../design/interrupt-framework-design.html#implication-of-preempted-smc-on-non-secure-software">5.6.1. Implication of preempted SMC on Non-Secure Software</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../design/psci-pd-tree.html">6. PSCI Power Domain Tree Structure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../design/psci-pd-tree.html#requirements">6.1. Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design/psci-pd-tree.html#design">6.2. Design</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../design/psci-pd-tree.html#describing-a-power-domain-tree">6.2.1. Describing a power domain tree</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/psci-pd-tree.html#removing-assumptions-about-mpidrs-used-in-a-platform">6.2.2. Removing assumptions about MPIDRs used in a platform</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/psci-pd-tree.html#traversing-through-and-distinguishing-between-core-and-non-core-power-domains">6.2.3. Traversing through and distinguishing between core and non-core power domains</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/psci-pd-tree.html#populating-the-power-domain-tree">6.2.4. Populating the power domain tree</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../design/reset-design.html">7. CPU Reset</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../design/reset-design.html#general-reset-code-flow">7.1. General reset code flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design/reset-design.html#programmable-cpu-reset-address">7.2. Programmable CPU reset address</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design/reset-design.html#cold-boot-on-a-single-cpu">7.3. Cold boot on a single CPU</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design/reset-design.html#programmable-cpu-reset-address-cold-boot-on-a-single-cpu">7.4. Programmable CPU reset address, Cold boot on a single CPU</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design/reset-design.html#using-bl31-entrypoint-as-the-reset-address">7.5. Using BL31 entrypoint as the reset address</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../design/reset-design.html#determination-of-boot-path">7.5.1. Determination of boot path</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design/reset-design.html#platform-initialization">7.5.2. Platform initialization</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../design/trusted-board-boot.html">8. Trusted Board Boot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../design/trusted-board-boot.html#chain-of-trust">8.1. Chain of Trust</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design/trusted-board-boot.html#trusted-board-boot-sequence">8.2. Trusted Board Boot Sequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design/trusted-board-boot.html#authentication-framework">8.3. Authentication Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design/trusted-board-boot.html#certificate-generation-tool">8.4. Certificate Generation Tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design/trusted-board-boot.html#authenticated-encryption-framework">8.5. Authenticated Encryption Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design/trusted-board-boot.html#firmware-encryption-tool">8.6. Firmware Encryption Tool</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../design/trusted-board-boot-build.html">9. Building FIP images with support for Trusted Board Boot</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../plat/index.html">Platform Ports</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../plat/allwinner.html">1. Allwinner ARMv8 SoCs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/allwinner.html#trusted-os-dispatcher">1.1. Trusted OS dispatcher</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/arm/index.html">2. Arm Development Platforms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/arm/juno/index.html">2.1. Arm Juno Development Platform</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/juno/index.html#platform-specific-build-options">2.1.1. Platform-specific build options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/juno/index.html#running-software-on-juno">2.1.2. Running software on Juno</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/juno/index.html#preparing-tf-a-images">2.1.3. Preparing TF-A images</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/juno/index.html#creating-a-firmware-image-package-fip">2.1.4. Creating a Firmware Image Package (FIP)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/juno/index.html#booting-firmware-update-images">2.1.5. Booting Firmware Update images</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/juno/index.html#booting-an-el3-payload">2.1.6. Booting an EL3 payload</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/juno/index.html#booting-a-preloaded-kernel-image">2.1.7. Booting a preloaded kernel image</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/juno/index.html#testing-system-suspend">2.1.8. Testing System Suspend</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/juno/index.html#additional-resources">2.1.9. Additional Resources</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/arm/fvp/index.html">2.2. Arm Fixed Virtual Platforms (FVP)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/fvp/index.html#fixed-virtual-platform-fvp-support">2.2.1. Fixed Virtual Platform (FVP) Support</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/fvp/index.html#arm-fvp-platform-specific-build-options">2.2.2. Arm FVP Platform Specific Build Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/fvp/index.html#booting-firmware-update-images">2.2.3. Booting Firmware Update images</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/fvp/index.html#booting-an-el3-payload">2.2.4. Booting an EL3 payload</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/fvp/index.html#booting-a-preloaded-kernel-image-base-fvp">2.2.5. Booting a preloaded kernel image (Base FVP)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/arm/fvp-ve/index.html">2.3. Arm Versatile Express</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/fvp-ve/index.html#boot-sequence">2.3.1. Boot Sequence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/fvp-ve/index.html#how-to-build">2.3.2. How to build</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/arm/tc0/index.html">2.4. TC0 Total Compute Platform</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/tc0/index.html#boot-sequence">2.4.1. Boot Sequence</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/arm/arm_fpga/index.html">2.5. Arm FPGA Platform</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/arm_fpga/index.html#platform-specific-build-options">2.5.1. Platform-specific build options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/arm_fpga/index.html#building-the-tf-a-image">2.5.2. Building the TF-A image</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/arm_fpga/index.html#running-the-tf-a-image">2.5.3. Running the TF-A image</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/arm/arm-build-options.html">2.6. Arm Development Platform Build Options</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/arm-build-options.html#arm-platform-build-options">2.6.1. Arm Platform Build Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/arm-build-options.html#arm-css-platform-specific-build-options">2.6.2. Arm CSS Platform-Specific Build Options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/arm/morello/index.html">2.7. Morello Platform</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/morello/index.html#boot-sequence">2.7.1. Boot Sequence</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/meson-axg.html">3. Amlogic Meson A113D (AXG)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plat/meson-gxbb.html">4. Amlogic Meson S905 (GXBB)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plat/meson-gxl.html">5. Amlogic Meson S905x (GXL)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plat/meson-g12a.html">6. Amlogic Meson S905X2 (G12A)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plat/hikey.html">7. HiKey</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/hikey.html#how-to-build">7.1. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/hikey.html#code-locations">7.1.1. Code Locations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/hikey.html#build-procedure">7.1.2. Build Procedure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/hikey.html#setup-console">7.2. Setup Console</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/hikey.html#flash-images-in-recovery-mode">7.3. Flash images in recovery mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/hikey.html#boot-uefi-in-normal-mode">7.4. Boot UEFI in normal mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/hikey960.html">8. HiKey960</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/hikey960.html#how-to-build">8.1. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/hikey960.html#code-locations">8.1.1. Code Locations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/hikey960.html#build-procedure">8.1.2. Build Procedure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/hikey960.html#setup-console">8.2. Setup Console</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/hikey960.html#boot-uefi-in-recovery-mode">8.3. Boot UEFI in recovery mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/hikey960.html#boot-uefi-in-normal-mode">8.4. Boot UEFI in normal mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/intel-agilex.html">9. Intel Agilex SoCFPGA</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/intel-agilex.html#how-to-build">9.1. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/intel-agilex.html#code-locations">9.1.1. Code Locations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/intel-agilex.html#build-procedure">9.1.2. Build Procedure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/intel-agilex.html#install-procedure">9.1.3. Install Procedure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/intel-agilex.html#boot-trace">9.2. Boot trace</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/intel-stratix10.html">10. Intel Stratix 10 SoCFPGA</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/intel-stratix10.html#how-to-build">10.1. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/intel-stratix10.html#code-locations">10.1.1. Code Locations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/intel-stratix10.html#build-procedure">10.1.2. Build Procedure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/intel-stratix10.html#install-procedure">10.1.3. Install Procedure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/intel-stratix10.html#boot-trace">10.2. Boot trace</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/marvell/index.html">11. Marvell</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/marvell/armada/build.html">11.1. TF-A Build Instructions for Marvell Platforms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/build.html#build-instructions">11.1.1. Build Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/build.html#special-build-flags">11.1.2. Special Build Flags</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/build.html#build-output">11.1.3. Build output</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/build.html#tools-and-external-components-installation">11.1.4. Tools and external components installation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/marvell/armada/porting.html">11.2. TF-A Porting Guide for Marvell Platforms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/porting.html#source-code-structure">11.2.1. Source Code Structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/porting.html#armada-70x0-armada-80x0-porting">11.2.2. Armada-70x0/Armada-80x0 Porting</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-a8k-addr-map.html">11.3. Address decoding flow and address translation units of Marvell Armada 8K SoC family</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-amb.html">11.4. AMB - AXI MBUS address decoding</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-amb.html#mandatory-functions">11.4.1. Mandatory functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-amb.html#mandatory-structures">11.4.2. Mandatory structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-amb.html#examples">11.4.3. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-ccu.html">11.5. Marvell CCU address decoding bindings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-ccu.html#mandatory-functions">11.5.1. Mandatory functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-ccu.html#mandatory-structures">11.5.2. Mandatory structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-ccu.html#example">11.5.3. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-io-win.html">11.6. Marvell IO WIN address decoding bindings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-io-win.html#mandatory-functions">11.6.1. Mandatory functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-io-win.html#mandatory-structures">11.6.2. Mandatory structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-io-win.html#example">11.6.3. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-iob.html">11.7. Marvell IOB address decoding bindings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-iob.html#mandatory-functions">11.7.1. Mandatory functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-iob.html#mandatory-structures">11.7.2. Mandatory structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-iob.html#target-id-options">11.7.3. Target ID options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-iob.html#example">11.7.4. Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/mt8183.html">12. MediaTek 8183</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/mt8183.html#boot-sequence">12.1. Boot Sequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/mt8183.html#how-to-build">12.2. How to Build</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/mt8192.html">13. MediaTek 8192</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/mt8192.html#boot-sequence">13.1. Boot Sequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/mt8192.html#how-to-build">13.2. How to Build</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/nvidia-tegra.html">14. NVIDIA Tegra</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/nvidia-tegra.html#directory-structure">14.1. Directory structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/nvidia-tegra.html#trusted-os-dispatcher">14.2. Trusted OS dispatcher</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/nvidia-tegra.html#scatter-files">14.3. Scatter files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/nvidia-tegra.html#preparing-the-bl31-image-to-run-on-tegra-socs">14.4. Preparing the BL31 image to run on Tegra SoCs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/nvidia-tegra.html#power-management">14.5. Power Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/nvidia-tegra.html#tegra-configs">14.6. Tegra configs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/warp7.html">15. NXP i.MX7 WaRP7</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/warp7.html#boot-flow">15.1. Boot Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/warp7.html#build-instructions">15.2. Build Instructions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/warp7.html#u-boot">15.2.1. U-Boot</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/warp7.html#op-tee">15.2.2. OP-TEE</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/warp7.html#tf-a">15.2.3. TF-A</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/warp7.html#fip">15.2.4. FIP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/warp7.html#deploy-images">15.3. Deploy Images</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/warp7.html#signing-bl2">15.4. Signing BL2</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/imx8.html">16. NXP i.MX 8 Series</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/imx8.html#boot-sequence">16.1. Boot Sequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/imx8.html#how-to-build">16.2. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/imx8.html#build-procedure">16.2.1. Build Procedure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/imx8.html#deploy-tf-a-images">16.2.2. Deploy TF-A Images</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/imx8m.html">17. NXP i.MX 8M Series</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/imx8m.html#boot-sequence">17.1. Boot Sequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/imx8m.html#how-to-build">17.2. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/imx8m.html#build-procedure">17.2.1. Build Procedure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/imx8m.html#deploy-tf-a-images">17.2.2. Deploy TF-A Images</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/ls1043a.html">18. NXP QorIQ® LS1043A</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/ls1043a.html#ls1043ardb-specification">18.1. LS1043ARDB Specification:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/ls1043a.html#boot-sequence">18.2. Boot Sequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/ls1043a.html#how-to-build">18.3. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/ls1043a.html#build-procedure">18.3.1. Build Procedure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/ls1043a.html#deploy-tf-a-images">18.3.2. Deploy TF-A Images</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/poplar.html">19. Poplar</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/poplar.html#how-to-build">19.1. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/poplar.html#code-locations">19.1.1. Code Locations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/poplar.html#build-procedure">19.1.2. Build Procedure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/poplar.html#install-procedure">19.2. Install Procedure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/poplar.html#boot-trace">19.3. Boot trace</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/qemu.html">20. QEMU virt Armv8-A</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/qemu.html#getting-non-tf-images">20.1. Getting non-TF images</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/qemu.html#booting-via-semi-hosting-option">20.2. Booting via semi-hosting option</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/qemu.html#booting-via-flash-based-firmwares">20.3. Booting via flash based firmwares</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/qemu-sbsa.html">21. QEMU SBSA Target</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plat/qti.html">22. Qualcomm Technologies, Inc.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/qti.html#boot-trace">22.1. Boot Trace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/qti.html#how-to-build">22.2. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/qti.html#code-locations">22.2.1. Code Locations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/qti.html#build-procedure">22.2.2. Build Procedure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/rpi3.html">23. Raspberry Pi 3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/rpi3.html#design">23.1. Design</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/rpi3.html#placement-of-images">23.1.1. Placement of images</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/rpi3.html#boot-sequence">23.1.2. Boot sequence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/rpi3.html#secondary-cores">23.1.3. Secondary cores</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/rpi3.html#build-instructions">23.2. Build Instructions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/rpi3.html#building-the-firmware-for-kernels-that-don-t-support-psci">23.2.1. Building the firmware for kernels that don’t support PSCI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/rpi3.html#building-the-firmware-for-kernels-that-support-psci">23.2.2. Building the firmware for kernels that support PSCI</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/rpi3.html#aarch64-kernel-build-instructions">23.3. AArch64 kernel build instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/rpi3.html#setup-sd-card">23.4. Setup SD card</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/rpi4.html">24. Raspberry Pi 4</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/rpi4.html#build-instructions">24.1. Build Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/rpi4.html#tf-a-port-design">24.2. TF-A port design</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/rcar-gen3.html">25. Renesas R-Car</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/rcar-gen3.html#renesas-r-car-gen3-evaluation-boards">25.1. Renesas R-Car Gen3 evaluation boards:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/rcar-gen3.html#overview">25.2. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/rcar-gen3.html#how-to-build">25.3. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/rcar-gen3.html#build-tested">25.3.1. Build Tested:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/rcar-gen3.html#system-tested">25.3.2. System Tested:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/rcar-gen3.html#tf-a-build-procedure">25.3.3. TF-A Build Procedure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/rcar-gen3.html#install-procedure">25.3.4. Install Procedure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/rcar-gen3.html#boot-trace">25.4. Boot trace</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/rz-g2.html">26. Renesas RZ/G</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/rz-g2.html#renesas-rz-g2-reference-platforms">26.1. Renesas RZ/G2 reference platforms:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/rz-g2.html#overview">26.2. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/rz-g2.html#how-to-build">26.3. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/rz-g2.html#build-tested">26.3.1. Build Tested:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/rz-g2.html#system-tested">26.3.2. System Tested:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/rz-g2.html#tf-a-build-procedure">26.3.3. TF-A Build Procedure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/rz-g2.html#install-procedure">26.3.4. Install Procedure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/rz-g2.html#boot-trace">26.4. Boot trace</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/rockchip.html">27. Rockchip SoCs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/rockchip.html#boot-sequence">27.1. Boot Sequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/rockchip.html#how-to-build">27.2. How to build</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/rockchip.html#how-to-deploy">27.3. How to deploy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/socionext-uniphier.html">28. Socionext UniPhier</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/socionext-uniphier.html#boot-flow">28.1. Boot Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/socionext-uniphier.html#basic-build">28.2. Basic Build</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/socionext-uniphier.html#optional-features">28.3. Optional features</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/synquacer.html">29. Socionext Synquacer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/synquacer.html#how-to-build">29.1. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/synquacer.html#code-locations">29.1.1. Code Locations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/synquacer.html#boot-flow">29.1.2. Boot Flow</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/synquacer.html#build-procedure">29.1.3. Build Procedure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/synquacer.html#install-the-system-firmware">29.1.4. Install the System Firmware</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/stm32mp1.html">30. STMicroelectronics STM32MP1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/stm32mp1.html#stm32mp1-versions">30.1. STM32MP1 Versions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/stm32mp1.html#design">30.2. Design</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/stm32mp1.html#memory-mapping">30.2.1. Memory mapping</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/stm32mp1.html#boot-sequence">30.2.2. Boot sequence</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/stm32mp1.html#build-instructions">30.3. Build Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/stm32mp1.html#populate-sd-card">30.4. Populate SD-card</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/ti-k3.html">31. Texas Instruments K3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/ti-k3.html#boot-flow">31.1. Boot Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/ti-k3.html#build-instructions">31.2. Build Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/ti-k3.html#deploy-images">31.3. Deploy Images</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/xilinx-versal.html">32. Xilinx Versal</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/xilinx-versal.html#xilinx-versal-platform-specific-build-options">32.1. Xilinx Versal platform specific build options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/xilinx-versal.html#plm-tf-a-parameter-passing">32.2. # PLM-&gt;TF-A Parameter Passing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/xilinx-zynqmp.html">33. Xilinx Zynq UltraScale+ MPSoC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/xilinx-zynqmp.html#zynqmp-platform-specific-build-options">33.1. ZynqMP platform specific build options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/xilinx-zynqmp.html#fsbl-tf-a-parameter-passing">33.2. FSBL-&gt;TF-A Parameter Passing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/xilinx-zynqmp.html#power-domain-tree">33.3. Power Domain Tree</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/brcm-stingray.html">34. Broadcom Stingray</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/brcm-stingray.html#description">34.1. Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/brcm-stingray.html#boot-sequence">34.2. Boot Sequence</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/brcm-stingray.html#code-locations">34.2.1. Code Locations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/brcm-stingray.html#how-to-build">34.3. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/brcm-stingray.html#build-procedure">34.3.1. Build Procedure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/brcm-stingray.html#deploy-tf-a-images">34.3.2. Deploy TF-A Images</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../perf/index.html">Performance &amp; Testing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../perf/psci-performance-juno.html">1. PSCI Performance Measurements on Arm Juno Development Platform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../perf/psci-performance-juno.html#method">1.1. Method</a></li>
<li class="toctree-l3"><a class="reference internal" href="../perf/psci-performance-juno.html#results-and-commentary">1.2. Results and Commentary</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../perf/psci-performance-juno.html#cpu-suspend-to-deepest-power-level-on-all-cpus-in-parallel">1.2.1. <code class="docutils literal notranslate"><span class="pre">CPU_SUSPEND</span></code> to deepest power level on all CPUs in parallel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../perf/psci-performance-juno.html#cpu-suspend-to-power-level-0-on-all-cpus-in-parallel">1.2.2. <code class="docutils literal notranslate"><span class="pre">CPU_SUSPEND</span></code> to power level 0 on all CPUs in parallel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../perf/psci-performance-juno.html#cpu-suspend-to-deepest-power-level-on-all-cpus-in-sequence">1.2.3. <code class="docutils literal notranslate"><span class="pre">CPU_SUSPEND</span></code> to deepest power level on all CPUs in sequence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../perf/psci-performance-juno.html#cpu-suspend-to-power-level-0-on-all-cpus-in-sequence">1.2.4. <code class="docutils literal notranslate"><span class="pre">CPU_SUSPEND</span></code> to power level 0 on all CPUs in sequence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../perf/psci-performance-juno.html#cpu-off-on-all-non-lead-cpus-in-sequence-then-cpu-suspend-on-lead-cpu-to-deepest-power-level">1.2.5. <code class="docutils literal notranslate"><span class="pre">CPU_OFF</span></code> on all non-lead CPUs in sequence then <code class="docutils literal notranslate"><span class="pre">CPU_SUSPEND</span></code> on lead CPU to deepest power level</a></li>
<li class="toctree-l4"><a class="reference internal" href="../perf/psci-performance-juno.html#psci-version-on-all-cpus-in-parallel">1.2.6. <code class="docutils literal notranslate"><span class="pre">PSCI_VERSION</span></code> on all CPUs in parallel</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../perf/tsp.html">2. Test Secure Payload (TSP) and Dispatcher (TSPD)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../perf/tsp.html#building-the-test-secure-payload">2.1. Building the Test Secure Payload</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../perf/performance-monitoring-unit.html">3. Performance Monitoring Unit</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../perf/performance-monitoring-unit.html#pmu-counters">3.1. PMU Counters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../perf/performance-monitoring-unit.html#architectural-mappings">3.1.1. Architectural mappings</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../perf/performance-monitoring-unit.html#configuring-the-pmu-for-counting-events">3.2. Configuring the PMU for counting events</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../perf/performance-monitoring-unit.html#id1">3.2.1. Architectural mappings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../perf/performance-monitoring-unit.html#relevant-register-fields">3.2.2. Relevant register fields</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../security_advisories/index.html">Security Advisories</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../security_advisories/security-advisory-tfv-1.html">1. Advisory TFV-1 (CVE-2016-10319)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security_advisories/security-advisory-tfv-2.html">2. Advisory TFV-2 (CVE-2017-7564)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security_advisories/security-advisory-tfv-3.html">3. Advisory TFV-3 (CVE-2017-7563)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security_advisories/security-advisory-tfv-4.html">4. Advisory TFV-4 (CVE-2017-9607)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security_advisories/security-advisory-tfv-5.html">5. Advisory TFV-5 (CVE-2017-15031)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security_advisories/security-advisory-tfv-6.html">6. Advisory TFV-6 (CVE-2017-5753, CVE-2017-5715, CVE-2017-5754)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../security_advisories/security-advisory-tfv-6.html#variant-1-cve-2017-5753">6.1. Variant 1 (CVE-2017-5753)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../security_advisories/security-advisory-tfv-6.html#variant-2-cve-2017-5715">6.2. Variant 2 (CVE-2017-5715)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../security_advisories/security-advisory-tfv-6.html#variant-3-cve-2017-5754">6.3. Variant 3 (CVE-2017-5754)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../security_advisories/security-advisory-tfv-7.html">7. Advisory TFV-7 (CVE-2018-3639)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../security_advisories/security-advisory-tfv-7.html#static-mitigation">7.1. Static mitigation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../security_advisories/security-advisory-tfv-7.html#dynamic-mitigation">7.2. Dynamic mitigation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../security_advisories/security-advisory-tfv-8.html">8. Advisory TFV-8 (CVE-2018-19440)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../design_documents/index.html">Design Documents</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../design_documents/cmake_framework.html">1. TF-A CMake Build System Proposal</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../design_documents/cmake_framework.html#abstract">1.1. Abstract</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design_documents/cmake_framework.html#introduction">1.2. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design_documents/cmake_framework.html#main-features">1.3. Main features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../design_documents/cmake_framework.html#structured-configuration-description">1.3.1. Structured configuration description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design_documents/cmake_framework.html#target-description">1.3.2. Target description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design_documents/cmake_framework.html#compiler-abstraction">1.3.3. Compiler abstraction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design_documents/cmake_framework.html#external-tools">1.3.4. External tools</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../design_documents/cmake_framework.html#workflow">1.4. Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design_documents/cmake_framework.html#example">1.5. Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../change-log.html">Change Log &amp; Release Notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-2-4">Version 2.4</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#new-features">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#changed">Changed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#resolved-issues">Resolved Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#known-issues">Known Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-2-3">Version 2.3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id1">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id2">Changed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id3">Resolved Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id4">Known Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-2-2">Version 2.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id5">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id6">Changed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id7">Resolved Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#deprecations">Deprecations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id8">Known Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-2-1">Version 2.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id9">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id10">Changed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id11">Resolved Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id12">Deprecations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id13">Known Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-2-0">Version 2.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id14">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#issues-resolved-since-last-release">Issues resolved since last release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id15">Known Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-1-6">Version 1.6</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id16">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id17">Issues resolved since last release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id18">Known Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-1-5">Version 1.5</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id19">New features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id20">Issues resolved since last release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id21">Known Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-1-4">Version 1.4</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id22">New features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id23">Issues resolved since last release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id24">Known Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-1-3">Version 1.3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id25">New features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id26">Issues resolved since last release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id27">Known issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-1-2">Version 1.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id28">New features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id29">Issues resolved since last release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id30">Known issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-1-1">Version 1.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id31">New features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id32">Issues resolved since last release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id33">Known issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-1-0">Version 1.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id34">New features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id35">Issues resolved since last release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id36">Known issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-0-4">Version 0.4</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id37">New features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id38">Issues resolved since last release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id39">Known issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-0-3">Version 0.3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id40">New features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id41">Issues resolved since last release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id42">Known issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-0-2">Version 0.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id43">New features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id44">Issues resolved since last release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id45">Known issues</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../change-log-upcoming.html">Change Log for Upcoming Release</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../change-log-upcoming.html#upcoming-release-version-2-4">Upcoming Release Version 2.4</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log-upcoming.html#new-features">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log-upcoming.html#changed">Changed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log-upcoming.html#resolved-issues">Resolved Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log-upcoming.html#deprecations">Deprecations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log-upcoming.html#known-issues">Known Issues</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../license.html#spdx-identifiers">SPDX Identifiers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../license.html#other-projects">Other Projects</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cmake/index.html">Build System Manual</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cmake/index.html#contents">Contents</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cmake/concepts.html">Build System Concepts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cmake/concepts.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cmake/concepts.html#high-level-requirements">High-level requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cmake/concepts.html#configuration-space">Configuration space</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cmake/concepts.html#structured-programming-concepts-with-cmake">Structured Programming Concepts With CMake</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cmake/concepts.html#structuring-the-project">Structuring the project.</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cmake/concepts.html#entry-points">Entry points</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cmake/concepts.html#todo-items">TODO items</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../cmake/user_guide.html">Build System Users Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cmake/user_guide.html#what-is-needed-to-build-with-cmake">What is needed to build with CMake?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cmake/user_guide.html#how-to-build-with-cmake">How-to build with CMake</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cmake/user_guide.html#current-limitations">Current limitations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cmake/user_guide.html#list-of-modules">List of modules</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Trusted Firmware-A</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Getting Started</a> &raquo;</li>
        
      <li><span class="section-number">7. </span>Porting Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/getting_started/porting-guide.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="psci-lib-integration-guide.html" class="btn btn-neutral float-right" title="8. PSCI Library Integration guide for Armv8-A AArch32 systems" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
      
      
        <a href="image-terminology.html" class="btn btn-neutral float-left" title="6. Image Terminology" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="porting-guide">
<h1><span class="section-number">7. </span>Porting Guide<a class="headerlink" href="#porting-guide" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2><span class="section-number">7.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Porting Trusted Firmware-A (TF-A) to a new platform involves making some
mandatory and optional modifications for both the cold and warm boot paths.
Modifications consist of:</p>
<ul class="simple">
<li><p>Implementing a platform-specific function or variable,</p></li>
<li><p>Setting up the execution context in a certain way, or</p></li>
<li><p>Defining certain constants (for example #defines).</p></li>
</ul>
<p>The platform-specific functions and variables are declared in
<code class="docutils literal notranslate"><span class="pre">include/plat/common/platform.h</span></code>. The firmware provides a default
implementation of variables and functions to fulfill the optional requirements.
These implementations are all weakly defined; they are provided to ease the
porting effort. Each platform port can override them with its own implementation
if the default implementation is inadequate.</p>
<p>Some modifications are common to all Boot Loader (BL) stages. Section 2
discusses these in detail. The subsequent sections discuss the remaining
modifications for each BL stage in detail.</p>
<p>Please refer to the <a class="reference internal" href="../process/platform-compatibility-policy.html#platform-compatibility-policy"><span class="std std-ref">Platform Compatibility Policy</span></a> for the policy
regarding compatibility and deprecation of these porting interfaces.</p>
<p>Only Arm development platforms (such as FVP and Juno) may use the
functions/definitions in <code class="docutils literal notranslate"><span class="pre">include/plat/arm/common/</span></code> and the corresponding
source files in <code class="docutils literal notranslate"><span class="pre">plat/arm/common/</span></code>. This is done so that there are no
dependencies between platforms maintained by different people/companies. If you
want to use any of the functionality present in <code class="docutils literal notranslate"><span class="pre">plat/arm</span></code> files, please
create a pull request that moves the code to <code class="docutils literal notranslate"><span class="pre">plat/common</span></code> so that it can be
discussed.</p>
</div>
<div class="section" id="common-modifications">
<h2><span class="section-number">7.2. </span>Common modifications<a class="headerlink" href="#common-modifications" title="Permalink to this headline">¶</a></h2>
<p>This section covers the modifications that should be made by the platform for
each BL stage to correctly port the firmware stack. They are categorized as
either mandatory or optional.</p>
</div>
<div class="section" id="common-mandatory-modifications">
<h2><span class="section-number">7.3. </span>Common mandatory modifications<a class="headerlink" href="#common-mandatory-modifications" title="Permalink to this headline">¶</a></h2>
<p>A platform port must enable the Memory Management Unit (MMU) as well as the
instruction and data caches for each BL stage. Setting up the translation
tables is the responsibility of the platform port because memory maps differ
across platforms. A memory translation library (see <code class="docutils literal notranslate"><span class="pre">lib/xlat_tables/</span></code>) is
provided to help in this setup.</p>
<p>Note that although this library supports non-identity mappings, this is intended
only for re-mapping peripheral physical addresses and allows platforms with high
I/O addresses to reduce their virtual address space. All other addresses
corresponding to code and data must currently use an identity mapping.</p>
<p>Also, the only translation granule size supported in TF-A is 4KB, as various
parts of the code assume that is the case. It is not possible to switch to
16 KB or 64 KB granule sizes at the moment.</p>
<p>In Arm standard platforms, each BL stage configures the MMU in the
platform-specific architecture setup function, <code class="docutils literal notranslate"><span class="pre">blX_plat_arch_setup()</span></code>, and uses
an identity mapping for all addresses.</p>
<p>If the build option <code class="docutils literal notranslate"><span class="pre">USE_COHERENT_MEM</span></code> is enabled, each platform can allocate a
block of identity mapped secure memory with Device-nGnRE attributes aligned to
page boundary (4K) for each BL stage. All sections which allocate coherent
memory are grouped under <code class="docutils literal notranslate"><span class="pre">coherent_ram</span></code>. For ex: Bakery locks are placed in a
section identified by name <code class="docutils literal notranslate"><span class="pre">bakery_lock</span></code> inside <code class="docutils literal notranslate"><span class="pre">coherent_ram</span></code> so that its
possible for the firmware to place variables in it using the following C code
directive:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">__section</span><span class="p">(</span><span class="s2">&quot;bakery_lock&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Or alternatively the following assembler code directive:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">section</span> <span class="n">bakery_lock</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">coherent_ram</span></code> section is a sum of all sections like <code class="docutils literal notranslate"><span class="pre">bakery_lock</span></code> which are
used to allocate any data structures that are accessed both when a CPU is
executing with its MMU and caches enabled, and when it’s running with its MMU
and caches disabled. Examples are given below.</p>
<p>The following variables, functions and constants must be defined by the platform
for the firmware to work correctly.</p>
<div class="section" id="file-platform-def-h-mandatory">
<h3><span class="section-number">7.3.1. </span>File : platform_def.h [mandatory]<a class="headerlink" href="#file-platform-def-h-mandatory" title="Permalink to this headline">¶</a></h3>
<p>Each platform must ensure that a header file of this name is in the system
include path with the following constants defined. This will require updating
the list of <code class="docutils literal notranslate"><span class="pre">PLAT_INCLUDES</span></code> in the <code class="docutils literal notranslate"><span class="pre">platform.mk</span></code> file.</p>
<p>Platform ports may optionally use the file <code class="docutils literal notranslate"><span class="pre">include/plat/common/common_def.h</span></code>,
which provides typical values for some of the constants below. These values are
likely to be suitable for all platform ports.</p>
<ul>
<li><p><strong>#define : PLATFORM_LINKER_FORMAT</strong></p>
<p>Defines the linker format used by the platform, for example
<code class="docutils literal notranslate"><span class="pre">elf64-littleaarch64</span></code>.</p>
</li>
<li><p><strong>#define : PLATFORM_LINKER_ARCH</strong></p>
<p>Defines the processor architecture for the linker by the platform, for
example <code class="docutils literal notranslate"><span class="pre">aarch64</span></code>.</p>
</li>
<li><p><strong>#define : PLATFORM_STACK_SIZE</strong></p>
<p>Defines the normal stack memory available to each CPU. This constant is used
by <code class="docutils literal notranslate"><span class="pre">plat/common/aarch64/platform_mp_stack.S</span></code> and
<code class="docutils literal notranslate"><span class="pre">plat/common/aarch64/platform_up_stack.S</span></code>.</p>
</li>
<li><p><strong>#define : CACHE_WRITEBACK_GRANULE</strong></p>
<p>Defines the size in bits of the largest cache line across all the cache
levels in the platform.</p>
</li>
<li><p><strong>#define : FIRMWARE_WELCOME_STR</strong></p>
<p>Defines the character string printed by BL1 upon entry into the <code class="docutils literal notranslate"><span class="pre">bl1_main()</span></code>
function.</p>
</li>
<li><p><strong>#define : PLATFORM_CORE_COUNT</strong></p>
<p>Defines the total number of CPUs implemented by the platform across all
clusters in the system.</p>
</li>
<li><p><strong>#define : PLAT_NUM_PWR_DOMAINS</strong></p>
<p>Defines the total number of nodes in the power domain topology
tree at all the power domain levels used by the platform.
This macro is used by the PSCI implementation to allocate
data structures to represent power domain topology.</p>
</li>
<li><p><strong>#define : PLAT_MAX_PWR_LVL</strong></p>
<p>Defines the maximum power domain level that the power management operations
should apply to. More often, but not always, the power domain level
corresponds to affinity level. This macro allows the PSCI implementation
to know the highest power domain level that it should consider for power
management operations in the system that the platform implements. For
example, the Base AEM FVP implements two clusters with a configurable
number of CPUs and it reports the maximum power domain level as 1.</p>
</li>
<li><p><strong>#define : PLAT_MAX_OFF_STATE</strong></p>
<p>Defines the local power state corresponding to the deepest power down
possible at every power domain level in the platform. The local power
states for each level may be sparsely allocated between 0 and this value
with 0 being reserved for the RUN state. The PSCI implementation uses this
value to initialize the local power states of the power domain nodes and
to specify the requested power state for a PSCI_CPU_OFF call.</p>
</li>
<li><p><strong>#define : PLAT_MAX_RET_STATE</strong></p>
<p>Defines the local power state corresponding to the deepest retention state
possible at every power domain level in the platform. This macro should be
a value less than PLAT_MAX_OFF_STATE and greater than 0. It is used by the
PSCI implementation to distinguish between retention and power down local
power states within PSCI_CPU_SUSPEND call.</p>
</li>
<li><p><strong>#define : PLAT_MAX_PWR_LVL_STATES</strong></p>
<p>Defines the maximum number of local power states per power domain level
that the platform supports. The default value of this macro is 2 since
most platforms just support a maximum of two local power states at each
power domain level (power-down and retention). If the platform needs to
account for more local power states, then it must redefine this macro.</p>
<p>Currently, this macro is used by the Generic PSCI implementation to size
the array used for PSCI_STAT_COUNT/RESIDENCY accounting.</p>
</li>
<li><p><strong>#define : BL1_RO_BASE</strong></p>
<p>Defines the base address in secure ROM where BL1 originally lives. Must be
aligned on a page-size boundary.</p>
</li>
<li><p><strong>#define : BL1_RO_LIMIT</strong></p>
<p>Defines the maximum address in secure ROM that BL1’s actual content (i.e.
excluding any data section allocated at runtime) can occupy.</p>
</li>
<li><p><strong>#define : BL1_RW_BASE</strong></p>
<p>Defines the base address in secure RAM where BL1’s read-write data will live
at runtime. Must be aligned on a page-size boundary.</p>
</li>
<li><p><strong>#define : BL1_RW_LIMIT</strong></p>
<p>Defines the maximum address in secure RAM that BL1’s read-write data can
occupy at runtime.</p>
</li>
<li><p><strong>#define : BL2_BASE</strong></p>
<p>Defines the base address in secure RAM where BL1 loads the BL2 binary image.
Must be aligned on a page-size boundary. This constant is not applicable
when BL2_IN_XIP_MEM is set to ‘1’.</p>
</li>
<li><p><strong>#define : BL2_LIMIT</strong></p>
<p>Defines the maximum address in secure RAM that the BL2 image can occupy.
This constant is not applicable when BL2_IN_XIP_MEM is set to ‘1’.</p>
</li>
<li><p><strong>#define : BL2_RO_BASE</strong></p>
<p>Defines the base address in secure XIP memory where BL2 RO section originally
lives. Must be aligned on a page-size boundary. This constant is only needed
when BL2_IN_XIP_MEM is set to ‘1’.</p>
</li>
<li><p><strong>#define : BL2_RO_LIMIT</strong></p>
<p>Defines the maximum address in secure XIP memory that BL2’s actual content
(i.e. excluding any data section allocated at runtime) can occupy. This
constant is only needed when BL2_IN_XIP_MEM is set to ‘1’.</p>
</li>
<li><p><strong>#define : BL2_RW_BASE</strong></p>
<p>Defines the base address in secure RAM where BL2’s read-write data will live
at runtime. Must be aligned on a page-size boundary. This constant is only
needed when BL2_IN_XIP_MEM is set to ‘1’.</p>
</li>
<li><p><strong>#define : BL2_RW_LIMIT</strong></p>
<p>Defines the maximum address in secure RAM that BL2’s read-write data can
occupy at runtime. This constant is only needed when BL2_IN_XIP_MEM is set
to ‘1’.</p>
</li>
<li><p><strong>#define : BL31_BASE</strong></p>
<p>Defines the base address in secure RAM where BL2 loads the BL31 binary
image. Must be aligned on a page-size boundary.</p>
</li>
<li><p><strong>#define : BL31_LIMIT</strong></p>
<p>Defines the maximum address in secure RAM that the BL31 image can occupy.</p>
</li>
</ul>
<p>For every image, the platform must define individual identifiers that will be
used by BL1 or BL2 to load the corresponding image into memory from non-volatile
storage. For the sake of performance, integer numbers will be used as
identifiers. The platform will use those identifiers to return the relevant
information about the image to be loaded (file handler, load address,
authentication information, etc.). The following image identifiers are
mandatory:</p>
<ul>
<li><p><strong>#define : BL2_IMAGE_ID</strong></p>
<p>BL2 image identifier, used by BL1 to load BL2.</p>
</li>
<li><p><strong>#define : BL31_IMAGE_ID</strong></p>
<p>BL31 image identifier, used by BL2 to load BL31.</p>
</li>
<li><p><strong>#define : BL33_IMAGE_ID</strong></p>
<p>BL33 image identifier, used by BL2 to load BL33.</p>
</li>
</ul>
<p>If Trusted Board Boot is enabled, the following certificate identifiers must
also be defined:</p>
<ul>
<li><p><strong>#define : TRUSTED_BOOT_FW_CERT_ID</strong></p>
<p>BL2 content certificate identifier, used by BL1 to load the BL2 content
certificate.</p>
</li>
<li><p><strong>#define : TRUSTED_KEY_CERT_ID</strong></p>
<p>Trusted key certificate identifier, used by BL2 to load the trusted key
certificate.</p>
</li>
<li><p><strong>#define : SOC_FW_KEY_CERT_ID</strong></p>
<p>BL31 key certificate identifier, used by BL2 to load the BL31 key
certificate.</p>
</li>
<li><p><strong>#define : SOC_FW_CONTENT_CERT_ID</strong></p>
<p>BL31 content certificate identifier, used by BL2 to load the BL31 content
certificate.</p>
</li>
<li><p><strong>#define : NON_TRUSTED_FW_KEY_CERT_ID</strong></p>
<p>BL33 key certificate identifier, used by BL2 to load the BL33 key
certificate.</p>
</li>
<li><p><strong>#define : NON_TRUSTED_FW_CONTENT_CERT_ID</strong></p>
<p>BL33 content certificate identifier, used by BL2 to load the BL33 content
certificate.</p>
</li>
<li><p><strong>#define : FWU_CERT_ID</strong></p>
<p>Firmware Update (FWU) certificate identifier, used by NS_BL1U to load the
FWU content certificate.</p>
</li>
<li><p><strong>#define : PLAT_CRYPTOCELL_BASE</strong></p>
<p>This defines the base address of Arm® TrustZone® CryptoCell and must be
defined if CryptoCell crypto driver is used for Trusted Board Boot. For
capable Arm platforms, this driver is used if <code class="docutils literal notranslate"><span class="pre">ARM_CRYPTOCELL_INTEG</span></code> is
set.</p>
</li>
</ul>
<p>If the AP Firmware Updater Configuration image, BL2U is used, the following
must also be defined:</p>
<ul>
<li><p><strong>#define : BL2U_BASE</strong></p>
<p>Defines the base address in secure memory where BL1 copies the BL2U binary
image. Must be aligned on a page-size boundary.</p>
</li>
<li><p><strong>#define : BL2U_LIMIT</strong></p>
<p>Defines the maximum address in secure memory that the BL2U image can occupy.</p>
</li>
<li><p><strong>#define : BL2U_IMAGE_ID</strong></p>
<p>BL2U image identifier, used by BL1 to fetch an image descriptor
corresponding to BL2U.</p>
</li>
</ul>
<p>If the SCP Firmware Update Configuration Image, SCP_BL2U is used, the following
must also be defined:</p>
<ul>
<li><p><strong>#define : SCP_BL2U_IMAGE_ID</strong></p>
<p>SCP_BL2U image identifier, used by BL1 to fetch an image descriptor
corresponding to SCP_BL2U.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>TF-A does not provide source code for this image.</p>
</div>
</li>
</ul>
<p>If the Non-Secure Firmware Updater ROM, NS_BL1U is used, the following must
also be defined:</p>
<ul>
<li><p><strong>#define : NS_BL1U_BASE</strong></p>
<p>Defines the base address in non-secure ROM where NS_BL1U executes.
Must be aligned on a page-size boundary.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>TF-A does not provide source code for this image.</p>
</div>
</li>
<li><p><strong>#define : NS_BL1U_IMAGE_ID</strong></p>
<p>NS_BL1U image identifier, used by BL1 to fetch an image descriptor
corresponding to NS_BL1U.</p>
</li>
</ul>
<p>If the Non-Secure Firmware Updater, NS_BL2U is used, the following must also
be defined:</p>
<ul>
<li><p><strong>#define : NS_BL2U_BASE</strong></p>
<p>Defines the base address in non-secure memory where NS_BL2U executes.
Must be aligned on a page-size boundary.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>TF-A does not provide source code for this image.</p>
</div>
</li>
<li><p><strong>#define : NS_BL2U_IMAGE_ID</strong></p>
<p>NS_BL2U image identifier, used by BL1 to fetch an image descriptor
corresponding to NS_BL2U.</p>
</li>
</ul>
<p>For the the Firmware update capability of TRUSTED BOARD BOOT, the following
macros may also be defined:</p>
<ul>
<li><p><strong>#define : PLAT_FWU_MAX_SIMULTANEOUS_IMAGES</strong></p>
<p>Total number of images that can be loaded simultaneously. If the platform
doesn’t specify any value, it defaults to 10.</p>
</li>
</ul>
<p>If a SCP_BL2 image is supported by the platform, the following constants must
also be defined:</p>
<ul>
<li><p><strong>#define : SCP_BL2_IMAGE_ID</strong></p>
<p>SCP_BL2 image identifier, used by BL2 to load SCP_BL2 into secure memory
from platform storage before being transferred to the SCP.</p>
</li>
<li><p><strong>#define : SCP_FW_KEY_CERT_ID</strong></p>
<p>SCP_BL2 key certificate identifier, used by BL2 to load the SCP_BL2 key
certificate (mandatory when Trusted Board Boot is enabled).</p>
</li>
<li><p><strong>#define : SCP_FW_CONTENT_CERT_ID</strong></p>
<p>SCP_BL2 content certificate identifier, used by BL2 to load the SCP_BL2
content certificate (mandatory when Trusted Board Boot is enabled).</p>
</li>
</ul>
<p>If a BL32 image is supported by the platform, the following constants must
also be defined:</p>
<ul>
<li><p><strong>#define : BL32_IMAGE_ID</strong></p>
<p>BL32 image identifier, used by BL2 to load BL32.</p>
</li>
<li><p><strong>#define : TRUSTED_OS_FW_KEY_CERT_ID</strong></p>
<p>BL32 key certificate identifier, used by BL2 to load the BL32 key
certificate (mandatory when Trusted Board Boot is enabled).</p>
</li>
<li><p><strong>#define : TRUSTED_OS_FW_CONTENT_CERT_ID</strong></p>
<p>BL32 content certificate identifier, used by BL2 to load the BL32 content
certificate (mandatory when Trusted Board Boot is enabled).</p>
</li>
<li><p><strong>#define : BL32_BASE</strong></p>
<p>Defines the base address in secure memory where BL2 loads the BL32 binary
image. Must be aligned on a page-size boundary.</p>
</li>
<li><p><strong>#define : BL32_LIMIT</strong></p>
<p>Defines the maximum address that the BL32 image can occupy.</p>
</li>
</ul>
<p>If the Test Secure-EL1 Payload (TSP) instantiation of BL32 is supported by the
platform, the following constants must also be defined:</p>
<ul>
<li><p><strong>#define : TSP_SEC_MEM_BASE</strong></p>
<p>Defines the base address of the secure memory used by the TSP image on the
platform. This must be at the same address or below <code class="docutils literal notranslate"><span class="pre">BL32_BASE</span></code>.</p>
</li>
<li><p><strong>#define : TSP_SEC_MEM_SIZE</strong></p>
<p>Defines the size of the secure memory used by the BL32 image on the
platform. <code class="docutils literal notranslate"><span class="pre">TSP_SEC_MEM_BASE</span></code> and <code class="docutils literal notranslate"><span class="pre">TSP_SEC_MEM_SIZE</span></code> must fully
accommodate the memory required by the BL32 image, defined by <code class="docutils literal notranslate"><span class="pre">BL32_BASE</span></code>
and <code class="docutils literal notranslate"><span class="pre">BL32_LIMIT</span></code>.</p>
</li>
<li><p><strong>#define : TSP_IRQ_SEC_PHY_TIMER</strong></p>
<p>Defines the ID of the secure physical generic timer interrupt used by the
TSP’s interrupt handling code.</p>
</li>
</ul>
<p>If the platform port uses the translation table library code, the following
constants must also be defined:</p>
<ul>
<li><p><strong>#define : PLAT_XLAT_TABLES_DYNAMIC</strong></p>
<p>Optional flag that can be set per-image to enable the dynamic allocation of
regions even when the MMU is enabled. If not defined, only static
functionality will be available, if defined and set to 1 it will also
include the dynamic functionality.</p>
</li>
<li><p><strong>#define : MAX_XLAT_TABLES</strong></p>
<p>Defines the maximum number of translation tables that are allocated by the
translation table library code. To minimize the amount of runtime memory
used, choose the smallest value needed to map the required virtual addresses
for each BL stage. If <code class="docutils literal notranslate"><span class="pre">PLAT_XLAT_TABLES_DYNAMIC</span></code> flag is enabled for a BL
image, <code class="docutils literal notranslate"><span class="pre">MAX_XLAT_TABLES</span></code> must be defined to accommodate the dynamic regions
as well.</p>
</li>
<li><p><strong>#define : MAX_MMAP_REGIONS</strong></p>
<p>Defines the maximum number of regions that are allocated by the translation
table library code. A region consists of physical base address, virtual base
address, size and attributes (Device/Memory, RO/RW, Secure/Non-Secure), as
defined in the <code class="docutils literal notranslate"><span class="pre">mmap_region_t</span></code> structure. The platform defines the regions
that should be mapped. Then, the translation table library will create the
corresponding tables and descriptors at runtime. To minimize the amount of
runtime memory used, choose the smallest value needed to register the
required regions for each BL stage. If <code class="docutils literal notranslate"><span class="pre">PLAT_XLAT_TABLES_DYNAMIC</span></code> flag is
enabled for a BL image, <code class="docutils literal notranslate"><span class="pre">MAX_MMAP_REGIONS</span></code> must be defined to accommodate
the dynamic regions as well.</p>
</li>
<li><p><strong>#define : PLAT_VIRT_ADDR_SPACE_SIZE</strong></p>
<p>Defines the total size of the virtual address space in bytes. For example,
for a 32 bit virtual address space, this value should be <code class="docutils literal notranslate"><span class="pre">(1ULL</span> <span class="pre">&lt;&lt;</span> <span class="pre">32)</span></code>.</p>
</li>
<li><p><strong>#define : PLAT_PHY_ADDR_SPACE_SIZE</strong></p>
<p>Defines the total size of the physical address space in bytes. For example,
for a 32 bit physical address space, this value should be <code class="docutils literal notranslate"><span class="pre">(1ULL</span> <span class="pre">&lt;&lt;</span> <span class="pre">32)</span></code>.</p>
</li>
</ul>
<p>If the platform port uses the IO storage framework, the following constants
must also be defined:</p>
<ul>
<li><p><strong>#define : MAX_IO_DEVICES</strong></p>
<p>Defines the maximum number of registered IO devices. Attempting to register
more devices than this value using <code class="docutils literal notranslate"><span class="pre">io_register_device()</span></code> will fail with
-ENOMEM.</p>
</li>
<li><p><strong>#define : MAX_IO_HANDLES</strong></p>
<p>Defines the maximum number of open IO handles. Attempting to open more IO
entities than this value using <code class="docutils literal notranslate"><span class="pre">io_open()</span></code> will fail with -ENOMEM.</p>
</li>
<li><p><strong>#define : MAX_IO_BLOCK_DEVICES</strong></p>
<p>Defines the maximum number of registered IO block devices. Attempting to
register more devices this value using <code class="docutils literal notranslate"><span class="pre">io_dev_open()</span></code> will fail
with -ENOMEM. MAX_IO_BLOCK_DEVICES should be less than MAX_IO_DEVICES.
With this macro, multiple block devices could be supported at the same
time.</p>
</li>
</ul>
<p>If the platform needs to allocate data within the per-cpu data framework in
BL31, it should define the following macro. Currently this is only required if
the platform decides not to use the coherent memory section by undefining the
<code class="docutils literal notranslate"><span class="pre">USE_COHERENT_MEM</span></code> build flag. In this case, the framework allocates the
required memory within the the per-cpu data to minimize wastage.</p>
<ul>
<li><p><strong>#define : PLAT_PCPU_DATA_SIZE</strong></p>
<p>Defines the memory (in bytes) to be reserved within the per-cpu data
structure for use by the platform layer.</p>
</li>
</ul>
<p>The following constants are optional. They should be defined when the platform
memory layout implies some image overlaying like in Arm standard platforms.</p>
<ul>
<li><p><strong>#define : BL31_PROGBITS_LIMIT</strong></p>
<p>Defines the maximum address in secure RAM that the BL31’s progbits sections
can occupy.</p>
</li>
<li><p><strong>#define : TSP_PROGBITS_LIMIT</strong></p>
<p>Defines the maximum address that the TSP’s progbits sections can occupy.</p>
</li>
</ul>
<p>If the platform port uses the PL061 GPIO driver, the following constant may
optionally be defined:</p>
<ul class="simple">
<li><p><strong>PLAT_PL061_MAX_GPIOS</strong>
Maximum number of GPIOs required by the platform. This allows control how
much memory is allocated for PL061 GPIO controllers. The default value is</p>
<ol class="arabic simple">
<li><p>$(eval $(call add_define,PLAT_PL061_MAX_GPIOS))</p></li>
</ol>
</li>
</ul>
<p>If the platform port uses the partition driver, the following constant may
optionally be defined:</p>
<ul class="simple">
<li><p><strong>PLAT_PARTITION_MAX_ENTRIES</strong>
Maximum number of partition entries required by the platform. This allows
control how much memory is allocated for partition entries. The default
value is 128.
For example, define the build flag in <code class="docutils literal notranslate"><span class="pre">platform.mk</span></code>:
PLAT_PARTITION_MAX_ENTRIES := 12
$(eval $(call add_define,PLAT_PARTITION_MAX_ENTRIES))</p></li>
<li><p><strong>PLAT_PARTITION_BLOCK_SIZE</strong>
The size of partition block. It could be either 512 bytes or 4096 bytes.
The default value is 512.
For example, define the build flag in <code class="docutils literal notranslate"><span class="pre">platform.mk</span></code>:
PLAT_PARTITION_BLOCK_SIZE := 4096
$(eval $(call add_define,PLAT_PARTITION_BLOCK_SIZE))</p></li>
</ul>
<p>The following constant is optional. It should be defined to override the default
behaviour of the <code class="docutils literal notranslate"><span class="pre">assert()</span></code> function (for example, to save memory).</p>
<ul class="simple">
<li><p><strong>PLAT_LOG_LEVEL_ASSERT</strong>
If <code class="docutils literal notranslate"><span class="pre">PLAT_LOG_LEVEL_ASSERT</span></code> is higher or equal than <code class="docutils literal notranslate"><span class="pre">LOG_LEVEL_VERBOSE</span></code>,
<code class="docutils literal notranslate"><span class="pre">assert()</span></code> prints the name of the file, the line number and the asserted
expression. Else if it is higher than <code class="docutils literal notranslate"><span class="pre">LOG_LEVEL_INFO</span></code>, it prints the file
name and the line number. Else if it is lower than <code class="docutils literal notranslate"><span class="pre">LOG_LEVEL_INFO</span></code>, it
doesn’t print anything to the console. If <code class="docutils literal notranslate"><span class="pre">PLAT_LOG_LEVEL_ASSERT</span></code> isn’t
defined, it defaults to <code class="docutils literal notranslate"><span class="pre">LOG_LEVEL</span></code>.</p></li>
</ul>
<p>If the platform port uses the Activity Monitor Unit, the following constant
may be defined:</p>
<ul class="simple">
<li><p><strong>PLAT_AMU_GROUP1_COUNTERS_MASK</strong>
This mask reflects the set of group counters that should be enabled.  The
maximum number of group 1 counters supported by AMUv1 is 16 so the mask
can be at most 0xffff. If the platform does not define this mask, no group 1
counters are enabled.</p></li>
</ul>
</div>
<div class="section" id="file-plat-macros-s-mandatory">
<h3><span class="section-number">7.3.2. </span>File : plat_macros.S [mandatory]<a class="headerlink" href="#file-plat-macros-s-mandatory" title="Permalink to this headline">¶</a></h3>
<p>Each platform must ensure a file of this name is in the system include path with
the following macro defined. In the Arm development platforms, this file is
found in <code class="docutils literal notranslate"><span class="pre">plat/arm/board/&lt;plat_name&gt;/include/plat_macros.S</span></code>.</p>
<ul>
<li><p><strong>Macro : plat_crash_print_regs</strong></p>
<p>This macro allows the crash reporting routine to print relevant platform
registers in case of an unhandled exception in BL31. This aids in debugging
and this macro can be defined to be empty in case register reporting is not
desired.</p>
<p>For instance, GIC or interconnect registers may be helpful for
troubleshooting.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="handling-reset">
<h2><span class="section-number">7.4. </span>Handling Reset<a class="headerlink" href="#handling-reset" title="Permalink to this headline">¶</a></h2>
<p>BL1 by default implements the reset vector where execution starts from a cold
or warm boot. BL31 can be optionally set as a reset vector using the
<code class="docutils literal notranslate"><span class="pre">RESET_TO_BL31</span></code> make variable.</p>
<p>For each CPU, the reset vector code is responsible for the following tasks:</p>
<ol class="arabic simple">
<li><p>Distinguishing between a cold boot and a warm boot.</p></li>
<li><p>In the case of a cold boot and the CPU being a secondary CPU, ensuring that
the CPU is placed in a platform-specific state until the primary CPU
performs the necessary steps to remove it from this state.</p></li>
<li><p>In the case of a warm boot, ensuring that the CPU jumps to a platform-
specific address in the BL31 image in the same processor mode as it was
when released from reset.</p></li>
</ol>
<p>The following functions need to be implemented by the platform port to enable
reset vector code to perform the above tasks.</p>
<div class="section" id="function-plat-get-my-entrypoint-mandatory-when-programmable-reset-address-0">
<h3><span class="section-number">7.4.1. </span>Function : plat_get_my_entrypoint() [mandatory when PROGRAMMABLE_RESET_ADDRESS == 0]<a class="headerlink" href="#function-plat-get-my-entrypoint-mandatory-when-programmable-reset-address-0" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">uintptr_t</span>
</pre></div>
</div>
<p>This function is called with the MMU and caches disabled
(<code class="docutils literal notranslate"><span class="pre">SCTLR_EL3.M</span></code> = 0 and <code class="docutils literal notranslate"><span class="pre">SCTLR_EL3.C</span></code> = 0). The function is responsible for
distinguishing between a warm and cold reset for the current CPU using
platform-specific means. If it’s a warm reset, then it returns the warm
reset entrypoint point provided to <code class="docutils literal notranslate"><span class="pre">plat_setup_psci_ops()</span></code> during
BL31 initialization. If it’s a cold reset then this function must return zero.</p>
<p>This function does not follow the Procedure Call Standard used by the
Application Binary Interface for the Arm 64-bit architecture. The caller should
not assume that callee saved registers are preserved across a call to this
function.</p>
<p>This function fulfills requirement 1 and 3 listed above.</p>
<p>Note that for platforms that support programming the reset address, it is
expected that a CPU will start executing code directly at the right address,
both on a cold and warm reset. In this case, there is no need to identify the
type of reset nor to query the warm reset entrypoint. Therefore, implementing
this function is not required on such platforms.</p>
</div>
<div class="section" id="function-plat-secondary-cold-boot-setup-mandatory-when-cold-boot-single-cpu-0">
<h3><span class="section-number">7.4.2. </span>Function : plat_secondary_cold_boot_setup() [mandatory when COLD_BOOT_SINGLE_CPU == 0]<a class="headerlink" href="#function-plat-secondary-cold-boot-setup-mandatory-when-cold-boot-single-cpu-0" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function is called with the MMU and data caches disabled. It is responsible
for placing the executing secondary CPU in a platform-specific state until the
primary CPU performs the necessary actions to bring it out of that state and
allow entry into the OS. This function must not return.</p>
<p>In the Arm FVP port, when using the normal boot flow, each secondary CPU powers
itself off. The primary CPU is responsible for powering up the secondary CPUs
when normal world software requires them. When booting an EL3 payload instead,
they stay powered on and are put in a holding pen until their mailbox gets
populated.</p>
<p>This function fulfills requirement 2 above.</p>
<p>Note that for platforms that can’t release secondary CPUs out of reset, only the
primary CPU will execute the cold boot code. Therefore, implementing this
function is not required on such platforms.</p>
</div>
<div class="section" id="function-plat-is-my-cpu-primary-mandatory-when-cold-boot-single-cpu-0">
<h3><span class="section-number">7.4.3. </span>Function : plat_is_my_cpu_primary() [mandatory when COLD_BOOT_SINGLE_CPU == 0]<a class="headerlink" href="#function-plat-is-my-cpu-primary-mandatory-when-cold-boot-single-cpu-0" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">unsigned</span> <span class="nb">int</span>
</pre></div>
</div>
<p>This function identifies whether the current CPU is the primary CPU or a
secondary CPU. A return value of zero indicates that the CPU is not the
primary CPU, while a non-zero return value indicates that the CPU is the
primary CPU.</p>
<p>Note that for platforms that can’t release secondary CPUs out of reset, only the
primary CPU will execute the cold boot code. Therefore, there is no need to
distinguish between primary and secondary CPUs and implementing this function is
not required.</p>
</div>
<div class="section" id="function-platform-mem-init-mandatory">
<h3><span class="section-number">7.4.4. </span>Function : platform_mem_init() [mandatory]<a class="headerlink" href="#function-platform-mem-init-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function is called before any access to data is made by the firmware, in
order to carry out any essential memory initialization.</p>
</div>
<div class="section" id="function-plat-get-rotpk-info">
<h3><span class="section-number">7.4.5. </span>Function: plat_get_rotpk_info()<a class="headerlink" href="#function-plat-get-rotpk-info" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span> <span class="o">*</span><span class="p">,</span> <span class="n">void</span> <span class="o">**</span><span class="p">,</span> <span class="n">unsigned</span> <span class="nb">int</span> <span class="o">*</span><span class="p">,</span> <span class="n">unsigned</span> <span class="nb">int</span> <span class="o">*</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<p>This function is mandatory when Trusted Board Boot is enabled. It returns a
pointer to the ROTPK stored in the platform (or a hash of it) and its length.
The ROTPK must be encoded in DER format according to the following ASN.1
structure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AlgorithmIdentifier</span>  <span class="p">:</span><span class="o">:=</span>  <span class="n">SEQUENCE</span>  <span class="p">{</span>
    <span class="n">algorithm</span>         <span class="n">OBJECT</span> <span class="n">IDENTIFIER</span><span class="p">,</span>
    <span class="n">parameters</span>        <span class="n">ANY</span> <span class="n">DEFINED</span> <span class="n">BY</span> <span class="n">algorithm</span> <span class="n">OPTIONAL</span>
<span class="p">}</span>

<span class="n">SubjectPublicKeyInfo</span>  <span class="p">:</span><span class="o">:=</span>  <span class="n">SEQUENCE</span>  <span class="p">{</span>
    <span class="n">algorithm</span>         <span class="n">AlgorithmIdentifier</span><span class="p">,</span>
    <span class="n">subjectPublicKey</span>  <span class="n">BIT</span> <span class="n">STRING</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In case the function returns a hash of the key:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DigestInfo</span> <span class="p">:</span><span class="o">:=</span> <span class="n">SEQUENCE</span> <span class="p">{</span>
    <span class="n">digestAlgorithm</span>   <span class="n">AlgorithmIdentifier</span><span class="p">,</span>
    <span class="n">digest</span>            <span class="n">OCTET</span> <span class="n">STRING</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The function returns 0 on success. Any other value is treated as error by the
Trusted Board Boot. The function also reports extra information related
to the ROTPK in the flags parameter:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ROTPK_IS_HASH</span>      <span class="p">:</span> <span class="n">Indicates</span> <span class="n">that</span> <span class="n">the</span> <span class="n">ROTPK</span> <span class="n">returned</span> <span class="n">by</span> <span class="n">the</span> <span class="n">platform</span> <span class="ow">is</span> <span class="n">a</span>
                     <span class="nb">hash</span><span class="o">.</span>
<span class="n">ROTPK_NOT_DEPLOYED</span> <span class="p">:</span> <span class="n">This</span> <span class="n">allows</span> <span class="n">the</span> <span class="n">platform</span> <span class="n">to</span> <span class="n">skip</span> <span class="n">certificate</span> <span class="n">ROTPK</span>
                     <span class="n">verification</span> <span class="k">while</span> <span class="n">the</span> <span class="n">platform</span> <span class="n">ROTPK</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">deployed</span><span class="o">.</span>
                     <span class="n">When</span> <span class="n">this</span> <span class="n">flag</span> <span class="ow">is</span> <span class="nb">set</span><span class="p">,</span> <span class="n">the</span> <span class="n">function</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">need</span> <span class="n">to</span>
                     <span class="k">return</span> <span class="n">a</span> <span class="n">platform</span> <span class="n">ROTPK</span><span class="p">,</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">authentication</span>
                     <span class="n">framework</span> <span class="n">uses</span> <span class="n">the</span> <span class="n">ROTPK</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">certificate</span> <span class="n">without</span>
                     <span class="n">verifying</span> <span class="n">it</span> <span class="n">against</span> <span class="n">the</span> <span class="n">platform</span> <span class="n">value</span><span class="o">.</span> <span class="n">This</span> <span class="n">flag</span>
                     <span class="n">must</span> <span class="ow">not</span> <span class="n">be</span> <span class="n">used</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">deployed</span> <span class="n">production</span> <span class="n">environment</span><span class="o">.</span>
</pre></div>
</div>
</div>
<div class="section" id="function-plat-get-nv-ctr">
<h3><span class="section-number">7.4.6. </span>Function: plat_get_nv_ctr()<a class="headerlink" href="#function-plat-get-nv-ctr" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span> <span class="o">*</span><span class="p">,</span> <span class="n">unsigned</span> <span class="nb">int</span> <span class="o">*</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<p>This function is mandatory when Trusted Board Boot is enabled. It returns the
non-volatile counter value stored in the platform in the second argument. The
cookie in the first argument may be used to select the counter in case the
platform provides more than one (for example, on platforms that use the default
TBBR CoT, the cookie will correspond to the OID values defined in
TRUSTED_FW_NVCOUNTER_OID or NON_TRUSTED_FW_NVCOUNTER_OID).</p>
<p>The function returns 0 on success. Any other value means the counter value could
not be retrieved from the platform.</p>
</div>
<div class="section" id="function-plat-set-nv-ctr">
<h3><span class="section-number">7.4.7. </span>Function: plat_set_nv_ctr()<a class="headerlink" href="#function-plat-set-nv-ctr" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span> <span class="o">*</span><span class="p">,</span> <span class="n">unsigned</span> <span class="nb">int</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<p>This function is mandatory when Trusted Board Boot is enabled. It sets a new
counter value in the platform. The cookie in the first argument may be used to
select the counter (as explained in plat_get_nv_ctr()). The second argument is
the updated counter value to be written to the NV counter.</p>
<p>The function returns 0 on success. Any other value means the counter value could
not be updated.</p>
</div>
<div class="section" id="function-plat-set-nv-ctr2">
<h3><span class="section-number">7.4.8. </span>Function: plat_set_nv_ctr2()<a class="headerlink" href="#function-plat-set-nv-ctr2" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span> <span class="o">*</span><span class="p">,</span> <span class="n">const</span> <span class="n">auth_img_desc_t</span> <span class="o">*</span><span class="p">,</span> <span class="n">unsigned</span> <span class="nb">int</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<p>This function is optional when Trusted Board Boot is enabled. If this
interface is defined, then <code class="docutils literal notranslate"><span class="pre">plat_set_nv_ctr()</span></code> need not be defined. The
first argument passed is a cookie and is typically used to
differentiate between a Non Trusted NV Counter and a Trusted NV
Counter. The second argument is a pointer to an authentication image
descriptor and may be used to decide if the counter is allowed to be
updated or not. The third argument is the updated counter value to
be written to the NV counter.</p>
<p>The function returns 0 on success. Any other value means the counter value
either could not be updated or the authentication image descriptor indicates
that it is not allowed to be updated.</p>
</div>
</div>
<div class="section" id="common-mandatory-function-modifications">
<h2><span class="section-number">7.5. </span>Common mandatory function modifications<a class="headerlink" href="#common-mandatory-function-modifications" title="Permalink to this headline">¶</a></h2>
<p>The following functions are mandatory functions which need to be implemented
by the platform port.</p>
<div class="section" id="function-plat-my-core-pos">
<h3><span class="section-number">7.5.1. </span>Function : plat_my_core_pos()<a class="headerlink" href="#function-plat-my-core-pos" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">unsigned</span> <span class="nb">int</span>
</pre></div>
</div>
<p>This function returns the index of the calling CPU which is used as a
CPU-specific linear index into blocks of memory (for example while allocating
per-CPU stacks). This function will be invoked very early in the
initialization sequence which mandates that this function should be
implemented in assembly and should not rely on the availability of a C
runtime environment. This function can clobber x0 - x8 and must preserve
x9 - x29.</p>
<p>This function plays a crucial role in the power domain topology framework in
PSCI and details of this can be found in
<a class="reference internal" href="../design/psci-pd-tree.html#psci-power-domain-tree-structure"><span class="std std-ref">PSCI Power Domain Tree Structure</span></a>.</p>
</div>
<div class="section" id="function-plat-core-pos-by-mpidr">
<h3><span class="section-number">7.5.2. </span>Function : plat_core_pos_by_mpidr()<a class="headerlink" href="#function-plat-core-pos-by-mpidr" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">u_register_t</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<p>This function validates the <code class="docutils literal notranslate"><span class="pre">MPIDR</span></code> of a CPU and converts it to an index,
which can be used as a CPU-specific linear index into blocks of memory. In
case the <code class="docutils literal notranslate"><span class="pre">MPIDR</span></code> is invalid, this function returns -1. This function will only
be invoked by BL31 after the power domain topology is initialized and can
utilize the C runtime environment. For further details about how TF-A
represents the power domain topology and how this relates to the linear CPU
index, please refer <a class="reference internal" href="../design/psci-pd-tree.html#psci-power-domain-tree-structure"><span class="std std-ref">PSCI Power Domain Tree Structure</span></a>.</p>
</div>
<div class="section" id="function-plat-get-mbedtls-heap-when-trusted-board-boot-1">
<h3><span class="section-number">7.5.3. </span>Function : plat_get_mbedtls_heap() [when TRUSTED_BOARD_BOOT == 1]<a class="headerlink" href="#function-plat-get-mbedtls-heap-when-trusted-board-boot-1" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Arguments</span> <span class="p">:</span> <span class="n">void</span> <span class="o">**</span><span class="n">heap_addr</span><span class="p">,</span> <span class="n">size_t</span> <span class="o">*</span><span class="n">heap_size</span>
<span class="n">Return</span>    <span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<p>This function is invoked during Mbed TLS library initialisation to get a heap,
by means of a starting address and a size. This heap will then be used
internally by the Mbed TLS library. Hence, each BL stage that utilises Mbed TLS
must be able to provide a heap to it.</p>
<p>A helper function can be found in <cite>drivers/auth/mbedtls/mbedtls_common.c</cite> in
which a heap is statically reserved during compile time inside every image
(i.e. every BL stage) that utilises Mbed TLS. In this default implementation,
the function simply returns the address and size of this “pre-allocated” heap.
For a platform to use this default implementation, only a call to the helper
from inside plat_get_mbedtls_heap() body is enough and nothing else is needed.</p>
<p>However, by writting their own implementation, platforms have the potential to
optimise memory usage. For example, on some Arm platforms, the Mbed TLS heap is
shared between BL1 and BL2 stages and, thus, the necessary space is not reserved
twice.</p>
<p>On success the function should return 0 and a negative error code otherwise.</p>
</div>
<div class="section" id="function-plat-get-enc-key-info-when-fw-enc-status-0-or-1">
<h3><span class="section-number">7.5.4. </span>Function : plat_get_enc_key_info() [when FW_ENC_STATUS == 0 or 1]<a class="headerlink" href="#function-plat-get-enc-key-info-when-fw-enc-status-0-or-1" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Arguments</span> <span class="p">:</span> <span class="n">enum</span> <span class="n">fw_enc_status_t</span> <span class="n">fw_enc_status</span><span class="p">,</span> <span class="n">uint8_t</span> <span class="o">*</span><span class="n">key</span><span class="p">,</span>
            <span class="n">size_t</span> <span class="o">*</span><span class="n">key_len</span><span class="p">,</span> <span class="n">unsigned</span> <span class="nb">int</span> <span class="o">*</span><span class="n">flags</span><span class="p">,</span> <span class="n">const</span> <span class="n">uint8_t</span> <span class="o">*</span><span class="n">img_id</span><span class="p">,</span>
            <span class="n">size_t</span> <span class="n">img_id_len</span>
<span class="n">Return</span>    <span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<p>This function provides a symmetric key (either SSK or BSSK depending on
fw_enc_status) which is invoked during runtime decryption of encrypted
firmware images. <cite>plat/common/plat_bl_common.c</cite> provides a dummy weak
implementation for testing purposes which must be overridden by the platform
trying to implement a real world firmware encryption use-case.</p>
<p>It also allows the platform to pass symmetric key identifier rather than
actual symmetric key which is useful in cases where the crypto backend provides
secure storage for the symmetric key. So in this case <code class="docutils literal notranslate"><span class="pre">ENC_KEY_IS_IDENTIFIER</span></code>
flag must be set in <code class="docutils literal notranslate"><span class="pre">flags</span></code>.</p>
<p>In addition to above a platform may also choose to provide an image specific
symmetric key/identifier using img_id.</p>
<p>On success the function should return 0 and a negative error code otherwise.</p>
<p>Note that this API depends on <code class="docutils literal notranslate"><span class="pre">DECRYPTION_SUPPORT</span></code> build flag which is
marked as experimental.</p>
</div>
</div>
<div class="section" id="common-optional-modifications">
<h2><span class="section-number">7.6. </span>Common optional modifications<a class="headerlink" href="#common-optional-modifications" title="Permalink to this headline">¶</a></h2>
<p>The following are helper functions implemented by the firmware that perform
common platform-specific tasks. A platform may choose to override these
definitions.</p>
<div class="section" id="function-plat-set-my-stack">
<h3><span class="section-number">7.6.1. </span>Function : plat_set_my_stack()<a class="headerlink" href="#function-plat-set-my-stack" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function sets the current stack pointer to the normal memory stack that
has been allocated for the current CPU. For BL images that only require a
stack for the primary CPU, the UP version of the function is used. The size
of the stack allocated to each CPU is specified by the platform defined
constant <code class="docutils literal notranslate"><span class="pre">PLATFORM_STACK_SIZE</span></code>.</p>
<p>Common implementations of this function for the UP and MP BL images are
provided in <code class="docutils literal notranslate"><span class="pre">plat/common/aarch64/platform_up_stack.S</span></code> and
<code class="docutils literal notranslate"><span class="pre">plat/common/aarch64/platform_mp_stack.S</span></code></p>
</div>
<div class="section" id="function-plat-get-my-stack">
<h3><span class="section-number">7.6.2. </span>Function : plat_get_my_stack()<a class="headerlink" href="#function-plat-get-my-stack" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">uintptr_t</span>
</pre></div>
</div>
<p>This function returns the base address of the normal memory stack that
has been allocated for the current CPU. For BL images that only require a
stack for the primary CPU, the UP version of the function is used. The size
of the stack allocated to each CPU is specified by the platform defined
constant <code class="docutils literal notranslate"><span class="pre">PLATFORM_STACK_SIZE</span></code>.</p>
<p>Common implementations of this function for the UP and MP BL images are
provided in <code class="docutils literal notranslate"><span class="pre">plat/common/aarch64/platform_up_stack.S</span></code> and
<code class="docutils literal notranslate"><span class="pre">plat/common/aarch64/platform_mp_stack.S</span></code></p>
</div>
<div class="section" id="function-plat-report-exception">
<h3><span class="section-number">7.6.3. </span>Function : plat_report_exception()<a class="headerlink" href="#function-plat-report-exception" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">unsigned</span> <span class="nb">int</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>A platform may need to report various information about its status when an
exception is taken, for example the current exception level, the CPU security
state (secure/non-secure), the exception type, and so on. This function is
called in the following circumstances:</p>
<ul class="simple">
<li><p>In BL1, whenever an exception is taken.</p></li>
<li><p>In BL2, whenever an exception is taken.</p></li>
</ul>
<p>The default implementation doesn’t do anything, to avoid making assumptions
about the way the platform displays its status information.</p>
<p>For AArch64, this function receives the exception type as its argument.
Possible values for exceptions types are listed in the
<code class="docutils literal notranslate"><span class="pre">include/common/bl_common.h</span></code> header file. Note that these constants are not
related to any architectural exception code; they are just a TF-A convention.</p>
<p>For AArch32, this function receives the exception mode as its argument.
Possible values for exception modes are listed in the
<code class="docutils literal notranslate"><span class="pre">include/lib/aarch32/arch.h</span></code> header file.</p>
</div>
<div class="section" id="function-plat-reset-handler">
<h3><span class="section-number">7.6.4. </span>Function : plat_reset_handler()<a class="headerlink" href="#function-plat-reset-handler" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>A platform may need to do additional initialization after reset. This function
allows the platform to do the platform specific initializations. Platform
specific errata workarounds could also be implemented here. The API should
preserve the values of callee saved registers x19 to x29.</p>
<p>The default implementation doesn’t do anything. If a platform needs to override
the default implementation, refer to the <a class="reference internal" href="../design/firmware-design.html#firmware-design"><span class="std std-ref">Firmware Design</span></a> for general
guidelines.</p>
</div>
<div class="section" id="function-plat-disable-acp">
<h3><span class="section-number">7.6.5. </span>Function : plat_disable_acp()<a class="headerlink" href="#function-plat-disable-acp" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This API allows a platform to disable the Accelerator Coherency Port (if
present) during a cluster power down sequence. The default weak implementation
doesn’t do anything. Since this API is called during the power down sequence,
it has restrictions for stack usage and it can use the registers x0 - x17 as
scratch registers. It should preserve the value in x18 register as it is used
by the caller to store the return address.</p>
</div>
<div class="section" id="function-plat-error-handler">
<h3><span class="section-number">7.6.6. </span>Function : plat_error_handler()<a class="headerlink" href="#function-plat-error-handler" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="nb">int</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This API is called when the generic code encounters an error situation from
which it cannot continue. It allows the platform to perform error reporting or
recovery actions (for example, reset the system). This function must not return.</p>
<p>The parameter indicates the type of error using standard codes from <code class="docutils literal notranslate"><span class="pre">errno.h</span></code>.
Possible errors reported by the generic code are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">-EAUTH</span></code>: a certificate or image could not be authenticated (when Trusted
Board Boot is enabled)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-ENOENT</span></code>: the requested image or certificate could not be found or an IO
error was detected</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">-ENOMEM</span></code>: resources exhausted. TF-A does not use dynamic memory, so this
error is usually an indication of an incorrect array size</p></li>
</ul>
<p>The default implementation simply spins.</p>
</div>
<div class="section" id="function-plat-panic-handler">
<h3><span class="section-number">7.6.7. </span>Function : plat_panic_handler()<a class="headerlink" href="#function-plat-panic-handler" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This API is called when the generic code encounters an unexpected error
situation from which it cannot recover. This function must not return,
and must be implemented in assembly because it may be called before the C
environment is initialized.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The address from where it was called is stored in x30 (Link Register).
The default implementation simply spins.</p>
</div>
</div>
<div class="section" id="function-plat-get-bl-image-load-info">
<h3><span class="section-number">7.6.8. </span>Function : plat_get_bl_image_load_info()<a class="headerlink" href="#function-plat-get-bl-image-load-info" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">bl_load_info_t</span> <span class="o">*</span>
</pre></div>
</div>
<p>This function returns pointer to the list of images that the platform has
populated to load. This function is invoked in BL2 to load the
BL3xx images.</p>
</div>
<div class="section" id="function-plat-get-next-bl-params">
<h3><span class="section-number">7.6.9. </span>Function : plat_get_next_bl_params()<a class="headerlink" href="#function-plat-get-next-bl-params" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">bl_params_t</span> <span class="o">*</span>
</pre></div>
</div>
<p>This function returns a pointer to the shared memory that the platform has
kept aside to pass TF-A related information that next BL image needs. This
function is invoked in BL2 to pass this information to the next BL
image.</p>
</div>
<div class="section" id="function-plat-get-stack-protector-canary">
<h3><span class="section-number">7.6.10. </span>Function : plat_get_stack_protector_canary()<a class="headerlink" href="#function-plat-get-stack-protector-canary" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">u_register_t</span>
</pre></div>
</div>
<p>This function returns a random value that is used to initialize the canary used
when the stack protector is enabled with ENABLE_STACK_PROTECTOR. A predictable
value will weaken the protection as the attacker could easily write the right
value as part of the attack most of the time. Therefore, it should return a
true random number.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>For the protection to be effective, the global data need to be placed at
a lower address than the stack bases. Failure to do so would allow an
attacker to overwrite the canary as part of the stack buffer overflow attack.</p>
</div>
</div>
<div class="section" id="function-plat-flush-next-bl-params">
<h3><span class="section-number">7.6.11. </span>Function : plat_flush_next_bl_params()<a class="headerlink" href="#function-plat-flush-next-bl-params" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function flushes to main memory all the image params that are passed to
next image. This function is invoked in BL2 to flush this information
to the next BL image.</p>
</div>
<div class="section" id="function-plat-log-get-prefix">
<h3><span class="section-number">7.6.12. </span>Function : plat_log_get_prefix()<a class="headerlink" href="#function-plat-log-get-prefix" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">unsigned</span> <span class="nb">int</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">const</span> <span class="n">char</span> <span class="o">*</span>
</pre></div>
</div>
<p>This function defines the prefix string corresponding to the <cite>log_level</cite> to be
prepended to all the log output from TF-A. The <cite>log_level</cite> (argument) will
correspond to one of the standard log levels defined in debug.h. The platform
can override the common implementation to define a different prefix string for
the log output. The implementation should be robust to future changes that
increase the number of log levels.</p>
</div>
<div class="section" id="function-plat-get-soc-version">
<h3><span class="section-number">7.6.13. </span>Function : plat_get_soc_version()<a class="headerlink" href="#function-plat-get-soc-version" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">int32_t</span>
</pre></div>
</div>
<p>This function returns soc version which mainly consist of below fields</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">soc_version</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">24</span><span class="p">]</span> <span class="o">=</span> <span class="n">JEP</span><span class="o">-</span><span class="mi">106</span> <span class="n">continuation</span> <span class="n">code</span> <span class="k">for</span> <span class="n">the</span> <span class="n">SiP</span>
<span class="n">soc_version</span><span class="p">[</span><span class="mi">23</span><span class="p">:</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="n">JEP</span><span class="o">-</span><span class="mi">106</span> <span class="n">identification</span> <span class="n">code</span> <span class="k">with</span> <span class="n">parity</span> <span class="n">bit</span> <span class="k">for</span> <span class="n">the</span> <span class="n">SiP</span>
<span class="n">soc_version</span><span class="p">[</span><span class="mi">15</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="n">Implementation</span> <span class="n">defined</span> <span class="n">SoC</span> <span class="n">ID</span>
</pre></div>
</div>
</div>
<div class="section" id="function-plat-get-soc-revision">
<h3><span class="section-number">7.6.14. </span>Function : plat_get_soc_revision()<a class="headerlink" href="#function-plat-get-soc-revision" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">int32_t</span>
</pre></div>
</div>
<p>This function returns soc revision in below format</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">soc_revision</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">30</span><span class="p">]</span> <span class="o">=</span> <span class="n">SOC</span> <span class="n">revision</span> <span class="n">of</span> <span class="n">specific</span> <span class="n">SOC</span>
</pre></div>
</div>
</div>
<div class="section" id="function-plat-is-smccc-feature-available">
<h3><span class="section-number">7.6.15. </span>Function : plat_is_smccc_feature_available()<a class="headerlink" href="#function-plat-is-smccc-feature-available" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">u_register_t</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">int32_t</span>
</pre></div>
</div>
<p>This function returns SMC_ARCH_CALL_SUCCESS if the platform supports
the SMCCC function specified in the argument; otherwise returns
SMC_ARCH_CALL_NOT_SUPPORTED.</p>
</div>
</div>
<div class="section" id="modifications-specific-to-a-boot-loader-stage">
<h2><span class="section-number">7.7. </span>Modifications specific to a Boot Loader stage<a class="headerlink" href="#modifications-specific-to-a-boot-loader-stage" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="boot-loader-stage-1-bl1">
<h2><span class="section-number">7.8. </span>Boot Loader Stage 1 (BL1)<a class="headerlink" href="#boot-loader-stage-1-bl1" title="Permalink to this headline">¶</a></h2>
<p>BL1 implements the reset vector where execution starts from after a cold or
warm boot. For each CPU, BL1 is responsible for the following tasks:</p>
<ol class="arabic">
<li><p>Handling the reset as described in section 2.2</p></li>
<li><p>In the case of a cold boot and the CPU being the primary CPU, ensuring that
only this CPU executes the remaining BL1 code, including loading and passing
control to the BL2 stage.</p></li>
<li><p>Identifying and starting the Firmware Update process (if required).</p></li>
<li><p>Loading the BL2 image from non-volatile storage into secure memory at the
address specified by the platform defined constant <code class="docutils literal notranslate"><span class="pre">BL2_BASE</span></code>.</p></li>
<li><p>Populating a <code class="docutils literal notranslate"><span class="pre">meminfo</span></code> structure with the following information in memory,
accessible by BL2 immediately upon entry.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">meminfo</span><span class="o">.</span><span class="n">total_base</span> <span class="o">=</span> <span class="n">Base</span> <span class="n">address</span> <span class="n">of</span> <span class="n">secure</span> <span class="n">RAM</span> <span class="n">visible</span> <span class="n">to</span> <span class="n">BL2</span>
<span class="n">meminfo</span><span class="o">.</span><span class="n">total_size</span> <span class="o">=</span> <span class="n">Size</span> <span class="n">of</span> <span class="n">secure</span> <span class="n">RAM</span> <span class="n">visible</span> <span class="n">to</span> <span class="n">BL2</span>
</pre></div>
</div>
<p>By default, BL1 places this <code class="docutils literal notranslate"><span class="pre">meminfo</span></code> structure at the end of secure
memory visible to BL2.</p>
<p>It is possible for the platform to decide where it wants to place the
<code class="docutils literal notranslate"><span class="pre">meminfo</span></code> structure for BL2 or restrict the amount of memory visible to
BL2 by overriding the weak default implementation of
<code class="docutils literal notranslate"><span class="pre">bl1_plat_handle_post_image_load</span></code> API.</p>
</li>
</ol>
<p>The following functions need to be implemented by the platform port to enable
BL1 to perform the above tasks.</p>
<div class="section" id="function-bl1-early-platform-setup-mandatory">
<h3><span class="section-number">7.8.1. </span>Function : bl1_early_platform_setup() [mandatory]<a class="headerlink" href="#function-bl1-early-platform-setup-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function executes with the MMU and data caches disabled. It is only called
by the primary CPU.</p>
<p>On Arm standard platforms, this function:</p>
<ul class="simple">
<li><p>Enables a secure instance of SP805 to act as the Trusted Watchdog.</p></li>
<li><p>Initializes a UART (PL011 console), which enables access to the <code class="docutils literal notranslate"><span class="pre">printf</span></code>
family of functions in BL1.</p></li>
<li><p>Enables issuing of snoop and DVM (Distributed Virtual Memory) requests to
the CCI slave interface corresponding to the cluster that includes the
primary CPU.</p></li>
</ul>
</div>
<div class="section" id="function-bl1-plat-arch-setup-mandatory">
<h3><span class="section-number">7.8.2. </span>Function : bl1_plat_arch_setup() [mandatory]<a class="headerlink" href="#function-bl1-plat-arch-setup-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function performs any platform-specific and architectural setup that the
platform requires. Platform-specific setup might include configuration of
memory controllers and the interconnect.</p>
<p>In Arm standard platforms, this function enables the MMU.</p>
<p>This function helps fulfill requirement 2 above.</p>
</div>
<div class="section" id="function-bl1-platform-setup-mandatory">
<h3><span class="section-number">7.8.3. </span>Function : bl1_platform_setup() [mandatory]<a class="headerlink" href="#function-bl1-platform-setup-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function executes with the MMU and data caches enabled. It is responsible
for performing any remaining platform-specific setup that can occur after the
MMU and data cache have been enabled.</p>
<p>if support for multiple boot sources is required, it initializes the boot
sequence used by plat_try_next_boot_source().</p>
<p>In Arm standard platforms, this function initializes the storage abstraction
layer used to load the next bootloader image.</p>
<p>This function helps fulfill requirement 4 above.</p>
</div>
<div class="section" id="function-bl1-plat-sec-mem-layout-mandatory">
<h3><span class="section-number">7.8.4. </span>Function : bl1_plat_sec_mem_layout() [mandatory]<a class="headerlink" href="#function-bl1-plat-sec-mem-layout-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">meminfo</span> <span class="o">*</span>
</pre></div>
</div>
<p>This function should only be called on the cold boot path. It executes with the
MMU and data caches enabled. The pointer returned by this function must point to
a <code class="docutils literal notranslate"><span class="pre">meminfo</span></code> structure containing the extents and availability of secure RAM for
the BL1 stage.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">meminfo</span><span class="o">.</span><span class="n">total_base</span> <span class="o">=</span> <span class="n">Base</span> <span class="n">address</span> <span class="n">of</span> <span class="n">secure</span> <span class="n">RAM</span> <span class="n">visible</span> <span class="n">to</span> <span class="n">BL1</span>
<span class="n">meminfo</span><span class="o">.</span><span class="n">total_size</span> <span class="o">=</span> <span class="n">Size</span> <span class="n">of</span> <span class="n">secure</span> <span class="n">RAM</span> <span class="n">visible</span> <span class="n">to</span> <span class="n">BL1</span>
</pre></div>
</div>
<p>This information is used by BL1 to load the BL2 image in secure RAM. BL1 also
populates a similar structure to tell BL2 the extents of memory available for
its own use.</p>
<p>This function helps fulfill requirements 4 and 5 above.</p>
</div>
<div class="section" id="function-bl1-plat-prepare-exit-optional">
<h3><span class="section-number">7.8.5. </span>Function : bl1_plat_prepare_exit() [optional]<a class="headerlink" href="#function-bl1-plat-prepare-exit-optional" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">entry_point_info_t</span> <span class="o">*</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function is called prior to exiting BL1 in response to the
<code class="docutils literal notranslate"><span class="pre">BL1_SMC_RUN_IMAGE</span></code> SMC request raised by BL2. It should be used to perform
platform specific clean up or bookkeeping operations before transferring
control to the next image. It receives the address of the <code class="docutils literal notranslate"><span class="pre">entry_point_info_t</span></code>
structure passed from BL2. This function runs with MMU disabled.</p>
</div>
<div class="section" id="function-bl1-plat-set-ep-info-optional">
<h3><span class="section-number">7.8.6. </span>Function : bl1_plat_set_ep_info() [optional]<a class="headerlink" href="#function-bl1-plat-set-ep-info-optional" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">image_id</span><span class="p">,</span> <span class="n">entry_point_info_t</span> <span class="o">*</span><span class="n">ep_info</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function allows platforms to override <code class="docutils literal notranslate"><span class="pre">ep_info</span></code> for the given <code class="docutils literal notranslate"><span class="pre">image_id</span></code>.</p>
<p>The default implementation just returns.</p>
</div>
<div class="section" id="function-bl1-plat-get-next-image-id-optional">
<h3><span class="section-number">7.8.7. </span>Function : bl1_plat_get_next_image_id() [optional]<a class="headerlink" href="#function-bl1-plat-get-next-image-id-optional" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">unsigned</span> <span class="nb">int</span>
</pre></div>
</div>
<p>This and the following function must be overridden to enable the FWU feature.</p>
<p>BL1 calls this function after platform setup to identify the next image to be
loaded and executed. If the platform returns <code class="docutils literal notranslate"><span class="pre">BL2_IMAGE_ID</span></code> then BL1 proceeds
with the normal boot sequence, which loads and executes BL2. If the platform
returns a different image id, BL1 assumes that Firmware Update is required.</p>
<p>The default implementation always returns <code class="docutils literal notranslate"><span class="pre">BL2_IMAGE_ID</span></code>. The Arm development
platforms override this function to detect if firmware update is required, and
if so, return the first image in the firmware update process.</p>
</div>
<div class="section" id="function-bl1-plat-get-image-desc-optional">
<h3><span class="section-number">7.8.8. </span>Function : bl1_plat_get_image_desc() [optional]<a class="headerlink" href="#function-bl1-plat-get-image-desc-optional" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">image_id</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">image_desc_t</span> <span class="o">*</span>
</pre></div>
</div>
<p>BL1 calls this function to get the image descriptor information <code class="docutils literal notranslate"><span class="pre">image_desc_t</span></code>
for the provided <code class="docutils literal notranslate"><span class="pre">image_id</span></code> from the platform.</p>
<p>The default implementation always returns a common BL2 image descriptor. Arm
standard platforms return an image descriptor corresponding to BL2 or one of
the firmware update images defined in the Trusted Board Boot Requirements
specification.</p>
</div>
<div class="section" id="function-bl1-plat-handle-pre-image-load-optional">
<h3><span class="section-number">7.8.9. </span>Function : bl1_plat_handle_pre_image_load() [optional]<a class="headerlink" href="#function-bl1-plat-handle-pre-image-load-optional" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">image_id</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<p>This function can be used by the platforms to update/use image information
corresponding to <code class="docutils literal notranslate"><span class="pre">image_id</span></code>. This function is invoked in BL1, both in cold
boot and FWU code path, before loading the image.</p>
</div>
<div class="section" id="function-bl1-plat-handle-post-image-load-optional">
<h3><span class="section-number">7.8.10. </span>Function : bl1_plat_handle_post_image_load() [optional]<a class="headerlink" href="#function-bl1-plat-handle-post-image-load-optional" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">image_id</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<p>This function can be used by the platforms to update/use image information
corresponding to <code class="docutils literal notranslate"><span class="pre">image_id</span></code>. This function is invoked in BL1, both in cold
boot and FWU code path, after loading and authenticating the image.</p>
<p>The default weak implementation of this function calculates the amount of
Trusted SRAM that can be used by BL2 and allocates a <code class="docutils literal notranslate"><span class="pre">meminfo_t</span></code>
structure at the beginning of this free memory and populates it. The address
of <code class="docutils literal notranslate"><span class="pre">meminfo_t</span></code> structure is updated in <code class="docutils literal notranslate"><span class="pre">arg1</span></code> of the entrypoint
information to BL2.</p>
</div>
<div class="section" id="function-bl1-plat-fwu-done-optional">
<h3><span class="section-number">7.8.11. </span>Function : bl1_plat_fwu_done() [optional]<a class="headerlink" href="#function-bl1-plat-fwu-done-optional" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">image_id</span><span class="p">,</span> <span class="n">uintptr_t</span> <span class="n">image_src</span><span class="p">,</span>
           <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">image_size</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>BL1 calls this function when the FWU process is complete. It must not return.
The platform may override this function to take platform specific action, for
example to initiate the normal boot flow.</p>
<p>The default implementation spins forever.</p>
</div>
<div class="section" id="function-bl1-plat-mem-check-mandatory">
<h3><span class="section-number">7.8.12. </span>Function : bl1_plat_mem_check() [mandatory]<a class="headerlink" href="#function-bl1-plat-mem-check-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">uintptr_t</span> <span class="n">mem_base</span><span class="p">,</span> <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">mem_size</span><span class="p">,</span>
           <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">flags</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<p>BL1 calls this function while handling FWU related SMCs, more specifically when
copying or authenticating an image. Its responsibility is to ensure that the
region of memory identified by <code class="docutils literal notranslate"><span class="pre">mem_base</span></code> and <code class="docutils literal notranslate"><span class="pre">mem_size</span></code> is mapped in BL1, and
that this memory corresponds to either a secure or non-secure memory region as
indicated by the security state of the <code class="docutils literal notranslate"><span class="pre">flags</span></code> argument.</p>
<p>This function can safely assume that the value resulting from the addition of
<code class="docutils literal notranslate"><span class="pre">mem_base</span></code> and <code class="docutils literal notranslate"><span class="pre">mem_size</span></code> fits into a <code class="docutils literal notranslate"><span class="pre">uintptr_t</span></code> type variable and does not
overflow.</p>
<p>This function must return 0 on success, a non-null error code otherwise.</p>
<p>The default implementation of this function asserts therefore platforms must
override it when using the FWU feature.</p>
</div>
</div>
<div class="section" id="boot-loader-stage-2-bl2">
<h2><span class="section-number">7.9. </span>Boot Loader Stage 2 (BL2)<a class="headerlink" href="#boot-loader-stage-2-bl2" title="Permalink to this headline">¶</a></h2>
<p>The BL2 stage is executed only by the primary CPU, which is determined in BL1
using the <code class="docutils literal notranslate"><span class="pre">platform_is_primary_cpu()</span></code> function. BL1 passed control to BL2 at
<code class="docutils literal notranslate"><span class="pre">BL2_BASE</span></code>. BL2 executes in Secure EL1 and and invokes
<code class="docutils literal notranslate"><span class="pre">plat_get_bl_image_load_info()</span></code> to retrieve the list of images to load from
non-volatile storage to secure/non-secure RAM. After all the images are loaded
then BL2 invokes <code class="docutils literal notranslate"><span class="pre">plat_get_next_bl_params()</span></code> to get the list of executable
images to be passed to the next BL image.</p>
<p>The following functions must be implemented by the platform port to enable BL2
to perform the above tasks.</p>
<div class="section" id="function-bl2-early-platform-setup2-mandatory">
<h3><span class="section-number">7.9.1. </span>Function : bl2_early_platform_setup2() [mandatory]<a class="headerlink" href="#function-bl2-early-platform-setup2-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">u_register_t</span><span class="p">,</span> <span class="n">u_register_t</span><span class="p">,</span> <span class="n">u_register_t</span><span class="p">,</span> <span class="n">u_register_t</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function executes with the MMU and data caches disabled. It is only called
by the primary CPU. The 4 arguments are passed by BL1 to BL2 and these arguments
are platform specific.</p>
<p>On Arm standard platforms, the arguments received are :</p>
<blockquote>
<div><p>arg0 - Points to load address of FW_CONFIG</p>
<p>arg1 - <code class="docutils literal notranslate"><span class="pre">meminfo</span></code> structure populated by BL1. The platform copies
the contents of <code class="docutils literal notranslate"><span class="pre">meminfo</span></code> as it may be subsequently overwritten by BL2.</p>
</div></blockquote>
<p>On Arm standard platforms, this function also:</p>
<ul class="simple">
<li><p>Initializes a UART (PL011 console), which enables access to the <code class="docutils literal notranslate"><span class="pre">printf</span></code>
family of functions in BL2.</p></li>
<li><p>Initializes the storage abstraction layer used to load further bootloader
images. It is necessary to do this early on platforms with a SCP_BL2 image,
since the later <code class="docutils literal notranslate"><span class="pre">bl2_platform_setup</span></code> must be done after SCP_BL2 is loaded.</p></li>
</ul>
</div>
<div class="section" id="function-bl2-plat-arch-setup-mandatory">
<h3><span class="section-number">7.9.2. </span>Function : bl2_plat_arch_setup() [mandatory]<a class="headerlink" href="#function-bl2-plat-arch-setup-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function executes with the MMU and data caches disabled. It is only called
by the primary CPU.</p>
<p>The purpose of this function is to perform any architectural initialization
that varies across platforms.</p>
<p>On Arm standard platforms, this function enables the MMU.</p>
</div>
<div class="section" id="function-bl2-platform-setup-mandatory">
<h3><span class="section-number">7.9.3. </span>Function : bl2_platform_setup() [mandatory]<a class="headerlink" href="#function-bl2-platform-setup-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function may execute with the MMU and data caches enabled if the platform
port does the necessary initialization in <code class="docutils literal notranslate"><span class="pre">bl2_plat_arch_setup()</span></code>. It is only
called by the primary CPU.</p>
<p>The purpose of this function is to perform any platform initialization
specific to BL2.</p>
<p>In Arm standard platforms, this function performs security setup, including
configuration of the TrustZone controller to allow non-secure masters access
to most of DRAM. Part of DRAM is reserved for secure world use.</p>
</div>
<div class="section" id="function-bl2-plat-handle-pre-image-load-optional">
<h3><span class="section-number">7.9.4. </span>Function : bl2_plat_handle_pre_image_load() [optional]<a class="headerlink" href="#function-bl2-plat-handle-pre-image-load-optional" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">unsigned</span> <span class="nb">int</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<p>This function can be used by the platforms to update/use image information
for given <code class="docutils literal notranslate"><span class="pre">image_id</span></code>. This function is currently invoked in BL2 before
loading each image.</p>
</div>
<div class="section" id="function-bl2-plat-handle-post-image-load-optional">
<h3><span class="section-number">7.9.5. </span>Function : bl2_plat_handle_post_image_load() [optional]<a class="headerlink" href="#function-bl2-plat-handle-post-image-load-optional" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">unsigned</span> <span class="nb">int</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<p>This function can be used by the platforms to update/use image information
for given <code class="docutils literal notranslate"><span class="pre">image_id</span></code>. This function is currently invoked in BL2 after
loading each image.</p>
</div>
<div class="section" id="function-bl2-plat-preload-setup-optional">
<h3><span class="section-number">7.9.6. </span>Function : bl2_plat_preload_setup [optional]<a class="headerlink" href="#function-bl2-plat-preload-setup-optional" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This optional function performs any BL2 platform initialization
required before image loading, that is not done later in
bl2_platform_setup(). Specifically, if support for multiple
boot sources is required, it initializes the boot sequence used by
plat_try_next_boot_source().</p>
</div>
<div class="section" id="function-plat-try-next-boot-source-optional">
<h3><span class="section-number">7.9.7. </span>Function : plat_try_next_boot_source() [optional]<a class="headerlink" href="#function-plat-try-next-boot-source-optional" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<p>This optional function passes to the next boot source in the redundancy
sequence.</p>
<p>This function moves the current boot redundancy source to the next
element in the boot sequence. If there are no more boot sources then it
must return 0, otherwise it must return 1. The default implementation
of this always returns 0.</p>
</div>
</div>
<div class="section" id="boot-loader-stage-2-bl2-at-el3">
<h2><span class="section-number">7.10. </span>Boot Loader Stage 2 (BL2) at EL3<a class="headerlink" href="#boot-loader-stage-2-bl2-at-el3" title="Permalink to this headline">¶</a></h2>
<p>When the platform has a non-TF-A Boot ROM it is desirable to jump
directly to BL2 instead of TF-A BL1. In this case BL2 is expected to
execute at EL3 instead of executing at EL1. Refer to the <a class="reference internal" href="../design/firmware-design.html#firmware-design"><span class="std std-ref">Firmware Design</span></a>
document for more information.</p>
<p>All mandatory functions of BL2 must be implemented, except the functions
bl2_early_platform_setup and bl2_el3_plat_arch_setup, because
their work is done now by bl2_el3_early_platform_setup and
bl2_el3_plat_arch_setup. These functions should generally implement
the bl1_plat_xxx() and bl2_plat_xxx() functionality combined.</p>
<div class="section" id="function-bl2-el3-early-platform-setup-mandatory">
<h3><span class="section-number">7.10.1. </span>Function : bl2_el3_early_platform_setup() [mandatory]<a class="headerlink" href="#function-bl2-el3-early-platform-setup-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">u_register_t</span><span class="p">,</span> <span class="n">u_register_t</span><span class="p">,</span> <span class="n">u_register_t</span><span class="p">,</span> <span class="n">u_register_t</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function executes with the MMU and data caches disabled. It is only called
by the primary CPU. This function receives four parameters which can be used
by the platform to pass any needed information from the Boot ROM to BL2.</p>
<p>On Arm standard platforms, this function does the following:</p>
<ul class="simple">
<li><p>Initializes a UART (PL011 console), which enables access to the <code class="docutils literal notranslate"><span class="pre">printf</span></code>
family of functions in BL2.</p></li>
<li><p>Initializes the storage abstraction layer used to load further bootloader
images. It is necessary to do this early on platforms with a SCP_BL2 image,
since the later <code class="docutils literal notranslate"><span class="pre">bl2_platform_setup</span></code> must be done after SCP_BL2 is loaded.</p></li>
<li><p>Initializes the private variables that define the memory layout used.</p></li>
</ul>
</div>
<div class="section" id="function-bl2-el3-plat-arch-setup-mandatory">
<h3><span class="section-number">7.10.2. </span>Function : bl2_el3_plat_arch_setup() [mandatory]<a class="headerlink" href="#function-bl2-el3-plat-arch-setup-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function executes with the MMU and data caches disabled. It is only called
by the primary CPU.</p>
<p>The purpose of this function is to perform any architectural initialization
that varies across platforms.</p>
<p>On Arm standard platforms, this function enables the MMU.</p>
</div>
<div class="section" id="function-bl2-el3-plat-prepare-exit-optional">
<h3><span class="section-number">7.10.3. </span>Function : bl2_el3_plat_prepare_exit() [optional]<a class="headerlink" href="#function-bl2-el3-plat-prepare-exit-optional" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function is called prior to exiting BL2 and run the next image.
It should be used to perform platform specific clean up or bookkeeping
operations before transferring control to the next image. This function
runs with MMU disabled.</p>
</div>
</div>
<div class="section" id="fwu-boot-loader-stage-2-bl2u">
<h2><span class="section-number">7.11. </span>FWU Boot Loader Stage 2 (BL2U)<a class="headerlink" href="#fwu-boot-loader-stage-2-bl2u" title="Permalink to this headline">¶</a></h2>
<p>The AP Firmware Updater Configuration, BL2U, is an optional part of the FWU
process and is executed only by the primary CPU. BL1 passes control to BL2U at
<code class="docutils literal notranslate"><span class="pre">BL2U_BASE</span></code>. BL2U executes in Secure-EL1 and is responsible for:</p>
<ol class="arabic simple">
<li><p>(Optional) Transferring the optional SCP_BL2U binary image from AP secure
memory to SCP RAM. BL2U uses the SCP_BL2U <code class="docutils literal notranslate"><span class="pre">image_info</span></code> passed by BL1.
<code class="docutils literal notranslate"><span class="pre">SCP_BL2U_BASE</span></code> defines the address in AP secure memory where SCP_BL2U
should be copied from. Subsequent handling of the SCP_BL2U image is
implemented by the platform specific <code class="docutils literal notranslate"><span class="pre">bl2u_plat_handle_scp_bl2u()</span></code> function.
If <code class="docutils literal notranslate"><span class="pre">SCP_BL2U_BASE</span></code> is not defined then this step is not performed.</p></li>
<li><p>Any platform specific setup required to perform the FWU process. For
example, Arm standard platforms initialize the TZC controller so that the
normal world can access DDR memory.</p></li>
</ol>
<p>The following functions must be implemented by the platform port to enable
BL2U to perform the tasks mentioned above.</p>
<div class="section" id="function-bl2u-early-platform-setup-mandatory">
<h3><span class="section-number">7.11.1. </span>Function : bl2u_early_platform_setup() [mandatory]<a class="headerlink" href="#function-bl2u-early-platform-setup-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">meminfo</span> <span class="o">*</span><span class="n">mem_info</span><span class="p">,</span> <span class="n">void</span> <span class="o">*</span><span class="n">plat_info</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function executes with the MMU and data caches disabled. It is only
called by the primary CPU. The arguments to this function is the address
of the <code class="docutils literal notranslate"><span class="pre">meminfo</span></code> structure and platform specific info provided by BL1.</p>
<p>The platform may copy the contents of the <code class="docutils literal notranslate"><span class="pre">mem_info</span></code> and <code class="docutils literal notranslate"><span class="pre">plat_info</span></code> into
private storage as the original memory may be subsequently overwritten by BL2U.</p>
<p>On Arm CSS platforms <code class="docutils literal notranslate"><span class="pre">plat_info</span></code> is interpreted as an <code class="docutils literal notranslate"><span class="pre">image_info_t</span></code> structure,
to extract SCP_BL2U image information, which is then copied into a private
variable.</p>
</div>
<div class="section" id="function-bl2u-plat-arch-setup-mandatory">
<h3><span class="section-number">7.11.2. </span>Function : bl2u_plat_arch_setup() [mandatory]<a class="headerlink" href="#function-bl2u-plat-arch-setup-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function executes with the MMU and data caches disabled. It is only
called by the primary CPU.</p>
<p>The purpose of this function is to perform any architectural initialization
that varies across platforms, for example enabling the MMU (since the memory
map differs across platforms).</p>
</div>
<div class="section" id="function-bl2u-platform-setup-mandatory">
<h3><span class="section-number">7.11.3. </span>Function : bl2u_platform_setup() [mandatory]<a class="headerlink" href="#function-bl2u-platform-setup-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function may execute with the MMU and data caches enabled if the platform
port does the necessary initialization in <code class="docutils literal notranslate"><span class="pre">bl2u_plat_arch_setup()</span></code>. It is only
called by the primary CPU.</p>
<p>The purpose of this function is to perform any platform initialization
specific to BL2U.</p>
<p>In Arm standard platforms, this function performs security setup, including
configuration of the TrustZone controller to allow non-secure masters access
to most of DRAM. Part of DRAM is reserved for secure world use.</p>
</div>
<div class="section" id="function-bl2u-plat-handle-scp-bl2u-optional">
<h3><span class="section-number">7.11.4. </span>Function : bl2u_plat_handle_scp_bl2u() [optional]<a class="headerlink" href="#function-bl2u-plat-handle-scp-bl2u-optional" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<p>This function is used to perform any platform-specific actions required to
handle the SCP firmware. Typically it transfers the image into SCP memory using
a platform-specific protocol and waits until SCP executes it and signals to the
Application Processor (AP) for BL2U execution to continue.</p>
<p>This function returns 0 on success, a negative error code otherwise.
This function is included if SCP_BL2U_BASE is defined.</p>
</div>
</div>
<div class="section" id="boot-loader-stage-3-1-bl31">
<h2><span class="section-number">7.12. </span>Boot Loader Stage 3-1 (BL31)<a class="headerlink" href="#boot-loader-stage-3-1-bl31" title="Permalink to this headline">¶</a></h2>
<p>During cold boot, the BL31 stage is executed only by the primary CPU. This is
determined in BL1 using the <code class="docutils literal notranslate"><span class="pre">platform_is_primary_cpu()</span></code> function. BL1 passes
control to BL31 at <code class="docutils literal notranslate"><span class="pre">BL31_BASE</span></code>. During warm boot, BL31 is executed by all
CPUs. BL31 executes at EL3 and is responsible for:</p>
<ol class="arabic simple">
<li><p>Re-initializing all architectural and platform state. Although BL1 performs
some of this initialization, BL31 remains resident in EL3 and must ensure
that EL3 architectural and platform state is completely initialized. It
should make no assumptions about the system state when it receives control.</p></li>
<li><p>Passing control to a normal world BL image, pre-loaded at a platform-
specific address by BL2. On ARM platforms, BL31 uses the <code class="docutils literal notranslate"><span class="pre">bl_params</span></code> list
populated by BL2 in memory to do this.</p></li>
<li><p>Providing runtime firmware services. Currently, BL31 only implements a
subset of the Power State Coordination Interface (PSCI) API as a runtime
service. See Section 3.3 below for details of porting the PSCI
implementation.</p></li>
<li><p>Optionally passing control to the BL32 image, pre-loaded at a platform-
specific address by BL2. BL31 exports a set of APIs that allow runtime
services to specify the security state in which the next image should be
executed and run the corresponding image. On ARM platforms, BL31 uses the
<code class="docutils literal notranslate"><span class="pre">bl_params</span></code> list populated by BL2 in memory to do this.</p></li>
</ol>
<p>If BL31 is a reset vector, It also needs to handle the reset as specified in
section 2.2 before the tasks described above.</p>
<p>The following functions must be implemented by the platform port to enable BL31
to perform the above tasks.</p>
<div class="section" id="function-bl31-early-platform-setup2-mandatory">
<h3><span class="section-number">7.12.1. </span>Function : bl31_early_platform_setup2() [mandatory]<a class="headerlink" href="#function-bl31-early-platform-setup2-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">u_register_t</span><span class="p">,</span> <span class="n">u_register_t</span><span class="p">,</span> <span class="n">u_register_t</span><span class="p">,</span> <span class="n">u_register_t</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function executes with the MMU and data caches disabled. It is only called
by the primary CPU. BL2 can pass 4 arguments to BL31 and these arguments are
platform specific.</p>
<p>In Arm standard platforms, the arguments received are :</p>
<blockquote>
<div><p>arg0 - The pointer to the head of <cite>bl_params_t</cite> list
which is list of executable images following BL31,</p>
<dl>
<dt>arg1 - Points to load address of SOC_FW_CONFIG if present</dt><dd><p>except in case of Arm FVP platform.</p>
<p>In case of Arm FVP platform, Points to load address
of FW_CONFIG.</p>
</dd>
</dl>
<p>arg2 - Points to load address of HW_CONFIG if present</p>
<p>arg3 - A special value to verify platform parameters from BL2 to BL31. Not
used in release builds.</p>
</div></blockquote>
<p>The function runs through the <cite>bl_param_t</cite> list and extracts the entry point
information for BL32 and BL33. It also performs the following:</p>
<ul class="simple">
<li><p>Initialize a UART (PL011 console), which enables access to the <code class="docutils literal notranslate"><span class="pre">printf</span></code>
family of functions in BL31.</p></li>
<li><p>Enable issuing of snoop and DVM (Distributed Virtual Memory) requests to the
CCI slave interface corresponding to the cluster that includes the primary
CPU.</p></li>
</ul>
</div>
<div class="section" id="function-bl31-plat-arch-setup-mandatory">
<h3><span class="section-number">7.12.2. </span>Function : bl31_plat_arch_setup() [mandatory]<a class="headerlink" href="#function-bl31-plat-arch-setup-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function executes with the MMU and data caches disabled. It is only called
by the primary CPU.</p>
<p>The purpose of this function is to perform any architectural initialization
that varies across platforms.</p>
<p>On Arm standard platforms, this function enables the MMU.</p>
</div>
<div class="section" id="function-bl31-platform-setup-mandatory">
<h3><span class="section-number">7.12.3. </span>Function : bl31_platform_setup() [mandatory]<a class="headerlink" href="#function-bl31-platform-setup-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function may execute with the MMU and data caches enabled if the platform
port does the necessary initialization in <code class="docutils literal notranslate"><span class="pre">bl31_plat_arch_setup()</span></code>. It is only
called by the primary CPU.</p>
<p>The purpose of this function is to complete platform initialization so that both
BL31 runtime services and normal world software can function correctly.</p>
<p>On Arm standard platforms, this function does the following:</p>
<ul>
<li><p>Initialize the generic interrupt controller.</p>
<p>Depending on the GIC driver selected by the platform, the appropriate GICv2
or GICv3 initialization will be done, which mainly consists of:</p>
<ul class="simple">
<li><p>Enable secure interrupts in the GIC CPU interface.</p></li>
<li><p>Disable the legacy interrupt bypass mechanism.</p></li>
<li><p>Configure the priority mask register to allow interrupts of all priorities
to be signaled to the CPU interface.</p></li>
<li><p>Mark SGIs 8-15 and the other secure interrupts on the platform as secure.</p></li>
<li><p>Target all secure SPIs to CPU0.</p></li>
<li><p>Enable these secure interrupts in the GIC distributor.</p></li>
<li><p>Configure all other interrupts as non-secure.</p></li>
<li><p>Enable signaling of secure interrupts in the GIC distributor.</p></li>
</ul>
</li>
<li><p>Enable system-level implementation of the generic timer counter through the
memory mapped interface.</p></li>
<li><p>Grant access to the system counter timer module</p></li>
<li><p>Initialize the power controller device.</p>
<p>In particular, initialise the locks that prevent concurrent accesses to the
power controller device.</p>
</li>
</ul>
</div>
<div class="section" id="function-bl31-plat-runtime-setup-optional">
<h3><span class="section-number">7.12.4. </span>Function : bl31_plat_runtime_setup() [optional]<a class="headerlink" href="#function-bl31-plat-runtime-setup-optional" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>The purpose of this function is allow the platform to perform any BL31 runtime
setup just prior to BL31 exit during cold boot. The default weak
implementation of this function will invoke <code class="docutils literal notranslate"><span class="pre">console_switch_state()</span></code> to switch
console output to consoles marked for use in the <code class="docutils literal notranslate"><span class="pre">runtime</span></code> state.</p>
</div>
<div class="section" id="function-bl31-plat-get-next-image-ep-info-mandatory">
<h3><span class="section-number">7.12.5. </span>Function : bl31_plat_get_next_image_ep_info() [mandatory]<a class="headerlink" href="#function-bl31-plat-get-next-image-ep-info-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">uint32_t</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">entry_point_info</span> <span class="o">*</span>
</pre></div>
</div>
<p>This function may execute with the MMU and data caches enabled if the platform
port does the necessary initializations in <code class="docutils literal notranslate"><span class="pre">bl31_plat_arch_setup()</span></code>.</p>
<p>This function is called by <code class="docutils literal notranslate"><span class="pre">bl31_main()</span></code> to retrieve information provided by
BL2 for the next image in the security state specified by the argument. BL31
uses this information to pass control to that image in the specified security
state. This function must return a pointer to the <code class="docutils literal notranslate"><span class="pre">entry_point_info</span></code> structure
(that was copied during <code class="docutils literal notranslate"><span class="pre">bl31_early_platform_setup()</span></code>) if the image exists. It
should return NULL otherwise.</p>
</div>
<div class="section" id="function-bl31-plat-enable-mmu-optional">
<h3><span class="section-number">7.12.6. </span>Function : bl31_plat_enable_mmu [optional]<a class="headerlink" href="#function-bl31-plat-enable-mmu-optional" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">uint32_t</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function enables the MMU. The boot code calls this function with MMU and
caches disabled. This function should program necessary registers to enable
translation, and upon return, the MMU on the calling PE must be enabled.</p>
<p>The function must honor flags passed in the first argument. These flags are
defined by the translation library, and can be found in the file
<code class="docutils literal notranslate"><span class="pre">include/lib/xlat_tables/xlat_mmu_helpers.h</span></code>.</p>
<p>On DynamIQ systems, this function must not use stack while enabling MMU, which
is how the function in xlat table library version 2 is implemented.</p>
</div>
<div class="section" id="function-plat-init-apkey-optional">
<h3><span class="section-number">7.12.7. </span>Function : plat_init_apkey [optional]<a class="headerlink" href="#function-plat-init-apkey-optional" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">uint128_t</span>
</pre></div>
</div>
<p>This function returns the 128-bit value which can be used to program ARMv8.3
pointer authentication keys.</p>
<p>The value should be obtained from a reliable source of randomness.</p>
<p>This function is only needed if ARMv8.3 pointer authentication is used in the
Trusted Firmware by building with <code class="docutils literal notranslate"><span class="pre">BRANCH_PROTECTION</span></code> option set to non-zero.</p>
</div>
<div class="section" id="function-plat-get-syscnt-freq2-mandatory">
<h3><span class="section-number">7.12.8. </span>Function : plat_get_syscnt_freq2() [mandatory]<a class="headerlink" href="#function-plat-get-syscnt-freq2-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">unsigned</span> <span class="nb">int</span>
</pre></div>
</div>
<p>This function is used by the architecture setup code to retrieve the counter
frequency for the CPU’s generic timer. This value will be programmed into the
<code class="docutils literal notranslate"><span class="pre">CNTFRQ_EL0</span></code> register. In Arm standard platforms, it returns the base frequency
of the system counter, which is retrieved from the first entry in the frequency
modes table.</p>
</div>
<div class="section" id="function-plat-arm-set-twedel-scr-el3-optional">
<h3><span class="section-number">7.12.9. </span>Function : plat_arm_set_twedel_scr_el3() [optional]<a class="headerlink" href="#function-plat-arm-set-twedel-scr-el3-optional" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">uint32_t</span>
</pre></div>
</div>
<p>This function is used in v8.6+ systems to set the WFE trap delay value in
SCR_EL3. If this function returns TWED_DISABLED or is left unimplemented, this
feature is not enabled.  The only hook provided is to set the TWED fields in
SCR_EL3, there are similar fields in HCR_EL2, SCTLR_EL2, and SCTLR_EL1 to adjust
the WFE trap delays in lower ELs and these fields should be set by the
appropriate EL2 or EL1 code depending on the platform configuration.</p>
</div>
<div class="section" id="define-plat-percpu-bakery-lock-size-optional">
<h3><span class="section-number">7.12.10. </span>#define : PLAT_PERCPU_BAKERY_LOCK_SIZE [optional]<a class="headerlink" href="#define-plat-percpu-bakery-lock-size-optional" title="Permalink to this headline">¶</a></h3>
<p>When <code class="docutils literal notranslate"><span class="pre">USE_COHERENT_MEM</span> <span class="pre">=</span> <span class="pre">0</span></code>, this constant defines the total memory (in
bytes) aligned to the cache line boundary that should be allocated per-cpu to
accommodate all the bakery locks.</p>
<p>If this constant is not defined when <code class="docutils literal notranslate"><span class="pre">USE_COHERENT_MEM</span> <span class="pre">=</span> <span class="pre">0</span></code>, the linker
calculates the size of the <code class="docutils literal notranslate"><span class="pre">bakery_lock</span></code> input section, aligns it to the
nearest <code class="docutils literal notranslate"><span class="pre">CACHE_WRITEBACK_GRANULE</span></code>, multiplies it with <code class="docutils literal notranslate"><span class="pre">PLATFORM_CORE_COUNT</span></code>
and stores the result in a linker symbol. This constant prevents a platform
from relying on the linker and provide a more efficient mechanism for
accessing per-cpu bakery lock information.</p>
<p>If this constant is defined and its value is not equal to the value
calculated by the linker then a link time assertion is raised. A compile time
assertion is raised if the value of the constant is not aligned to the cache
line boundary.</p>
</div>
<div class="section" id="sdei-porting-requirements">
<span id="porting-guide-sdei-requirements"></span><h3><span class="section-number">7.12.11. </span>SDEI porting requirements<a class="headerlink" href="#sdei-porting-requirements" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="../glossary.html#term-SDEI"><span class="xref std std-term">SDEI</span></a> dispatcher requires the platform to provide the following macros
and functions, of which some are optional, and some others mandatory.</p>
<div class="section" id="macros">
<h4><span class="section-number">7.12.11.1. </span>Macros<a class="headerlink" href="#macros" title="Permalink to this headline">¶</a></h4>
<div class="section" id="macro-plat-sdei-normal-pri-mandatory">
<h5><span class="section-number">7.12.11.1.1. </span>Macro: PLAT_SDEI_NORMAL_PRI [mandatory]<a class="headerlink" href="#macro-plat-sdei-normal-pri-mandatory" title="Permalink to this headline">¶</a></h5>
<p>This macro must be defined to the EL3 exception priority level associated with
Normal <a class="reference internal" href="../glossary.html#term-SDEI"><span class="xref std std-term">SDEI</span></a> events on the platform. This must have a higher value
(therefore of lower priority) than <code class="docutils literal notranslate"><span class="pre">PLAT_SDEI_CRITICAL_PRI</span></code>.</p>
</div>
<div class="section" id="macro-plat-sdei-critical-pri-mandatory">
<h5><span class="section-number">7.12.11.1.2. </span>Macro: PLAT_SDEI_CRITICAL_PRI [mandatory]<a class="headerlink" href="#macro-plat-sdei-critical-pri-mandatory" title="Permalink to this headline">¶</a></h5>
<p>This macro must be defined to the EL3 exception priority level associated with
Critical <a class="reference internal" href="../glossary.html#term-SDEI"><span class="xref std std-term">SDEI</span></a> events on the platform. This must have a lower value
(therefore of higher priority) than <code class="docutils literal notranslate"><span class="pre">PLAT_SDEI_NORMAL_PRI</span></code>.</p>
<p><strong>Note</strong>: <a class="reference internal" href="../glossary.html#term-SDEI"><span class="xref std std-term">SDEI</span></a> exception priorities must be the lowest among Secure
priorities. Among the <a class="reference internal" href="../glossary.html#term-SDEI"><span class="xref std std-term">SDEI</span></a> exceptions, Critical <a class="reference internal" href="../glossary.html#term-SDEI"><span class="xref std std-term">SDEI</span></a> priority must
be higher than Normal <a class="reference internal" href="../glossary.html#term-SDEI"><span class="xref std std-term">SDEI</span></a> priority.</p>
</div>
</div>
<div class="section" id="functions">
<h4><span class="section-number">7.12.11.2. </span>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h4>
<div class="section" id="function-int-plat-sdei-validate-entry-point-optional">
<h5><span class="section-number">7.12.11.2.1. </span>Function: int plat_sdei_validate_entry_point() [optional]<a class="headerlink" href="#function-int-plat-sdei-validate-entry-point-optional" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span><span class="p">:</span> <span class="n">uintptr_t</span> <span class="n">ep</span><span class="p">,</span> <span class="n">unsigned</span> <span class="nb">int</span> <span class="n">client_mode</span>
<span class="n">Return</span><span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<p>This function validates the entry point address of the event handler provided by
the client for both event registration and <em>Complete and Resume</em> <a class="reference internal" href="../glossary.html#term-SDEI"><span class="xref std std-term">SDEI</span></a> calls.
The function ensures that the address is valid in the client translation regime.</p>
<p>The second argument is the exception level that the client is executing in. It
can be Non-Secure EL1 or Non-Secure EL2.</p>
<p>The function must return <code class="docutils literal notranslate"><span class="pre">0</span></code> for successful validation, or <code class="docutils literal notranslate"><span class="pre">-1</span></code> upon failure.</p>
<p>The default implementation always returns <code class="docutils literal notranslate"><span class="pre">0</span></code>. On Arm platforms, this function
translates the entry point address within the client translation regime and
further ensures that the resulting physical address is located in Non-secure
DRAM.</p>
</div>
<div class="section" id="function-void-plat-sdei-handle-masked-trigger-uint64-t-mpidr-unsigned-int-intr-optional">
<h5><span class="section-number">7.12.11.2.2. </span>Function: void plat_sdei_handle_masked_trigger(uint64_t mpidr, unsigned int intr) [optional]<a class="headerlink" href="#function-void-plat-sdei-handle-masked-trigger-uint64-t-mpidr-unsigned-int-intr-optional" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span><span class="p">:</span> <span class="n">uint64_t</span>
<span class="n">Argument</span><span class="p">:</span> <span class="n">unsigned</span> <span class="nb">int</span>
<span class="n">Return</span><span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p><a class="reference internal" href="../glossary.html#term-SDEI"><span class="xref std std-term">SDEI</span></a> specification requires that a PE comes out of reset with the events
masked. The client therefore is expected to call <code class="docutils literal notranslate"><span class="pre">PE_UNMASK</span></code> to unmask
<a class="reference internal" href="../glossary.html#term-SDEI"><span class="xref std std-term">SDEI</span></a> events on the PE. No <a class="reference internal" href="../glossary.html#term-SDEI"><span class="xref std std-term">SDEI</span></a> events can be dispatched until such
time.</p>
<p>Should a PE receive an interrupt that was bound to an <a class="reference internal" href="../glossary.html#term-SDEI"><span class="xref std std-term">SDEI</span></a> event while the
events are masked on the PE, the dispatcher implementation invokes the function
<code class="docutils literal notranslate"><span class="pre">plat_sdei_handle_masked_trigger</span></code>. The MPIDR of the PE that received the
interrupt and the interrupt ID are passed as parameters.</p>
<p>The default implementation only prints out a warning message.</p>
</div>
</div>
</div>
<div class="section" id="trng-porting-requirements">
<span id="porting-guide-trng-requirements"></span><h3><span class="section-number">7.12.12. </span>TRNG porting requirements<a class="headerlink" href="#trng-porting-requirements" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="../glossary.html#term-TRNG"><span class="xref std std-term">TRNG</span></a> backend requires the platform to provide the following values
and mandatory functions.</p>
<div class="section" id="values">
<h4><span class="section-number">7.12.12.1. </span>Values<a class="headerlink" href="#values" title="Permalink to this headline">¶</a></h4>
<div class="section" id="value-uuid-t-plat-trng-uuid-mandatory">
<h5><span class="section-number">7.12.12.1.1. </span>value: uuid_t plat_trng_uuid [mandatory]<a class="headerlink" href="#value-uuid-t-plat-trng-uuid-mandatory" title="Permalink to this headline">¶</a></h5>
<p>This value must be defined to the UUID of the TRNG backend that is specific to
the hardware after <code class="docutils literal notranslate"><span class="pre">plat_trng_setup</span></code> function is called. This value must
conform to the SMCCC calling convention; The most significant 32 bits of the
UUID must not equal <code class="docutils literal notranslate"><span class="pre">0xffffffff</span></code> or the signed integer <code class="docutils literal notranslate"><span class="pre">-1</span></code> as this value in
w0 indicates failure to get a TRNG source.</p>
</div>
</div>
<div class="section" id="id1">
<h4><span class="section-number">7.12.12.2. </span>Functions<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="section" id="function-void-plat-entropy-setup-void-mandatory">
<h5><span class="section-number">7.12.12.2.1. </span>Function: void plat_entropy_setup(void) [mandatory]<a class="headerlink" href="#function-void-plat-entropy-setup-void-mandatory" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span><span class="p">:</span> <span class="n">none</span>
<span class="n">Return</span><span class="p">:</span> <span class="n">none</span>
</pre></div>
</div>
<p>This function is expected to do platform-specific initialization of any TRNG
hardware. This may include generating a UUID from a hardware-specific seed.</p>
</div>
<div class="section" id="function-bool-plat-get-entropy-uint64-t-out-mandatory">
<h5><span class="section-number">7.12.12.2.2. </span>Function: bool plat_get_entropy(uint64_t *out) [mandatory]<a class="headerlink" href="#function-bool-plat-get-entropy-uint64-t-out-mandatory" title="Permalink to this headline">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span><span class="p">:</span> <span class="n">uint64_t</span> <span class="o">*</span>
<span class="n">Return</span><span class="p">:</span> <span class="nb">bool</span>
<span class="n">Out</span> <span class="p">:</span> <span class="n">when</span> <span class="n">the</span> <span class="k">return</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">true</span><span class="p">,</span> <span class="n">the</span> <span class="n">entropy</span> <span class="n">has</span> <span class="n">been</span> <span class="n">written</span> <span class="n">into</span> <span class="n">the</span>
<span class="n">storage</span> <span class="n">pointed</span> <span class="n">to</span>
</pre></div>
</div>
<p>This function writes entropy into storage provided by the caller. If no entropy
is available, it must return false and the storage must not be written.</p>
</div>
</div>
</div>
</div>
<div class="section" id="power-state-coordination-interface-in-bl31">
<h2><span class="section-number">7.13. </span>Power State Coordination Interface (in BL31)<a class="headerlink" href="#power-state-coordination-interface-in-bl31" title="Permalink to this headline">¶</a></h2>
<p>The TF-A implementation of the PSCI API is based around the concept of a
<em>power domain</em>. A <em>power domain</em> is a CPU or a logical group of CPUs which
share some state on which power management operations can be performed as
specified by <a class="reference external" href="http://infocenter.arm.com/help/topic/com.arm.doc.den0022c/DEN0022C_Power_State_Coordination_Interface.pdf">PSCI</a>. Each CPU in the system is assigned a cpu index which is
a unique number between <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">PLATFORM_CORE_COUNT</span> <span class="pre">-</span> <span class="pre">1</span></code>. The
<em>power domains</em> are arranged in a hierarchical tree structure and each
<em>power domain</em> can be identified in a system by the cpu index of any CPU that
is part of that domain and a <em>power domain level</em>. A processing element (for
example, a CPU) is at level 0. If the <em>power domain</em> node above a CPU is a
logical grouping of CPUs that share some state, then level 1 is that group of
CPUs (for example, a cluster), and level 2 is a group of clusters (for
example, the system). More details on the power domain topology and its
organization can be found in <a class="reference internal" href="../design/psci-pd-tree.html#psci-power-domain-tree-structure"><span class="std std-ref">PSCI Power Domain Tree Structure</span></a>.</p>
<p>BL31’s platform initialization code exports a pointer to the platform-specific
power management operations required for the PSCI implementation to function
correctly. This information is populated in the <code class="docutils literal notranslate"><span class="pre">plat_psci_ops</span></code> structure. The
PSCI implementation calls members of the <code class="docutils literal notranslate"><span class="pre">plat_psci_ops</span></code> structure for performing
power management operations on the power domains. For example, the target
CPU is specified by its <code class="docutils literal notranslate"><span class="pre">MPIDR</span></code> in a PSCI <code class="docutils literal notranslate"><span class="pre">CPU_ON</span></code> call. The <code class="docutils literal notranslate"><span class="pre">pwr_domain_on()</span></code>
handler (if present) is called for the CPU power domain.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">power-state</span></code> parameter of a PSCI <code class="docutils literal notranslate"><span class="pre">CPU_SUSPEND</span></code> call can be used to
describe composite power states specific to a platform. The PSCI implementation
defines a generic representation of the power-state parameter, which is an
array of local power states where each index corresponds to a power domain
level. Each entry contains the local power state the power domain at that power
level could enter. It depends on the <code class="docutils literal notranslate"><span class="pre">validate_power_state()</span></code> handler to
convert the power-state parameter (possibly encoding a composite power state)
passed in a PSCI <code class="docutils literal notranslate"><span class="pre">CPU_SUSPEND</span></code> call to this representation.</p>
<p>The following functions form part of platform port of PSCI functionality.</p>
<div class="section" id="function-plat-psci-stat-accounting-start-optional">
<h3><span class="section-number">7.13.1. </span>Function : plat_psci_stat_accounting_start() [optional]<a class="headerlink" href="#function-plat-psci-stat-accounting-start-optional" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">const</span> <span class="n">psci_power_state_t</span> <span class="o">*</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This is an optional hook that platforms can implement for residency statistics
accounting before entering a low power state. The <code class="docutils literal notranslate"><span class="pre">pwr_domain_state</span></code> field of
<code class="docutils literal notranslate"><span class="pre">state_info</span></code> (first argument) can be inspected if stat accounting is done
differently at CPU level versus higher levels. As an example, if the element at
index 0 (CPU power level) in the <code class="docutils literal notranslate"><span class="pre">pwr_domain_state</span></code> array indicates a power down
state, special hardware logic may be programmed in order to keep track of the
residency statistics. For higher levels (array indices &gt; 0), the residency
statistics could be tracked in software using PMF. If <code class="docutils literal notranslate"><span class="pre">ENABLE_PMF</span></code> is set, the
default implementation will use PMF to capture timestamps.</p>
</div>
<div class="section" id="function-plat-psci-stat-accounting-stop-optional">
<h3><span class="section-number">7.13.2. </span>Function : plat_psci_stat_accounting_stop() [optional]<a class="headerlink" href="#function-plat-psci-stat-accounting-stop-optional" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">const</span> <span class="n">psci_power_state_t</span> <span class="o">*</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This is an optional hook that platforms can implement for residency statistics
accounting after exiting from a low power state. The <code class="docutils literal notranslate"><span class="pre">pwr_domain_state</span></code> field
of <code class="docutils literal notranslate"><span class="pre">state_info</span></code> (first argument) can be inspected if stat accounting is done
differently at CPU level versus higher levels. As an example, if the element at
index 0 (CPU power level) in the <code class="docutils literal notranslate"><span class="pre">pwr_domain_state</span></code> array indicates a power down
state, special hardware logic may be programmed in order to keep track of the
residency statistics. For higher levels (array indices &gt; 0), the residency
statistics could be tracked in software using PMF. If <code class="docutils literal notranslate"><span class="pre">ENABLE_PMF</span></code> is set, the
default implementation will use PMF to capture timestamps.</p>
</div>
<div class="section" id="function-plat-psci-stat-get-residency-optional">
<h3><span class="section-number">7.13.3. </span>Function : plat_psci_stat_get_residency() [optional]<a class="headerlink" href="#function-plat-psci-stat-get-residency-optional" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">unsigned</span> <span class="nb">int</span><span class="p">,</span> <span class="n">const</span> <span class="n">psci_power_state_t</span> <span class="o">*</span><span class="p">,</span> <span class="n">unsigned</span> <span class="nb">int</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">u_register_t</span>
</pre></div>
</div>
<p>This is an optional interface that is is invoked after resuming from a low power
state and provides the time spent resident in that low power state by the power
domain at a particular power domain level. When a CPU wakes up from suspend,
all its parent power domain levels are also woken up. The generic PSCI code
invokes this function for each parent power domain that is resumed and it
identified by the <code class="docutils literal notranslate"><span class="pre">lvl</span></code> (first argument) parameter. The <code class="docutils literal notranslate"><span class="pre">state_info</span></code> (second
argument) describes the low power state that the power domain has resumed from.
The current CPU is the first CPU in the power domain to resume from the low
power state and the <code class="docutils literal notranslate"><span class="pre">last_cpu_idx</span></code> (third parameter) is the index of the last
CPU in the power domain to suspend and may be needed to calculate the residency
for that power domain.</p>
</div>
<div class="section" id="function-plat-get-target-pwr-state-optional">
<h3><span class="section-number">7.13.4. </span>Function : plat_get_target_pwr_state() [optional]<a class="headerlink" href="#function-plat-get-target-pwr-state-optional" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">unsigned</span> <span class="nb">int</span><span class="p">,</span> <span class="n">const</span> <span class="n">plat_local_state_t</span> <span class="o">*</span><span class="p">,</span> <span class="n">unsigned</span> <span class="nb">int</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">plat_local_state_t</span>
</pre></div>
</div>
<p>The PSCI generic code uses this function to let the platform participate in
state coordination during a power management operation. The function is passed
a pointer to an array of platform specific local power state <code class="docutils literal notranslate"><span class="pre">states</span></code> (second
argument) which contains the requested power state for each CPU at a particular
power domain level <code class="docutils literal notranslate"><span class="pre">lvl</span></code> (first argument) within the power domain. The function
is expected to traverse this array of upto <code class="docutils literal notranslate"><span class="pre">ncpus</span></code> (third argument) and return
a coordinated target power state by the comparing all the requested power
states. The target power state should not be deeper than any of the requested
power states.</p>
<p>A weak definition of this API is provided by default wherein it assumes
that the platform assigns a local state value in order of increasing depth
of the power state i.e. for two power states X &amp; Y, if X &lt; Y
then X represents a shallower power state than Y. As a result, the
coordinated target local power state for a power domain will be the minimum
of the requested local power state values.</p>
</div>
<div class="section" id="function-plat-get-power-domain-tree-desc-mandatory">
<h3><span class="section-number">7.13.5. </span>Function : plat_get_power_domain_tree_desc() [mandatory]<a class="headerlink" href="#function-plat-get-power-domain-tree-desc-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">const</span> <span class="n">unsigned</span> <span class="n">char</span> <span class="o">*</span>
</pre></div>
</div>
<p>This function returns a pointer to the byte array containing the power domain
topology tree description. The format and method to construct this array are
described in <a class="reference internal" href="../design/psci-pd-tree.html#psci-power-domain-tree-structure"><span class="std std-ref">PSCI Power Domain Tree Structure</span></a>. The BL31 PSCI
initialization code requires this array to be described by the platform, either
statically or dynamically, to initialize the power domain topology tree. In case
the array is populated dynamically, then plat_core_pos_by_mpidr() and
plat_my_core_pos() should also be implemented suitably so that the topology tree
description matches the CPU indices returned by these APIs. These APIs together
form the platform interface for the PSCI topology framework.</p>
</div>
<div class="section" id="function-plat-setup-psci-ops-mandatory">
<h3><span class="section-number">7.13.6. </span>Function : plat_setup_psci_ops() [mandatory]<a class="headerlink" href="#function-plat-setup-psci-ops-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">uintptr_t</span><span class="p">,</span> <span class="n">const</span> <span class="n">plat_psci_ops</span> <span class="o">**</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<p>This function may execute with the MMU and data caches enabled if the platform
port does the necessary initializations in <code class="docutils literal notranslate"><span class="pre">bl31_plat_arch_setup()</span></code>. It is only
called by the primary CPU.</p>
<p>This function is called by PSCI initialization code. Its purpose is to let
the platform layer know about the warm boot entrypoint through the
<code class="docutils literal notranslate"><span class="pre">sec_entrypoint</span></code> (first argument) and to export handler routines for
platform-specific psci power management actions by populating the passed
pointer with a pointer to BL31’s private <code class="docutils literal notranslate"><span class="pre">plat_psci_ops</span></code> structure.</p>
<p>A description of each member of this structure is given below. Please refer to
the Arm FVP specific implementation of these handlers in
<code class="docutils literal notranslate"><span class="pre">plat/arm/board/fvp/fvp_pm.c</span></code> as an example. For each PSCI function that the
platform wants to support, the associated operation or operations in this
structure must be provided and implemented (Refer section 4 of
<a class="reference internal" href="../design/firmware-design.html#firmware-design"><span class="std std-ref">Firmware Design</span></a> for the PSCI API supported in TF-A). To disable a PSCI
function in a platform port, the operation should be removed from this
structure instead of providing an empty implementation.</p>
<div class="section" id="plat-psci-ops-cpu-standby">
<h4><span class="section-number">7.13.6.1. </span>plat_psci_ops.cpu_standby()<a class="headerlink" href="#plat-psci-ops-cpu-standby" title="Permalink to this headline">¶</a></h4>
<p>Perform the platform-specific actions to enter the standby state for a cpu
indicated by the passed argument. This provides a fast path for CPU standby
wherein overheads of PSCI state management and lock acquisition is avoided.
For this handler to be invoked by the PSCI <code class="docutils literal notranslate"><span class="pre">CPU_SUSPEND</span></code> API implementation,
the suspend state type specified in the <code class="docutils literal notranslate"><span class="pre">power-state</span></code> parameter should be
STANDBY and the target power domain level specified should be the CPU. The
handler should put the CPU into a low power retention state (usually by
issuing a wfi instruction) and ensure that it can be woken up from that
state by a normal interrupt. The generic code expects the handler to succeed.</p>
</div>
<div class="section" id="plat-psci-ops-pwr-domain-on">
<h4><span class="section-number">7.13.6.2. </span>plat_psci_ops.pwr_domain_on()<a class="headerlink" href="#plat-psci-ops-pwr-domain-on" title="Permalink to this headline">¶</a></h4>
<p>Perform the platform specific actions to power on a CPU, specified
by the <code class="docutils literal notranslate"><span class="pre">MPIDR</span></code> (first argument). The generic code expects the platform to
return PSCI_E_SUCCESS on success or PSCI_E_INTERN_FAIL for any failure.</p>
</div>
<div class="section" id="plat-psci-ops-pwr-domain-off">
<h4><span class="section-number">7.13.6.3. </span>plat_psci_ops.pwr_domain_off()<a class="headerlink" href="#plat-psci-ops-pwr-domain-off" title="Permalink to this headline">¶</a></h4>
<p>Perform the platform specific actions to prepare to power off the calling CPU
and its higher parent power domain levels as indicated by the <code class="docutils literal notranslate"><span class="pre">target_state</span></code>
(first argument). It is called by the PSCI <code class="docutils literal notranslate"><span class="pre">CPU_OFF</span></code> API implementation.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">target_state</span></code> encodes the platform coordinated target local power states
for the CPU power domain and its parent power domain levels. The handler
needs to perform power management operation corresponding to the local state
at each power level.</p>
<p>For this handler, the local power state for the CPU power domain will be a
power down state where as it could be either power down, retention or run state
for the higher power domain levels depending on the result of state
coordination. The generic code expects the handler to succeed.</p>
</div>
<div class="section" id="plat-psci-ops-pwr-domain-suspend-pwrdown-early-optional">
<h4><span class="section-number">7.13.6.4. </span>plat_psci_ops.pwr_domain_suspend_pwrdown_early() [optional]<a class="headerlink" href="#plat-psci-ops-pwr-domain-suspend-pwrdown-early-optional" title="Permalink to this headline">¶</a></h4>
<p>This optional function may be used as a performance optimization to replace
or complement pwr_domain_suspend() on some platforms. Its calling semantics
are identical to pwr_domain_suspend(), except the PSCI implementation only
calls this function when suspending to a power down state, and it guarantees
that data caches are enabled.</p>
<p>When HW_ASSISTED_COHERENCY = 0, the PSCI implementation disables data caches
before calling pwr_domain_suspend(). If the target_state corresponds to a
power down state and it is safe to perform some or all of the platform
specific actions in that function with data caches enabled, it may be more
efficient to move those actions to this function. When HW_ASSISTED_COHERENCY
= 1, data caches remain enabled throughout, and so there is no advantage to
moving platform specific actions to this function.</p>
</div>
<div class="section" id="plat-psci-ops-pwr-domain-suspend">
<h4><span class="section-number">7.13.6.5. </span>plat_psci_ops.pwr_domain_suspend()<a class="headerlink" href="#plat-psci-ops-pwr-domain-suspend" title="Permalink to this headline">¶</a></h4>
<p>Perform the platform specific actions to prepare to suspend the calling
CPU and its higher parent power domain levels as indicated by the
<code class="docutils literal notranslate"><span class="pre">target_state</span></code> (first argument). It is called by the PSCI <code class="docutils literal notranslate"><span class="pre">CPU_SUSPEND</span></code>
API implementation.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">target_state</span></code> has a similar meaning as described in
the <code class="docutils literal notranslate"><span class="pre">pwr_domain_off()</span></code> operation. It encodes the platform coordinated
target local power states for the CPU power domain and its parent
power domain levels. The handler needs to perform power management operation
corresponding to the local state at each power level. The generic code
expects the handler to succeed.</p>
<p>The difference between turning a power domain off versus suspending it is that
in the former case, the power domain is expected to re-initialize its state
when it is next powered on (see <code class="docutils literal notranslate"><span class="pre">pwr_domain_on_finish()</span></code>). In the latter
case, the power domain is expected to save enough state so that it can resume
execution by restoring this state when its powered on (see
<code class="docutils literal notranslate"><span class="pre">pwr_domain_suspend_finish()</span></code>).</p>
<p>When suspending a core, the platform can also choose to power off the GICv3
Redistributor and ITS through an implementation-defined sequence. To achieve
this safely, the ITS context must be saved first. The architectural part is
implemented by the <code class="docutils literal notranslate"><span class="pre">gicv3_its_save_disable()</span></code> helper, but most of the needed
sequence is implementation defined and it is therefore the responsibility of
the platform code to implement the necessary sequence. Then the GIC
Redistributor context can be saved using the <code class="docutils literal notranslate"><span class="pre">gicv3_rdistif_save()</span></code> helper.
Powering off the Redistributor requires the implementation to support it and it
is the responsibility of the platform code to execute the right implementation
defined sequence.</p>
<p>When a system suspend is requested, the platform can also make use of the
<code class="docutils literal notranslate"><span class="pre">gicv3_distif_save()</span></code> helper to save the context of the GIC Distributor after
it has saved the context of the Redistributors and ITS of all the cores in the
system. The context of the Distributor can be large and may require it to be
allocated in a special area if it cannot fit in the platform’s global static
data, for example in DRAM. The Distributor can then be powered down using an
implementation-defined sequence.</p>
</div>
<div class="section" id="plat-psci-ops-pwr-domain-pwr-down-wfi">
<h4><span class="section-number">7.13.6.6. </span>plat_psci_ops.pwr_domain_pwr_down_wfi()<a class="headerlink" href="#plat-psci-ops-pwr-domain-pwr-down-wfi" title="Permalink to this headline">¶</a></h4>
<p>This is an optional function and, if implemented, is expected to perform
platform specific actions including the <code class="docutils literal notranslate"><span class="pre">wfi</span></code> invocation which allows the
CPU to powerdown. Since this function is invoked outside the PSCI locks,
the actions performed in this hook must be local to the CPU or the platform
must ensure that races between multiple CPUs cannot occur.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">target_state</span></code> has a similar meaning as described in the <code class="docutils literal notranslate"><span class="pre">pwr_domain_off()</span></code>
operation and it encodes the platform coordinated target local power states for
the CPU power domain and its parent power domain levels. This function must
not return back to the caller.</p>
<p>If this function is not implemented by the platform, PSCI generic
implementation invokes <code class="docutils literal notranslate"><span class="pre">psci_power_down_wfi()</span></code> for power down.</p>
</div>
<div class="section" id="plat-psci-ops-pwr-domain-on-finish">
<h4><span class="section-number">7.13.6.7. </span>plat_psci_ops.pwr_domain_on_finish()<a class="headerlink" href="#plat-psci-ops-pwr-domain-on-finish" title="Permalink to this headline">¶</a></h4>
<p>This function is called by the PSCI implementation after the calling CPU is
powered on and released from reset in response to an earlier PSCI <code class="docutils literal notranslate"><span class="pre">CPU_ON</span></code> call.
It performs the platform-specific setup required to initialize enough state for
this CPU to enter the normal world and also provide secure runtime firmware
services.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">target_state</span></code> (first argument) is the prior state of the power domains
immediately before the CPU was turned on. It indicates which power domains
above the CPU might require initialization due to having previously been in
low power states. The generic code expects the handler to succeed.</p>
</div>
<div class="section" id="plat-psci-ops-pwr-domain-on-finish-late-optional">
<h4><span class="section-number">7.13.6.8. </span>plat_psci_ops.pwr_domain_on_finish_late() [optional]<a class="headerlink" href="#plat-psci-ops-pwr-domain-on-finish-late-optional" title="Permalink to this headline">¶</a></h4>
<p>This optional function is called by the PSCI implementation after the calling
CPU is fully powered on with respective data caches enabled. The calling CPU and
the associated cluster are guaranteed to be participating in coherency. This
function gives the flexibility to perform any platform-specific actions safely,
such as initialization or modification of shared data structures, without the
overhead of explicit cache maintainace operations.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">target_state</span></code> has a similar meaning as described in the <code class="docutils literal notranslate"><span class="pre">pwr_domain_on_finish()</span></code>
operation. The generic code expects the handler to succeed.</p>
</div>
<div class="section" id="plat-psci-ops-pwr-domain-suspend-finish">
<h4><span class="section-number">7.13.6.9. </span>plat_psci_ops.pwr_domain_suspend_finish()<a class="headerlink" href="#plat-psci-ops-pwr-domain-suspend-finish" title="Permalink to this headline">¶</a></h4>
<p>This function is called by the PSCI implementation after the calling CPU is
powered on and released from reset in response to an asynchronous wakeup
event, for example a timer interrupt that was programmed by the CPU during the
<code class="docutils literal notranslate"><span class="pre">CPU_SUSPEND</span></code> call or <code class="docutils literal notranslate"><span class="pre">SYSTEM_SUSPEND</span></code> call. It performs the platform-specific
setup required to restore the saved state for this CPU to resume execution
in the normal world and also provide secure runtime firmware services.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">target_state</span></code> (first argument) has a similar meaning as described in
the <code class="docutils literal notranslate"><span class="pre">pwr_domain_on_finish()</span></code> operation. The generic code expects the platform
to succeed.</p>
<p>If the Distributor, Redistributors or ITS have been powered off as part of a
suspend, their context must be restored in this function in the reverse order
to how they were saved during suspend sequence.</p>
</div>
<div class="section" id="plat-psci-ops-system-off">
<h4><span class="section-number">7.13.6.10. </span>plat_psci_ops.system_off()<a class="headerlink" href="#plat-psci-ops-system-off" title="Permalink to this headline">¶</a></h4>
<p>This function is called by PSCI implementation in response to a <code class="docutils literal notranslate"><span class="pre">SYSTEM_OFF</span></code>
call. It performs the platform-specific system poweroff sequence after
notifying the Secure Payload Dispatcher.</p>
</div>
<div class="section" id="plat-psci-ops-system-reset">
<h4><span class="section-number">7.13.6.11. </span>plat_psci_ops.system_reset()<a class="headerlink" href="#plat-psci-ops-system-reset" title="Permalink to this headline">¶</a></h4>
<p>This function is called by PSCI implementation in response to a <code class="docutils literal notranslate"><span class="pre">SYSTEM_RESET</span></code>
call. It performs the platform-specific system reset sequence after
notifying the Secure Payload Dispatcher.</p>
</div>
<div class="section" id="plat-psci-ops-validate-power-state">
<h4><span class="section-number">7.13.6.12. </span>plat_psci_ops.validate_power_state()<a class="headerlink" href="#plat-psci-ops-validate-power-state" title="Permalink to this headline">¶</a></h4>
<p>This function is called by the PSCI implementation during the <code class="docutils literal notranslate"><span class="pre">CPU_SUSPEND</span></code>
call to validate the <code class="docutils literal notranslate"><span class="pre">power_state</span></code> parameter of the PSCI API and if valid,
populate it in <code class="docutils literal notranslate"><span class="pre">req_state</span></code> (second argument) array as power domain level
specific local states. If the <code class="docutils literal notranslate"><span class="pre">power_state</span></code> is invalid, the platform must
return PSCI_E_INVALID_PARAMS as error, which is propagated back to the
normal world PSCI client.</p>
</div>
<div class="section" id="plat-psci-ops-validate-ns-entrypoint">
<h4><span class="section-number">7.13.6.13. </span>plat_psci_ops.validate_ns_entrypoint()<a class="headerlink" href="#plat-psci-ops-validate-ns-entrypoint" title="Permalink to this headline">¶</a></h4>
<p>This function is called by the PSCI implementation during the <code class="docutils literal notranslate"><span class="pre">CPU_SUSPEND</span></code>,
<code class="docutils literal notranslate"><span class="pre">SYSTEM_SUSPEND</span></code> and <code class="docutils literal notranslate"><span class="pre">CPU_ON</span></code> calls to validate the non-secure <code class="docutils literal notranslate"><span class="pre">entry_point</span></code>
parameter passed by the normal world. If the <code class="docutils literal notranslate"><span class="pre">entry_point</span></code> is invalid,
the platform must return PSCI_E_INVALID_ADDRESS as error, which is
propagated back to the normal world PSCI client.</p>
</div>
<div class="section" id="plat-psci-ops-get-sys-suspend-power-state">
<h4><span class="section-number">7.13.6.14. </span>plat_psci_ops.get_sys_suspend_power_state()<a class="headerlink" href="#plat-psci-ops-get-sys-suspend-power-state" title="Permalink to this headline">¶</a></h4>
<p>This function is called by the PSCI implementation during the <code class="docutils literal notranslate"><span class="pre">SYSTEM_SUSPEND</span></code>
call to get the <code class="docutils literal notranslate"><span class="pre">req_state</span></code> parameter from platform which encodes the power
domain level specific local states to suspend to system affinity level. The
<code class="docutils literal notranslate"><span class="pre">req_state</span></code> will be utilized to do the PSCI state coordination and
<code class="docutils literal notranslate"><span class="pre">pwr_domain_suspend()</span></code> will be invoked with the coordinated target state to
enter system suspend.</p>
</div>
<div class="section" id="plat-psci-ops-get-pwr-lvl-state-idx">
<h4><span class="section-number">7.13.6.15. </span>plat_psci_ops.get_pwr_lvl_state_idx()<a class="headerlink" href="#plat-psci-ops-get-pwr-lvl-state-idx" title="Permalink to this headline">¶</a></h4>
<p>This is an optional function and, if implemented, is invoked by the PSCI
implementation to convert the <code class="docutils literal notranslate"><span class="pre">local_state</span></code> (first argument) at a specified
<code class="docutils literal notranslate"><span class="pre">pwr_lvl</span></code> (second argument) to an index between 0 and
<code class="docutils literal notranslate"><span class="pre">PLAT_MAX_PWR_LVL_STATES</span></code> - 1. This function is only needed if the platform
supports more than two local power states at each power domain level, that is
<code class="docutils literal notranslate"><span class="pre">PLAT_MAX_PWR_LVL_STATES</span></code> is greater than 2, and needs to account for these
local power states.</p>
</div>
<div class="section" id="plat-psci-ops-translate-power-state-by-mpidr">
<h4><span class="section-number">7.13.6.16. </span>plat_psci_ops.translate_power_state_by_mpidr()<a class="headerlink" href="#plat-psci-ops-translate-power-state-by-mpidr" title="Permalink to this headline">¶</a></h4>
<p>This is an optional function and, if implemented, verifies the <code class="docutils literal notranslate"><span class="pre">power_state</span></code>
(second argument) parameter of the PSCI API corresponding to a target power
domain. The target power domain is identified by using both <code class="docutils literal notranslate"><span class="pre">MPIDR</span></code> (first
argument) and the power domain level encoded in <code class="docutils literal notranslate"><span class="pre">power_state</span></code>. The power domain
level specific local states are to be extracted from <code class="docutils literal notranslate"><span class="pre">power_state</span></code> and be
populated in the <code class="docutils literal notranslate"><span class="pre">output_state</span></code> (third argument) array. The functionality
is similar to the <code class="docutils literal notranslate"><span class="pre">validate_power_state</span></code> function described above and is
envisaged to be used in case the validity of <code class="docutils literal notranslate"><span class="pre">power_state</span></code> depend on the
targeted power domain. If the <code class="docutils literal notranslate"><span class="pre">power_state</span></code> is invalid for the targeted power
domain, the platform must return PSCI_E_INVALID_PARAMS as error. If this
function is not implemented, then the generic implementation relies on
<code class="docutils literal notranslate"><span class="pre">validate_power_state</span></code> function to translate the <code class="docutils literal notranslate"><span class="pre">power_state</span></code>.</p>
<p>This function can also be used in case the platform wants to support local
power state encoding for <code class="docutils literal notranslate"><span class="pre">power_state</span></code> parameter of PSCI_STAT_COUNT/RESIDENCY
APIs as described in Section 5.18 of <a class="reference external" href="http://infocenter.arm.com/help/topic/com.arm.doc.den0022c/DEN0022C_Power_State_Coordination_Interface.pdf">PSCI</a>.</p>
</div>
<div class="section" id="plat-psci-ops-get-node-hw-state">
<h4><span class="section-number">7.13.6.17. </span>plat_psci_ops.get_node_hw_state()<a class="headerlink" href="#plat-psci-ops-get-node-hw-state" title="Permalink to this headline">¶</a></h4>
<p>This is an optional function. If implemented this function is intended to return
the power state of a node (identified by the first parameter, the <code class="docutils literal notranslate"><span class="pre">MPIDR</span></code>) in
the power domain topology (identified by the second parameter, <code class="docutils literal notranslate"><span class="pre">power_level</span></code>),
as retrieved from a power controller or equivalent component on the platform.
Upon successful completion, the implementation must map and return the final
status among <code class="docutils literal notranslate"><span class="pre">HW_ON</span></code>, <code class="docutils literal notranslate"><span class="pre">HW_OFF</span></code> or <code class="docutils literal notranslate"><span class="pre">HW_STANDBY</span></code>. Upon encountering failures, it
must return either <code class="docutils literal notranslate"><span class="pre">PSCI_E_INVALID_PARAMS</span></code> or <code class="docutils literal notranslate"><span class="pre">PSCI_E_NOT_SUPPORTED</span></code> as
appropriate.</p>
<p>Implementations are not expected to handle <code class="docutils literal notranslate"><span class="pre">power_levels</span></code> greater than
<code class="docutils literal notranslate"><span class="pre">PLAT_MAX_PWR_LVL</span></code>.</p>
</div>
<div class="section" id="plat-psci-ops-system-reset2">
<h4><span class="section-number">7.13.6.18. </span>plat_psci_ops.system_reset2()<a class="headerlink" href="#plat-psci-ops-system-reset2" title="Permalink to this headline">¶</a></h4>
<p>This is an optional function. If implemented this function is
called during the <code class="docutils literal notranslate"><span class="pre">SYSTEM_RESET2</span></code> call to perform a reset
based on the first parameter <code class="docutils literal notranslate"><span class="pre">reset_type</span></code> as specified in
<a class="reference external" href="http://infocenter.arm.com/help/topic/com.arm.doc.den0022c/DEN0022C_Power_State_Coordination_Interface.pdf">PSCI</a>. The parameter <code class="docutils literal notranslate"><span class="pre">cookie</span></code> can be used to pass additional
reset information. If the <code class="docutils literal notranslate"><span class="pre">reset_type</span></code> is not supported, the
function must return <code class="docutils literal notranslate"><span class="pre">PSCI_E_NOT_SUPPORTED</span></code>. For architectural
resets, all failures must return <code class="docutils literal notranslate"><span class="pre">PSCI_E_INVALID_PARAMETERS</span></code>
and vendor reset can return other PSCI error codes as defined
in <a class="reference external" href="http://infocenter.arm.com/help/topic/com.arm.doc.den0022c/DEN0022C_Power_State_Coordination_Interface.pdf">PSCI</a>. On success this function will not return.</p>
</div>
<div class="section" id="plat-psci-ops-write-mem-protect">
<h4><span class="section-number">7.13.6.19. </span>plat_psci_ops.write_mem_protect()<a class="headerlink" href="#plat-psci-ops-write-mem-protect" title="Permalink to this headline">¶</a></h4>
<p>This is an optional function. If implemented it enables or disables the
<code class="docutils literal notranslate"><span class="pre">MEM_PROTECT</span></code> functionality based on the value of <code class="docutils literal notranslate"><span class="pre">val</span></code>.
A non-zero value enables <code class="docutils literal notranslate"><span class="pre">MEM_PROTECT</span></code> and a value of zero
disables it. Upon encountering failures it must return a negative value
and on success it must return 0.</p>
</div>
<div class="section" id="plat-psci-ops-read-mem-protect">
<h4><span class="section-number">7.13.6.20. </span>plat_psci_ops.read_mem_protect()<a class="headerlink" href="#plat-psci-ops-read-mem-protect" title="Permalink to this headline">¶</a></h4>
<p>This is an optional function. If implemented it returns the current
state of <code class="docutils literal notranslate"><span class="pre">MEM_PROTECT</span></code> via the <code class="docutils literal notranslate"><span class="pre">val</span></code> parameter.  Upon encountering
failures it must return a negative value and on success it must
return 0.</p>
</div>
<div class="section" id="plat-psci-ops-mem-protect-chk">
<h4><span class="section-number">7.13.6.21. </span>plat_psci_ops.mem_protect_chk()<a class="headerlink" href="#plat-psci-ops-mem-protect-chk" title="Permalink to this headline">¶</a></h4>
<p>This is an optional function. If implemented it checks if a memory
region defined by a base address <code class="docutils literal notranslate"><span class="pre">base</span></code> and with a size of <code class="docutils literal notranslate"><span class="pre">length</span></code>
bytes is protected by <code class="docutils literal notranslate"><span class="pre">MEM_PROTECT</span></code>.  If the region is protected
then it must return 0, otherwise it must return a negative number.</p>
</div>
</div>
</div>
<div class="section" id="interrupt-management-framework-in-bl31">
<span id="porting-guide-imf-in-bl31"></span><h2><span class="section-number">7.14. </span>Interrupt Management framework (in BL31)<a class="headerlink" href="#interrupt-management-framework-in-bl31" title="Permalink to this headline">¶</a></h2>
<p>BL31 implements an Interrupt Management Framework (IMF) to manage interrupts
generated in either security state and targeted to EL1 or EL2 in the non-secure
state or EL3/S-EL1 in the secure state. The design of this framework is
described in the <a class="reference internal" href="../design/interrupt-framework-design.html#interrupt-management-framework"><span class="std std-ref">Interrupt Management Framework</span></a></p>
<p>A platform should export the following APIs to support the IMF. The following
text briefly describes each API and its implementation in Arm standard
platforms. The API implementation depends upon the type of interrupt controller
present in the platform. Arm standard platform layer supports both
<a class="reference external" href="http://infocenter.arm.com/help/topic/com.arm.doc.ihi0048b/index.html">Arm Generic Interrupt Controller version 2.0 (GICv2)</a>
and <a class="reference external" href="http://infocenter.arm.com/help/topic/com.arm.doc.ihi0069b/index.html">3.0 (GICv3)</a>. Juno builds the Arm platform layer to use GICv2 and the
FVP can be configured to use either GICv2 or GICv3 depending on the build flag
<code class="docutils literal notranslate"><span class="pre">FVP_USE_GIC_DRIVER</span></code> (See <a class="reference internal" href="../plat/arm/fvp/index.html#build-options-arm-fvp-platform"><span class="std std-ref">Arm FVP Platform Specific Build Options</span></a> for more
details).</p>
<p>See also: <a class="reference internal" href="../components/platform-interrupt-controller-API.html#platform-interrupt-controller-api"><span class="std std-ref">Interrupt Controller Abstraction APIs</span></a>.</p>
<div class="section" id="function-plat-interrupt-type-to-line-mandatory">
<h3><span class="section-number">7.14.1. </span>Function : plat_interrupt_type_to_line() [mandatory]<a class="headerlink" href="#function-plat-interrupt-type-to-line-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">uint32_t</span><span class="p">,</span> <span class="n">uint32_t</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">uint32_t</span>
</pre></div>
</div>
<p>The Arm processor signals an interrupt exception either through the IRQ or FIQ
interrupt line. The specific line that is signaled depends on how the interrupt
controller (IC) reports different interrupt types from an execution context in
either security state. The IMF uses this API to determine which interrupt line
the platform IC uses to signal each type of interrupt supported by the framework
from a given security state. This API must be invoked at EL3.</p>
<p>The first parameter will be one of the <code class="docutils literal notranslate"><span class="pre">INTR_TYPE_*</span></code> values (see
<a class="reference internal" href="../design/interrupt-framework-design.html#interrupt-management-framework"><span class="std std-ref">Interrupt Management Framework</span></a>) indicating the target type of the
interrupt, the second parameter is the security state of the originating
execution context. The return result is the bit position in the <code class="docutils literal notranslate"><span class="pre">SCR_EL3</span></code>
register of the respective interrupt trap: IRQ=1, FIQ=2.</p>
<p>In the case of Arm standard platforms using GICv2, S-EL1 interrupts are
configured as FIQs and Non-secure interrupts as IRQs from either security
state.</p>
<p>In the case of Arm standard platforms using GICv3, the interrupt line to be
configured depends on the security state of the execution context when the
interrupt is signalled and are as follows:</p>
<ul class="simple">
<li><p>The S-EL1 interrupts are signaled as IRQ in S-EL0/1 context and as FIQ in
NS-EL0/1/2 context.</p></li>
<li><p>The Non secure interrupts are signaled as FIQ in S-EL0/1 context and as IRQ
in the NS-EL0/1/2 context.</p></li>
<li><p>The EL3 interrupts are signaled as FIQ in both S-EL0/1 and NS-EL0/1/2
context.</p></li>
</ul>
</div>
<div class="section" id="function-plat-ic-get-pending-interrupt-type-mandatory">
<h3><span class="section-number">7.14.2. </span>Function : plat_ic_get_pending_interrupt_type() [mandatory]<a class="headerlink" href="#function-plat-ic-get-pending-interrupt-type-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">uint32_t</span>
</pre></div>
</div>
<p>This API returns the type of the highest priority pending interrupt at the
platform IC. The IMF uses the interrupt type to retrieve the corresponding
handler function. <code class="docutils literal notranslate"><span class="pre">INTR_TYPE_INVAL</span></code> is returned when there is no interrupt
pending. The valid interrupt types that can be returned are <code class="docutils literal notranslate"><span class="pre">INTR_TYPE_EL3</span></code>,
<code class="docutils literal notranslate"><span class="pre">INTR_TYPE_S_EL1</span></code> and <code class="docutils literal notranslate"><span class="pre">INTR_TYPE_NS</span></code>. This API must be invoked at EL3.</p>
<p>In the case of Arm standard platforms using GICv2, the <em>Highest Priority
Pending Interrupt Register</em> (<code class="docutils literal notranslate"><span class="pre">GICC_HPPIR</span></code>) is read to determine the id of
the pending interrupt. The type of interrupt depends upon the id value as
follows.</p>
<ol class="arabic simple">
<li><p>id &lt; 1022 is reported as a S-EL1 interrupt</p></li>
<li><p>id = 1022 is reported as a Non-secure interrupt.</p></li>
<li><p>id = 1023 is reported as an invalid interrupt type.</p></li>
</ol>
<p>In the case of Arm standard platforms using GICv3, the system register
<code class="docutils literal notranslate"><span class="pre">ICC_HPPIR0_EL1</span></code>, <em>Highest Priority Pending group 0 Interrupt Register</em>,
is read to determine the id of the pending interrupt. The type of interrupt
depends upon the id value as follows.</p>
<ol class="arabic simple">
<li><p>id = <code class="docutils literal notranslate"><span class="pre">PENDING_G1S_INTID</span></code> (1020) is reported as a S-EL1 interrupt</p></li>
<li><p>id = <code class="docutils literal notranslate"><span class="pre">PENDING_G1NS_INTID</span></code> (1021) is reported as a Non-secure interrupt.</p></li>
<li><p>id = <code class="docutils literal notranslate"><span class="pre">GIC_SPURIOUS_INTERRUPT</span></code> (1023) is reported as an invalid interrupt type.</p></li>
<li><p>All other interrupt id’s are reported as EL3 interrupt.</p></li>
</ol>
</div>
<div class="section" id="function-plat-ic-get-pending-interrupt-id-mandatory">
<h3><span class="section-number">7.14.3. </span>Function : plat_ic_get_pending_interrupt_id() [mandatory]<a class="headerlink" href="#function-plat-ic-get-pending-interrupt-id-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">uint32_t</span>
</pre></div>
</div>
<p>This API returns the id of the highest priority pending interrupt at the
platform IC. <code class="docutils literal notranslate"><span class="pre">INTR_ID_UNAVAILABLE</span></code> is returned when there is no interrupt
pending.</p>
<p>In the case of Arm standard platforms using GICv2, the <em>Highest Priority
Pending Interrupt Register</em> (<code class="docutils literal notranslate"><span class="pre">GICC_HPPIR</span></code>) is read to determine the id of the
pending interrupt. The id that is returned by API depends upon the value of
the id read from the interrupt controller as follows.</p>
<ol class="arabic simple">
<li><p>id &lt; 1022. id is returned as is.</p></li>
<li><p>id = 1022. The <em>Aliased Highest Priority Pending Interrupt Register</em>
(<code class="docutils literal notranslate"><span class="pre">GICC_AHPPIR</span></code>) is read to determine the id of the non-secure interrupt.
This id is returned by the API.</p></li>
<li><p>id = 1023. <code class="docutils literal notranslate"><span class="pre">INTR_ID_UNAVAILABLE</span></code> is returned.</p></li>
</ol>
<p>In the case of Arm standard platforms using GICv3, if the API is invoked from
EL3, the system register <code class="docutils literal notranslate"><span class="pre">ICC_HPPIR0_EL1</span></code>, <em>Highest Priority Pending Interrupt
group 0 Register</em>, is read to determine the id of the pending interrupt. The id
that is returned by API depends upon the value of the id read from the
interrupt controller as follows.</p>
<ol class="arabic simple">
<li><p>id &lt; <code class="docutils literal notranslate"><span class="pre">PENDING_G1S_INTID</span></code> (1020). id is returned as is.</p></li>
<li><p>id = <code class="docutils literal notranslate"><span class="pre">PENDING_G1S_INTID</span></code> (1020) or <code class="docutils literal notranslate"><span class="pre">PENDING_G1NS_INTID</span></code> (1021). The system
register <code class="docutils literal notranslate"><span class="pre">ICC_HPPIR1_EL1</span></code>, <em>Highest Priority Pending Interrupt group 1
Register</em> is read to determine the id of the group 1 interrupt. This id
is returned by the API as long as it is a valid interrupt id</p></li>
<li><p>If the id is any of the special interrupt identifiers,
<code class="docutils literal notranslate"><span class="pre">INTR_ID_UNAVAILABLE</span></code> is returned.</p></li>
</ol>
<p>When the API invoked from S-EL1 for GICv3 systems, the id read from system
register <code class="docutils literal notranslate"><span class="pre">ICC_HPPIR1_EL1</span></code>, <em>Highest Priority Pending group 1 Interrupt
Register</em>, is returned if is not equal to GIC_SPURIOUS_INTERRUPT (1023) else
<code class="docutils literal notranslate"><span class="pre">INTR_ID_UNAVAILABLE</span></code> is returned.</p>
</div>
<div class="section" id="function-plat-ic-acknowledge-interrupt-mandatory">
<h3><span class="section-number">7.14.4. </span>Function : plat_ic_acknowledge_interrupt() [mandatory]<a class="headerlink" href="#function-plat-ic-acknowledge-interrupt-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">uint32_t</span>
</pre></div>
</div>
<p>This API is used by the CPU to indicate to the platform IC that processing of
the highest pending interrupt has begun. It should return the raw, unmodified
value obtained from the interrupt controller when acknowledging an interrupt.
The actual interrupt number shall be extracted from this raw value using the API
<cite>plat_ic_get_interrupt_id()&lt;plat_ic_get_interrupt_id&gt;</cite>.</p>
<p>This function in Arm standard platforms using GICv2, reads the <em>Interrupt
Acknowledge Register</em> (<code class="docutils literal notranslate"><span class="pre">GICC_IAR</span></code>). This changes the state of the highest
priority pending interrupt from pending to active in the interrupt controller.
It returns the value read from the <code class="docutils literal notranslate"><span class="pre">GICC_IAR</span></code>, unmodified.</p>
<p>In the case of Arm standard platforms using GICv3, if the API is invoked
from EL3, the function reads the system register <code class="docutils literal notranslate"><span class="pre">ICC_IAR0_EL1</span></code>, <em>Interrupt
Acknowledge Register group 0</em>. If the API is invoked from S-EL1, the function
reads the system register <code class="docutils literal notranslate"><span class="pre">ICC_IAR1_EL1</span></code>, <em>Interrupt Acknowledge Register
group 1</em>. The read changes the state of the highest pending interrupt from
pending to active in the interrupt controller. The value read is returned
unmodified.</p>
<p>The TSP uses this API to start processing of the secure physical timer
interrupt.</p>
</div>
<div class="section" id="function-plat-ic-end-of-interrupt-mandatory">
<h3><span class="section-number">7.14.5. </span>Function : plat_ic_end_of_interrupt() [mandatory]<a class="headerlink" href="#function-plat-ic-end-of-interrupt-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">uint32_t</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This API is used by the CPU to indicate to the platform IC that processing of
the interrupt corresponding to the id (passed as the parameter) has
finished. The id should be the same as the id returned by the
<code class="docutils literal notranslate"><span class="pre">plat_ic_acknowledge_interrupt()</span></code> API.</p>
<p>Arm standard platforms write the id to the <em>End of Interrupt Register</em>
(<code class="docutils literal notranslate"><span class="pre">GICC_EOIR</span></code>) in case of GICv2, and to <code class="docutils literal notranslate"><span class="pre">ICC_EOIR0_EL1</span></code> or <code class="docutils literal notranslate"><span class="pre">ICC_EOIR1_EL1</span></code>
system register in case of GICv3 depending on where the API is invoked from,
EL3 or S-EL1. This deactivates the corresponding interrupt in the interrupt
controller.</p>
<p>The TSP uses this API to finish processing of the secure physical timer
interrupt.</p>
</div>
<div class="section" id="function-plat-ic-get-interrupt-type-mandatory">
<h3><span class="section-number">7.14.6. </span>Function : plat_ic_get_interrupt_type() [mandatory]<a class="headerlink" href="#function-plat-ic-get-interrupt-type-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">uint32_t</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">uint32_t</span>
</pre></div>
</div>
<p>This API returns the type of the interrupt id passed as the parameter.
<code class="docutils literal notranslate"><span class="pre">INTR_TYPE_INVAL</span></code> is returned if the id is invalid. If the id is valid, a valid
interrupt type (one of <code class="docutils literal notranslate"><span class="pre">INTR_TYPE_EL3</span></code>, <code class="docutils literal notranslate"><span class="pre">INTR_TYPE_S_EL1</span></code> and <code class="docutils literal notranslate"><span class="pre">INTR_TYPE_NS</span></code>) is
returned depending upon how the interrupt has been configured by the platform
IC. This API must be invoked at EL3.</p>
<p>Arm standard platforms using GICv2 configures S-EL1 interrupts as Group0 interrupts
and Non-secure interrupts as Group1 interrupts. It reads the group value
corresponding to the interrupt id from the relevant <em>Interrupt Group Register</em>
(<code class="docutils literal notranslate"><span class="pre">GICD_IGROUPRn</span></code>). It uses the group value to determine the type of interrupt.</p>
<p>In the case of Arm standard platforms using GICv3, both the <em>Interrupt Group
Register</em> (<code class="docutils literal notranslate"><span class="pre">GICD_IGROUPRn</span></code>) and <em>Interrupt Group Modifier Register</em>
(<code class="docutils literal notranslate"><span class="pre">GICD_IGRPMODRn</span></code>) is read to figure out whether the interrupt is configured
as Group 0 secure interrupt, Group 1 secure interrupt or Group 1 NS interrupt.</p>
</div>
</div>
<div class="section" id="crash-reporting-mechanism-in-bl31">
<h2><span class="section-number">7.15. </span>Crash Reporting mechanism (in BL31)<a class="headerlink" href="#crash-reporting-mechanism-in-bl31" title="Permalink to this headline">¶</a></h2>
<p>BL31 implements a crash reporting mechanism which prints the various registers
of the CPU to enable quick crash analysis and debugging. This mechanism relies
on the platform implementing <code class="docutils literal notranslate"><span class="pre">plat_crash_console_init</span></code>,
<code class="docutils literal notranslate"><span class="pre">plat_crash_console_putc</span></code> and <code class="docutils literal notranslate"><span class="pre">plat_crash_console_flush</span></code>.</p>
<p>The file <code class="docutils literal notranslate"><span class="pre">plat/common/aarch64/crash_console_helpers.S</span></code> contains sample
implementation of all of them. Platforms may include this file to their
makefiles in order to benefit from them. By default, they will cause the crash
output to be routed over the normal console infrastructure and get printed on
consoles configured to output in crash state. <code class="docutils literal notranslate"><span class="pre">console_set_scope()</span></code> can be
used to control whether a console is used for crash output.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Platforms are responsible for making sure that they only mark consoles for
use in the crash scope that are able to support this, i.e. that are written
in assembly and conform with the register clobber rules for putc()
(x0-x2, x16-x17) and flush() (x0-x3, x16-x17) crash callbacks.</p>
</div>
<p>In some cases (such as debugging very early crashes that happen before the
normal boot console can be set up), platforms may want to control crash output
more explicitly. These platforms may instead provide custom implementations for
these. They are executed outside of a C environment and without a stack. Many
console drivers provide functions named <code class="docutils literal notranslate"><span class="pre">console_xxx_core_init/putc/flush</span></code>
that are designed to be used by these functions. See Arm platforms (like juno)
for an example of this.</p>
<div class="section" id="function-plat-crash-console-init-mandatory">
<h3><span class="section-number">7.15.1. </span>Function : plat_crash_console_init [mandatory]<a class="headerlink" href="#function-plat-crash-console-init-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<p>This API is used by the crash reporting mechanism to initialize the crash
console. It must only use the general purpose registers x0 through x7 to do the
initialization and returns 1 on success.</p>
</div>
<div class="section" id="function-plat-crash-console-putc-mandatory">
<h3><span class="section-number">7.15.2. </span>Function : plat_crash_console_putc [mandatory]<a class="headerlink" href="#function-plat-crash-console-putc-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="nb">int</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="nb">int</span>
</pre></div>
</div>
<p>This API is used by the crash reporting mechanism to print a character on the
designated crash console. It must only use general purpose registers x1 and
x2 to do its work. The parameter and the return value are in general purpose
register x0.</p>
</div>
<div class="section" id="function-plat-crash-console-flush-mandatory">
<h3><span class="section-number">7.15.3. </span>Function : plat_crash_console_flush [mandatory]<a class="headerlink" href="#function-plat-crash-console-flush-mandatory" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This API is used by the crash reporting mechanism to force write of all buffered
data on the designated crash console. It should only use general purpose
registers x0 through x5 to do its work.</p>
</div>
</div>
<div class="section" id="external-abort-handling-and-ras-support">
<span id="id2"></span><h2><span class="section-number">7.16. </span>External Abort handling and RAS Support<a class="headerlink" href="#external-abort-handling-and-ras-support" title="Permalink to this headline">¶</a></h2>
<div class="section" id="function-plat-ea-handler">
<h3><span class="section-number">7.16.1. </span>Function : plat_ea_handler<a class="headerlink" href="#function-plat-ea-handler" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="nb">int</span>
<span class="n">Argument</span> <span class="p">:</span> <span class="n">uint64_t</span>
<span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span> <span class="o">*</span>
<span class="n">Argument</span> <span class="p">:</span> <span class="n">void</span> <span class="o">*</span>
<span class="n">Argument</span> <span class="p">:</span> <span class="n">uint64_t</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function is invoked by the RAS framework for the platform to handle an
External Abort received at EL3. The intention of the function is to attempt to
resolve the cause of External Abort and return; if that’s not possible, to
initiate orderly shutdown of the system.</p>
<p>The first parameter (<code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">ea_reason</span></code>) indicates the reason for External Abort.
Its value is one of <code class="docutils literal notranslate"><span class="pre">ERROR_EA_*</span></code> constants defined in <code class="docutils literal notranslate"><span class="pre">ea_handle.h</span></code>.</p>
<p>The second parameter (<code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">syndrome</span></code>) is the respective syndrome
presented to EL3 after having received the External Abort. Depending on the
nature of the abort (as can be inferred from the <code class="docutils literal notranslate"><span class="pre">ea_reason</span></code> parameter), this
can be the content of either <code class="docutils literal notranslate"><span class="pre">ESR_EL3</span></code> or <code class="docutils literal notranslate"><span class="pre">DISR_EL1</span></code>.</p>
<p>The third parameter (<code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*cookie</span></code>) is unused for now. The fourth parameter
(<code class="docutils literal notranslate"><span class="pre">void</span> <span class="pre">*handle</span></code>) is a pointer to the preempted context. The fifth parameter
(<code class="docutils literal notranslate"><span class="pre">uint64_t</span> <span class="pre">flags</span></code>) indicates the preempted security state. These parameters
are received from the top-level exception handler.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">RAS_EXTENSION</span></code> is set to <code class="docutils literal notranslate"><span class="pre">1</span></code>, the default implementation of this
function iterates through RAS handlers registered by the platform. If any of the
RAS handlers resolve the External Abort, no further action is taken.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">RAS_EXTENSION</span></code> is set to <code class="docutils literal notranslate"><span class="pre">0</span></code>, or if none of the platform RAS handlers
could resolve the External Abort, the default implementation prints an error
message, and panics.</p>
</div>
<div class="section" id="function-plat-handle-uncontainable-ea">
<h3><span class="section-number">7.16.2. </span>Function : plat_handle_uncontainable_ea<a class="headerlink" href="#function-plat-handle-uncontainable-ea" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="nb">int</span>
<span class="n">Argument</span> <span class="p">:</span> <span class="n">uint64_t</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function is invoked by the RAS framework when an External Abort of
Uncontainable type is received at EL3. Due to the critical nature of
Uncontainable errors, the intention of this function is to initiate orderly
shutdown of the system, and is not expected to return.</p>
<p>This function must be implemented in assembly.</p>
<p>The first and second parameters are the same as that of <code class="docutils literal notranslate"><span class="pre">plat_ea_handler</span></code>.</p>
<p>The default implementation of this function calls
<code class="docutils literal notranslate"><span class="pre">report_unhandled_exception</span></code>.</p>
</div>
<div class="section" id="function-plat-handle-double-fault">
<h3><span class="section-number">7.16.3. </span>Function : plat_handle_double_fault<a class="headerlink" href="#function-plat-handle-double-fault" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Argument</span> <span class="p">:</span> <span class="nb">int</span>
<span class="n">Argument</span> <span class="p">:</span> <span class="n">uint64_t</span>
<span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function is invoked by the RAS framework when another External Abort is
received at EL3 while one is already being handled. I.e., a call to
<code class="docutils literal notranslate"><span class="pre">plat_ea_handler</span></code> is outstanding. Due to its critical nature, the intention of
this function is to initiate orderly shutdown of the system, and is not expected
recover or return.</p>
<p>This function must be implemented in assembly.</p>
<p>The first and second parameters are the same as that of <code class="docutils literal notranslate"><span class="pre">plat_ea_handler</span></code>.</p>
<p>The default implementation of this function calls
<code class="docutils literal notranslate"><span class="pre">report_unhandled_exception</span></code>.</p>
</div>
<div class="section" id="function-plat-handle-el3-ea">
<h3><span class="section-number">7.16.4. </span>Function : plat_handle_el3_ea<a class="headerlink" href="#function-plat-handle-el3-ea" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Return</span>   <span class="p">:</span> <span class="n">void</span>
</pre></div>
</div>
<p>This function is invoked when an External Abort is received while executing in
EL3. Due to its critical nature, the intention of this function is to initiate
orderly shutdown of the system, and is not expected recover or return.</p>
<p>This function must be implemented in assembly.</p>
<p>The default implementation of this function calls
<code class="docutils literal notranslate"><span class="pre">report_unhandled_exception</span></code>.</p>
</div>
</div>
<div class="section" id="build-flags">
<h2><span class="section-number">7.17. </span>Build flags<a class="headerlink" href="#build-flags" title="Permalink to this headline">¶</a></h2>
<p>There are some build flags which can be defined by the platform to control
inclusion or exclusion of certain BL stages from the FIP image. These flags
need to be defined in the platform makefile which will get included by the
build system.</p>
<ul class="simple">
<li><p><strong>NEED_BL33</strong>
By default, this flag is defined <code class="docutils literal notranslate"><span class="pre">yes</span></code> by the build system and <code class="docutils literal notranslate"><span class="pre">BL33</span></code>
build option should be supplied as a build option. The platform has the
option of excluding the BL33 image in the <code class="docutils literal notranslate"><span class="pre">fip</span></code> image by defining this flag
to <code class="docutils literal notranslate"><span class="pre">no</span></code>. If any of the options <code class="docutils literal notranslate"><span class="pre">EL3_PAYLOAD_BASE</span></code> or <code class="docutils literal notranslate"><span class="pre">PRELOADED_BL33_BASE</span></code>
are used, this flag will be set to <code class="docutils literal notranslate"><span class="pre">no</span></code> automatically.</p></li>
</ul>
</div>
<div class="section" id="platform-include-paths">
<h2><span class="section-number">7.18. </span>Platform include paths<a class="headerlink" href="#platform-include-paths" title="Permalink to this headline">¶</a></h2>
<p>Platforms are allowed to add more include paths to be passed to the compiler.
The <code class="docutils literal notranslate"><span class="pre">PLAT_INCLUDES</span></code> variable is used for this purpose. This is needed in
particular for the file <code class="docutils literal notranslate"><span class="pre">platform_def.h</span></code>.</p>
<p>Example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">PLAT_INCLUDES</span>  <span class="o">+=</span> <span class="o">-</span><span class="n">Iinclude</span><span class="o">/</span><span class="n">plat</span><span class="o">/</span><span class="n">myplat</span><span class="o">/</span><span class="n">include</span>
</pre></div>
</div>
</div>
<div class="section" id="c-library">
<h2><span class="section-number">7.19. </span>C Library<a class="headerlink" href="#c-library" title="Permalink to this headline">¶</a></h2>
<p>To avoid subtle toolchain behavioral dependencies, the header files provided
by the compiler are not used. The software is built with the <code class="docutils literal notranslate"><span class="pre">-nostdinc</span></code> flag
to ensure no headers are included from the toolchain inadvertently. Instead the
required headers are included in the TF-A source tree. The library only
contains those C library definitions required by the local implementation. If
more functionality is required, the needed library functions will need to be
added to the local implementation.</p>
<p>Some C headers have been obtained from <a class="reference external" href="https://www.freebsd.org">FreeBSD</a> and <a class="reference external" href="http://www.simple-cc.org/">SCC</a>, while others have
been written specifically for TF-A. Some implementation files have been obtained
from <a class="reference external" href="https://www.freebsd.org">FreeBSD</a>, others have been written specifically for TF-A as well. The
files can be found in <code class="docutils literal notranslate"><span class="pre">include/lib/libc</span></code> and <code class="docutils literal notranslate"><span class="pre">lib/libc</span></code>.</p>
<p>SCC can be found in <a class="reference external" href="http://www.simple-cc.org/">http://www.simple-cc.org/</a>. A copy of the <a class="reference external" href="https://www.freebsd.org">FreeBSD</a> sources
can be obtained from <a class="reference external" href="http://github.com/freebsd/freebsd">http://github.com/freebsd/freebsd</a>.</p>
</div>
<div class="section" id="storage-abstraction-layer">
<h2><span class="section-number">7.20. </span>Storage abstraction layer<a class="headerlink" href="#storage-abstraction-layer" title="Permalink to this headline">¶</a></h2>
<p>In order to improve platform independence and portability a storage abstraction
layer is used to load data from non-volatile platform storage. Currently
storage access is only required by BL1 and BL2 phases and performed inside the
<code class="docutils literal notranslate"><span class="pre">load_image()</span></code> function in <code class="docutils literal notranslate"><span class="pre">bl_common.c</span></code>.</p>
<p class="plantuml">
<img src="../_images/plantuml-308b20503f79a5c67e3782d9c13ecfe3b5ca1ad8.svg" alt="&#64;startuml

participant bl_common
participant arm_io_storage
participant io_storage

== Platform Setup ==

bl1_main -&gt; xxx_bl1_setup : bl1_platform_setup()
xxx_bl1_setup -&gt; arm_io_storage : plat_arm_io_setup()

arm_io_storage -&gt; arm_io_storage : arm_io_setup()
ref over arm_io_storage, io_storage : io device registration

== Get Image ==
bl1_main -&gt; xxx_bl1_setup : bl1_plat_get_next_image_id()
bl1_main &lt;-- xxx_bl1_setup : BL2_IMAGE_ID

bl1_main -&gt; bl1_main : bl1_load_bl2()
activate bl1_main
bl1_main -&gt; plat_bl1_common : bl1_plat_get_image_desc(BL2_IMAGE_ID)
bl1_main &lt;-- plat_bl1_common : BL2_IMAGE_DESC

bl1_main -&gt; plat_bl1_common : bl1_plat_handle_pre_image_load(BL2_IMAGE_ID)

bl1_main -&gt; bl_common : load_auth_image(BL2_IMAGE_ID, image_info)
activate bl_common
bl_common -&gt; bl_common : load_auth_image_internal(BL2_IMAGE_ID, image_info, is_parent_image)
activate bl_common
bl_common -&gt; bl_common : load_image(BL2_IMAGE_ID, image_info)
activate bl_common
bl_common -&gt; arm_io_storage : plat_get_image_source(BL2_IMAGE_ID, &amp;dev_handle, &amp;image_spec)
ref over arm_io_storage, io_storage : init and check device (BL2_IMAGE_ID)
bl_common &lt;-- arm_io_storage : dev_handle

bl_common -&gt; io_storage : io_open(dev_handle, image_spec, &amp;image_handle)
ref over io_storage : io_open() on fip device
bl_common &lt;-- io_storage : image_handle
bl_common -&gt; io_storage : io_size(image_handle, &amp;image_size)
ref over io_storage : io_size() on fip device
bl_common -&gt; io_storage : io_read(image_handle, image_base, image_size, &amp;bytes_read)
ref over io_storage : io_read() on fip device
bl_common -&gt; io_storage : io_close(image_handle)
ref over io_storage : io_close() on fip device
bl_common -&gt; io_storage : io_dev_close(dev_handle)
ref over io_storage : io_dev_close() on fip device

deactivate bl_common
deactivate bl_common
deactivate bl_common

== Prepare Next Image ==
bl1_main -&gt; plat_bl1_common : bl1_plat_handle_post_image_load(BL2_IMAGE_ID)

deactivate bl1_main

== Jump to next Image ==

&#64;enduml
"/></p>
<p>It is mandatory to implement at least one storage driver. For the Arm
development platforms the Firmware Image Package (FIP) driver is provided as
the default means to load data from storage (see <a class="reference internal" href="../design/firmware-design.html#firmware-design-fip"><span class="std std-ref">Firmware Image Package (FIP)</span></a>).
The storage layer is described in the header file
<code class="docutils literal notranslate"><span class="pre">include/drivers/io/io_storage.h</span></code>. The implementation of the common library is
in <code class="docutils literal notranslate"><span class="pre">drivers/io/io_storage.c</span></code> and the driver files are located in
<code class="docutils literal notranslate"><span class="pre">drivers/io/</span></code>.</p>
<p class="plantuml">
<img src="../_images/plantuml-4d639ef7d35bbf6aec5b5e711684b56a2d07aa9c.svg" alt="&#64;startuml

package arm_io_storage {

	class plat_io_policy {
		dev_handle : uintptr_t*
		image_spec : uintptr_t
		{abstract} check() : fctptr
	}

	class FIP_IMAGE_ID {
		memmap_dev_handle
		fip_block_spec
		open_memmap()
	}

	class BL2_IMAGE_ID{
		fip_dev_handle
		bl2_uuid_spec
		open_fip()
	}

	class xxx_IMAGE_ID{
		fip_dev_handle
		xxx_uuid_spec
		open_fip()
	}

	class arm_io_storage {
		fip_dev_con : io_dev_connector_t*
		fip_dev_handle : uintptr_t
		memmap_dev_con : io_dev_connector_t*
		memmap_dev_handle : uintptr_t

		fip_block_spec : io_block_spec_t

		policies : plat_io_policy[1..*]

		-open_fip()
		-open_memmap()

		+arm_io_setup()
		+plat_get_image_source()
	}

	FIP_IMAGE_ID -up-|&gt; plat_io_policy
	BL2_IMAGE_ID -up-|&gt; plat_io_policy
	xxx_IMAGE_ID -up-|&gt; plat_io_policy

	arm_io_storage *-&quot;1..*&quot; plat_io_policy
}

package IO {
	class  io_storage {
		io_dev_open()
		io_dev_init()
		io_dev_close()

		.. synchronous operations ..
		io_open()
		io_seek()
		io_size()
		io_read()
		io_write()
		io_close()

		io_register_device()
	}

	class io_fip {
		register_io_dev_fip()
		.. io_dev_funcs_t interface ..
		fip_dev_funcs : io_dev_funcs_t
	}

	class io_memmap {
		register_io_dev_memmap()
		.. io_dev_funcs_t interface ..
		memmap_dev_funcs : io_dev_funcs_t
	}

	interface io_driver {
		io_entity_t
		io_dev_info_t

		.. io_dev_connector_t interface ..
		dev_open()

		.. io_dev_funcs_t interface ..
			type()
			open()
			seek()
			size()
			read()
			write()
			close()
			dev_init()
			dev_close()

		io_register_device()
	}
}
arm_io_storage .. io_driver
arm_io_storage .. io_fip
arm_io_storage .. io_memmap
arm_io_storage .. io_storage


&#64;enduml
"/></p>
<p>Each IO driver must provide <code class="docutils literal notranslate"><span class="pre">io_dev_*</span></code> structures, as described in
<code class="docutils literal notranslate"><span class="pre">drivers/io/io_driver.h</span></code>. These are returned via a mandatory registration
function that is called on platform initialization. The semi-hosting driver
implementation in <code class="docutils literal notranslate"><span class="pre">io_semihosting.c</span></code> can be used as an example.</p>
<p>Each platform should register devices and their drivers via the storage
abstraction layer. These drivers then need to be initialized by bootloader
phases as required in their respective <code class="docutils literal notranslate"><span class="pre">blx_platform_setup()</span></code> functions.</p>
<p class="plantuml">
<img src="../_images/plantuml-e8b3a32cb1f12ca7502c519e395cf46d373130d8.svg" alt="&#64;startuml

participant arm_io_storage
participant io_storage
participant io_fip
participant io_memmap

 -&gt; arm_io_storage : arm_io_setup()

group io dev registration

arm_io_storage -&gt; io_fip : register_io_dev_fip(&amp;fip_dev_con)
io_fip -&gt; io_storage : io_register_device(&amp;dev_info_pool[])
note over io_storage
	devices[dev_count] = (fip_)dev_info_pool
	dev_count++
end note

arm_io_storage -&gt; io_memmap : register_io_dev_memmap(&amp;memmap_dev_con)
io_memmap -&gt; io_storage : io_register_device(&amp;memmap_dev_info)
note over io_storage
	devices[dev_count] = memmap_dev_info
	dev_count++
end note

arm_io_storage -&gt; io_storage : io_dev_open(fip_dev_con, NULL, fip_dev_handle)
 io_storage -&gt; io_storage : dev_open(dev_con, dev_spec, handle)
activate io_storage
opt dev_open() on fip device
	io_storage -&gt; io_fip : fip_dev_open(dev_spec, dev_info)
	note over io_fip
		dev_info = one of the
		&quot;fip_dev_info&quot; from
		dev_info_pool[]
	end note
end opt
deactivate io_storage


arm_io_storage -&gt; io_storage : io_dev_open(memmap_dev_con, NULL, memmap_dev_handle)
io_storage -&gt; io_storage : dev_open(dev_con, dev_spec, handle)
activate io_storage
opt dev_open() on memmap device
	io_storage -&gt; io_memmap : memmap_dev_open(dev_spec, dev_info)
	note over io_memmap
		dev_info = memmap_dev_info
	end note
end opt
deactivate io_storage

end group
&#64;enduml
"/></p>
<p>The storage abstraction layer provides mechanisms (<code class="docutils literal notranslate"><span class="pre">io_dev_init()</span></code>) to
initialize storage devices before IO operations are called.</p>
<p class="plantuml">
<img src="../_images/plantuml-ef7a12870a9b080fcf07080b66096d7b64117c80.svg" alt="&#64;startuml

participant arm_io_storage
participant io_storage

 -&gt; arm_io_storage : plat_get_image_source(image_id, &amp;dev_handle, &amp;image_spec)

group init and check device (image_id)

alt image_id = BL2_IMAGE_ID
note over arm_io_storage
	get BL2_IMAGE_ID policy:
	- fip_dev_handle
	- open_fip()
end note
opt policy-&gt;check()
	arm_io_storage -&gt; arm_io_storage : open_fip(spec)
	activate arm_io_storage
	arm_io_storage -&gt; io_storage : io_dev_init(fip_dev_handle, FIP_IMAGE_ID)
	ref over io_storage : dev_init() on fip device

	arm_io_storage -&gt; io_storage : io_open(fip_dev_handle, spec, &amp;local_image_handle)
	ref over io_storage : io_open() on fip device

	arm_io_storage -&gt; io_storage : io_close(local_image_handle)
	ref over io_storage : io_close() on fip device

	hnote over arm_io_storage
		fip_dev_handle ready
	end note
end opt
deactivate arm_io_storage

else image_id = FIP_IMAGE_ID
activate arm_io_storage
note over arm_io_storage
	get FIP_IMAGE_ID policy:
	- memmap_dev_handle
	- open_memmap()
end note
opt policy-&gt;check()
	arm_io_storage -&gt; arm_io_storage : open_memmap(spec)
	activate arm_io_storage
	arm_io_storage -&gt; io_storage : io_dev_init(memmap_dev_handle, NULL)
	ref over io_storage : dev_init() on memmap device

	arm_io_storage -&gt; io_storage : io_open(memmap_dev_handle, spec, &amp;local_image_handle)
	ref over io_storage : io_open() on memmap device

	arm_io_storage -&gt; io_storage : io_close(local_image_handle)
	ref over io_storage : io_close() on memmap device

	hnote over arm_io_storage
		memmap_dev_handle ready
	end note
	deactivate arm_io_storage
end  opt
deactivate arm_io_storage
end alt

end group
&#64;enduml
"/></p>
<p>The basic operations supported by the layer
include <code class="docutils literal notranslate"><span class="pre">open()</span></code>, <code class="docutils literal notranslate"><span class="pre">close()</span></code>, <code class="docutils literal notranslate"><span class="pre">read()</span></code>, <code class="docutils literal notranslate"><span class="pre">write()</span></code>, <code class="docutils literal notranslate"><span class="pre">size()</span></code> and <code class="docutils literal notranslate"><span class="pre">seek()</span></code>.
Drivers do not have to implement all operations, but each platform must
provide at least one driver for a device capable of supporting generic
operations such as loading a bootloader image.</p>
<p>The current implementation only allows for known images to be loaded by the
firmware. These images are specified by using their identifiers, as defined in
<code class="docutils literal notranslate"><span class="pre">include/plat/common/common_def.h</span></code> (or a separate header file included from
there). The platform layer (<code class="docutils literal notranslate"><span class="pre">plat_get_image_source()</span></code>) then returns a reference
to a device and a driver-specific <code class="docutils literal notranslate"><span class="pre">spec</span></code> which will be understood by the driver
to allow access to the image data.</p>
<p>The layer is designed in such a way that is it possible to chain drivers with
other drivers. For example, file-system drivers may be implemented on top of
physical block devices, both represented by IO devices with corresponding
drivers. In such a case, the file-system “binding” with the block device may
be deferred until the file-system device is initialised.</p>
<p>The abstraction currently depends on structures being statically allocated
by the drivers and callers, as the system does not yet provide a means of
dynamically allocating memory. This may also have the affect of limiting the
amount of open resources per driver.</p>
<hr class="docutils" />
<p><em>Copyright (c) 2013-2021, Arm Limited and Contributors. All rights reserved.</em></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="psci-lib-integration-guide.html" class="btn btn-neutral float-right" title="8. PSCI Library Integration guide for Armv8-A AArch32 systems" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="image-terminology.html" class="btn btn-neutral float-left" title="6. Image Terminology" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>