

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>4. Firmware Design &mdash; Trusted Firmware-A  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5. Interrupt Management Framework" href="interrupt-framework-design.html" />
    <link rel="prev" title="3. Arm CPU Specific Build Macros" href="cpu-specific-build-macros.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Trusted Firmware-A
          

          
            
            <img src="../_static/TrustedFirmware-Logo_standard-white.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about/features.html">1. Feature Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../about/features.html#current-features">1.1. Current features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../about/features.html#still-to-come">1.2. Still to come</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../about/release-information.html">2. Release Processes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../about/release-information.html#project-release-cadence">2.1. Project Release Cadence</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../about/release-information.html#upcoming-releases">2.1.1. Upcoming Releases</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../about/release-information.html#removal-of-deprecated-interfaces">2.2. Removal of Deprecated Interfaces</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../about/maintainers.html">3. Project Maintenance</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../about/maintainers.html#maintainers">3.1. Maintainers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../about/maintainers.html#code-owners">3.2. Code owners</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../about/maintainers.html#core-code">3.2.1. Core Code</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/maintainers.html#drivers-libraries-and-framework-code">3.2.2. Drivers, Libraries and Framework Code</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/maintainers.html#platform-ports">3.2.3. Platform Ports</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/maintainers.html#secure-payloads-and-dispatchers">3.2.4. Secure Payloads and Dispatchers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../about/maintainers.html#tools">3.2.5. Tools</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../about/contact.html">4. Support &amp; Contact</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../about/contact.html#mailing-lists">4.1. Mailing Lists</a></li>
<li class="toctree-l3"><a class="reference internal" href="../about/contact.html#open-tech-forum-call">4.2. Open Tech Forum Call</a></li>
<li class="toctree-l3"><a class="reference internal" href="../about/contact.html#issue-tracker">4.3. Issue Tracker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../about/contact.html#arm-licensees">4.4. Arm Licensees</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../about/acknowledgements.html">5. Contributor Acknowledgements</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/prerequisites.html">1. Prerequisites</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/prerequisites.html#build-host">1.1. Build Host</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/prerequisites.html#toolchain">1.2. Toolchain</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/prerequisites.html#software-and-libraries">1.3. Software and Libraries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/prerequisites.html#package-installation-linux">1.3.1. Package Installation (Linux)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/prerequisites.html#supporting-files">1.4. Supporting Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/prerequisites.html#getting-the-tf-a-source">1.5. Getting the TF-A Source</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/docs-build.html">2. Building Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/docs-build.html#prerequisites">2.1. Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/docs-build.html#building-rendered-documentation">2.2. Building rendered documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/docs-build.html#building-rendered-documentation-from-a-container">2.3. Building rendered documentation from a container</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/tools-build.html">3. Building Supporting Tools</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/tools-build.html#building-and-using-the-fip-tool">3.1. Building and using the FIP tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/tools-build.html#building-the-certificate-generation-tool">3.2. Building the Certificate Generation Tool</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/tools-build.html#building-the-firmware-encryption-tool">3.2.1. Building the Firmware Encryption Tool</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/initial-build.html">4. Performing an Initial Build</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/build-options.html">5. Build Options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/build-options.html#common-build-options">5.1. Common build options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/build-options.html#gicv3-driver-options">5.2. GICv3 driver options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/build-options.html#debugging-options">5.3. Debugging options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/image-terminology.html">6. Image Terminology</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/image-terminology.html#general-notes">6.1. General Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/image-terminology.html#trusted-firmware-images">6.2. Trusted Firmware Images</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/image-terminology.html#ap-boot-rom-ap-bl1">6.2.1. AP Boot ROM: <code class="docutils literal notranslate"><span class="pre">AP_BL1</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/image-terminology.html#ap-ram-firmware-ap-bl2">6.2.2. AP RAM Firmware: <code class="docutils literal notranslate"><span class="pre">AP_BL2</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/image-terminology.html#el3-runtime-firmware-ap-bl31">6.2.3. EL3 Runtime Firmware: <code class="docutils literal notranslate"><span class="pre">AP_BL31</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/image-terminology.html#secure-el1-payload-sp-ap-bl32">6.2.4. Secure-EL1 Payload (SP): <code class="docutils literal notranslate"><span class="pre">AP_BL32</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/image-terminology.html#ap-normal-world-firmware-ap-bl33">6.2.5. AP Normal World Firmware: <code class="docutils literal notranslate"><span class="pre">AP_BL33</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/image-terminology.html#other-ap-3rd-level-images-ap-bl3-xxx">6.2.6. Other AP 3rd level images: <code class="docutils literal notranslate"><span class="pre">AP_BL3_XXX</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/image-terminology.html#scp-boot-rom-scp-bl1-previously-bl0">6.2.7. SCP Boot ROM: <code class="docutils literal notranslate"><span class="pre">SCP_BL1</span></code> (previously <code class="docutils literal notranslate"><span class="pre">BL0</span></code>)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/image-terminology.html#scp-ram-firmware-scp-bl2-previously-bl3-0">6.2.8. SCP RAM Firmware: <code class="docutils literal notranslate"><span class="pre">SCP_BL2</span></code> (previously <code class="docutils literal notranslate"><span class="pre">BL3-0</span></code>)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/image-terminology.html#firmware-update-fwu-images">6.3. Firmware Update (FWU) Images</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/image-terminology.html#ap-firmware-update-boot-rom-ap-ns-bl1u">6.3.1. AP Firmware Update Boot ROM: <code class="docutils literal notranslate"><span class="pre">AP_NS_BL1U</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/image-terminology.html#ap-firmware-update-config-ap-bl2u">6.3.2. AP Firmware Update Config: <code class="docutils literal notranslate"><span class="pre">AP_BL2U</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/image-terminology.html#scp-firmware-update-config-scp-bl2u-previously-bl2-u0">6.3.3. SCP Firmware Update Config: <code class="docutils literal notranslate"><span class="pre">SCP_BL2U</span></code> (previously <code class="docutils literal notranslate"><span class="pre">BL2-U0</span></code>)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/image-terminology.html#ap-firmware-updater-ap-ns-bl2u-previously-bl3-u">6.3.4. AP Firmware Updater: <code class="docutils literal notranslate"><span class="pre">AP_NS_BL2U</span></code> (previously <code class="docutils literal notranslate"><span class="pre">BL3-U</span></code>)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/image-terminology.html#other-processor-firmware-images">6.4. Other Processor Firmware Images</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/image-terminology.html#mcp-boot-rom-mcp-bl1">6.4.1. MCP Boot ROM: <code class="docutils literal notranslate"><span class="pre">MCP_BL1</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/image-terminology.html#mcp-ram-firmware-mcp-bl2">6.4.2. MCP RAM Firmware: <code class="docutils literal notranslate"><span class="pre">MCP_BL2</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/porting-guide.html">7. Porting Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/porting-guide.html#introduction">7.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/porting-guide.html#common-modifications">7.2. Common modifications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/porting-guide.html#common-mandatory-modifications">7.3. Common mandatory modifications</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#file-platform-def-h-mandatory">7.3.1. File : platform_def.h [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#file-plat-macros-s-mandatory">7.3.2. File : plat_macros.S [mandatory]</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/porting-guide.html#handling-reset">7.4. Handling Reset</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-get-my-entrypoint-mandatory-when-programmable-reset-address-0">7.4.1. Function : plat_get_my_entrypoint() [mandatory when PROGRAMMABLE_RESET_ADDRESS == 0]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-secondary-cold-boot-setup-mandatory-when-cold-boot-single-cpu-0">7.4.2. Function : plat_secondary_cold_boot_setup() [mandatory when COLD_BOOT_SINGLE_CPU == 0]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-is-my-cpu-primary-mandatory-when-cold-boot-single-cpu-0">7.4.3. Function : plat_is_my_cpu_primary() [mandatory when COLD_BOOT_SINGLE_CPU == 0]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-platform-mem-init-mandatory">7.4.4. Function : platform_mem_init() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-get-rotpk-info">7.4.5. Function: plat_get_rotpk_info()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-get-nv-ctr">7.4.6. Function: plat_get_nv_ctr()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-set-nv-ctr">7.4.7. Function: plat_set_nv_ctr()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-set-nv-ctr2">7.4.8. Function: plat_set_nv_ctr2()</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/porting-guide.html#common-mandatory-function-modifications">7.5. Common mandatory function modifications</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-my-core-pos">7.5.1. Function : plat_my_core_pos()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-core-pos-by-mpidr">7.5.2. Function : plat_core_pos_by_mpidr()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-get-mbedtls-heap-when-trusted-board-boot-1">7.5.3. Function : plat_get_mbedtls_heap() [when TRUSTED_BOARD_BOOT == 1]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-get-enc-key-info-when-fw-enc-status-0-or-1">7.5.4. Function : plat_get_enc_key_info() [when FW_ENC_STATUS == 0 or 1]</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/porting-guide.html#common-optional-modifications">7.6. Common optional modifications</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-set-my-stack">7.6.1. Function : plat_set_my_stack()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-get-my-stack">7.6.2. Function : plat_get_my_stack()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-report-exception">7.6.3. Function : plat_report_exception()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-reset-handler">7.6.4. Function : plat_reset_handler()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-disable-acp">7.6.5. Function : plat_disable_acp()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-error-handler">7.6.6. Function : plat_error_handler()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-panic-handler">7.6.7. Function : plat_panic_handler()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-get-bl-image-load-info">7.6.8. Function : plat_get_bl_image_load_info()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-get-next-bl-params">7.6.9. Function : plat_get_next_bl_params()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-get-stack-protector-canary">7.6.10. Function : plat_get_stack_protector_canary()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-flush-next-bl-params">7.6.11. Function : plat_flush_next_bl_params()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-log-get-prefix">7.6.12. Function : plat_log_get_prefix()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-get-soc-version">7.6.13. Function : plat_get_soc_version()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-get-soc-revision">7.6.14. Function : plat_get_soc_revision()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-is-smccc-feature-available">7.6.15. Function : plat_is_smccc_feature_available()</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/porting-guide.html#modifications-specific-to-a-boot-loader-stage">7.7. Modifications specific to a Boot Loader stage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/porting-guide.html#boot-loader-stage-1-bl1">7.8. Boot Loader Stage 1 (BL1)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl1-early-platform-setup-mandatory">7.8.1. Function : bl1_early_platform_setup() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl1-plat-arch-setup-mandatory">7.8.2. Function : bl1_plat_arch_setup() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl1-platform-setup-mandatory">7.8.3. Function : bl1_platform_setup() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl1-plat-sec-mem-layout-mandatory">7.8.4. Function : bl1_plat_sec_mem_layout() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl1-plat-prepare-exit-optional">7.8.5. Function : bl1_plat_prepare_exit() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl1-plat-set-ep-info-optional">7.8.6. Function : bl1_plat_set_ep_info() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl1-plat-get-next-image-id-optional">7.8.7. Function : bl1_plat_get_next_image_id() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl1-plat-get-image-desc-optional">7.8.8. Function : bl1_plat_get_image_desc() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl1-plat-handle-pre-image-load-optional">7.8.9. Function : bl1_plat_handle_pre_image_load() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl1-plat-handle-post-image-load-optional">7.8.10. Function : bl1_plat_handle_post_image_load() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl1-plat-fwu-done-optional">7.8.11. Function : bl1_plat_fwu_done() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl1-plat-mem-check-mandatory">7.8.12. Function : bl1_plat_mem_check() [mandatory]</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/porting-guide.html#boot-loader-stage-2-bl2">7.9. Boot Loader Stage 2 (BL2)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl2-early-platform-setup2-mandatory">7.9.1. Function : bl2_early_platform_setup2() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl2-plat-arch-setup-mandatory">7.9.2. Function : bl2_plat_arch_setup() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl2-platform-setup-mandatory">7.9.3. Function : bl2_platform_setup() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl2-plat-handle-pre-image-load-optional">7.9.4. Function : bl2_plat_handle_pre_image_load() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl2-plat-handle-post-image-load-optional">7.9.5. Function : bl2_plat_handle_post_image_load() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl2-plat-preload-setup-optional">7.9.6. Function : bl2_plat_preload_setup [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-try-next-boot-source-optional">7.9.7. Function : plat_try_next_boot_source() [optional]</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/porting-guide.html#boot-loader-stage-2-bl2-at-el3">7.10. Boot Loader Stage 2 (BL2) at EL3</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl2-el3-early-platform-setup-mandatory">7.10.1. Function : bl2_el3_early_platform_setup() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl2-el3-plat-arch-setup-mandatory">7.10.2. Function : bl2_el3_plat_arch_setup() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl2-el3-plat-prepare-exit-optional">7.10.3. Function : bl2_el3_plat_prepare_exit() [optional]</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/porting-guide.html#fwu-boot-loader-stage-2-bl2u">7.11. FWU Boot Loader Stage 2 (BL2U)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl2u-early-platform-setup-mandatory">7.11.1. Function : bl2u_early_platform_setup() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl2u-plat-arch-setup-mandatory">7.11.2. Function : bl2u_plat_arch_setup() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl2u-platform-setup-mandatory">7.11.3. Function : bl2u_platform_setup() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl2u-plat-handle-scp-bl2u-optional">7.11.4. Function : bl2u_plat_handle_scp_bl2u() [optional]</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/porting-guide.html#boot-loader-stage-3-1-bl31">7.12. Boot Loader Stage 3-1 (BL31)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl31-early-platform-setup2-mandatory">7.12.1. Function : bl31_early_platform_setup2() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl31-plat-arch-setup-mandatory">7.12.2. Function : bl31_plat_arch_setup() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl31-platform-setup-mandatory">7.12.3. Function : bl31_platform_setup() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl31-plat-runtime-setup-optional">7.12.4. Function : bl31_plat_runtime_setup() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl31-plat-get-next-image-ep-info-mandatory">7.12.5. Function : bl31_plat_get_next_image_ep_info() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-bl31-plat-enable-mmu-optional">7.12.6. Function : bl31_plat_enable_mmu [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-init-apkey-optional">7.12.7. Function : plat_init_apkey [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-get-syscnt-freq2-mandatory">7.12.8. Function : plat_get_syscnt_freq2() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-arm-set-twedel-scr-el3-optional">7.12.9. Function : plat_arm_set_twedel_scr_el3() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#define-plat-percpu-bakery-lock-size-optional">7.12.10. #define : PLAT_PERCPU_BAKERY_LOCK_SIZE [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#sdei-porting-requirements">7.12.11. SDEI porting requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#trng-porting-requirements">7.12.12. TRNG porting requirements</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/porting-guide.html#power-state-coordination-interface-in-bl31">7.13. Power State Coordination Interface (in BL31)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-psci-stat-accounting-start-optional">7.13.1. Function : plat_psci_stat_accounting_start() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-psci-stat-accounting-stop-optional">7.13.2. Function : plat_psci_stat_accounting_stop() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-psci-stat-get-residency-optional">7.13.3. Function : plat_psci_stat_get_residency() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-get-target-pwr-state-optional">7.13.4. Function : plat_get_target_pwr_state() [optional]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-get-power-domain-tree-desc-mandatory">7.13.5. Function : plat_get_power_domain_tree_desc() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-setup-psci-ops-mandatory">7.13.6. Function : plat_setup_psci_ops() [mandatory]</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/porting-guide.html#interrupt-management-framework-in-bl31">7.14. Interrupt Management framework (in BL31)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-interrupt-type-to-line-mandatory">7.14.1. Function : plat_interrupt_type_to_line() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-ic-get-pending-interrupt-type-mandatory">7.14.2. Function : plat_ic_get_pending_interrupt_type() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-ic-get-pending-interrupt-id-mandatory">7.14.3. Function : plat_ic_get_pending_interrupt_id() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-ic-acknowledge-interrupt-mandatory">7.14.4. Function : plat_ic_acknowledge_interrupt() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-ic-end-of-interrupt-mandatory">7.14.5. Function : plat_ic_end_of_interrupt() [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-ic-get-interrupt-type-mandatory">7.14.6. Function : plat_ic_get_interrupt_type() [mandatory]</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/porting-guide.html#crash-reporting-mechanism-in-bl31">7.15. Crash Reporting mechanism (in BL31)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-crash-console-init-mandatory">7.15.1. Function : plat_crash_console_init [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-crash-console-putc-mandatory">7.15.2. Function : plat_crash_console_putc [mandatory]</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-crash-console-flush-mandatory">7.15.3. Function : plat_crash_console_flush [mandatory]</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/porting-guide.html#external-abort-handling-and-ras-support">7.16. External Abort handling and RAS Support</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-ea-handler">7.16.1. Function : plat_ea_handler</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-handle-uncontainable-ea">7.16.2. Function : plat_handle_uncontainable_ea</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-handle-double-fault">7.16.3. Function : plat_handle_double_fault</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/porting-guide.html#function-plat-handle-el3-ea">7.16.4. Function : plat_handle_el3_ea</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/porting-guide.html#build-flags">7.17. Build flags</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/porting-guide.html#platform-include-paths">7.18. Platform include paths</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/porting-guide.html#c-library">7.19. C Library</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/porting-guide.html#storage-abstraction-layer">7.20. Storage abstraction layer</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/psci-lib-integration-guide.html">8. PSCI Library Integration guide for Armv8-A AArch32 systems</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/psci-lib-integration-guide.html#generic-call-sequence-for-psci-library-interface-aarch32">8.1. Generic call sequence for PSCI Library interface (AArch32)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/psci-lib-integration-guide.html#psci-cpu-context-management">8.2. PSCI CPU context management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/psci-lib-integration-guide.html#psci-library-interface">8.3. PSCI Library Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/psci-lib-integration-guide.html#interface-psci-setup">8.3.1. Interface : psci_setup()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/psci-lib-integration-guide.html#interface-psci-prepare-next-non-secure-ctx">8.3.2. Interface : psci_prepare_next_non_secure_ctx()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/psci-lib-integration-guide.html#interface-psci-register-spd-pm-hook">8.3.3. Interface : psci_register_spd_pm_hook()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/psci-lib-integration-guide.html#interface-psci-smc-handler">8.3.4. Interface : psci_smc_handler()</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/psci-lib-integration-guide.html#interface-psci-warmboot-entrypoint">8.3.5. Interface : psci_warmboot_entrypoint()</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/psci-lib-integration-guide.html#el3-runtime-software-dependencies">8.4. EL3 Runtime Software dependencies</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/psci-lib-integration-guide.html#general-dependencies">8.4.1. General dependencies</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/psci-lib-integration-guide.html#cpu-context-management-api">8.4.2. CPU Context management API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/psci-lib-integration-guide.html#platform-api">8.4.3. Platform API</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/psci-lib-integration-guide.html#secure-payload-power-management-callback">8.4.4. Secure payload power management callback</a></li>
<li class="toctree-l4"><a class="reference internal" href="../getting_started/psci-lib-integration-guide.html#cpu-operations">8.4.5. CPU operations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/rt-svc-writers-guide.html">9. EL3 Runtime Service Writer’s Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/rt-svc-writers-guide.html#introduction">9.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/rt-svc-writers-guide.html#owning-entities-call-types-and-function-ids">9.2. Owning Entities, Call Types and Function IDs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/rt-svc-writers-guide.html#getting-started">9.3. Getting started</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/rt-svc-writers-guide.html#registering-a-runtime-service">9.4. Registering a runtime service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/rt-svc-writers-guide.html#initializing-a-runtime-service">9.5. Initializing a runtime service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/rt-svc-writers-guide.html#handling-runtime-service-requests">9.6. Handling runtime service requests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/rt-svc-writers-guide.html#services-that-contain-multiple-sub-services">9.7. Services that contain multiple sub-services</a></li>
<li class="toctree-l3"><a class="reference internal" href="../getting_started/rt-svc-writers-guide.html#secure-el1-payload-dispatcher-service-spd">9.8. Secure-EL1 Payload Dispatcher service (SPD)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../process/index.html">Processes &amp; Policies</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../process/security.html">1. Security Handling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../process/security.html#security-disclosures">1.1. Security Disclosures</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/security.html#found-a-security-issue">1.2. Found a Security Issue?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/security.html#attribution">1.3. Attribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/security.html#security-advisories">1.4. Security Advisories</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../process/platform-compatibility-policy.html">2. Platform Compatibility Policy</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../process/platform-compatibility-policy.html#introduction">2.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/platform-compatibility-policy.html#id1">2.2. Platform compatibility policy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../process/coding-style.html">3. Coding Style</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#file-encoding">3.1. File Encoding</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#language">3.2. Language</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#c-language-standard">3.3. C Language Standard</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#misra-compliance">3.4. MISRA Compliance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#indentation">3.5. Indentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#spacing">3.6. Spacing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#line-length">3.7. Line Length</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#blank-lines">3.8. Blank Lines</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#braces">3.9. Braces</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-style.html#opening-brace-placement">3.9.1. Opening Brace Placement</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-style.html#conditional-statement-bodies">3.9.2. Conditional Statement Bodies</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#naming">3.10. Naming</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-style.html#functions">3.10.1. Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-style.html#local-variables-and-parameters">3.10.2. Local Variables and Parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-style.html#preprocessor-macros">3.10.3. Preprocessor Macros</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#function-attributes">3.11. Function Attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#alignment">3.12. Alignment</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-style.html#switch-statement-alignment">3.12.1. Switch Statement Alignment</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-style.html#pointer-alignment">3.12.2. Pointer Alignment</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#comments">3.13. Comments</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#headers-and-inclusion">3.14. Headers and inclusion</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-style.html#header-guards">3.14.1. Header guards</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-style.html#include-statement-ordering">3.14.2. Include statement ordering</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-style.html#include-statement-variants">3.14.3. Include statement variants</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-style.html#typedefs">3.15. Typedefs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-style.html#avoid-anonymous-typedefs-of-structs-enums-in-headers">3.15.1. Avoid anonymous typedefs of structs/enums in headers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../process/coding-guidelines.html">4. Coding Guidelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-guidelines.html#automatic-editor-configuration">4.1. Automatic Editor Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-guidelines.html#automatic-compliance-checking">4.2. Automatic Compliance Checking</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-guidelines.html#ignored-checkpatch-warnings">4.2.1. Ignored Checkpatch Warnings</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-guidelines.html#performance-considerations">4.3. Performance considerations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-guidelines.html#avoid-printf-and-use-logging-macros">4.3.1. Avoid printf and use logging macros</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-guidelines.html#use-const-data-where-possible">4.3.2. Use const data where possible</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-guidelines.html#libc-functions-that-are-banned-or-to-be-used-with-caution">4.4. Libc functions that are banned or to be used with caution</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-guidelines.html#error-handling-and-robustness">4.5. Error handling and robustness</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-guidelines.html#using-cassert-to-check-for-compile-time-data-errors">4.5.1. Using CASSERT to check for compile time data errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-guidelines.html#using-assert-to-check-for-programming-errors">4.5.2. Using assert() to check for programming errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-guidelines.html#handling-integration-errors">4.5.3. Handling integration errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-guidelines.html#handling-recoverable-errors">4.5.4. Handling recoverable errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-guidelines.html#handling-unrecoverable-errors">4.5.5. Handling unrecoverable errors</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/coding-guidelines.html#handling-critical-unresponsiveness">4.5.6. Handling critical unresponsiveness</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-guidelines.html#use-of-built-in-c-and-libc-data-types">4.6. Use of built-in <em>C</em> and <em>libc</em> data types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/coding-guidelines.html#favor-c-language-over-assembly-language">4.7. Favor C language over assembly language</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../process/contributing.html">5. Contributor’s Guide</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../process/contributing.html#getting-started">5.1. Getting Started</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/contributing.html#making-changes">5.2. Making Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/contributing.html#submitting-changes">5.3. Submitting Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/contributing.html#binary-components">5.4. Binary Components</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../process/code-review-guidelines.html">6. Code Review Guidelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../process/code-review-guidelines.html#why-do-we-do-code-reviews">6.1. Why do we do code reviews?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/code-review-guidelines.html#good-practices">6.2. Good practices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/code-review-guidelines.html#guidelines-for-patch-contributors">6.3. Guidelines for patch contributors</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/code-review-guidelines.html#guidelines-for-all-reviewers">6.4. Guidelines for all reviewers</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/code-review-guidelines.html#guidelines-for-code-owners">6.5. Guidelines for code owners</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/code-review-guidelines.html#guidelines-for-maintainers">6.6. Guidelines for maintainers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../process/faq.html">7. Frequently-Asked Questions (FAQ)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../process/faq.html#how-do-i-update-my-changes">7.1. How do I update my changes?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/faq.html#how-long-will-my-changes-take-to-merge-into-integration">7.2. How long will my changes take to merge into <code class="docutils literal notranslate"><span class="pre">integration</span></code>?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/faq.html#how-long-will-it-take-for-my-changes-to-go-from-integration-to-master">7.3. How long will it take for my changes to go from <code class="docutils literal notranslate"><span class="pre">integration</span></code> to <code class="docutils literal notranslate"><span class="pre">master</span></code>?</a></li>
<li class="toctree-l3"><a class="reference internal" href="../process/faq.html#what-are-these-strange-comments-in-my-changes">7.4. What are these strange comments in my changes?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../process/security-hardening.html">8. Secure Development Guidelines</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../process/security-hardening.html#security-considerations">8.1. Security considerations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../process/security-hardening.html#do-not-leak-secrets-to-the-normal-world">8.1.1. Do not leak secrets to the normal world</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/security-hardening.html#handling-denial-of-service-attacks">8.1.2. Handling Denial of Service attacks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../process/security-hardening.html#preventing-secure-world-timing-information-leakage-via-pmu-counters">8.1.3. Preventing Secure-world timing information leakage via PMU counters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../process/security-hardening.html#build-options">8.2. Build options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../components/index.html">Components</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../components/spd/index.html">1. Secure Payload Dispatcher (SPD)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/spd/optee-dispatcher.html">1.1. OP-TEE Dispatcher</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/spd/tlk-dispatcher.html">1.2. Trusted Little Kernel (TLK) Dispatcher</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/spd/tlk-dispatcher.html#trusted-little-kernel-tlk">1.2.1. Trusted Little Kernel (TLK)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/spd/tlk-dispatcher.html#build-tlk">1.2.2. Build TLK</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/spd/tlk-dispatcher.html#input-parameters-to-tlk">1.2.3. Input parameters to TLK</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/spd/trusty-dispatcher.html">1.3. Trusty Dispatcher</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/spd/trusty-dispatcher.html#boot-parameters">1.3.1. Boot parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/spd/trusty-dispatcher.html#supported-platforms">1.3.2. Supported platforms</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/arm-sip-service.html">2. Arm SiP Services</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/arm-sip-service.html#performance-measurement-framework-pmf">2.1. Performance Measurement Framework (PMF)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/arm-sip-service.html#execution-state-switching-service">2.2. Execution State Switching service</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/arm-sip-service.html#arm-sip-svc-exe-state-switch">2.2.1. <code class="docutils literal notranslate"><span class="pre">ARM_SIP_SVC_EXE_STATE_SWITCH</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/arm-sip-service.html#debugfs-interface">2.3. DebugFS interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/arm-sip-service.html#mount">2.3.1. MOUNT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/arm-sip-service.html#open">2.3.2. OPEN</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/arm-sip-service.html#close">2.3.3. CLOSE</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/arm-sip-service.html#read">2.3.4. READ</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/arm-sip-service.html#seek">2.3.5. SEEK</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/arm-sip-service.html#bind">2.3.6. BIND</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/arm-sip-service.html#stat">2.3.7. STAT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/arm-sip-service.html#init">2.3.8. INIT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/arm-sip-service.html#version">2.3.9. VERSION</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/debugfs-design.html">3. Debug FS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/debugfs-design.html#overview">3.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/debugfs-design.html#virtual-filesystem">3.2. Virtual filesystem</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/debugfs-design.html#namespace">3.2.1. Namespace</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/debugfs-design.html#p-interface">3.2.2. 9p interface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/debugfs-design.html#smc-interface">3.3. SMC interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/debugfs-design.html#security-considerations">3.4. Security considerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/debugfs-design.html#limitations">3.5. Limitations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/debugfs-design.html#applications">3.6. Applications</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/exception-handling.html">4. Exception Handling Framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/exception-handling.html#introduction">4.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/exception-handling.html#the-role-of-exception-handling-framework">4.2. The role of Exception Handling Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/exception-handling.html#interrupt-handling">4.3. Interrupt handling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/exception-handling.html#partitioning-priority-levels">4.3.1. Partitioning priority levels</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/exception-handling.html#programming-priority">4.3.2. Programming priority</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/exception-handling.html#registering-handler">4.4. Registering handler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/exception-handling.html#interrupt-handling-example">4.5. Interrupt handling example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/exception-handling.html#activating-and-deactivating-priorities">4.6. Activating and Deactivating priorities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/exception-handling.html#transition-of-priority-levels">4.7. Transition of priority levels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/exception-handling.html#effect-on-smc-calls">4.8. Effect on SMC calls</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/exception-handling.html#build-time-flow">4.9. Build-time flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/exception-handling.html#run-time-flow">4.10. Run-time flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/exception-handling.html#interrupt-prioritisation-considerations">4.11. Interrupt Prioritisation Considerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/exception-handling.html#limitations">4.12. Limitations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/fconf/index.html">5. Firmware Configuration Framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/fconf/index.html#introduction">5.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/fconf/index.html#accessing-properties">5.2. Accessing properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/fconf/index.html#defining-properties">5.3. Defining properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/fconf/index.html#loading-the-property-device-tree">5.4. Loading the property device tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/fconf/index.html#populating-the-properties">5.5. Populating the properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/fconf/index.html#namespace-guidance">5.6. Namespace guidance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/fconf/index.html#properties-binding-information">5.7. Properties binding information</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/fconf/fconf_properties.html">5.7.1. DTB binding for FCONF properties</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/firmware-update.html">6. Firmware Update (FWU)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/firmware-update.html#introduction">6.1. Introduction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/firmware-update.html#scope">6.1.1. Scope</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/firmware-update.html#fwu-overview">6.2. FWU Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/firmware-update.html#image-identification">6.3. Image Identification</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/firmware-update.html#fwu-state-machine">6.4. FWU State Machine</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/firmware-update.html#bl1-smc-interface">6.5. BL1 SMC Interface</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/firmware-update.html#bl1-smc-call-count">6.5.1. BL1_SMC_CALL_COUNT</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/firmware-update.html#bl1-smc-uid">6.5.2. BL1_SMC_UID</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/firmware-update.html#bl1-smc-version">6.5.3. BL1_SMC_VERSION</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/firmware-update.html#bl1-smc-run-image">6.5.4. BL1_SMC_RUN_IMAGE</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/firmware-update.html#fwu-smc-image-copy">6.5.5. FWU_SMC_IMAGE_COPY</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/firmware-update.html#fwu-smc-image-auth">6.5.6. FWU_SMC_IMAGE_AUTH</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/firmware-update.html#fwu-smc-image-execute">6.5.7. FWU_SMC_IMAGE_EXECUTE</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/firmware-update.html#fwu-smc-image-resume">6.5.8. FWU_SMC_IMAGE_RESUME</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/firmware-update.html#fwu-smc-sec-image-done">6.5.9. FWU_SMC_SEC_IMAGE_DONE</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/firmware-update.html#fwu-smc-update-done">6.5.10. FWU_SMC_UPDATE_DONE</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/firmware-update.html#fwu-smc-image-reset">6.5.11. FWU_SMC_IMAGE_RESET</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/measured_boot/index.html">7. Measured Boot Driver (MBD)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/measured_boot/index.html#properties-binding-information">7.1. Properties binding information</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/measured_boot/event_log.html">7.1.1. DTB binding for Event Log properties</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/platform-interrupt-controller-API.html">8. Platform Interrupt Controller API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-unsigned-int-plat-ic-get-running-priority-void-optional">8.1. Function: unsigned int plat_ic_get_running_priority(void); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-int-plat-ic-is-spi-unsigned-int-id-optional">8.2. Function: int plat_ic_is_spi(unsigned int id); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-int-plat-ic-is-ppi-unsigned-int-id-optional">8.3. Function: int plat_ic_is_ppi(unsigned int id); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-int-plat-ic-is-sgi-unsigned-int-id-optional">8.4. Function: int plat_ic_is_sgi(unsigned int id); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-unsigned-int-plat-ic-get-interrupt-active-unsigned-int-id-optional">8.5. Function: unsigned int plat_ic_get_interrupt_active(unsigned int id); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-void-plat-ic-enable-interrupt-unsigned-int-id-optional">8.6. Function: void plat_ic_enable_interrupt(unsigned int id); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-void-plat-ic-disable-interrupt-unsigned-int-id-optional">8.7. Function: void plat_ic_disable_interrupt(unsigned int id); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-void-plat-ic-set-interrupt-priority-unsigned-int-id-unsigned-int-priority-optional">8.8. Function: void plat_ic_set_interrupt_priority(unsigned int id, unsigned int priority); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-int-plat-ic-has-interrupt-type-unsigned-int-type-optional">8.9. Function: int plat_ic_has_interrupt_type(unsigned int type); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-void-plat-ic-set-interrupt-type-unsigned-int-id-unsigned-int-type-optional">8.10. Function: void plat_ic_set_interrupt_type(unsigned int id, unsigned int type); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-void-plat-ic-raise-el3-sgi-int-sgi-num-u-register-t-target-optional">8.11. Function: void plat_ic_raise_el3_sgi(int sgi_num, u_register_t target); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-void-plat-ic-set-spi-routing-unsigned-int-id-unsigned-int-routing-mode-u-register-t-mpidr-optional">8.12. Function: void plat_ic_set_spi_routing(unsigned int id, unsigned int routing_mode, u_register_t mpidr); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-void-plat-ic-set-interrupt-pending-unsigned-int-id-optional">8.13. Function: void plat_ic_set_interrupt_pending(unsigned int id); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-void-plat-ic-clear-interrupt-pending-unsigned-int-id-optional">8.14. Function: void plat_ic_clear_interrupt_pending(unsigned int id); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-unsigned-int-plat-ic-set-priority-mask-unsigned-int-id-optional">8.15. Function: unsigned int plat_ic_set_priority_mask(unsigned int id); [optional]</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/platform-interrupt-controller-API.html#function-unsigned-int-plat-ic-get-interrupt-id-unsigned-int-raw-optional">8.16. Function: unsigned int plat_ic_get_interrupt_id(unsigned int raw); [optional]</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/ras.html">9. Reliability, Availability, and Serviceability (RAS) Extensions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/ras.html#overview">9.1. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/ras.html#platform-apis">9.2. Platform APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/ras.html#registering-ras-error-records">9.3. Registering RAS error records</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/ras.html#standard-error-record-helpers">9.3.1. Standard Error Record helpers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/ras.html#registering-ras-interrupts">9.4. Registering RAS interrupts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/ras.html#double-fault-handling">9.5. Double-fault handling</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/ras.html#engaging-the-ras-framework">9.6. Engaging the RAS framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/ras.html#interaction-with-exception-handling-framework">9.7. Interaction with Exception Handling Framework</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/romlib-design.html">10. Library at ROM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/romlib-design.html#introduction">10.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/romlib-design.html#index-file">10.2. Index file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/romlib-design.html#wrapper-functions">10.3. Wrapper functions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/romlib-design.html#script">10.4. Script</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/romlib-design.html#patching-of-functions-in-library-at-rom">10.5. Patching of functions in library at ROM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/romlib-design.html#memory-impact">10.6. Memory impact</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/romlib-design.html#build-library-at-rom">10.7. Build library at ROM</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/sdei.html">11. SDEI: Software Delegated Exception Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/sdei.html#introduction">11.1. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/sdei.html#defining-events">11.2. Defining events</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/sdei.html#event-flags">11.2.1. Event flags</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/sdei.html#event-definition-example">11.3. Event definition example</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/sdei.html#configuration-within-exception-handling-framework">11.4. Configuration within Exception Handling Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/sdei.html#determining-client-el">11.5. Determining client EL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/sdei.html#explicit-dispatch-of-events">11.6. Explicit dispatch of events</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/sdei.html#conditions-for-event-dispatch">11.6.1. Conditions for event dispatch</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/sdei.html#porting-requirements">11.7. Porting requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/sdei.html#note-on-writing-sdei-event-handlers">11.8. Note on writing SDEI event handlers</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/secure-partition-manager.html">12. Secure Partition Manager</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/secure-partition-manager.html#acronyms">12.1. Acronyms</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/secure-partition-manager.html#foreword">12.2. Foreword</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#terminology">12.2.1. Terminology</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#support-for-legacy-platforms">12.2.2. Support for legacy platforms</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/secure-partition-manager.html#sample-reference-stack">12.3. Sample reference stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/secure-partition-manager.html#tf-a-build-options">12.4. TF-A build options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/secure-partition-manager.html#boot-process">12.5. Boot process</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#loading-hafnium-and-secure-partitions-in-the-secure-world">12.5.1. Loading Hafnium and Secure Partitions in the secure world</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#booting-through-tf-a">12.5.2. Booting through TF-A</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/secure-partition-manager.html#hafnium-in-the-secure-world">12.6. Hafnium in the secure world</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#general-considerations">12.6.1. General considerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#parsing-sp-partition-manifests">12.6.2. Parsing SP partition manifests</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#passing-boot-data-to-the-sp">12.6.3. Passing boot data to the SP</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#sp-boot-order">12.6.4. SP Boot order</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#boot-phases">12.6.5. Boot phases</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#mandatory-interfaces">12.6.6. Mandatory interfaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#direct-messaging">12.6.7. Direct messaging</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#memory-management">12.6.8. Memory management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#interrupt-management">12.6.9. Interrupt management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#power-management">12.6.10. Power management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager.html#sp-notification">12.6.11. SP notification</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/secure-partition-manager.html#references">12.7. References</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/secure-partition-manager-mm.html">13. Secure Partition Manager (MM)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/secure-partition-manager-mm.html#foreword">13.1. Foreword</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/secure-partition-manager-mm.html#background">13.2. Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/secure-partition-manager-mm.html#introduction">13.3. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/secure-partition-manager-mm.html#description">13.4. Description</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager-mm.html#building-tf-a-with-secure-partition-support">13.4.1. Building TF-A with Secure Partition support</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager-mm.html#describing-secure-partition-resources">13.4.2. Describing Secure Partition resources</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager-mm.html#accessing-secure-partition-services">13.4.3. Accessing Secure Partition services</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager-mm.html#exchanging-data-with-the-secure-partition">13.4.4. Exchanging data with the Secure Partition</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/secure-partition-manager-mm.html#runtime-model-of-the-secure-partition">13.5. Runtime model of the Secure Partition</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager-mm.html#interface-with-spm">13.5.1. Interface with SPM</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager-mm.html#miscellaneous-interfaces">13.5.2. Miscellaneous interfaces</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager-mm.html#secure-partition-initialisation">13.5.3. Secure Partition Initialisation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager-mm.html#runtime-event-delegation">13.5.4. Runtime Event Delegation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager-mm.html#secure-partition-memory-management">13.5.5. Secure Partition Memory Management</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/secure-partition-manager-mm.html#error-codes">13.5.6. Error Codes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/psa-ffa-manifest-binding.html">14. PSA FF-A manifest binding to device tree</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/psa-ffa-manifest-binding.html#version-1-0">14.1. Version 1.0</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/psa-ffa-manifest-binding.html#partition-properties">14.1.1. Partition Properties</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/psa-ffa-manifest-binding.html#memory-regions">14.2. Memory Regions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/psa-ffa-manifest-binding.html#device-regions">14.3. Device Regions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html">15. Translation (XLAT) Tables Library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#about-version-1-and-version-2">15.1. About version 1 and version 2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#design-concepts-and-interfaces">15.2. Design concepts and interfaces</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#mmap-regions">15.2.1. <cite>mmap</cite> regions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#translation-context">15.2.2. Translation Context</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#static-and-dynamic-memory-regions">15.2.3. Static and dynamic memory regions</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#library-apis">15.3. Library APIs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#library-limitations">15.4. Library limitations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#implementation-details">15.5. Implementation details</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#code-structure">15.5.1. Code structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#from-mmap-regions-to-translation-tables">15.5.2. From mmap regions to translation tables</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#the-memory-mapping-algorithm">15.5.3. The memory mapping algorithm</a></li>
<li class="toctree-l4"><a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#tlb-maintenance-operations">15.5.4. TLB maintenance operations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../components/cot-binding.html">16. Chain of trust bindings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../components/cot-binding.html#cot">16.1. cot</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/cot-binding.html#manifests-and-certificate-node-bindings-definition">16.2. Manifests and Certificate node bindings definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/cot-binding.html#images-and-image-node-bindings-definition">16.3. Images and Image node bindings definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/cot-binding.html#non-volatile-counter-node-binding-definition">16.4. non-volatile counter node binding definition</a></li>
<li class="toctree-l3"><a class="reference internal" href="../components/cot-binding.html#future-update-to-chain-of-trust-binding">16.5. Future update to chain of trust binding</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">System Design</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="alt-boot-flows.html">1. Alternative Boot Flows</a><ul>
<li class="toctree-l3"><a class="reference internal" href="alt-boot-flows.html#el3-payloads-alternative-boot-flow">1.1. EL3 payloads alternative boot flow</a><ul>
<li class="toctree-l4"><a class="reference internal" href="alt-boot-flows.html#booting-an-el3-payload">1.1.1. Booting an EL3 payload</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="alt-boot-flows.html#preloaded-bl33-alternative-boot-flow">1.2. Preloaded BL33 alternative boot flow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="auth-framework.html">2. Authentication Framework &amp; Chain of Trust</a><ul>
<li class="toctree-l3"><a class="reference internal" href="auth-framework.html#framework-design">2.1. Framework design</a><ul>
<li class="toctree-l4"><a class="reference internal" href="auth-framework.html#chain-of-trust">2.1.1. Chain of Trust</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth-framework.html#image-types">2.1.2. Image types</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth-framework.html#component-responsibilities">2.1.3. Component responsibilities</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth-framework.html#authentication-methods">2.1.4. Authentication methods</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="auth-framework.html#specifying-a-chain-of-trust">2.2. Specifying a Chain of Trust</a><ul>
<li class="toctree-l4"><a class="reference internal" href="auth-framework.html#describing-the-image-parsing-methods">2.2.1. Describing the image parsing methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth-framework.html#describing-the-authentication-method-s">2.2.2. Describing the authentication method(s)</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth-framework.html#storing-authentication-parameters">2.2.3. Storing Authentication parameters</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth-framework.html#describing-an-image-in-a-cot">2.2.4. Describing an image in a CoT</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="auth-framework.html#implementation-example">2.3. Implementation example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="auth-framework.html#the-tbbr-cot">2.3.1. The TBBR CoT</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth-framework.html#the-image-parser-library">2.3.2. The image parser library</a></li>
<li class="toctree-l4"><a class="reference internal" href="auth-framework.html#the-cryptographic-library">2.3.3. The cryptographic library</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cpu-specific-build-macros.html">3. Arm CPU Specific Build Macros</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cpu-specific-build-macros.html#security-vulnerability-workarounds">3.1. Security Vulnerability Workarounds</a></li>
<li class="toctree-l3"><a class="reference internal" href="cpu-specific-build-macros.html#cpu-errata-workarounds">3.2. CPU Errata Workarounds</a></li>
<li class="toctree-l3"><a class="reference internal" href="cpu-specific-build-macros.html#dsu-errata-workarounds">3.3. DSU Errata Workarounds</a></li>
<li class="toctree-l3"><a class="reference internal" href="cpu-specific-build-macros.html#cpu-specific-optimizations">3.4. CPU Specific optimizations</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4. Firmware Design</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cold-boot">4.1. Cold boot</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#dynamic-configuration-during-cold-boot">4.1.1. Dynamic Configuration during cold boot</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bl1">4.1.2. BL1</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bl2">4.1.3. BL2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-bl2-at-el3-execution-level">4.1.4. Running BL2 at EL3 execution level</a></li>
<li class="toctree-l4"><a class="reference internal" href="#aarch64-bl31">4.1.5. AArch64 BL31</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-alternative-trusted-boot-firmware-in-place-of-bl1-bl2-aarch64-only">4.1.6. Using alternative Trusted Boot Firmware in place of BL1 &amp; BL2 (AArch64 only)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#aarch32-el3-runtime-software-entrypoint-interface">4.1.7. AArch32 EL3 Runtime Software entrypoint interface</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#el3-runtime-services-framework">4.2. EL3 runtime services framework</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#registration">4.2.1. Registration</a></li>
<li class="toctree-l4"><a class="reference internal" href="#initialization">4.2.2. Initialization</a></li>
<li class="toctree-l4"><a class="reference internal" href="#handling-an-smc">4.2.3. Handling an SMC</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#exception-handling-framework">4.3. Exception Handling Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="#power-state-coordination-interface">4.4. Power State Coordination Interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="#secure-el1-payloads-and-dispatchers">4.5. Secure-EL1 Payloads and Dispatchers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#initializing-a-bl32-image">4.5.1. Initializing a BL32 Image</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#crash-reporting-in-bl31">4.6. Crash Reporting in BL31</a></li>
<li class="toctree-l3"><a class="reference internal" href="#guidelines-for-reset-handlers">4.7. Guidelines for Reset Handlers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuring-secure-interrupts">4.8. Configuring secure interrupts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cpu-specific-operations-framework">4.9. CPU specific operations framework</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#cpu-specific-reset-handling">4.9.1. CPU specific Reset Handling</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cpu-specific-power-down-sequence">4.9.2. CPU specific power down sequence</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cpu-specific-register-reporting-during-crash">4.9.3. CPU specific register reporting during crash</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cpu-errata-status-reporting">4.9.4. CPU errata status reporting</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#memory-layout-of-bl-images">4.10. Memory layout of BL images</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#linker-scripts-and-symbols">4.10.1. Linker scripts and symbols</a></li>
<li class="toctree-l4"><a class="reference internal" href="#how-to-choose-the-right-base-addresses-for-each-bootloader-stage-image">4.10.2. How to choose the right base addresses for each bootloader stage image</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#firmware-image-package-fip">4.11. Firmware Image Package (FIP)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#firmware-image-package-layout">4.11.1. Firmware Image Package layout</a></li>
<li class="toctree-l4"><a class="reference internal" href="#firmware-image-package-creation-tool">4.11.2. Firmware Image Package creation tool</a></li>
<li class="toctree-l4"><a class="reference internal" href="#loading-from-a-firmware-image-package-fip">4.11.3. Loading from a Firmware Image Package (FIP)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#use-of-coherent-memory-in-tf-a">4.12. Use of coherent memory in TF-A</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#disabling-the-use-of-coherent-memory-in-tf-a">4.12.1. Disabling the use of coherent memory in TF-A</a></li>
<li class="toctree-l4"><a class="reference internal" href="#coherent-memory-usage-in-psci-implementation">4.12.2. Coherent memory usage in PSCI implementation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bakery-lock-data">4.12.3. Bakery lock data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#non-functional-impact-of-removing-coherent-memory">4.12.4. Non Functional Impact of removing coherent memory</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#isolating-code-and-read-only-data-on-separate-memory-pages">4.13. Isolating code and read-only data on separate memory pages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#publish-and-subscribe-framework">4.14. Publish and Subscribe Framework</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#publish-and-subscribe-example">4.14.1. Publish and Subscribe Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#reclaiming-the-bl31-initialization-code">4.14.2. Reclaiming the BL31 initialization code</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#performance-measurement-framework">4.15. Performance Measurement Framework</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#timestamp-identifier-format">4.15.1. Timestamp identifier format</a></li>
<li class="toctree-l4"><a class="reference internal" href="#registering-a-pmf-service">4.15.2. Registering a PMF service</a></li>
<li class="toctree-l4"><a class="reference internal" href="#capturing-a-timestamp">4.15.3. Capturing a timestamp</a></li>
<li class="toctree-l4"><a class="reference internal" href="#retrieving-a-timestamp">4.15.4. Retrieving a timestamp</a></li>
<li class="toctree-l4"><a class="reference internal" href="#pmf-code-structure">4.15.5. PMF code structure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#armv8-a-architecture-extensions">4.16. Armv8-A Architecture Extensions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#armv8-1-a">4.16.1. Armv8.1-A</a></li>
<li class="toctree-l4"><a class="reference internal" href="#armv8-2-a">4.16.2. Armv8.2-A</a></li>
<li class="toctree-l4"><a class="reference internal" href="#armv8-3-a">4.16.3. Armv8.3-A</a></li>
<li class="toctree-l4"><a class="reference internal" href="#armv8-5-a">4.16.4. Armv8.5-A</a></li>
<li class="toctree-l4"><a class="reference internal" href="#armv7-a">4.16.5. Armv7-A</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#code-structure">4.17. Code Structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="interrupt-framework-design.html">5. Interrupt Management Framework</a><ul>
<li class="toctree-l3"><a class="reference internal" href="interrupt-framework-design.html#concepts">5.1. Concepts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="interrupt-framework-design.html#interrupt-types">5.1.1. Interrupt types</a></li>
<li class="toctree-l4"><a class="reference internal" href="interrupt-framework-design.html#routing-model">5.1.2. Routing model</a></li>
<li class="toctree-l4"><a class="reference internal" href="interrupt-framework-design.html#valid-routing-models">5.1.3. Valid routing models</a></li>
<li class="toctree-l4"><a class="reference internal" href="interrupt-framework-design.html#mapping-of-interrupt-type-to-signal">5.1.4. Mapping of interrupt type to signal</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="interrupt-framework-design.html#assumptions-in-interrupt-management-framework">5.2. Assumptions in Interrupt Management Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="interrupt-framework-design.html#software-components">5.3. Software components</a></li>
<li class="toctree-l3"><a class="reference internal" href="interrupt-framework-design.html#interrupt-registration">5.4. Interrupt registration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="interrupt-framework-design.html#el3-runtime-firmware">5.4.1. EL3 runtime firmware</a></li>
<li class="toctree-l4"><a class="reference internal" href="interrupt-framework-design.html#secure-payload-dispatcher">5.4.2. Secure payload dispatcher</a></li>
<li class="toctree-l4"><a class="reference internal" href="interrupt-framework-design.html#test-secure-payload-dispatcher-behavior">5.4.3. Test secure payload dispatcher behavior</a></li>
<li class="toctree-l4"><a class="reference internal" href="interrupt-framework-design.html#secure-payload">5.4.4. Secure payload</a></li>
<li class="toctree-l4"><a class="reference internal" href="interrupt-framework-design.html#test-secure-payload-behavior">5.4.5. Test secure payload behavior</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="interrupt-framework-design.html#interrupt-handling">5.5. Interrupt handling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="interrupt-framework-design.html#id4">5.5.1. EL3 runtime firmware</a></li>
<li class="toctree-l4"><a class="reference internal" href="interrupt-framework-design.html#id5">5.5.2. Secure payload dispatcher</a></li>
<li class="toctree-l4"><a class="reference internal" href="interrupt-framework-design.html#secure-payload-interrupt-handling">5.5.3. Secure payload interrupt handling</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="interrupt-framework-design.html#other-considerations">5.6. Other considerations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="interrupt-framework-design.html#implication-of-preempted-smc-on-non-secure-software">5.6.1. Implication of preempted SMC on Non-Secure Software</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="psci-pd-tree.html">6. PSCI Power Domain Tree Structure</a><ul>
<li class="toctree-l3"><a class="reference internal" href="psci-pd-tree.html#requirements">6.1. Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="psci-pd-tree.html#design">6.2. Design</a><ul>
<li class="toctree-l4"><a class="reference internal" href="psci-pd-tree.html#describing-a-power-domain-tree">6.2.1. Describing a power domain tree</a></li>
<li class="toctree-l4"><a class="reference internal" href="psci-pd-tree.html#removing-assumptions-about-mpidrs-used-in-a-platform">6.2.2. Removing assumptions about MPIDRs used in a platform</a></li>
<li class="toctree-l4"><a class="reference internal" href="psci-pd-tree.html#traversing-through-and-distinguishing-between-core-and-non-core-power-domains">6.2.3. Traversing through and distinguishing between core and non-core power domains</a></li>
<li class="toctree-l4"><a class="reference internal" href="psci-pd-tree.html#populating-the-power-domain-tree">6.2.4. Populating the power domain tree</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="reset-design.html">7. CPU Reset</a><ul>
<li class="toctree-l3"><a class="reference internal" href="reset-design.html#general-reset-code-flow">7.1. General reset code flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="reset-design.html#programmable-cpu-reset-address">7.2. Programmable CPU reset address</a></li>
<li class="toctree-l3"><a class="reference internal" href="reset-design.html#cold-boot-on-a-single-cpu">7.3. Cold boot on a single CPU</a></li>
<li class="toctree-l3"><a class="reference internal" href="reset-design.html#programmable-cpu-reset-address-cold-boot-on-a-single-cpu">7.4. Programmable CPU reset address, Cold boot on a single CPU</a></li>
<li class="toctree-l3"><a class="reference internal" href="reset-design.html#using-bl31-entrypoint-as-the-reset-address">7.5. Using BL31 entrypoint as the reset address</a><ul>
<li class="toctree-l4"><a class="reference internal" href="reset-design.html#determination-of-boot-path">7.5.1. Determination of boot path</a></li>
<li class="toctree-l4"><a class="reference internal" href="reset-design.html#platform-initialization">7.5.2. Platform initialization</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="trusted-board-boot.html">8. Trusted Board Boot</a><ul>
<li class="toctree-l3"><a class="reference internal" href="trusted-board-boot.html#chain-of-trust">8.1. Chain of Trust</a></li>
<li class="toctree-l3"><a class="reference internal" href="trusted-board-boot.html#trusted-board-boot-sequence">8.2. Trusted Board Boot Sequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="trusted-board-boot.html#authentication-framework">8.3. Authentication Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="trusted-board-boot.html#certificate-generation-tool">8.4. Certificate Generation Tool</a></li>
<li class="toctree-l3"><a class="reference internal" href="trusted-board-boot.html#authenticated-encryption-framework">8.5. Authenticated Encryption Framework</a></li>
<li class="toctree-l3"><a class="reference internal" href="trusted-board-boot.html#firmware-encryption-tool">8.6. Firmware Encryption Tool</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="trusted-board-boot-build.html">9. Building FIP images with support for Trusted Board Boot</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../plat/index.html">Platform Ports</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../plat/allwinner.html">1. Allwinner ARMv8 SoCs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/allwinner.html#trusted-os-dispatcher">1.1. Trusted OS dispatcher</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/arm/index.html">2. Arm Development Platforms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/arm/juno/index.html">2.1. Arm Juno Development Platform</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/juno/index.html#platform-specific-build-options">2.1.1. Platform-specific build options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/juno/index.html#running-software-on-juno">2.1.2. Running software on Juno</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/juno/index.html#preparing-tf-a-images">2.1.3. Preparing TF-A images</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/juno/index.html#creating-a-firmware-image-package-fip">2.1.4. Creating a Firmware Image Package (FIP)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/juno/index.html#booting-firmware-update-images">2.1.5. Booting Firmware Update images</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/juno/index.html#booting-an-el3-payload">2.1.6. Booting an EL3 payload</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/juno/index.html#booting-a-preloaded-kernel-image">2.1.7. Booting a preloaded kernel image</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/juno/index.html#testing-system-suspend">2.1.8. Testing System Suspend</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/juno/index.html#additional-resources">2.1.9. Additional Resources</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/arm/fvp/index.html">2.2. Arm Fixed Virtual Platforms (FVP)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/fvp/index.html#fixed-virtual-platform-fvp-support">2.2.1. Fixed Virtual Platform (FVP) Support</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/fvp/index.html#arm-fvp-platform-specific-build-options">2.2.2. Arm FVP Platform Specific Build Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/fvp/index.html#booting-firmware-update-images">2.2.3. Booting Firmware Update images</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/fvp/index.html#booting-an-el3-payload">2.2.4. Booting an EL3 payload</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/fvp/index.html#booting-a-preloaded-kernel-image-base-fvp">2.2.5. Booting a preloaded kernel image (Base FVP)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/arm/fvp-ve/index.html">2.3. Arm Versatile Express</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/fvp-ve/index.html#boot-sequence">2.3.1. Boot Sequence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/fvp-ve/index.html#how-to-build">2.3.2. How to build</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/arm/tc0/index.html">2.4. TC0 Total Compute Platform</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/tc0/index.html#boot-sequence">2.4.1. Boot Sequence</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/arm/arm_fpga/index.html">2.5. Arm FPGA Platform</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/arm_fpga/index.html#platform-specific-build-options">2.5.1. Platform-specific build options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/arm_fpga/index.html#building-the-tf-a-image">2.5.2. Building the TF-A image</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/arm_fpga/index.html#running-the-tf-a-image">2.5.3. Running the TF-A image</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/arm/arm-build-options.html">2.6. Arm Development Platform Build Options</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/arm-build-options.html#arm-platform-build-options">2.6.1. Arm Platform Build Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/arm-build-options.html#arm-css-platform-specific-build-options">2.6.2. Arm CSS Platform-Specific Build Options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/arm/morello/index.html">2.7. Morello Platform</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/arm/morello/index.html#boot-sequence">2.7.1. Boot Sequence</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/meson-axg.html">3. Amlogic Meson A113D (AXG)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plat/meson-gxbb.html">4. Amlogic Meson S905 (GXBB)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plat/meson-gxl.html">5. Amlogic Meson S905x (GXL)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plat/meson-g12a.html">6. Amlogic Meson S905X2 (G12A)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plat/hikey.html">7. HiKey</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/hikey.html#how-to-build">7.1. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/hikey.html#code-locations">7.1.1. Code Locations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/hikey.html#build-procedure">7.1.2. Build Procedure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/hikey.html#setup-console">7.2. Setup Console</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/hikey.html#flash-images-in-recovery-mode">7.3. Flash images in recovery mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/hikey.html#boot-uefi-in-normal-mode">7.4. Boot UEFI in normal mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/hikey960.html">8. HiKey960</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/hikey960.html#how-to-build">8.1. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/hikey960.html#code-locations">8.1.1. Code Locations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/hikey960.html#build-procedure">8.1.2. Build Procedure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/hikey960.html#setup-console">8.2. Setup Console</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/hikey960.html#boot-uefi-in-recovery-mode">8.3. Boot UEFI in recovery mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/hikey960.html#boot-uefi-in-normal-mode">8.4. Boot UEFI in normal mode</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/intel-agilex.html">9. Intel Agilex SoCFPGA</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/intel-agilex.html#how-to-build">9.1. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/intel-agilex.html#code-locations">9.1.1. Code Locations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/intel-agilex.html#build-procedure">9.1.2. Build Procedure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/intel-agilex.html#install-procedure">9.1.3. Install Procedure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/intel-agilex.html#boot-trace">9.2. Boot trace</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/intel-stratix10.html">10. Intel Stratix 10 SoCFPGA</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/intel-stratix10.html#how-to-build">10.1. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/intel-stratix10.html#code-locations">10.1.1. Code Locations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/intel-stratix10.html#build-procedure">10.1.2. Build Procedure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/intel-stratix10.html#install-procedure">10.1.3. Install Procedure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/intel-stratix10.html#boot-trace">10.2. Boot trace</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/marvell/index.html">11. Marvell</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/marvell/armada/build.html">11.1. TF-A Build Instructions for Marvell Platforms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/build.html#build-instructions">11.1.1. Build Instructions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/build.html#special-build-flags">11.1.2. Special Build Flags</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/build.html#build-output">11.1.3. Build output</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/build.html#tools-and-external-components-installation">11.1.4. Tools and external components installation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/marvell/armada/porting.html">11.2. TF-A Porting Guide for Marvell Platforms</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/porting.html#source-code-structure">11.2.1. Source Code Structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/porting.html#armada-70x0-armada-80x0-porting">11.2.2. Armada-70x0/Armada-80x0 Porting</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-a8k-addr-map.html">11.3. Address decoding flow and address translation units of Marvell Armada 8K SoC family</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-amb.html">11.4. AMB - AXI MBUS address decoding</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-amb.html#mandatory-functions">11.4.1. Mandatory functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-amb.html#mandatory-structures">11.4.2. Mandatory structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-amb.html#examples">11.4.3. Examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-ccu.html">11.5. Marvell CCU address decoding bindings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-ccu.html#mandatory-functions">11.5.1. Mandatory functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-ccu.html#mandatory-structures">11.5.2. Mandatory structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-ccu.html#example">11.5.3. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-io-win.html">11.6. Marvell IO WIN address decoding bindings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-io-win.html#mandatory-functions">11.6.1. Mandatory functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-io-win.html#mandatory-structures">11.6.2. Mandatory structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-io-win.html#example">11.6.3. Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-iob.html">11.7. Marvell IOB address decoding bindings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-iob.html#mandatory-functions">11.7.1. Mandatory functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-iob.html#mandatory-structures">11.7.2. Mandatory structures</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-iob.html#target-id-options">11.7.3. Target ID options</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/marvell/armada/misc/mvebu-iob.html#example">11.7.4. Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/mt8183.html">12. MediaTek 8183</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/mt8183.html#boot-sequence">12.1. Boot Sequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/mt8183.html#how-to-build">12.2. How to Build</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/mt8192.html">13. MediaTek 8192</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/mt8192.html#boot-sequence">13.1. Boot Sequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/mt8192.html#how-to-build">13.2. How to Build</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/nvidia-tegra.html">14. NVIDIA Tegra</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/nvidia-tegra.html#directory-structure">14.1. Directory structure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/nvidia-tegra.html#trusted-os-dispatcher">14.2. Trusted OS dispatcher</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/nvidia-tegra.html#scatter-files">14.3. Scatter files</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/nvidia-tegra.html#preparing-the-bl31-image-to-run-on-tegra-socs">14.4. Preparing the BL31 image to run on Tegra SoCs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/nvidia-tegra.html#power-management">14.5. Power Management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/nvidia-tegra.html#tegra-configs">14.6. Tegra configs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/warp7.html">15. NXP i.MX7 WaRP7</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/warp7.html#boot-flow">15.1. Boot Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/warp7.html#build-instructions">15.2. Build Instructions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/warp7.html#u-boot">15.2.1. U-Boot</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/warp7.html#op-tee">15.2.2. OP-TEE</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/warp7.html#tf-a">15.2.3. TF-A</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/warp7.html#fip">15.2.4. FIP</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/warp7.html#deploy-images">15.3. Deploy Images</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/warp7.html#signing-bl2">15.4. Signing BL2</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/imx8.html">16. NXP i.MX 8 Series</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/imx8.html#boot-sequence">16.1. Boot Sequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/imx8.html#how-to-build">16.2. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/imx8.html#build-procedure">16.2.1. Build Procedure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/imx8.html#deploy-tf-a-images">16.2.2. Deploy TF-A Images</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/imx8m.html">17. NXP i.MX 8M Series</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/imx8m.html#boot-sequence">17.1. Boot Sequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/imx8m.html#how-to-build">17.2. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/imx8m.html#build-procedure">17.2.1. Build Procedure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/imx8m.html#deploy-tf-a-images">17.2.2. Deploy TF-A Images</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/ls1043a.html">18. NXP QorIQ® LS1043A</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/ls1043a.html#ls1043ardb-specification">18.1. LS1043ARDB Specification:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/ls1043a.html#boot-sequence">18.2. Boot Sequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/ls1043a.html#how-to-build">18.3. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/ls1043a.html#build-procedure">18.3.1. Build Procedure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/ls1043a.html#deploy-tf-a-images">18.3.2. Deploy TF-A Images</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/poplar.html">19. Poplar</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/poplar.html#how-to-build">19.1. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/poplar.html#code-locations">19.1.1. Code Locations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/poplar.html#build-procedure">19.1.2. Build Procedure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/poplar.html#install-procedure">19.2. Install Procedure</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/poplar.html#boot-trace">19.3. Boot trace</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/qemu.html">20. QEMU virt Armv8-A</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/qemu.html#getting-non-tf-images">20.1. Getting non-TF images</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/qemu.html#booting-via-semi-hosting-option">20.2. Booting via semi-hosting option</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/qemu.html#booting-via-flash-based-firmwares">20.3. Booting via flash based firmwares</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/qemu-sbsa.html">21. QEMU SBSA Target</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plat/qti.html">22. Qualcomm Technologies, Inc.</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/qti.html#boot-trace">22.1. Boot Trace</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/qti.html#how-to-build">22.2. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/qti.html#code-locations">22.2.1. Code Locations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/qti.html#build-procedure">22.2.2. Build Procedure</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/rpi3.html">23. Raspberry Pi 3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/rpi3.html#design">23.1. Design</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/rpi3.html#placement-of-images">23.1.1. Placement of images</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/rpi3.html#boot-sequence">23.1.2. Boot sequence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/rpi3.html#secondary-cores">23.1.3. Secondary cores</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/rpi3.html#build-instructions">23.2. Build Instructions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/rpi3.html#building-the-firmware-for-kernels-that-don-t-support-psci">23.2.1. Building the firmware for kernels that don’t support PSCI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/rpi3.html#building-the-firmware-for-kernels-that-support-psci">23.2.2. Building the firmware for kernels that support PSCI</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/rpi3.html#aarch64-kernel-build-instructions">23.3. AArch64 kernel build instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/rpi3.html#setup-sd-card">23.4. Setup SD card</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/rpi4.html">24. Raspberry Pi 4</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/rpi4.html#build-instructions">24.1. Build Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/rpi4.html#tf-a-port-design">24.2. TF-A port design</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/rcar-gen3.html">25. Renesas R-Car</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/rcar-gen3.html#renesas-r-car-gen3-evaluation-boards">25.1. Renesas R-Car Gen3 evaluation boards:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/rcar-gen3.html#overview">25.2. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/rcar-gen3.html#how-to-build">25.3. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/rcar-gen3.html#build-tested">25.3.1. Build Tested:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/rcar-gen3.html#system-tested">25.3.2. System Tested:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/rcar-gen3.html#tf-a-build-procedure">25.3.3. TF-A Build Procedure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/rcar-gen3.html#install-procedure">25.3.4. Install Procedure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/rcar-gen3.html#boot-trace">25.4. Boot trace</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/rz-g2.html">26. Renesas RZ/G</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/rz-g2.html#renesas-rz-g2-reference-platforms">26.1. Renesas RZ/G2 reference platforms:</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/rz-g2.html#overview">26.2. Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/rz-g2.html#how-to-build">26.3. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/rz-g2.html#build-tested">26.3.1. Build Tested:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/rz-g2.html#system-tested">26.3.2. System Tested:</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/rz-g2.html#tf-a-build-procedure">26.3.3. TF-A Build Procedure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/rz-g2.html#install-procedure">26.3.4. Install Procedure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/rz-g2.html#boot-trace">26.4. Boot trace</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/rockchip.html">27. Rockchip SoCs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/rockchip.html#boot-sequence">27.1. Boot Sequence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/rockchip.html#how-to-build">27.2. How to build</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/rockchip.html#how-to-deploy">27.3. How to deploy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/socionext-uniphier.html">28. Socionext UniPhier</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/socionext-uniphier.html#boot-flow">28.1. Boot Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/socionext-uniphier.html#basic-build">28.2. Basic Build</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/socionext-uniphier.html#optional-features">28.3. Optional features</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/synquacer.html">29. Socionext Synquacer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/synquacer.html#how-to-build">29.1. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/synquacer.html#code-locations">29.1.1. Code Locations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/synquacer.html#boot-flow">29.1.2. Boot Flow</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/synquacer.html#build-procedure">29.1.3. Build Procedure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/synquacer.html#install-the-system-firmware">29.1.4. Install the System Firmware</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/stm32mp1.html">30. STMicroelectronics STM32MP1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/stm32mp1.html#stm32mp1-versions">30.1. STM32MP1 Versions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/stm32mp1.html#design">30.2. Design</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/stm32mp1.html#memory-mapping">30.2.1. Memory mapping</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/stm32mp1.html#boot-sequence">30.2.2. Boot sequence</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/stm32mp1.html#build-instructions">30.3. Build Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/stm32mp1.html#populate-sd-card">30.4. Populate SD-card</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/ti-k3.html">31. Texas Instruments K3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/ti-k3.html#boot-flow">31.1. Boot Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/ti-k3.html#build-instructions">31.2. Build Instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/ti-k3.html#deploy-images">31.3. Deploy Images</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/xilinx-versal.html">32. Xilinx Versal</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/xilinx-versal.html#xilinx-versal-platform-specific-build-options">32.1. Xilinx Versal platform specific build options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/xilinx-versal.html#plm-tf-a-parameter-passing">32.2. # PLM-&gt;TF-A Parameter Passing</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/xilinx-zynqmp.html">33. Xilinx Zynq UltraScale+ MPSoC</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/xilinx-zynqmp.html#zynqmp-platform-specific-build-options">33.1. ZynqMP platform specific build options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/xilinx-zynqmp.html#fsbl-tf-a-parameter-passing">33.2. FSBL-&gt;TF-A Parameter Passing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/xilinx-zynqmp.html#power-domain-tree">33.3. Power Domain Tree</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plat/brcm-stingray.html">34. Broadcom Stingray</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plat/brcm-stingray.html#description">34.1. Description</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plat/brcm-stingray.html#boot-sequence">34.2. Boot Sequence</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/brcm-stingray.html#code-locations">34.2.1. Code Locations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../plat/brcm-stingray.html#how-to-build">34.3. How to build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../plat/brcm-stingray.html#build-procedure">34.3.1. Build Procedure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../plat/brcm-stingray.html#deploy-tf-a-images">34.3.2. Deploy TF-A Images</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../perf/index.html">Performance &amp; Testing</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../perf/psci-performance-juno.html">1. PSCI Performance Measurements on Arm Juno Development Platform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../perf/psci-performance-juno.html#method">1.1. Method</a></li>
<li class="toctree-l3"><a class="reference internal" href="../perf/psci-performance-juno.html#results-and-commentary">1.2. Results and Commentary</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../perf/psci-performance-juno.html#cpu-suspend-to-deepest-power-level-on-all-cpus-in-parallel">1.2.1. <code class="docutils literal notranslate"><span class="pre">CPU_SUSPEND</span></code> to deepest power level on all CPUs in parallel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../perf/psci-performance-juno.html#cpu-suspend-to-power-level-0-on-all-cpus-in-parallel">1.2.2. <code class="docutils literal notranslate"><span class="pre">CPU_SUSPEND</span></code> to power level 0 on all CPUs in parallel</a></li>
<li class="toctree-l4"><a class="reference internal" href="../perf/psci-performance-juno.html#cpu-suspend-to-deepest-power-level-on-all-cpus-in-sequence">1.2.3. <code class="docutils literal notranslate"><span class="pre">CPU_SUSPEND</span></code> to deepest power level on all CPUs in sequence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../perf/psci-performance-juno.html#cpu-suspend-to-power-level-0-on-all-cpus-in-sequence">1.2.4. <code class="docutils literal notranslate"><span class="pre">CPU_SUSPEND</span></code> to power level 0 on all CPUs in sequence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../perf/psci-performance-juno.html#cpu-off-on-all-non-lead-cpus-in-sequence-then-cpu-suspend-on-lead-cpu-to-deepest-power-level">1.2.5. <code class="docutils literal notranslate"><span class="pre">CPU_OFF</span></code> on all non-lead CPUs in sequence then <code class="docutils literal notranslate"><span class="pre">CPU_SUSPEND</span></code> on lead CPU to deepest power level</a></li>
<li class="toctree-l4"><a class="reference internal" href="../perf/psci-performance-juno.html#psci-version-on-all-cpus-in-parallel">1.2.6. <code class="docutils literal notranslate"><span class="pre">PSCI_VERSION</span></code> on all CPUs in parallel</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../perf/tsp.html">2. Test Secure Payload (TSP) and Dispatcher (TSPD)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../perf/tsp.html#building-the-test-secure-payload">2.1. Building the Test Secure Payload</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../perf/performance-monitoring-unit.html">3. Performance Monitoring Unit</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../perf/performance-monitoring-unit.html#pmu-counters">3.1. PMU Counters</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../perf/performance-monitoring-unit.html#architectural-mappings">3.1.1. Architectural mappings</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../perf/performance-monitoring-unit.html#configuring-the-pmu-for-counting-events">3.2. Configuring the PMU for counting events</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../perf/performance-monitoring-unit.html#id1">3.2.1. Architectural mappings</a></li>
<li class="toctree-l4"><a class="reference internal" href="../perf/performance-monitoring-unit.html#relevant-register-fields">3.2.2. Relevant register fields</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../security_advisories/index.html">Security Advisories</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../security_advisories/security-advisory-tfv-1.html">1. Advisory TFV-1 (CVE-2016-10319)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security_advisories/security-advisory-tfv-2.html">2. Advisory TFV-2 (CVE-2017-7564)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security_advisories/security-advisory-tfv-3.html">3. Advisory TFV-3 (CVE-2017-7563)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security_advisories/security-advisory-tfv-4.html">4. Advisory TFV-4 (CVE-2017-9607)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security_advisories/security-advisory-tfv-5.html">5. Advisory TFV-5 (CVE-2017-15031)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security_advisories/security-advisory-tfv-6.html">6. Advisory TFV-6 (CVE-2017-5753, CVE-2017-5715, CVE-2017-5754)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../security_advisories/security-advisory-tfv-6.html#variant-1-cve-2017-5753">6.1. Variant 1 (CVE-2017-5753)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../security_advisories/security-advisory-tfv-6.html#variant-2-cve-2017-5715">6.2. Variant 2 (CVE-2017-5715)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../security_advisories/security-advisory-tfv-6.html#variant-3-cve-2017-5754">6.3. Variant 3 (CVE-2017-5754)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../security_advisories/security-advisory-tfv-7.html">7. Advisory TFV-7 (CVE-2018-3639)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../security_advisories/security-advisory-tfv-7.html#static-mitigation">7.1. Static mitigation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../security_advisories/security-advisory-tfv-7.html#dynamic-mitigation">7.2. Dynamic mitigation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../security_advisories/security-advisory-tfv-8.html">8. Advisory TFV-8 (CVE-2018-19440)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../design_documents/index.html">Design Documents</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../design_documents/cmake_framework.html">1. TF-A CMake Build System Proposal</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../design_documents/cmake_framework.html#abstract">1.1. Abstract</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design_documents/cmake_framework.html#introduction">1.2. Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design_documents/cmake_framework.html#main-features">1.3. Main features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../design_documents/cmake_framework.html#structured-configuration-description">1.3.1. Structured configuration description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design_documents/cmake_framework.html#target-description">1.3.2. Target description</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design_documents/cmake_framework.html#compiler-abstraction">1.3.3. Compiler abstraction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../design_documents/cmake_framework.html#external-tools">1.3.4. External tools</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../design_documents/cmake_framework.html#workflow">1.4. Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../design_documents/cmake_framework.html#example">1.5. Example</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../change-log.html">Change Log &amp; Release Notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-2-4">Version 2.4</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#new-features">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#changed">Changed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#resolved-issues">Resolved Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#known-issues">Known Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-2-3">Version 2.3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id1">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id2">Changed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id3">Resolved Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id4">Known Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-2-2">Version 2.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id5">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id6">Changed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id7">Resolved Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#deprecations">Deprecations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id8">Known Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-2-1">Version 2.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id9">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id10">Changed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id11">Resolved Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id12">Deprecations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id13">Known Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-2-0">Version 2.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id14">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#issues-resolved-since-last-release">Issues resolved since last release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id15">Known Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-1-6">Version 1.6</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id16">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id17">Issues resolved since last release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id18">Known Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-1-5">Version 1.5</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id19">New features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id20">Issues resolved since last release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id21">Known Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-1-4">Version 1.4</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id22">New features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id23">Issues resolved since last release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id24">Known Issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-1-3">Version 1.3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id25">New features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id26">Issues resolved since last release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id27">Known issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-1-2">Version 1.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id28">New features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id29">Issues resolved since last release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id30">Known issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-1-1">Version 1.1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id31">New features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id32">Issues resolved since last release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id33">Known issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-1-0">Version 1.0</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id34">New features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id35">Issues resolved since last release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id36">Known issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-0-4">Version 0.4</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id37">New features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id38">Issues resolved since last release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id39">Known issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-0-3">Version 0.3</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id40">New features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id41">Issues resolved since last release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id42">Known issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../change-log.html#version-0-2">Version 0.2</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id43">New features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id44">Issues resolved since last release</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log.html#id45">Known issues</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../change-log-upcoming.html">Change Log for Upcoming Release</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../change-log-upcoming.html#upcoming-release-version-2-4">Upcoming Release Version 2.4</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../change-log-upcoming.html#new-features">New Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log-upcoming.html#changed">Changed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log-upcoming.html#resolved-issues">Resolved Issues</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log-upcoming.html#deprecations">Deprecations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../change-log-upcoming.html#known-issues">Known Issues</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../license.html#spdx-identifiers">SPDX Identifiers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../license.html#other-projects">Other Projects</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../cmake/index.html">Build System Manual</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../cmake/index.html#contents">Contents</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../cmake/concepts.html">Build System Concepts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cmake/concepts.html#introduction">Introduction</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cmake/concepts.html#high-level-requirements">High-level requirements</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cmake/concepts.html#configuration-space">Configuration space</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cmake/concepts.html#structured-programming-concepts-with-cmake">Structured Programming Concepts With CMake</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cmake/concepts.html#structuring-the-project">Structuring the project.</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cmake/concepts.html#entry-points">Entry points</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cmake/concepts.html#todo-items">TODO items</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../cmake/user_guide.html">Build System Users Guide</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../cmake/user_guide.html#what-is-needed-to-build-with-cmake">What is needed to build with CMake?</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cmake/user_guide.html#how-to-build-with-cmake">How-to build with CMake</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cmake/user_guide.html#current-limitations">Current limitations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cmake/user_guide.html#list-of-modules">List of modules</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Trusted Firmware-A</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">System Design</a> &raquo;</li>
        
      <li><span class="section-number">4. </span>Firmware Design</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/design/firmware-design.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="interrupt-framework-design.html" class="btn btn-neutral float-right" title="5. Interrupt Management Framework" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
      
      
        <a href="cpu-specific-build-macros.html" class="btn btn-neutral float-left" title="3. Arm CPU Specific Build Macros" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="firmware-design">
<h1><span class="section-number">4. </span>Firmware Design<a class="headerlink" href="#firmware-design" title="Permalink to this headline">¶</a></h1>
<p>Trusted Firmware-A (TF-A) implements a subset of the Trusted Board Boot
Requirements (TBBR) Platform Design Document (PDD) for Arm reference
platforms.</p>
<p>The TBB sequence starts when the platform is powered on and runs up
to the stage where it hands-off control to firmware running in the normal
world in DRAM. This is the cold boot path.</p>
<p>TF-A also implements the <a class="reference external" href="http://infocenter.arm.com/help/topic/com.arm.doc.den0022d/Power_State_Coordination_Interface_PDD_v1_1_DEN0022D.pdf">Power State Coordination Interface PDD</a> as a
runtime service. PSCI is the interface from normal world software to firmware
implementing power management use-cases (for example, secondary CPU boot,
hotplug and idle). Normal world software can access TF-A runtime services via
the Arm SMC (Secure Monitor Call) instruction. The SMC instruction must be
used as mandated by the SMC Calling Convention (<a class="reference external" href="https://developer.arm.com/docs/den0028/latest">SMCCC</a>).</p>
<p>TF-A implements a framework for configuring and managing interrupts generated
in either security state. The details of the interrupt management framework
and its design can be found in <a class="reference internal" href="interrupt-framework-design.html#interrupt-management-framework"><span class="std std-ref">Interrupt Management Framework</span></a>.</p>
<p>TF-A also implements a library for setting up and managing the translation
tables. The details of this library can be found in
<a class="reference internal" href="../components/xlat-tables-lib-v2-design.html#translation-xlat-tables-library"><span class="std std-ref">Translation (XLAT) Tables Library</span></a>.</p>
<p>TF-A can be built to support either AArch64 or AArch32 execution state.</p>
<div class="section" id="cold-boot">
<h2><span class="section-number">4.1. </span>Cold boot<a class="headerlink" href="#cold-boot" title="Permalink to this headline">¶</a></h2>
<p>The cold boot path starts when the platform is physically turned on. If
<code class="docutils literal notranslate"><span class="pre">COLD_BOOT_SINGLE_CPU=0</span></code>, one of the CPUs released from reset is chosen as the
primary CPU, and the remaining CPUs are considered secondary CPUs. The primary
CPU is chosen through platform-specific means. The cold boot path is mainly
executed by the primary CPU, other than essential CPU initialization executed by
all CPUs. The secondary CPUs are kept in a safe platform-specific state until
the primary CPU has performed enough initialization to boot them.</p>
<p>Refer to the <a class="reference internal" href="reset-design.html#cpu-reset"><span class="std std-ref">CPU Reset</span></a> for more information on the effect of the
<code class="docutils literal notranslate"><span class="pre">COLD_BOOT_SINGLE_CPU</span></code> platform build option.</p>
<p>The cold boot path in this implementation of TF-A depends on the execution
state. For AArch64, it is divided into five steps (in order of execution):</p>
<ul class="simple">
<li><p>Boot Loader stage 1 (BL1) <em>AP Trusted ROM</em></p></li>
<li><p>Boot Loader stage 2 (BL2) <em>Trusted Boot Firmware</em></p></li>
<li><p>Boot Loader stage 3-1 (BL31) <em>EL3 Runtime Software</em></p></li>
<li><p>Boot Loader stage 3-2 (BL32) <em>Secure-EL1 Payload</em> (optional)</p></li>
<li><p>Boot Loader stage 3-3 (BL33) <em>Non-trusted Firmware</em></p></li>
</ul>
<p>For AArch32, it is divided into four steps (in order of execution):</p>
<ul class="simple">
<li><p>Boot Loader stage 1 (BL1) <em>AP Trusted ROM</em></p></li>
<li><p>Boot Loader stage 2 (BL2) <em>Trusted Boot Firmware</em></p></li>
<li><p>Boot Loader stage 3-2 (BL32) <em>EL3 Runtime Software</em></p></li>
<li><p>Boot Loader stage 3-3 (BL33) <em>Non-trusted Firmware</em></p></li>
</ul>
<p>Arm development platforms (Fixed Virtual Platforms (FVPs) and Juno) implement a
combination of the following types of memory regions. Each bootloader stage uses
one or more of these memory regions.</p>
<ul class="simple">
<li><p>Regions accessible from both non-secure and secure states. For example,
non-trusted SRAM, ROM and DRAM.</p></li>
<li><p>Regions accessible from only the secure state. For example, trusted SRAM and
ROM. The FVPs also implement the trusted DRAM which is statically
configured. Additionally, the Base FVPs and Juno development platform
configure the TrustZone Controller (TZC) to create a region in the DRAM
which is accessible only from the secure state.</p></li>
</ul>
<p>The sections below provide the following details:</p>
<ul class="simple">
<li><p>dynamic configuration of Boot Loader stages</p></li>
<li><p>initialization and execution of the first three stages during cold boot</p></li>
<li><p>specification of the EL3 Runtime Software (BL31 for AArch64 and BL32 for
AArch32) entrypoint requirements for use by alternative Trusted Boot
Firmware in place of the provided BL1 and BL2</p></li>
</ul>
<div class="section" id="dynamic-configuration-during-cold-boot">
<h3><span class="section-number">4.1.1. </span>Dynamic Configuration during cold boot<a class="headerlink" href="#dynamic-configuration-during-cold-boot" title="Permalink to this headline">¶</a></h3>
<p>Each of the Boot Loader stages may be dynamically configured if required by the
platform. The Boot Loader stage may optionally specify a firmware
configuration file and/or hardware configuration file as listed below:</p>
<ul class="simple">
<li><p>FW_CONFIG - The firmware configuration file. Holds properties shared across
all BLx images.
An example is the “dtb-registry” node, which contains the information about
the other device tree configurations (load-address, size, image_id).</p></li>
<li><p>HW_CONFIG - The hardware configuration file. Can be shared by all Boot Loader
stages and also by the Normal World Rich OS.</p></li>
<li><p>TB_FW_CONFIG - Trusted Boot Firmware configuration file. Shared between BL1
and BL2.</p></li>
<li><p>SOC_FW_CONFIG - SoC Firmware configuration file. Used by BL31.</p></li>
<li><p>TOS_FW_CONFIG - Trusted OS Firmware configuration file. Used by Trusted OS
(BL32).</p></li>
<li><p>NT_FW_CONFIG - Non Trusted Firmware configuration file. Used by Non-trusted
firmware (BL33).</p></li>
</ul>
<p>The Arm development platforms use the Flattened Device Tree format for the
dynamic configuration files.</p>
<p>Each Boot Loader stage can pass up to 4 arguments via registers to the next
stage.  BL2 passes the list of the next images to execute to the <em>EL3 Runtime
Software</em> (BL31 for AArch64 and BL32 for AArch32) via <cite>arg0</cite>. All the other
arguments are platform defined. The Arm development platforms use the following
convention:</p>
<ul class="simple">
<li><p>BL1 passes the address of a meminfo_t structure to BL2 via <code class="docutils literal notranslate"><span class="pre">arg1</span></code>. This
structure contains the memory layout available to BL2.</p></li>
<li><p>When dynamic configuration files are present, the firmware configuration for
the next Boot Loader stage is populated in the first available argument and
the generic hardware configuration is passed the next available argument.
For example,</p>
<ul>
<li><p>FW_CONFIG is loaded by BL1, then its address is passed in <code class="docutils literal notranslate"><span class="pre">arg0</span></code> to BL2.</p></li>
<li><p>TB_FW_CONFIG address is retrieved by BL2 from FW_CONFIG device tree.</p></li>
<li><p>If HW_CONFIG is loaded by BL1, then its address is passed in <code class="docutils literal notranslate"><span class="pre">arg2</span></code> to
BL2. Note, <code class="docutils literal notranslate"><span class="pre">arg1</span></code> is already used for meminfo_t.</p></li>
<li><p>If SOC_FW_CONFIG is loaded by BL2, then its address is passed in <code class="docutils literal notranslate"><span class="pre">arg1</span></code>
to BL31. Note, <code class="docutils literal notranslate"><span class="pre">arg0</span></code> is used to pass the list of executable images.</p></li>
<li><p>Similarly, if HW_CONFIG is loaded by BL1 or BL2, then its address is
passed in <code class="docutils literal notranslate"><span class="pre">arg2</span></code> to BL31.</p></li>
<li><p>For other BL3x images, if the firmware configuration file is loaded by
BL2, then its address is passed in <code class="docutils literal notranslate"><span class="pre">arg0</span></code> and if HW_CONFIG is loaded
then its address is passed in <code class="docutils literal notranslate"><span class="pre">arg1</span></code>.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="bl1">
<h3><span class="section-number">4.1.2. </span>BL1<a class="headerlink" href="#bl1" title="Permalink to this headline">¶</a></h3>
<p>This stage begins execution from the platform’s reset vector at EL3. The reset
address is platform dependent but it is usually located in a Trusted ROM area.
The BL1 data section is copied to trusted SRAM at runtime.</p>
<p>On the Arm development platforms, BL1 code starts execution from the reset
vector defined by the constant <code class="docutils literal notranslate"><span class="pre">BL1_RO_BASE</span></code>. The BL1 data section is copied
to the top of trusted SRAM as defined by the constant <code class="docutils literal notranslate"><span class="pre">BL1_RW_BASE</span></code>.</p>
<p>The functionality implemented by this stage is as follows.</p>
<div class="section" id="determination-of-boot-path">
<h4><span class="section-number">4.1.2.1. </span>Determination of boot path<a class="headerlink" href="#determination-of-boot-path" title="Permalink to this headline">¶</a></h4>
<p>Whenever a CPU is released from reset, BL1 needs to distinguish between a warm
boot and a cold boot. This is done using platform-specific mechanisms (see the
<code class="docutils literal notranslate"><span class="pre">plat_get_my_entrypoint()</span></code> function in the <a class="reference internal" href="../getting_started/porting-guide.html#porting-guide"><span class="std std-ref">Porting Guide</span></a>). In the case
of a warm boot, a CPU is expected to continue execution from a separate
entrypoint. In the case of a cold boot, the secondary CPUs are placed in a safe
platform-specific state (see the <code class="docutils literal notranslate"><span class="pre">plat_secondary_cold_boot_setup()</span></code> function in
the <a class="reference internal" href="../getting_started/porting-guide.html#porting-guide"><span class="std std-ref">Porting Guide</span></a>) while the primary CPU executes the remaining cold boot
path as described in the following sections.</p>
<p>This step only applies when <code class="docutils literal notranslate"><span class="pre">PROGRAMMABLE_RESET_ADDRESS=0</span></code>. Refer to the
<a class="reference internal" href="reset-design.html#cpu-reset"><span class="std std-ref">CPU Reset</span></a> for more information on the effect of the
<code class="docutils literal notranslate"><span class="pre">PROGRAMMABLE_RESET_ADDRESS</span></code> platform build option.</p>
</div>
<div class="section" id="architectural-initialization">
<h4><span class="section-number">4.1.2.2. </span>Architectural initialization<a class="headerlink" href="#architectural-initialization" title="Permalink to this headline">¶</a></h4>
<p>BL1 performs minimal architectural initialization as follows.</p>
<ul>
<li><p>Exception vectors</p>
<p>BL1 sets up simple exception vectors for both synchronous and asynchronous
exceptions. The default behavior upon receiving an exception is to populate
a status code in the general purpose register <code class="docutils literal notranslate"><span class="pre">X0/R0</span></code> and call the
<code class="docutils literal notranslate"><span class="pre">plat_report_exception()</span></code> function (see the <a class="reference internal" href="../getting_started/porting-guide.html#porting-guide"><span class="std std-ref">Porting Guide</span></a>). The
status code is one of:</p>
<p>For AArch64:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mh">0x0</span> <span class="p">:</span> <span class="n">Synchronous</span> <span class="n">exception</span> <span class="kn">from</span> <span class="nn">Current</span> <span class="n">EL</span> <span class="k">with</span> <span class="n">SP_EL0</span>
<span class="mh">0x1</span> <span class="p">:</span> <span class="n">IRQ</span> <span class="n">exception</span> <span class="kn">from</span> <span class="nn">Current</span> <span class="n">EL</span> <span class="k">with</span> <span class="n">SP_EL0</span>
<span class="mh">0x2</span> <span class="p">:</span> <span class="n">FIQ</span> <span class="n">exception</span> <span class="kn">from</span> <span class="nn">Current</span> <span class="n">EL</span> <span class="k">with</span> <span class="n">SP_EL0</span>
<span class="mh">0x3</span> <span class="p">:</span> <span class="n">System</span> <span class="n">Error</span> <span class="n">exception</span> <span class="kn">from</span> <span class="nn">Current</span> <span class="n">EL</span> <span class="k">with</span> <span class="n">SP_EL0</span>
<span class="mh">0x4</span> <span class="p">:</span> <span class="n">Synchronous</span> <span class="n">exception</span> <span class="kn">from</span> <span class="nn">Current</span> <span class="n">EL</span> <span class="k">with</span> <span class="n">SP_ELx</span>
<span class="mh">0x5</span> <span class="p">:</span> <span class="n">IRQ</span> <span class="n">exception</span> <span class="kn">from</span> <span class="nn">Current</span> <span class="n">EL</span> <span class="k">with</span> <span class="n">SP_ELx</span>
<span class="mh">0x6</span> <span class="p">:</span> <span class="n">FIQ</span> <span class="n">exception</span> <span class="kn">from</span> <span class="nn">Current</span> <span class="n">EL</span> <span class="k">with</span> <span class="n">SP_ELx</span>
<span class="mh">0x7</span> <span class="p">:</span> <span class="n">System</span> <span class="n">Error</span> <span class="n">exception</span> <span class="kn">from</span> <span class="nn">Current</span> <span class="n">EL</span> <span class="k">with</span> <span class="n">SP_ELx</span>
<span class="mh">0x8</span> <span class="p">:</span> <span class="n">Synchronous</span> <span class="n">exception</span> <span class="kn">from</span> <span class="nn">Lower</span> <span class="n">EL</span> <span class="n">using</span> <span class="n">aarch64</span>
<span class="mh">0x9</span> <span class="p">:</span> <span class="n">IRQ</span> <span class="n">exception</span> <span class="kn">from</span> <span class="nn">Lower</span> <span class="n">EL</span> <span class="n">using</span> <span class="n">aarch64</span>
<span class="mh">0xa</span> <span class="p">:</span> <span class="n">FIQ</span> <span class="n">exception</span> <span class="kn">from</span> <span class="nn">Lower</span> <span class="n">EL</span> <span class="n">using</span> <span class="n">aarch64</span>
<span class="mh">0xb</span> <span class="p">:</span> <span class="n">System</span> <span class="n">Error</span> <span class="n">exception</span> <span class="kn">from</span> <span class="nn">Lower</span> <span class="n">EL</span> <span class="n">using</span> <span class="n">aarch64</span>
<span class="mh">0xc</span> <span class="p">:</span> <span class="n">Synchronous</span> <span class="n">exception</span> <span class="kn">from</span> <span class="nn">Lower</span> <span class="n">EL</span> <span class="n">using</span> <span class="n">aarch32</span>
<span class="mh">0xd</span> <span class="p">:</span> <span class="n">IRQ</span> <span class="n">exception</span> <span class="kn">from</span> <span class="nn">Lower</span> <span class="n">EL</span> <span class="n">using</span> <span class="n">aarch32</span>
<span class="mh">0xe</span> <span class="p">:</span> <span class="n">FIQ</span> <span class="n">exception</span> <span class="kn">from</span> <span class="nn">Lower</span> <span class="n">EL</span> <span class="n">using</span> <span class="n">aarch32</span>
<span class="mh">0xf</span> <span class="p">:</span> <span class="n">System</span> <span class="n">Error</span> <span class="n">exception</span> <span class="kn">from</span> <span class="nn">Lower</span> <span class="n">EL</span> <span class="n">using</span> <span class="n">aarch32</span>
</pre></div>
</div>
<p>For AArch32:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mh">0x10</span> <span class="p">:</span> <span class="n">User</span> <span class="n">mode</span>
<span class="mh">0x11</span> <span class="p">:</span> <span class="n">FIQ</span> <span class="n">mode</span>
<span class="mh">0x12</span> <span class="p">:</span> <span class="n">IRQ</span> <span class="n">mode</span>
<span class="mh">0x13</span> <span class="p">:</span> <span class="n">SVC</span> <span class="n">mode</span>
<span class="mh">0x16</span> <span class="p">:</span> <span class="n">Monitor</span> <span class="n">mode</span>
<span class="mh">0x17</span> <span class="p">:</span> <span class="n">Abort</span> <span class="n">mode</span>
<span class="mh">0x1a</span> <span class="p">:</span> <span class="n">Hypervisor</span> <span class="n">mode</span>
<span class="mh">0x1b</span> <span class="p">:</span> <span class="n">Undefined</span> <span class="n">mode</span>
<span class="mh">0x1f</span> <span class="p">:</span> <span class="n">System</span> <span class="n">mode</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">plat_report_exception()</span></code> implementation on the Arm FVP port programs
the Versatile Express System LED register in the following format to
indicate the occurrence of an unexpected exception:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">SYS_LED</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>   <span class="o">-</span> <span class="n">Security</span> <span class="n">state</span> <span class="p">(</span><span class="n">Secure</span><span class="o">=</span><span class="mi">0</span><span class="o">/</span><span class="n">Non</span><span class="o">-</span><span class="n">Secure</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">SYS_LED</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="ne">Exception</span> <span class="n">Level</span> <span class="p">(</span><span class="n">EL3</span><span class="o">=</span><span class="mh">0x3</span><span class="p">,</span> <span class="n">EL2</span><span class="o">=</span><span class="mh">0x2</span><span class="p">,</span> <span class="n">EL1</span><span class="o">=</span><span class="mh">0x1</span><span class="p">,</span> <span class="n">EL0</span><span class="o">=</span><span class="mh">0x0</span><span class="p">)</span>
               <span class="n">For</span> <span class="n">AArch32</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">always</span> <span class="mh">0x0</span>
<span class="n">SYS_LED</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="ne">Exception</span> <span class="n">Class</span> <span class="p">(</span><span class="n">Sync</span><span class="o">/</span><span class="n">Async</span> <span class="o">&amp;</span> <span class="n">origin</span><span class="p">)</span><span class="o">.</span> <span class="n">This</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">value</span>
               <span class="n">of</span> <span class="n">the</span> <span class="n">status</span> <span class="n">code</span>
</pre></div>
</div>
<p>A write to the LED register reflects in the System LEDs (S6LED0..7) in the
CLCD window of the FVP.</p>
<p>BL1 does not expect to receive any exceptions other than the SMC exception.
For the latter, BL1 installs a simple stub. The stub expects to receive a
limited set of SMC types (determined by their function IDs in the general
purpose register <code class="docutils literal notranslate"><span class="pre">X0/R0</span></code>):</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">BL1_SMC_RUN_IMAGE</span></code>: This SMC is raised by BL2 to make BL1 pass control
to EL3 Runtime Software.</p></li>
<li><p>All SMCs listed in section “BL1 SMC Interface” in the <a class="reference internal" href="../components/firmware-update.html#firmware-update-fwu"><span class="std std-ref">Firmware Update (FWU)</span></a>
Design Guide are supported for AArch64 only. These SMCs are currently
not supported when BL1 is built for AArch32.</p></li>
</ul>
<p>Any other SMC leads to an assertion failure.</p>
</li>
<li><p>CPU initialization</p>
<p>BL1 calls the <code class="docutils literal notranslate"><span class="pre">reset_handler()</span></code> function which in turn calls the CPU
specific reset handler function (see the section: “CPU specific operations
framework”).</p>
</li>
<li><p>Control register setup (for AArch64)</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SCTLR_EL3</span></code>. Instruction cache is enabled by setting the <code class="docutils literal notranslate"><span class="pre">SCTLR_EL3.I</span></code>
bit. Alignment and stack alignment checking is enabled by setting the
<code class="docutils literal notranslate"><span class="pre">SCTLR_EL3.A</span></code> and <code class="docutils literal notranslate"><span class="pre">SCTLR_EL3.SA</span></code> bits. Exception endianness is set to
little-endian by clearing the <code class="docutils literal notranslate"><span class="pre">SCTLR_EL3.EE</span></code> bit.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SCR_EL3</span></code>. The register width of the next lower exception level is set
to AArch64 by setting the <code class="docutils literal notranslate"><span class="pre">SCR.RW</span></code> bit. The <code class="docutils literal notranslate"><span class="pre">SCR.EA</span></code> bit is set to trap
both External Aborts and SError Interrupts in EL3. The <code class="docutils literal notranslate"><span class="pre">SCR.SIF</span></code> bit is
also set to disable instruction fetches from Non-secure memory when in
secure state.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CPTR_EL3</span></code>. Accesses to the <code class="docutils literal notranslate"><span class="pre">CPACR_EL1</span></code> register from EL1 or EL2, or the
<code class="docutils literal notranslate"><span class="pre">CPTR_EL2</span></code> register from EL2 are configured to not trap to EL3 by
clearing the <code class="docutils literal notranslate"><span class="pre">CPTR_EL3.TCPAC</span></code> bit. Access to the trace functionality is
configured not to trap to EL3 by clearing the <code class="docutils literal notranslate"><span class="pre">CPTR_EL3.TTA</span></code> bit.
Instructions that access the registers associated with Floating Point
and Advanced SIMD execution are configured to not trap to EL3 by
clearing the <code class="docutils literal notranslate"><span class="pre">CPTR_EL3.TFP</span></code> bit.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DAIF</span></code>. The SError interrupt is enabled by clearing the SError interrupt
mask bit.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MDCR_EL3</span></code>. The trap controls, <code class="docutils literal notranslate"><span class="pre">MDCR_EL3.TDOSA</span></code>, <code class="docutils literal notranslate"><span class="pre">MDCR_EL3.TDA</span></code> and
<code class="docutils literal notranslate"><span class="pre">MDCR_EL3.TPM</span></code>, are set so that accesses to the registers they control
do not trap to EL3. AArch64 Secure self-hosted debug is disabled by
setting the <code class="docutils literal notranslate"><span class="pre">MDCR_EL3.SDD</span></code> bit. Also <code class="docutils literal notranslate"><span class="pre">MDCR_EL3.SPD32</span></code> is set to
disable AArch32 Secure self-hosted privileged debug from S-EL1.</p></li>
</ul>
</li>
<li><p>Control register setup (for AArch32)</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">SCTLR</span></code>. Instruction cache is enabled by setting the <code class="docutils literal notranslate"><span class="pre">SCTLR.I</span></code> bit.
Alignment checking is enabled by setting the <code class="docutils literal notranslate"><span class="pre">SCTLR.A</span></code> bit.
Exception endianness is set to little-endian by clearing the
<code class="docutils literal notranslate"><span class="pre">SCTLR.EE</span></code> bit.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SCR</span></code>. The <code class="docutils literal notranslate"><span class="pre">SCR.SIF</span></code> bit is set to disable instruction fetches from
Non-secure memory when in secure state.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CPACR</span></code>. Allow execution of Advanced SIMD instructions at PL0 and PL1,
by clearing the <code class="docutils literal notranslate"><span class="pre">CPACR.ASEDIS</span></code> bit. Access to the trace functionality
is configured not to trap to undefined mode by clearing the
<code class="docutils literal notranslate"><span class="pre">CPACR.TRCDIS</span></code> bit.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NSACR</span></code>. Enable non-secure access to Advanced SIMD functionality and
system register access to implemented trace registers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FPEXC</span></code>. Enable access to the Advanced SIMD and floating-point
functionality from all Exception levels.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">CPSR.A</span></code>. The Asynchronous data abort interrupt is enabled by clearing
the Asynchronous data abort interrupt mask bit.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SDCR</span></code>. The <code class="docutils literal notranslate"><span class="pre">SDCR.SPD</span></code> field is set to disable AArch32 Secure
self-hosted privileged debug.</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="platform-initialization">
<h4><span class="section-number">4.1.2.3. </span>Platform initialization<a class="headerlink" href="#platform-initialization" title="Permalink to this headline">¶</a></h4>
<p>On Arm platforms, BL1 performs the following platform initializations:</p>
<ul class="simple">
<li><p>Enable the Trusted Watchdog.</p></li>
<li><p>Initialize the console.</p></li>
<li><p>Configure the Interconnect to enable hardware coherency.</p></li>
<li><p>Enable the MMU and map the memory it needs to access.</p></li>
<li><p>Configure any required platform storage to load the next bootloader image
(BL2).</p></li>
<li><p>If the BL1 dynamic configuration file, <code class="docutils literal notranslate"><span class="pre">TB_FW_CONFIG</span></code>, is available, then
load it to the platform defined address and make it available to BL2 via
<code class="docutils literal notranslate"><span class="pre">arg0</span></code>.</p></li>
<li><p>Configure the system timer and program the <cite>CNTFRQ_EL0</cite> for use by NS-BL1U
and NS-BL2U firmware update images.</p></li>
</ul>
</div>
<div class="section" id="firmware-update-detection-and-execution">
<h4><span class="section-number">4.1.2.4. </span>Firmware Update detection and execution<a class="headerlink" href="#firmware-update-detection-and-execution" title="Permalink to this headline">¶</a></h4>
<p>After performing platform setup, BL1 common code calls
<code class="docutils literal notranslate"><span class="pre">bl1_plat_get_next_image_id()</span></code> to determine if <a class="reference internal" href="../components/firmware-update.html#firmware-update-fwu"><span class="std std-ref">Firmware Update (FWU)</span></a> is
required or to proceed with the normal boot process. If the platform code
returns <code class="docutils literal notranslate"><span class="pre">BL2_IMAGE_ID</span></code> then the normal boot sequence is executed as described
in the next section, else BL1 assumes that <a class="reference internal" href="../components/firmware-update.html#firmware-update-fwu"><span class="std std-ref">Firmware Update (FWU)</span></a> is
required and execution passes to the first image in the
<a class="reference internal" href="../components/firmware-update.html#firmware-update-fwu"><span class="std std-ref">Firmware Update (FWU)</span></a> process. In either case, BL1 retrieves a descriptor
of the next image by calling <code class="docutils literal notranslate"><span class="pre">bl1_plat_get_image_desc()</span></code>. The image descriptor
contains an <code class="docutils literal notranslate"><span class="pre">entry_point_info_t</span></code> structure, which BL1 uses to initialize the
execution state of the next image.</p>
</div>
<div class="section" id="bl2-image-load-and-execution">
<h4><span class="section-number">4.1.2.5. </span>BL2 image load and execution<a class="headerlink" href="#bl2-image-load-and-execution" title="Permalink to this headline">¶</a></h4>
<p>In the normal boot flow, BL1 execution continues as follows:</p>
<ol class="arabic">
<li><p>BL1 prints the following string from the primary CPU to indicate successful
execution of the BL1 stage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Booting Trusted Firmware&quot;</span>
</pre></div>
</div>
</li>
<li><p>BL1 loads a BL2 raw binary image from platform storage, at a
platform-specific base address. Prior to the load, BL1 invokes
<code class="docutils literal notranslate"><span class="pre">bl1_plat_handle_pre_image_load()</span></code> which allows the platform to update or
use the image information. If the BL2 image file is not present or if
there is not enough free trusted SRAM the following error message is
printed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;Failed to load BL2 firmware.&quot;</span>
</pre></div>
</div>
</li>
<li><p>BL1 invokes <code class="docutils literal notranslate"><span class="pre">bl1_plat_handle_post_image_load()</span></code> which again is intended
for platforms to take further action after image load. This function must
populate the necessary arguments for BL2, which may also include the memory
layout. Further description of the memory layout can be found later
in this document.</p></li>
<li><p>BL1 passes control to the BL2 image at Secure EL1 (for AArch64) or at
Secure SVC mode (for AArch32), starting from its load address.</p></li>
</ol>
</div>
</div>
<div class="section" id="bl2">
<h3><span class="section-number">4.1.3. </span>BL2<a class="headerlink" href="#bl2" title="Permalink to this headline">¶</a></h3>
<p>BL1 loads and passes control to BL2 at Secure-EL1 (for AArch64) or at Secure
SVC mode (for AArch32) . BL2 is linked against and loaded at a platform-specific
base address (more information can be found later in this document).
The functionality implemented by BL2 is as follows.</p>
<div class="section" id="id1">
<h4><span class="section-number">4.1.3.1. </span>Architectural initialization<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>For AArch64, BL2 performs the minimal architectural initialization required
for subsequent stages of TF-A and normal world software. EL1 and EL0 are given
access to Floating Point and Advanced SIMD registers by setting the
<code class="docutils literal notranslate"><span class="pre">CPACR.FPEN</span></code> bits.</p>
<p>For AArch32, the minimal architectural initialization required for subsequent
stages of TF-A and normal world software is taken care of in BL1 as both BL1
and BL2 execute at PL1.</p>
</div>
<div class="section" id="id2">
<h4><span class="section-number">4.1.3.2. </span>Platform initialization<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>On Arm platforms, BL2 performs the following platform initializations:</p>
<ul class="simple">
<li><p>Initialize the console.</p></li>
<li><p>Configure any required platform storage to allow loading further bootloader
images.</p></li>
<li><p>Enable the MMU and map the memory it needs to access.</p></li>
<li><p>Perform platform security setup to allow access to controlled components.</p></li>
<li><p>Reserve some memory for passing information to the next bootloader image
EL3 Runtime Software and populate it.</p></li>
<li><p>Define the extents of memory available for loading each subsequent
bootloader image.</p></li>
<li><p>If BL1 has passed TB_FW_CONFIG dynamic configuration file in <code class="docutils literal notranslate"><span class="pre">arg0</span></code>,
then parse it.</p></li>
</ul>
</div>
<div class="section" id="image-loading-in-bl2">
<h4><span class="section-number">4.1.3.3. </span>Image loading in BL2<a class="headerlink" href="#image-loading-in-bl2" title="Permalink to this headline">¶</a></h4>
<p>BL2 generic code loads the images based on the list of loadable images
provided by the platform. BL2 passes the list of executable images
provided by the platform to the next handover BL image.</p>
<p>The list of loadable images provided by the platform may also contain
dynamic configuration files. The files are loaded and can be parsed as
needed in the <code class="docutils literal notranslate"><span class="pre">bl2_plat_handle_post_image_load()</span></code> function. These
configuration files can be passed to next Boot Loader stages as arguments
by updating the corresponding entrypoint information in this function.</p>
</div>
<div class="section" id="scp-bl2-system-control-processor-firmware-image-load">
<h4><span class="section-number">4.1.3.4. </span>SCP_BL2 (System Control Processor Firmware) image load<a class="headerlink" href="#scp-bl2-system-control-processor-firmware-image-load" title="Permalink to this headline">¶</a></h4>
<p>Some systems have a separate System Control Processor (SCP) for power, clock,
reset and system control. BL2 loads the optional SCP_BL2 image from platform
storage into a platform-specific region of secure memory. The subsequent
handling of SCP_BL2 is platform specific. For example, on the Juno Arm
development platform port the image is transferred into SCP’s internal memory
using the Boot Over MHU (BOM) protocol after being loaded in the trusted SRAM
memory. The SCP executes SCP_BL2 and signals to the Application Processor (AP)
for BL2 execution to continue.</p>
</div>
<div class="section" id="el3-runtime-software-image-load">
<h4><span class="section-number">4.1.3.5. </span>EL3 Runtime Software image load<a class="headerlink" href="#el3-runtime-software-image-load" title="Permalink to this headline">¶</a></h4>
<p>BL2 loads the EL3 Runtime Software image from platform storage into a platform-
specific address in trusted SRAM. If there is not enough memory to load the
image or image is missing it leads to an assertion failure.</p>
</div>
<div class="section" id="aarch64-bl32-secure-el1-payload-image-load">
<h4><span class="section-number">4.1.3.6. </span>AArch64 BL32 (Secure-EL1 Payload) image load<a class="headerlink" href="#aarch64-bl32-secure-el1-payload-image-load" title="Permalink to this headline">¶</a></h4>
<p>BL2 loads the optional BL32 image from platform storage into a platform-
specific region of secure memory. The image executes in the secure world. BL2
relies on BL31 to pass control to the BL32 image, if present. Hence, BL2
populates a platform-specific area of memory with the entrypoint/load-address
of the BL32 image. The value of the Saved Processor Status Register (<code class="docutils literal notranslate"><span class="pre">SPSR</span></code>)
for entry into BL32 is not determined by BL2, it is initialized by the
Secure-EL1 Payload Dispatcher (see later) within BL31, which is responsible for
managing interaction with BL32. This information is passed to BL31.</p>
</div>
<div class="section" id="bl33-non-trusted-firmware-image-load">
<h4><span class="section-number">4.1.3.7. </span>BL33 (Non-trusted Firmware) image load<a class="headerlink" href="#bl33-non-trusted-firmware-image-load" title="Permalink to this headline">¶</a></h4>
<p>BL2 loads the BL33 image (e.g. UEFI or other test or boot software) from
platform storage into non-secure memory as defined by the platform.</p>
<p>BL2 relies on EL3 Runtime Software to pass control to BL33 once secure state
initialization is complete. Hence, BL2 populates a platform-specific area of
memory with the entrypoint and Saved Program Status Register (<code class="docutils literal notranslate"><span class="pre">SPSR</span></code>) of the
normal world software image. The entrypoint is the load address of the BL33
image. The <code class="docutils literal notranslate"><span class="pre">SPSR</span></code> is determined as specified in Section 5.13 of the
<a class="reference external" href="http://infocenter.arm.com/help/topic/com.arm.doc.den0022d/Power_State_Coordination_Interface_PDD_v1_1_DEN0022D.pdf">Power State Coordination Interface PDD</a>. This information is passed to the
EL3 Runtime Software.</p>
</div>
<div class="section" id="aarch64-bl31-el3-runtime-software-execution">
<h4><span class="section-number">4.1.3.8. </span>AArch64 BL31 (EL3 Runtime Software) execution<a class="headerlink" href="#aarch64-bl31-el3-runtime-software-execution" title="Permalink to this headline">¶</a></h4>
<p>BL2 execution continues as follows:</p>
<ol class="arabic simple">
<li><p>BL2 passes control back to BL1 by raising an SMC, providing BL1 with the
BL31 entrypoint. The exception is handled by the SMC exception handler
installed by BL1.</p></li>
<li><p>BL1 turns off the MMU and flushes the caches. It clears the
<code class="docutils literal notranslate"><span class="pre">SCTLR_EL3.M/I/C</span></code> bits, flushes the data cache to the point of coherency
and invalidates the TLBs.</p></li>
<li><p>BL1 passes control to BL31 at the specified entrypoint at EL3.</p></li>
</ol>
</div>
</div>
<div class="section" id="running-bl2-at-el3-execution-level">
<h3><span class="section-number">4.1.4. </span>Running BL2 at EL3 execution level<a class="headerlink" href="#running-bl2-at-el3-execution-level" title="Permalink to this headline">¶</a></h3>
<p>Some platforms have a non-TF-A Boot ROM that expects the next boot stage
to execute at EL3. On these platforms, TF-A BL1 is a waste of memory
as its only purpose is to ensure TF-A BL2 is entered at S-EL1. To avoid
this waste, a special mode enables BL2 to execute at EL3, which allows
a non-TF-A Boot ROM to load and jump directly to BL2. This mode is selected
when the build flag BL2_AT_EL3 is enabled. The main differences in this
mode are:</p>
<ol class="arabic simple">
<li><p>BL2 includes the reset code and the mailbox mechanism to differentiate
cold boot and warm boot. It runs at EL3 doing the arch
initialization required for EL3.</p></li>
<li><p>BL2 does not receive the meminfo information from BL1 anymore. This
information can be passed by the Boot ROM or be internal to the
BL2 image.</p></li>
<li><p>Since BL2 executes at EL3, BL2 jumps directly to the next image,
instead of invoking the RUN_IMAGE SMC call.</p></li>
</ol>
<p>We assume 3 different types of BootROM support on the platform:</p>
<ol class="arabic simple">
<li><p>The Boot ROM always jumps to the same address, for both cold
and warm boot. In this case, we will need to keep a resident part
of BL2 whose memory cannot be reclaimed by any other image. The
linker script defines the symbols __TEXT_RESIDENT_START__ and
__TEXT_RESIDENT_END__ that allows the platform to configure
correctly the memory map.</p></li>
<li><p>The platform has some mechanism to indicate the jump address to the
Boot ROM. Platform code can then program the jump address with
psci_warmboot_entrypoint during cold boot.</p></li>
<li><p>The platform has some mechanism to program the reset address using
the PROGRAMMABLE_RESET_ADDRESS feature. Platform code can then
program the reset address with psci_warmboot_entrypoint during
cold boot, bypassing the boot ROM for warm boot.</p></li>
</ol>
<p>In the last 2 cases, no part of BL2 needs to remain resident at
runtime. In the first 2 cases, we expect the Boot ROM to be able to
differentiate between warm and cold boot, to avoid loading BL2 again
during warm boot.</p>
<p>This functionality can be tested with FVP loading the image directly
in memory and changing the address where the system jumps at reset.
For example:</p>
<blockquote>
<div><p>-C cluster0.cpu0.RVBAR=0x4022000
–data <a class="reference external" href="mailto:cluster0&#46;cpu0=bl2&#46;bin&#37;&#52;&#48;0x4022000">cluster0<span>&#46;</span>cpu0=bl2<span>&#46;</span>bin<span>&#64;</span>0x4022000</a></p>
</div></blockquote>
<p>With this configuration, FVP is like a platform of the first case,
where the Boot ROM jumps always to the same address. For simplification,
BL32 is loaded in DRAM in this case, to avoid other images reclaiming
BL2 memory.</p>
</div>
<div class="section" id="aarch64-bl31">
<h3><span class="section-number">4.1.5. </span>AArch64 BL31<a class="headerlink" href="#aarch64-bl31" title="Permalink to this headline">¶</a></h3>
<p>The image for this stage is loaded by BL2 and BL1 passes control to BL31 at
EL3. BL31 executes solely in trusted SRAM. BL31 is linked against and
loaded at a platform-specific base address (more information can be found later
in this document). The functionality implemented by BL31 is as follows.</p>
<div class="section" id="id3">
<h4><span class="section-number">4.1.5.1. </span>Architectural initialization<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>Currently, BL31 performs a similar architectural initialization to BL1 as
far as system register settings are concerned. Since BL1 code resides in ROM,
architectural initialization in BL31 allows override of any previous
initialization done by BL1.</p>
<p>BL31 initializes the per-CPU data framework, which provides a cache of
frequently accessed per-CPU data optimised for fast, concurrent manipulation
on different CPUs. This buffer includes pointers to per-CPU contexts, crash
buffer, CPU reset and power down operations, PSCI data, platform data and so on.</p>
<p>It then replaces the exception vectors populated by BL1 with its own. BL31
exception vectors implement more elaborate support for handling SMCs since this
is the only mechanism to access the runtime services implemented by BL31 (PSCI
for example). BL31 checks each SMC for validity as specified by the
<a class="reference external" href="https://developer.arm.com/docs/den0028/latest">SMC Calling Convention</a> before passing control to the required SMC
handler routine.</p>
<p>BL31 programs the <code class="docutils literal notranslate"><span class="pre">CNTFRQ_EL0</span></code> register with the clock frequency of the system
counter, which is provided by the platform.</p>
</div>
<div class="section" id="id4">
<h4><span class="section-number">4.1.5.2. </span>Platform initialization<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>BL31 performs detailed platform initialization, which enables normal world
software to function correctly.</p>
<p>On Arm platforms, this consists of the following:</p>
<ul class="simple">
<li><p>Initialize the console.</p></li>
<li><p>Configure the Interconnect to enable hardware coherency.</p></li>
<li><p>Enable the MMU and map the memory it needs to access.</p></li>
<li><p>Initialize the generic interrupt controller.</p></li>
<li><p>Initialize the power controller device.</p></li>
<li><p>Detect the system topology.</p></li>
</ul>
</div>
<div class="section" id="runtime-services-initialization">
<h4><span class="section-number">4.1.5.3. </span>Runtime services initialization<a class="headerlink" href="#runtime-services-initialization" title="Permalink to this headline">¶</a></h4>
<p>BL31 is responsible for initializing the runtime services. One of them is PSCI.</p>
<p>As part of the PSCI initializations, BL31 detects the system topology. It also
initializes the data structures that implement the state machine used to track
the state of power domain nodes. The state can be one of <code class="docutils literal notranslate"><span class="pre">OFF</span></code>, <code class="docutils literal notranslate"><span class="pre">RUN</span></code> or
<code class="docutils literal notranslate"><span class="pre">RETENTION</span></code>. All secondary CPUs are initially in the <code class="docutils literal notranslate"><span class="pre">OFF</span></code> state. The cluster
that the primary CPU belongs to is <code class="docutils literal notranslate"><span class="pre">ON</span></code>; any other cluster is <code class="docutils literal notranslate"><span class="pre">OFF</span></code>. It also
initializes the locks that protect them. BL31 accesses the state of a CPU or
cluster immediately after reset and before the data cache is enabled in the
warm boot path. It is not currently possible to use ‘exclusive’ based spinlocks,
therefore BL31 uses locks based on Lamport’s Bakery algorithm instead.</p>
<p>The runtime service framework and its initialization is described in more
detail in the “EL3 runtime services framework” section below.</p>
<p>Details about the status of the PSCI implementation are provided in the
“Power State Coordination Interface” section below.</p>
</div>
<div class="section" id="aarch64-bl32-secure-el1-payload-image-initialization">
<h4><span class="section-number">4.1.5.4. </span>AArch64 BL32 (Secure-EL1 Payload) image initialization<a class="headerlink" href="#aarch64-bl32-secure-el1-payload-image-initialization" title="Permalink to this headline">¶</a></h4>
<p>If a BL32 image is present then there must be a matching Secure-EL1 Payload
Dispatcher (SPD) service (see later for details). During initialization
that service must register a function to carry out initialization of BL32
once the runtime services are fully initialized. BL31 invokes such a
registered function to initialize BL32 before running BL33. This initialization
is not necessary for AArch32 SPs.</p>
<p>Details on BL32 initialization and the SPD’s role are described in the
<a class="reference internal" href="#firmware-design-sel1-spd"><span class="std std-ref">Secure-EL1 Payloads and Dispatchers</span></a> section below.</p>
</div>
<div class="section" id="bl33-non-trusted-firmware-execution">
<h4><span class="section-number">4.1.5.5. </span>BL33 (Non-trusted Firmware) execution<a class="headerlink" href="#bl33-non-trusted-firmware-execution" title="Permalink to this headline">¶</a></h4>
<p>EL3 Runtime Software initializes the EL2 or EL1 processor context for normal-
world cold boot, ensuring that no secure state information finds its way into
the non-secure execution state. EL3 Runtime Software uses the entrypoint
information provided by BL2 to jump to the Non-trusted firmware image (BL33)
at the highest available Exception Level (EL2 if available, otherwise EL1).</p>
</div>
</div>
<div class="section" id="using-alternative-trusted-boot-firmware-in-place-of-bl1-bl2-aarch64-only">
<h3><span class="section-number">4.1.6. </span>Using alternative Trusted Boot Firmware in place of BL1 &amp; BL2 (AArch64 only)<a class="headerlink" href="#using-alternative-trusted-boot-firmware-in-place-of-bl1-bl2-aarch64-only" title="Permalink to this headline">¶</a></h3>
<p>Some platforms have existing implementations of Trusted Boot Firmware that
would like to use TF-A BL31 for the EL3 Runtime Software. To enable this
firmware architecture it is important to provide a fully documented and stable
interface between the Trusted Boot Firmware and BL31.</p>
<p>Future changes to the BL31 interface will be done in a backwards compatible
way, and this enables these firmware components to be independently enhanced/
updated to develop and exploit new functionality.</p>
<div class="section" id="required-cpu-state-when-calling-bl31-entrypoint-during-cold-boot">
<h4><span class="section-number">4.1.6.1. </span>Required CPU state when calling <code class="docutils literal notranslate"><span class="pre">bl31_entrypoint()</span></code> during cold boot<a class="headerlink" href="#required-cpu-state-when-calling-bl31-entrypoint-during-cold-boot" title="Permalink to this headline">¶</a></h4>
<p>This function must only be called by the primary CPU.</p>
<p>On entry to this function the calling primary CPU must be executing in AArch64
EL3, little-endian data access, and all interrupt sources masked:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PSTATE</span><span class="o">.</span><span class="n">EL</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">PSTATE</span><span class="o">.</span><span class="n">RW</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">PSTATE</span><span class="o">.</span><span class="n">DAIF</span> <span class="o">=</span> <span class="mh">0xf</span>
<span class="n">SCTLR_EL3</span><span class="o">.</span><span class="n">EE</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>X0 and X1 can be used to pass information from the Trusted Boot Firmware to the
platform code in BL31:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">X0</span> <span class="p">:</span> <span class="n">Reserved</span> <span class="k">for</span> <span class="n">common</span> <span class="n">TF</span><span class="o">-</span><span class="n">A</span> <span class="n">information</span>
<span class="n">X1</span> <span class="p">:</span> <span class="n">Platform</span> <span class="n">specific</span> <span class="n">information</span>
</pre></div>
</div>
<p>BL31 zero-init sections (e.g. <code class="docutils literal notranslate"><span class="pre">.bss</span></code>) should not contain valid data on entry,
these will be zero filled prior to invoking platform setup code.</p>
<div class="section" id="use-of-the-x0-and-x1-parameters">
<h5><span class="section-number">4.1.6.1.1. </span>Use of the X0 and X1 parameters<a class="headerlink" href="#use-of-the-x0-and-x1-parameters" title="Permalink to this headline">¶</a></h5>
<p>The parameters are platform specific and passed from <code class="docutils literal notranslate"><span class="pre">bl31_entrypoint()</span></code> to
<code class="docutils literal notranslate"><span class="pre">bl31_early_platform_setup()</span></code>. The value of these parameters is never directly
used by the common BL31 code.</p>
<p>The convention is that <code class="docutils literal notranslate"><span class="pre">X0</span></code> conveys information regarding the BL31, BL32 and
BL33 images from the Trusted Boot firmware and <code class="docutils literal notranslate"><span class="pre">X1</span></code> can be used for other
platform specific purpose. This convention allows platforms which use TF-A’s
BL1 and BL2 images to transfer additional platform specific information from
Secure Boot without conflicting with future evolution of TF-A using <code class="docutils literal notranslate"><span class="pre">X0</span></code> to
pass a <code class="docutils literal notranslate"><span class="pre">bl31_params</span></code> structure.</p>
<p>BL31 common and SPD initialization code depends on image and entrypoint
information about BL33 and BL32, which is provided via BL31 platform APIs.
This information is required until the start of execution of BL33. This
information can be provided in a platform defined manner, e.g. compiled into
the platform code in BL31, or provided in a platform defined memory location
by the Trusted Boot firmware, or passed from the Trusted Boot Firmware via the
Cold boot Initialization parameters. This data may need to be cleaned out of
the CPU caches if it is provided by an earlier boot stage and then accessed by
BL31 platform code before the caches are enabled.</p>
<p>TF-A’s BL2 implementation passes a <code class="docutils literal notranslate"><span class="pre">bl31_params</span></code> structure in
<code class="docutils literal notranslate"><span class="pre">X0</span></code> and the Arm development platforms interpret this in the BL31 platform
code.</p>
</div>
<div class="section" id="mmu-data-caches-coherency">
<h5><span class="section-number">4.1.6.1.2. </span>MMU, Data caches &amp; Coherency<a class="headerlink" href="#mmu-data-caches-coherency" title="Permalink to this headline">¶</a></h5>
<p>BL31 does not depend on the enabled state of the MMU, data caches or
interconnect coherency on entry to <code class="docutils literal notranslate"><span class="pre">bl31_entrypoint()</span></code>. If these are disabled
on entry, these should be enabled during <code class="docutils literal notranslate"><span class="pre">bl31_plat_arch_setup()</span></code>.</p>
</div>
<div class="section" id="data-structures-used-in-the-bl31-cold-boot-interface">
<h5><span class="section-number">4.1.6.1.3. </span>Data structures used in the BL31 cold boot interface<a class="headerlink" href="#data-structures-used-in-the-bl31-cold-boot-interface" title="Permalink to this headline">¶</a></h5>
<p>These structures are designed to support compatibility and independent
evolution of the structures and the firmware images. For example, a version of
BL31 that can interpret the BL3x image information from different versions of
BL2, a platform that uses an extended entry_point_info structure to convey
additional register information to BL31, or a ELF image loader that can convey
more details about the firmware images.</p>
<p>To support these scenarios the structures are versioned and sized, which enables
BL31 to detect which information is present and respond appropriately. The
<code class="docutils literal notranslate"><span class="pre">param_header</span></code> is defined to capture this information:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="nc">param_header</span> <span class="p">{</span>
    <span class="kt">uint8_t</span> <span class="n">type</span><span class="p">;</span>       <span class="cm">/* type of the structure */</span>
    <span class="kt">uint8_t</span> <span class="n">version</span><span class="p">;</span>    <span class="cm">/* version of this structure */</span>
    <span class="kt">uint16_t</span> <span class="n">size</span><span class="p">;</span>      <span class="cm">/* size of this structure in bytes */</span>
    <span class="kt">uint32_t</span> <span class="n">attr</span><span class="p">;</span>      <span class="cm">/* attributes: unused bits SBZ */</span>
<span class="p">}</span> <span class="n">param_header_t</span><span class="p">;</span>
</pre></div>
</div>
<p>The structures using this format are <code class="docutils literal notranslate"><span class="pre">entry_point_info</span></code>, <code class="docutils literal notranslate"><span class="pre">image_info</span></code> and
<code class="docutils literal notranslate"><span class="pre">bl31_params</span></code>. The code that allocates and populates these structures must set
the header fields appropriately, and the <code class="docutils literal notranslate"><span class="pre">SET_PARAM_HEAD()</span></code> a macro is defined
to simplify this action.</p>
</div>
</div>
<div class="section" id="required-cpu-state-for-bl31-warm-boot-initialization">
<h4><span class="section-number">4.1.6.2. </span>Required CPU state for BL31 Warm boot initialization<a class="headerlink" href="#required-cpu-state-for-bl31-warm-boot-initialization" title="Permalink to this headline">¶</a></h4>
<p>When requesting a CPU power-on, or suspending a running CPU, TF-A provides
the platform power management code with a Warm boot initialization
entry-point, to be invoked by the CPU immediately after the reset handler.
On entry to the Warm boot initialization function the calling CPU must be in
AArch64 EL3, little-endian data access and all interrupt sources masked:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PSTATE</span><span class="o">.</span><span class="n">EL</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">PSTATE</span><span class="o">.</span><span class="n">RW</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">PSTATE</span><span class="o">.</span><span class="n">DAIF</span> <span class="o">=</span> <span class="mh">0xf</span>
<span class="n">SCTLR_EL3</span><span class="o">.</span><span class="n">EE</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>The PSCI implementation will initialize the processor state and ensure that the
platform power management code is then invoked as required to initialize all
necessary system, cluster and CPU resources.</p>
</div>
</div>
<div class="section" id="aarch32-el3-runtime-software-entrypoint-interface">
<h3><span class="section-number">4.1.7. </span>AArch32 EL3 Runtime Software entrypoint interface<a class="headerlink" href="#aarch32-el3-runtime-software-entrypoint-interface" title="Permalink to this headline">¶</a></h3>
<p>To enable this firmware architecture it is important to provide a fully
documented and stable interface between the Trusted Boot Firmware and the
AArch32 EL3 Runtime Software.</p>
<p>Future changes to the entrypoint interface will be done in a backwards
compatible way, and this enables these firmware components to be independently
enhanced/updated to develop and exploit new functionality.</p>
<div class="section" id="required-cpu-state-when-entering-during-cold-boot">
<h4><span class="section-number">4.1.7.1. </span>Required CPU state when entering during cold boot<a class="headerlink" href="#required-cpu-state-when-entering-during-cold-boot" title="Permalink to this headline">¶</a></h4>
<p>This function must only be called by the primary CPU.</p>
<p>On entry to this function the calling primary CPU must be executing in AArch32
EL3, little-endian data access, and all interrupt sources masked:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PSTATE</span><span class="o">.</span><span class="n">AIF</span> <span class="o">=</span> <span class="mh">0x7</span>
<span class="n">SCTLR</span><span class="o">.</span><span class="n">EE</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>R0 and R1 are used to pass information from the Trusted Boot Firmware to the
platform code in AArch32 EL3 Runtime Software:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">R0</span> <span class="p">:</span> <span class="n">Reserved</span> <span class="k">for</span> <span class="n">common</span> <span class="n">TF</span><span class="o">-</span><span class="n">A</span> <span class="n">information</span>
<span class="n">R1</span> <span class="p">:</span> <span class="n">Platform</span> <span class="n">specific</span> <span class="n">information</span>
</pre></div>
</div>
<div class="section" id="use-of-the-r0-and-r1-parameters">
<h5><span class="section-number">4.1.7.1.1. </span>Use of the R0 and R1 parameters<a class="headerlink" href="#use-of-the-r0-and-r1-parameters" title="Permalink to this headline">¶</a></h5>
<p>The parameters are platform specific and the convention is that <code class="docutils literal notranslate"><span class="pre">R0</span></code> conveys
information regarding the BL3x images from the Trusted Boot firmware and <code class="docutils literal notranslate"><span class="pre">R1</span></code>
can be used for other platform specific purpose. This convention allows
platforms which use TF-A’s BL1 and BL2 images to transfer additional platform
specific information from Secure Boot without conflicting with future
evolution of TF-A using <code class="docutils literal notranslate"><span class="pre">R0</span></code> to pass a <code class="docutils literal notranslate"><span class="pre">bl_params</span></code> structure.</p>
<p>The AArch32 EL3 Runtime Software is responsible for entry into BL33. This
information can be obtained in a platform defined manner, e.g. compiled into
the AArch32 EL3 Runtime Software, or provided in a platform defined memory
location by the Trusted Boot firmware, or passed from the Trusted Boot Firmware
via the Cold boot Initialization parameters. This data may need to be cleaned
out of the CPU caches if it is provided by an earlier boot stage and then
accessed by AArch32 EL3 Runtime Software before the caches are enabled.</p>
<p>When using AArch32 EL3 Runtime Software, the Arm development platforms pass a
<code class="docutils literal notranslate"><span class="pre">bl_params</span></code> structure in <code class="docutils literal notranslate"><span class="pre">R0</span></code> from BL2 to be interpreted by AArch32 EL3 Runtime
Software platform code.</p>
</div>
<div class="section" id="id5">
<h5><span class="section-number">4.1.7.1.2. </span>MMU, Data caches &amp; Coherency<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h5>
<p>AArch32 EL3 Runtime Software must not depend on the enabled state of the MMU,
data caches or interconnect coherency in its entrypoint. They must be explicitly
enabled if required.</p>
</div>
<div class="section" id="data-structures-used-in-cold-boot-interface">
<h5><span class="section-number">4.1.7.1.3. </span>Data structures used in cold boot interface<a class="headerlink" href="#data-structures-used-in-cold-boot-interface" title="Permalink to this headline">¶</a></h5>
<p>The AArch32 EL3 Runtime Software cold boot interface uses <code class="docutils literal notranslate"><span class="pre">bl_params</span></code> instead
of <code class="docutils literal notranslate"><span class="pre">bl31_params</span></code>. The <code class="docutils literal notranslate"><span class="pre">bl_params</span></code> structure is based on the convention
described in AArch64 BL31 cold boot interface section.</p>
</div>
</div>
<div class="section" id="required-cpu-state-for-warm-boot-initialization">
<h4><span class="section-number">4.1.7.2. </span>Required CPU state for warm boot initialization<a class="headerlink" href="#required-cpu-state-for-warm-boot-initialization" title="Permalink to this headline">¶</a></h4>
<p>When requesting a CPU power-on, or suspending a running CPU, AArch32 EL3
Runtime Software must ensure execution of a warm boot initialization entrypoint.
If TF-A BL1 is used and the PROGRAMMABLE_RESET_ADDRESS build flag is false,
then AArch32 EL3 Runtime Software must ensure that BL1 branches to the warm
boot entrypoint by arranging for the BL1 platform function,
plat_get_my_entrypoint(), to return a non-zero value.</p>
<p>In this case, the warm boot entrypoint must be in AArch32 EL3, little-endian
data access and all interrupt sources masked:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PSTATE</span><span class="o">.</span><span class="n">AIF</span> <span class="o">=</span> <span class="mh">0x7</span>
<span class="n">SCTLR</span><span class="o">.</span><span class="n">EE</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>The warm boot entrypoint may be implemented by using TF-A
<code class="docutils literal notranslate"><span class="pre">psci_warmboot_entrypoint()</span></code> function. In that case, the platform must fulfil
the pre-requisites mentioned in the
<a class="reference internal" href="../getting_started/psci-lib-integration-guide.html#psci-library-integration-guide-for-armv8-a-aarch32-systems"><span class="std std-ref">PSCI Library Integration guide for Armv8-A AArch32 systems</span></a>.</p>
</div>
</div>
</div>
<div class="section" id="el3-runtime-services-framework">
<h2><span class="section-number">4.2. </span>EL3 runtime services framework<a class="headerlink" href="#el3-runtime-services-framework" title="Permalink to this headline">¶</a></h2>
<p>Software executing in the non-secure state and in the secure state at exception
levels lower than EL3 will request runtime services using the Secure Monitor
Call (SMC) instruction. These requests will follow the convention described in
the SMC Calling Convention PDD (<a class="reference external" href="https://developer.arm.com/docs/den0028/latest">SMCCC</a>). The <a class="reference external" href="https://developer.arm.com/docs/den0028/latest">SMCCC</a> assigns function
identifiers to each SMC request and describes how arguments are passed and
returned.</p>
<p>The EL3 runtime services framework enables the development of services by
different providers that can be easily integrated into final product firmware.
The following sections describe the framework which facilitates the
registration, initialization and use of runtime services in EL3 Runtime
Software (BL31).</p>
<p>The design of the runtime services depends heavily on the concepts and
definitions described in the <a class="reference external" href="https://developer.arm.com/docs/den0028/latest">SMCCC</a>, in particular SMC Function IDs, Owning
Entity Numbers (OEN), Fast and Yielding calls, and the SMC32 and SMC64 calling
conventions. Please refer to that document for more detailed explanation of
these terms.</p>
<p>The following runtime services are expected to be implemented first. They have
not all been instantiated in the current implementation.</p>
<ol class="arabic">
<li><p>Standard service calls</p>
<p>This service is for management of the entire system. The Power State
Coordination Interface (<a class="reference external" href="http://infocenter.arm.com/help/topic/com.arm.doc.den0022d/Power_State_Coordination_Interface_PDD_v1_1_DEN0022D.pdf">PSCI</a>) is the first set of standard service calls
defined by Arm (see PSCI section later).</p>
</li>
<li><p>Secure-EL1 Payload Dispatcher service</p>
<p>If a system runs a Trusted OS or other Secure-EL1 Payload (SP) then
it also requires a <em>Secure Monitor</em> at EL3 to switch the EL1 processor
context between the normal world (EL1/EL2) and trusted world (Secure-EL1).
The Secure Monitor will make these world switches in response to SMCs. The
<a class="reference external" href="https://developer.arm.com/docs/den0028/latest">SMCCC</a> provides for such SMCs with the Trusted OS Call and Trusted
Application Call OEN ranges.</p>
<p>The interface between the EL3 Runtime Software and the Secure-EL1 Payload is
not defined by the <a class="reference external" href="https://developer.arm.com/docs/den0028/latest">SMCCC</a> or any other standard. As a result, each
Secure-EL1 Payload requires a specific Secure Monitor that runs as a runtime
service - within TF-A this service is referred to as the Secure-EL1 Payload
Dispatcher (SPD).</p>
<p>TF-A provides a Test Secure-EL1 Payload (TSP) and its associated Dispatcher
(TSPD). Details of SPD design and TSP/TSPD operation are described in the
<a class="reference internal" href="#firmware-design-sel1-spd"><span class="std std-ref">Secure-EL1 Payloads and Dispatchers</span></a> section below.</p>
</li>
<li><p>CPU implementation service</p>
<p>This service will provide an interface to CPU implementation specific
services for a given platform e.g. access to processor errata workarounds.
This service is currently unimplemented.</p>
</li>
</ol>
<p>Additional services for Arm Architecture, SiP and OEM calls can be implemented.
Each implemented service handles a range of SMC function identifiers as
described in the <a class="reference external" href="https://developer.arm.com/docs/den0028/latest">SMCCC</a>.</p>
<div class="section" id="registration">
<h3><span class="section-number">4.2.1. </span>Registration<a class="headerlink" href="#registration" title="Permalink to this headline">¶</a></h3>
<p>A runtime service is registered using the <code class="docutils literal notranslate"><span class="pre">DECLARE_RT_SVC()</span></code> macro, specifying
the name of the service, the range of OENs covered, the type of service and
initialization and call handler functions. This macro instantiates a <code class="docutils literal notranslate"><span class="pre">const</span> <span class="pre">struct</span> <span class="pre">rt_svc_desc</span></code> for the service with these details (see <code class="docutils literal notranslate"><span class="pre">runtime_svc.h</span></code>).
This structure is allocated in a special ELF section <code class="docutils literal notranslate"><span class="pre">rt_svc_descs</span></code>, enabling
the framework to find all service descriptors included into BL31.</p>
<p>The specific service for a SMC Function is selected based on the OEN and call
type of the Function ID, and the framework uses that information in the service
descriptor to identify the handler for the SMC Call.</p>
<p>The service descriptors do not include information to identify the precise set
of SMC function identifiers supported by this service implementation, the
security state from which such calls are valid nor the capability to support
64-bit and/or 32-bit callers (using SMC32 or SMC64). Responding appropriately
to these aspects of a SMC call is the responsibility of the service
implementation, the framework is focused on integration of services from
different providers and minimizing the time taken by the framework before the
service handler is invoked.</p>
<p>Details of the parameters, requirements and behavior of the initialization and
call handling functions are provided in the following sections.</p>
</div>
<div class="section" id="initialization">
<h3><span class="section-number">4.2.2. </span>Initialization<a class="headerlink" href="#initialization" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">runtime_svc_init()</span></code> in <code class="docutils literal notranslate"><span class="pre">runtime_svc.c</span></code> initializes the runtime services
framework running on the primary CPU during cold boot as part of the BL31
initialization. This happens prior to initializing a Trusted OS and running
Normal world boot firmware that might in turn use these services.
Initialization involves validating each of the declared runtime service
descriptors, calling the service initialization function and populating the
index used for runtime lookup of the service.</p>
<p>The BL31 linker script collects all of the declared service descriptors into a
single array and defines symbols that allow the framework to locate and traverse
the array, and determine its size.</p>
<p>The framework does basic validation of each descriptor to halt firmware
initialization if service declaration errors are detected. The framework does
not check descriptors for the following error conditions, and may behave in an
unpredictable manner under such scenarios:</p>
<ol class="arabic simple">
<li><p>Overlapping OEN ranges</p></li>
<li><p>Multiple descriptors for the same range of OENs and <code class="docutils literal notranslate"><span class="pre">call_type</span></code></p></li>
<li><p>Incorrect range of owning entity numbers for a given <code class="docutils literal notranslate"><span class="pre">call_type</span></code></p></li>
</ol>
<p>Once validated, the service <code class="docutils literal notranslate"><span class="pre">init()</span></code> callback is invoked. This function carries
out any essential EL3 initialization before servicing requests. The <code class="docutils literal notranslate"><span class="pre">init()</span></code>
function is only invoked on the primary CPU during cold boot. If the service
uses per-CPU data this must either be initialized for all CPUs during this call,
or be done lazily when a CPU first issues an SMC call to that service. If
<code class="docutils literal notranslate"><span class="pre">init()</span></code> returns anything other than <code class="docutils literal notranslate"><span class="pre">0</span></code>, this is treated as an initialization
error and the service is ignored: this does not cause the firmware to halt.</p>
<p>The OEN and call type fields present in the SMC Function ID cover a total of
128 distinct services, but in practice a single descriptor can cover a range of
OENs, e.g. SMCs to call a Trusted OS function. To optimize the lookup of a
service handler, the framework uses an array of 128 indices that map every
distinct OEN/call-type combination either to one of the declared services or to
indicate the service is not handled. This <code class="docutils literal notranslate"><span class="pre">rt_svc_descs_indices[]</span></code> array is
populated for all of the OENs covered by a service after the service <code class="docutils literal notranslate"><span class="pre">init()</span></code>
function has reported success. So a service that fails to initialize will never
have it’s <code class="docutils literal notranslate"><span class="pre">handle()</span></code> function invoked.</p>
<p>The following figure shows how the <code class="docutils literal notranslate"><span class="pre">rt_svc_descs_indices[]</span></code> index maps the SMC
Function ID call type and OEN onto a specific service handler in the
<code class="docutils literal notranslate"><span class="pre">rt_svc_descs[]</span></code> array.</p>
<p><img alt="Image 1" src="../_images/rt-svc-descs-layout.png" /></p>
</div>
<div class="section" id="handling-an-smc">
<span id="id6"></span><h3><span class="section-number">4.2.3. </span>Handling an SMC<a class="headerlink" href="#handling-an-smc" title="Permalink to this headline">¶</a></h3>
<p>When the EL3 runtime services framework receives a Secure Monitor Call, the SMC
Function ID is passed in W0 from the lower exception level (as per the
<a class="reference external" href="https://developer.arm.com/docs/den0028/latest">SMCCC</a>). If the calling register width is AArch32, it is invalid to invoke an
SMC Function which indicates the SMC64 calling convention: such calls are
ignored and return the Unknown SMC Function Identifier result code <code class="docutils literal notranslate"><span class="pre">0xFFFFFFFF</span></code>
in R0/X0.</p>
<p>Bit[31] (fast/yielding call) and bits[29:24] (owning entity number) of the SMC
Function ID are combined to index into the <code class="docutils literal notranslate"><span class="pre">rt_svc_descs_indices[]</span></code> array. The
resulting value might indicate a service that has no handler, in this case the
framework will also report an Unknown SMC Function ID. Otherwise, the value is
used as a further index into the <code class="docutils literal notranslate"><span class="pre">rt_svc_descs[]</span></code> array to locate the required
service and handler.</p>
<p>The service’s <code class="docutils literal notranslate"><span class="pre">handle()</span></code> callback is provided with five of the SMC parameters
directly, the others are saved into memory for retrieval (if needed) by the
handler. The handler is also provided with an opaque <code class="docutils literal notranslate"><span class="pre">handle</span></code> for use with the
supporting library for parameter retrieval, setting return values and context
manipulation; and with <code class="docutils literal notranslate"><span class="pre">flags</span></code> indicating the security state of the caller. The
framework finally sets up the execution stack for the handler, and invokes the
services <code class="docutils literal notranslate"><span class="pre">handle()</span></code> function.</p>
<p>On return from the handler the result registers are populated in X0-X7 as needed
before restoring the stack and CPU state and returning from the original SMC.</p>
</div>
</div>
<div class="section" id="exception-handling-framework">
<h2><span class="section-number">4.3. </span>Exception Handling Framework<a class="headerlink" href="#exception-handling-framework" title="Permalink to this headline">¶</a></h2>
<p>Please refer to the <a class="reference internal" href="../components/exception-handling.html#exception-handling-framework"><span class="std std-ref">Exception Handling Framework</span></a> document.</p>
</div>
<div class="section" id="power-state-coordination-interface">
<h2><span class="section-number">4.4. </span>Power State Coordination Interface<a class="headerlink" href="#power-state-coordination-interface" title="Permalink to this headline">¶</a></h2>
<p>TODO: Provide design walkthrough of PSCI implementation.</p>
<p>The PSCI v1.1 specification categorizes APIs as optional and mandatory. All the
mandatory APIs in PSCI v1.1, PSCI v1.0 and in PSCI v0.2 draft specification
<a class="reference external" href="http://infocenter.arm.com/help/topic/com.arm.doc.den0022d/Power_State_Coordination_Interface_PDD_v1_1_DEN0022D.pdf">Power State Coordination Interface PDD</a> are implemented. The table lists
the PSCI v1.1 APIs and their support in generic code.</p>
<p>An API implementation might have a dependency on platform code e.g. CPU_SUSPEND
requires the platform to export a part of the implementation. Hence the level
of support of the mandatory APIs depends upon the support exported by the
platform port as well. The Juno and FVP (all variants) platforms export all the
required support.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 40%" />
<col style="width: 18%" />
<col style="width: 42%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>PSCI v1.1 API</p></th>
<th class="head"><p>Supported</p></th>
<th class="head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">PSCI_VERSION</span></code></p></td>
<td><p>Yes</p></td>
<td><p>The version returned is 1.1</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CPU_SUSPEND</span></code></p></td>
<td><p>Yes*</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CPU_OFF</span></code></p></td>
<td><p>Yes*</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CPU_ON</span></code></p></td>
<td><p>Yes*</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">AFFINITY_INFO</span></code></p></td>
<td><p>Yes</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">MIGRATE</span></code></p></td>
<td><p>Yes**</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">MIGRATE_INFO_TYPE</span></code></p></td>
<td><p>Yes**</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">MIGRATE_INFO_CPU</span></code></p></td>
<td><p>Yes**</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">SYSTEM_OFF</span></code></p></td>
<td><p>Yes*</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">SYSTEM_RESET</span></code></p></td>
<td><p>Yes*</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">PSCI_FEATURES</span></code></p></td>
<td><p>Yes</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">CPU_FREEZE</span></code></p></td>
<td><p>No</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">CPU_DEFAULT_SUSPEND</span></code></p></td>
<td><p>No</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">NODE_HW_STATE</span></code></p></td>
<td><p>Yes*</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">SYSTEM_SUSPEND</span></code></p></td>
<td><p>Yes*</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">PSCI_SET_SUSPEND_MODE</span></code></p></td>
<td><p>No</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">PSCI_STAT_RESIDENCY</span></code></p></td>
<td><p>Yes*</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">PSCI_STAT_COUNT</span></code></p></td>
<td><p>Yes*</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">SYSTEM_RESET2</span></code></p></td>
<td><p>Yes*</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">MEM_PROTECT</span></code></p></td>
<td><p>Yes*</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">MEM_PROTECT_CHECK_RANGE</span></code></p></td>
<td><p>Yes*</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>*Note : These PSCI APIs require platform power management hooks to be
registered with the generic PSCI code to be supported.</p>
<p>**Note : These PSCI APIs require appropriate Secure Payload Dispatcher
hooks to be registered with the generic PSCI code to be supported.</p>
<p>The PSCI implementation in TF-A is a library which can be integrated with
AArch64 or AArch32 EL3 Runtime Software for Armv8-A systems. A guide to
integrating PSCI library with AArch32 EL3 Runtime Software can be found
at <a class="reference internal" href="../getting_started/psci-lib-integration-guide.html#psci-library-integration-guide-for-armv8-a-aarch32-systems"><span class="std std-ref">PSCI Library Integration guide for Armv8-A AArch32 systems</span></a>.</p>
</div>
<div class="section" id="secure-el1-payloads-and-dispatchers">
<span id="firmware-design-sel1-spd"></span><h2><span class="section-number">4.5. </span>Secure-EL1 Payloads and Dispatchers<a class="headerlink" href="#secure-el1-payloads-and-dispatchers" title="Permalink to this headline">¶</a></h2>
<p>On a production system that includes a Trusted OS running in Secure-EL1/EL0,
the Trusted OS is coupled with a companion runtime service in the BL31
firmware. This service is responsible for the initialisation of the Trusted
OS and all communications with it. The Trusted OS is the BL32 stage of the
boot flow in TF-A. The firmware will attempt to locate, load and execute a
BL32 image.</p>
<p>TF-A uses a more general term for the BL32 software that runs at Secure-EL1 -
the <em>Secure-EL1 Payload</em> - as it is not always a Trusted OS.</p>
<p>TF-A provides a Test Secure-EL1 Payload (TSP) and a Test Secure-EL1 Payload
Dispatcher (TSPD) service as an example of how a Trusted OS is supported on a
production system using the Runtime Services Framework. On such a system, the
Test BL32 image and service are replaced by the Trusted OS and its dispatcher
service. The TF-A build system expects that the dispatcher will define the
build flag <code class="docutils literal notranslate"><span class="pre">NEED_BL32</span></code> to enable it to include the BL32 in the build either
as a binary or to compile from source depending on whether the <code class="docutils literal notranslate"><span class="pre">BL32</span></code> build
option is specified or not.</p>
<p>The TSP runs in Secure-EL1. It is designed to demonstrate synchronous
communication with the normal-world software running in EL1/EL2. Communication
is initiated by the normal-world software</p>
<ul class="simple">
<li><p>either directly through a Fast SMC (as defined in the <a class="reference external" href="https://developer.arm.com/docs/den0028/latest">SMCCC</a>)</p></li>
<li><p>or indirectly through a <a class="reference external" href="http://infocenter.arm.com/help/topic/com.arm.doc.den0022d/Power_State_Coordination_Interface_PDD_v1_1_DEN0022D.pdf">PSCI</a> SMC. The <a class="reference external" href="http://infocenter.arm.com/help/topic/com.arm.doc.den0022d/Power_State_Coordination_Interface_PDD_v1_1_DEN0022D.pdf">PSCI</a> implementation in turn
informs the TSPD about the requested power management operation. This allows
the TSP to prepare for or respond to the power state change</p></li>
</ul>
<p>The TSPD service is responsible for.</p>
<ul class="simple">
<li><p>Initializing the TSP</p></li>
<li><p>Routing requests and responses between the secure and the non-secure
states during the two types of communications just described</p></li>
</ul>
<div class="section" id="initializing-a-bl32-image">
<h3><span class="section-number">4.5.1. </span>Initializing a BL32 Image<a class="headerlink" href="#initializing-a-bl32-image" title="Permalink to this headline">¶</a></h3>
<p>The Secure-EL1 Payload Dispatcher (SPD) service is responsible for initializing
the BL32 image. It needs access to the information passed by BL2 to BL31 to do
so. This is provided by:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">entry_point_info_t</span> <span class="o">*</span><span class="nf">bl31_plat_get_next_image_ep_info</span><span class="p">(</span><span class="kt">uint32_t</span><span class="p">);</span>
</pre></div>
</div>
<p>which returns a reference to the <code class="docutils literal notranslate"><span class="pre">entry_point_info</span></code> structure corresponding to
the image which will be run in the specified security state. The SPD uses this
API to get entry point information for the SECURE image, BL32.</p>
<p>In the absence of a BL32 image, BL31 passes control to the normal world
bootloader image (BL33). When the BL32 image is present, it is typical
that the SPD wants control to be passed to BL32 first and then later to BL33.</p>
<p>To do this the SPD has to register a BL32 initialization function during
initialization of the SPD service. The BL32 initialization function has this
prototype:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">int32_t</span> <span class="nf">init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>
</div>
<p>and is registered using the <code class="docutils literal notranslate"><span class="pre">bl31_register_bl32_init()</span></code> function.</p>
<p>TF-A supports two approaches for the SPD to pass control to BL32 before
returning through EL3 and running the non-trusted firmware (BL33):</p>
<ol class="arabic">
<li><p>In the BL32 setup function, use <code class="docutils literal notranslate"><span class="pre">bl31_set_next_image_type()</span></code> to
request that the exit from <code class="docutils literal notranslate"><span class="pre">bl31_main()</span></code> is to the BL32 entrypoint in
Secure-EL1. BL31 will exit to BL32 using the asynchronous method by
calling <code class="docutils literal notranslate"><span class="pre">bl31_prepare_next_image_entry()</span></code> and <code class="docutils literal notranslate"><span class="pre">el3_exit()</span></code>.</p>
<p>When the BL32 has completed initialization at Secure-EL1, it returns to
BL31 by issuing an SMC, using a Function ID allocated to the SPD. On
receipt of this SMC, the SPD service handler should switch the CPU context
from trusted to normal world and use the <code class="docutils literal notranslate"><span class="pre">bl31_set_next_image_type()</span></code> and
<code class="docutils literal notranslate"><span class="pre">bl31_prepare_next_image_entry()</span></code> functions to set up the initial return to
the normal world firmware BL33. On return from the handler the framework
will exit to EL2 and run BL33.</p>
</li>
<li><p>The BL32 setup function registers an initialization function using
<code class="docutils literal notranslate"><span class="pre">bl31_register_bl32_init()</span></code> which provides a SPD-defined mechanism to
invoke a ‘world-switch synchronous call’ to Secure-EL1 to run the BL32
entrypoint.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Test SPD service included with TF-A provides one implementation
of such a mechanism.</p>
</div>
<p>On completion BL32 returns control to BL31 via a SMC, and on receipt the
SPD service handler invokes the synchronous call return mechanism to return
to the BL32 initialization function. On return from this function,
<code class="docutils literal notranslate"><span class="pre">bl31_main()</span></code> will set up the return to the normal world firmware BL33 and
continue the boot process in the normal world.</p>
</li>
</ol>
</div>
</div>
<div class="section" id="crash-reporting-in-bl31">
<h2><span class="section-number">4.6. </span>Crash Reporting in BL31<a class="headerlink" href="#crash-reporting-in-bl31" title="Permalink to this headline">¶</a></h2>
<p>BL31 implements a scheme for reporting the processor state when an unhandled
exception is encountered. The reporting mechanism attempts to preserve all the
register contents and report it via a dedicated UART (PL011 console). BL31
reports the general purpose, EL3, Secure EL1 and some EL2 state registers.</p>
<p>A dedicated per-CPU crash stack is maintained by BL31 and this is retrieved via
the per-CPU pointer cache. The implementation attempts to minimise the memory
required for this feature. The file <code class="docutils literal notranslate"><span class="pre">crash_reporting.S</span></code> contains the
implementation for crash reporting.</p>
<p>The sample crash output is shown below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">x0</span>             <span class="o">=</span> <span class="mh">0x000000002a4a0000</span>
<span class="n">x1</span>             <span class="o">=</span> <span class="mh">0x0000000000000001</span>
<span class="n">x2</span>             <span class="o">=</span> <span class="mh">0x0000000000000002</span>
<span class="n">x3</span>             <span class="o">=</span> <span class="mh">0x0000000000000003</span>
<span class="n">x4</span>             <span class="o">=</span> <span class="mh">0x0000000000000004</span>
<span class="n">x5</span>             <span class="o">=</span> <span class="mh">0x0000000000000005</span>
<span class="n">x6</span>             <span class="o">=</span> <span class="mh">0x0000000000000006</span>
<span class="n">x7</span>             <span class="o">=</span> <span class="mh">0x0000000000000007</span>
<span class="n">x8</span>             <span class="o">=</span> <span class="mh">0x0000000000000008</span>
<span class="n">x9</span>             <span class="o">=</span> <span class="mh">0x0000000000000009</span>
<span class="n">x10</span>            <span class="o">=</span> <span class="mh">0x0000000000000010</span>
<span class="n">x11</span>            <span class="o">=</span> <span class="mh">0x0000000000000011</span>
<span class="n">x12</span>            <span class="o">=</span> <span class="mh">0x0000000000000012</span>
<span class="n">x13</span>            <span class="o">=</span> <span class="mh">0x0000000000000013</span>
<span class="n">x14</span>            <span class="o">=</span> <span class="mh">0x0000000000000014</span>
<span class="n">x15</span>            <span class="o">=</span> <span class="mh">0x0000000000000015</span>
<span class="n">x16</span>            <span class="o">=</span> <span class="mh">0x0000000000000016</span>
<span class="n">x17</span>            <span class="o">=</span> <span class="mh">0x0000000000000017</span>
<span class="n">x18</span>            <span class="o">=</span> <span class="mh">0x0000000000000018</span>
<span class="n">x19</span>            <span class="o">=</span> <span class="mh">0x0000000000000019</span>
<span class="n">x20</span>            <span class="o">=</span> <span class="mh">0x0000000000000020</span>
<span class="n">x21</span>            <span class="o">=</span> <span class="mh">0x0000000000000021</span>
<span class="n">x22</span>            <span class="o">=</span> <span class="mh">0x0000000000000022</span>
<span class="n">x23</span>            <span class="o">=</span> <span class="mh">0x0000000000000023</span>
<span class="n">x24</span>            <span class="o">=</span> <span class="mh">0x0000000000000024</span>
<span class="n">x25</span>            <span class="o">=</span> <span class="mh">0x0000000000000025</span>
<span class="n">x26</span>            <span class="o">=</span> <span class="mh">0x0000000000000026</span>
<span class="n">x27</span>            <span class="o">=</span> <span class="mh">0x0000000000000027</span>
<span class="n">x28</span>            <span class="o">=</span> <span class="mh">0x0000000000000028</span>
<span class="n">x29</span>            <span class="o">=</span> <span class="mh">0x0000000000000029</span>
<span class="n">x30</span>            <span class="o">=</span> <span class="mh">0x0000000088000b78</span>
<span class="n">scr_el3</span>        <span class="o">=</span> <span class="mh">0x000000000003073d</span>
<span class="n">sctlr_el3</span>      <span class="o">=</span> <span class="mh">0x00000000b0cd183f</span>
<span class="n">cptr_el3</span>       <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">tcr_el3</span>        <span class="o">=</span> <span class="mh">0x000000008080351c</span>
<span class="n">daif</span>           <span class="o">=</span> <span class="mh">0x00000000000002c0</span>
<span class="n">mair_el3</span>       <span class="o">=</span> <span class="mh">0x00000000004404ff</span>
<span class="n">spsr_el3</span>       <span class="o">=</span> <span class="mh">0x0000000060000349</span>
<span class="n">elr_el3</span>        <span class="o">=</span> <span class="mh">0x0000000088000114</span>
<span class="n">ttbr0_el3</span>      <span class="o">=</span> <span class="mh">0x0000000004018201</span>
<span class="n">esr_el3</span>        <span class="o">=</span> <span class="mh">0x00000000be000000</span>
<span class="n">far_el3</span>        <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">spsr_el1</span>       <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">elr_el1</span>        <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">spsr_abt</span>       <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">spsr_und</span>       <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">spsr_irq</span>       <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">spsr_fiq</span>       <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">sctlr_el1</span>      <span class="o">=</span> <span class="mh">0x0000000030d00800</span>
<span class="n">actlr_el1</span>      <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">cpacr_el1</span>      <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">csselr_el1</span>     <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">sp_el1</span>         <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">esr_el1</span>        <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">ttbr0_el1</span>      <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">ttbr1_el1</span>      <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">mair_el1</span>       <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">amair_el1</span>      <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">tcr_el1</span>        <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">tpidr_el1</span>      <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">tpidr_el0</span>      <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">tpidrro_el0</span>    <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">par_el1</span>        <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">mpidr_el1</span>      <span class="o">=</span> <span class="mh">0x0000000080000000</span>
<span class="n">afsr0_el1</span>      <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">afsr1_el1</span>      <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">contextidr_el1</span> <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">vbar_el1</span>       <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">cntp_ctl_el0</span>   <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">cntp_cval_el0</span>  <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">cntv_ctl_el0</span>   <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">cntv_cval_el0</span>  <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">cntkctl_el1</span>    <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">sp_el0</span>         <span class="o">=</span> <span class="mh">0x0000000004014940</span>
<span class="n">isr_el1</span>        <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">dacr32_el2</span>     <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">ifsr32_el2</span>     <span class="o">=</span> <span class="mh">0x0000000000000000</span>
<span class="n">icc_hppir0_el1</span> <span class="o">=</span> <span class="mh">0x00000000000003ff</span>
<span class="n">icc_hppir1_el1</span> <span class="o">=</span> <span class="mh">0x00000000000003ff</span>
<span class="n">icc_ctlr_el3</span>   <span class="o">=</span> <span class="mh">0x0000000000080400</span>
<span class="n">gicd_ispendr</span> <span class="n">regs</span> <span class="p">(</span><span class="n">Offsets</span> <span class="mh">0x200</span><span class="o">-</span><span class="mh">0x278</span><span class="p">)</span>
<span class="n">Offset</span>                  <span class="n">Value</span>
<span class="mh">0x200</span><span class="p">:</span>           <span class="mh">0x0000000000000000</span>
<span class="mh">0x208</span><span class="p">:</span>           <span class="mh">0x0000000000000000</span>
<span class="mh">0x210</span><span class="p">:</span>           <span class="mh">0x0000000000000000</span>
<span class="mh">0x218</span><span class="p">:</span>           <span class="mh">0x0000000000000000</span>
<span class="mh">0x220</span><span class="p">:</span>           <span class="mh">0x0000000000000000</span>
<span class="mh">0x228</span><span class="p">:</span>           <span class="mh">0x0000000000000000</span>
<span class="mh">0x230</span><span class="p">:</span>           <span class="mh">0x0000000000000000</span>
<span class="mh">0x238</span><span class="p">:</span>           <span class="mh">0x0000000000000000</span>
<span class="mh">0x240</span><span class="p">:</span>           <span class="mh">0x0000000000000000</span>
<span class="mh">0x248</span><span class="p">:</span>           <span class="mh">0x0000000000000000</span>
<span class="mh">0x250</span><span class="p">:</span>           <span class="mh">0x0000000000000000</span>
<span class="mh">0x258</span><span class="p">:</span>           <span class="mh">0x0000000000000000</span>
<span class="mh">0x260</span><span class="p">:</span>           <span class="mh">0x0000000000000000</span>
<span class="mh">0x268</span><span class="p">:</span>           <span class="mh">0x0000000000000000</span>
<span class="mh">0x270</span><span class="p">:</span>           <span class="mh">0x0000000000000000</span>
<span class="mh">0x278</span><span class="p">:</span>           <span class="mh">0x0000000000000000</span>
</pre></div>
</div>
</div>
<div class="section" id="guidelines-for-reset-handlers">
<h2><span class="section-number">4.7. </span>Guidelines for Reset Handlers<a class="headerlink" href="#guidelines-for-reset-handlers" title="Permalink to this headline">¶</a></h2>
<p>TF-A implements a framework that allows CPU and platform ports to perform
actions very early after a CPU is released from reset in both the cold and warm
boot paths. This is done by calling the <code class="docutils literal notranslate"><span class="pre">reset_handler()</span></code> function in both
the BL1 and BL31 images. It in turn calls the platform and CPU specific reset
handling functions.</p>
<p>Details for implementing a CPU specific reset handler can be found in
Section 8. Details for implementing a platform specific reset handler can be
found in the <a class="reference internal" href="../getting_started/porting-guide.html#porting-guide"><span class="std std-ref">Porting Guide</span></a> (see the <code class="docutils literal notranslate"><span class="pre">plat_reset_handler()</span></code> function).</p>
<p>When adding functionality to a reset handler, keep in mind that if a different
reset handling behavior is required between the first and the subsequent
invocations of the reset handling code, this should be detected at runtime.
In other words, the reset handler should be able to detect whether an action has
already been performed and act as appropriate. Possible courses of actions are,
e.g. skip the action the second time, or undo/redo it.</p>
</div>
<div class="section" id="configuring-secure-interrupts">
<span id="id7"></span><h2><span class="section-number">4.8. </span>Configuring secure interrupts<a class="headerlink" href="#configuring-secure-interrupts" title="Permalink to this headline">¶</a></h2>
<p>The GIC driver is responsible for performing initial configuration of secure
interrupts on the platform. To this end, the platform is expected to provide the
GIC driver (either GICv2 or GICv3, as selected by the platform) with the
interrupt configuration during the driver initialisation.</p>
<p>Secure interrupt configuration are specified in an array of secure interrupt
properties. In this scheme, in both GICv2 and GICv3 driver data structures, the
<code class="docutils literal notranslate"><span class="pre">interrupt_props</span></code> member points to an array of interrupt properties. Each
element of the array specifies the interrupt number and its attributes
(priority, group, configuration). Each element of the array shall be populated
by the macro <code class="docutils literal notranslate"><span class="pre">INTR_PROP_DESC()</span></code>. The macro takes the following arguments:</p>
<ul class="simple">
<li><p>10-bit interrupt number,</p></li>
<li><p>8-bit interrupt priority,</p></li>
<li><p>Interrupt type (one of <code class="docutils literal notranslate"><span class="pre">INTR_TYPE_EL3</span></code>, <code class="docutils literal notranslate"><span class="pre">INTR_TYPE_S_EL1</span></code>,
<code class="docutils literal notranslate"><span class="pre">INTR_TYPE_NS</span></code>),</p></li>
<li><p>Interrupt configuration (either <code class="docutils literal notranslate"><span class="pre">GIC_INTR_CFG_LEVEL</span></code> or
<code class="docutils literal notranslate"><span class="pre">GIC_INTR_CFG_EDGE</span></code>).</p></li>
</ul>
</div>
<div class="section" id="cpu-specific-operations-framework">
<span id="firmware-design-cpu-ops-fwk"></span><h2><span class="section-number">4.9. </span>CPU specific operations framework<a class="headerlink" href="#cpu-specific-operations-framework" title="Permalink to this headline">¶</a></h2>
<p>Certain aspects of the Armv8-A architecture are implementation defined,
that is, certain behaviours are not architecturally defined, but must be
defined and documented by individual processor implementations. TF-A
implements a framework which categorises the common implementation defined
behaviours and allows a processor to export its implementation of that
behaviour. The categories are:</p>
<ol class="arabic simple">
<li><p>Processor specific reset sequence.</p></li>
<li><p>Processor specific power down sequences.</p></li>
<li><p>Processor specific register dumping as a part of crash reporting.</p></li>
<li><p>Errata status reporting.</p></li>
</ol>
<p>Each of the above categories fulfils a different requirement.</p>
<ol class="arabic simple">
<li><p>allows any processor specific initialization before the caches and MMU
are turned on, like implementation of errata workarounds, entry into
the intra-cluster coherency domain etc.</p></li>
<li><p>allows each processor to implement the power down sequence mandated in
its Technical Reference Manual (TRM).</p></li>
<li><p>allows a processor to provide additional information to the developer
in the event of a crash, for example Cortex-A53 has registers which
can expose the data cache contents.</p></li>
<li><p>allows a processor to define a function that inspects and reports the status
of all errata workarounds on that processor.</p></li>
</ol>
<p>Please note that only 2. is mandated by the TRM.</p>
<p>The CPU specific operations framework scales to accommodate a large number of
different CPUs during power down and reset handling. The platform can specify
any CPU optimization it wants to enable for each CPU. It can also specify
the CPU errata workarounds to be applied for each CPU type during reset
handling by defining CPU errata compile time macros. Details on these macros
can be found in the <a class="reference internal" href="cpu-specific-build-macros.html#arm-cpu-specific-build-macros"><span class="std std-ref">Arm CPU Specific Build Macros</span></a> document.</p>
<p>The CPU specific operations framework depends on the <code class="docutils literal notranslate"><span class="pre">cpu_ops</span></code> structure which
needs to be exported for each type of CPU in the platform. It is defined in
<code class="docutils literal notranslate"><span class="pre">include/lib/cpus/aarch64/cpu_macros.S</span></code> and has the following fields : <code class="docutils literal notranslate"><span class="pre">midr</span></code>,
<code class="docutils literal notranslate"><span class="pre">reset_func()</span></code>, <code class="docutils literal notranslate"><span class="pre">cpu_pwr_down_ops</span></code> (array of power down functions) and
<code class="docutils literal notranslate"><span class="pre">cpu_reg_dump()</span></code>.</p>
<p>The CPU specific files in <code class="docutils literal notranslate"><span class="pre">lib/cpus</span></code> export a <code class="docutils literal notranslate"><span class="pre">cpu_ops</span></code> data structure with
suitable handlers for that CPU. For example, <code class="docutils literal notranslate"><span class="pre">lib/cpus/aarch64/cortex_a53.S</span></code>
exports the <code class="docutils literal notranslate"><span class="pre">cpu_ops</span></code> for Cortex-A53 CPU. According to the platform
configuration, these CPU specific files must be included in the build by
the platform makefile. The generic CPU specific operations framework code exists
in <code class="docutils literal notranslate"><span class="pre">lib/cpus/aarch64/cpu_helpers.S</span></code>.</p>
<div class="section" id="cpu-specific-reset-handling">
<h3><span class="section-number">4.9.1. </span>CPU specific Reset Handling<a class="headerlink" href="#cpu-specific-reset-handling" title="Permalink to this headline">¶</a></h3>
<p>After a reset, the state of the CPU when it calls generic reset handler is:
MMU turned off, both instruction and data caches turned off and not part
of any coherency domain.</p>
<p>The BL entrypoint code first invokes the <code class="docutils literal notranslate"><span class="pre">plat_reset_handler()</span></code> to allow
the platform to perform any system initialization required and any system
errata workarounds that needs to be applied. The <code class="docutils literal notranslate"><span class="pre">get_cpu_ops_ptr()</span></code> reads
the current CPU midr, finds the matching <code class="docutils literal notranslate"><span class="pre">cpu_ops</span></code> entry in the <code class="docutils literal notranslate"><span class="pre">cpu_ops</span></code>
array and returns it. Note that only the part number and implementer fields
in midr are used to find the matching <code class="docutils literal notranslate"><span class="pre">cpu_ops</span></code> entry. The <code class="docutils literal notranslate"><span class="pre">reset_func()</span></code> in
the returned <code class="docutils literal notranslate"><span class="pre">cpu_ops</span></code> is then invoked which executes the required reset
handling for that CPU and also any errata workarounds enabled by the platform.
This function must preserve the values of general purpose registers x20 to x29.</p>
<p>Refer to Section “Guidelines for Reset Handlers” for general guidelines
regarding placement of code in a reset handler.</p>
</div>
<div class="section" id="cpu-specific-power-down-sequence">
<h3><span class="section-number">4.9.2. </span>CPU specific power down sequence<a class="headerlink" href="#cpu-specific-power-down-sequence" title="Permalink to this headline">¶</a></h3>
<p>During the BL31 initialization sequence, the pointer to the matching <code class="docutils literal notranslate"><span class="pre">cpu_ops</span></code>
entry is stored in per-CPU data by <code class="docutils literal notranslate"><span class="pre">init_cpu_ops()</span></code> so that it can be quickly
retrieved during power down sequences.</p>
<p>Various CPU drivers register handlers to perform power down at certain power
levels for that specific CPU. The PSCI service, upon receiving a power down
request, determines the highest power level at which to execute power down
sequence for a particular CPU. It uses the <code class="docutils literal notranslate"><span class="pre">prepare_cpu_pwr_dwn()</span></code> function to
pick the right power down handler for the requested level. The function
retrieves <code class="docutils literal notranslate"><span class="pre">cpu_ops</span></code> pointer member of per-CPU data, and from that, further
retrieves <code class="docutils literal notranslate"><span class="pre">cpu_pwr_down_ops</span></code> array, and indexes into the required level. If the
requested power level is higher than what a CPU driver supports, the handler
registered for highest level is invoked.</p>
<p>At runtime the platform hooks for power down are invoked by the PSCI service to
perform platform specific operations during a power down sequence, for example
turning off CCI coherency during a cluster power down.</p>
</div>
<div class="section" id="cpu-specific-register-reporting-during-crash">
<h3><span class="section-number">4.9.3. </span>CPU specific register reporting during crash<a class="headerlink" href="#cpu-specific-register-reporting-during-crash" title="Permalink to this headline">¶</a></h3>
<p>If the crash reporting is enabled in BL31, when a crash occurs, the crash
reporting framework calls <code class="docutils literal notranslate"><span class="pre">do_cpu_reg_dump</span></code> which retrieves the matching
<code class="docutils literal notranslate"><span class="pre">cpu_ops</span></code> using <code class="docutils literal notranslate"><span class="pre">get_cpu_ops_ptr()</span></code> function. The <code class="docutils literal notranslate"><span class="pre">cpu_reg_dump()</span></code> in
<code class="docutils literal notranslate"><span class="pre">cpu_ops</span></code> is invoked, which then returns the CPU specific register values to
be reported and a pointer to the ASCII list of register names in a format
expected by the crash reporting framework.</p>
</div>
<div class="section" id="cpu-errata-status-reporting">
<span id="firmware-design-cpu-errata-reporting"></span><h3><span class="section-number">4.9.4. </span>CPU errata status reporting<a class="headerlink" href="#cpu-errata-status-reporting" title="Permalink to this headline">¶</a></h3>
<p>Errata workarounds for CPUs supported in TF-A are applied during both cold and
warm boots, shortly after reset. Individual Errata workarounds are enabled as
build options. Some errata workarounds have potential run-time implications;
therefore some are enabled by default, others not. Platform ports shall
override build options to enable or disable errata as appropriate. The CPU
drivers take care of applying errata workarounds that are enabled and applicable
to a given CPU. Refer to <a class="reference internal" href="cpu-specific-build-macros.html#arm-cpu-macros-errata-workarounds"><span class="std std-ref">CPU Errata Workarounds</span></a> for more
information.</p>
<p>Functions in CPU drivers that apply errata workaround must follow the
conventions listed below.</p>
<p>The errata workaround must be authored as two separate functions:</p>
<ul class="simple">
<li><p>One that checks for errata. This function must determine whether that errata
applies to the current CPU. Typically this involves matching the current
CPUs revision and variant against a value that’s known to be affected by the
errata. If the function determines that the errata applies to this CPU, it
must return <code class="docutils literal notranslate"><span class="pre">ERRATA_APPLIES</span></code>; otherwise, it must return
<code class="docutils literal notranslate"><span class="pre">ERRATA_NOT_APPLIES</span></code>. The utility functions <code class="docutils literal notranslate"><span class="pre">cpu_get_rev_var</span></code> and
<code class="docutils literal notranslate"><span class="pre">cpu_rev_var_ls</span></code> functions may come in handy for this purpose.</p></li>
</ul>
<p>For an errata identified as <code class="docutils literal notranslate"><span class="pre">E</span></code>, the check function must be named
<code class="docutils literal notranslate"><span class="pre">check_errata_E</span></code>.</p>
<p>This function will be invoked at different times, both from assembly and from
C run time. Therefore it must follow AAPCS, and must not use stack.</p>
<ul class="simple">
<li><p>Another one that applies the errata workaround. This function would call the
check function described above, and applies errata workaround if required.</p></li>
</ul>
<p>CPU drivers that apply errata workaround can optionally implement an assembly
function that report the status of errata workarounds pertaining to that CPU.
For a driver that registers the CPU, for example, <code class="docutils literal notranslate"><span class="pre">cpux</span></code> via <code class="docutils literal notranslate"><span class="pre">declare_cpu_ops</span></code>
macro, the errata reporting function, if it exists, must be named
<code class="docutils literal notranslate"><span class="pre">cpux_errata_report</span></code>. This function will always be called with MMU enabled; it
must follow AAPCS and may use stack.</p>
<p>In a debug build of TF-A, on a CPU that comes out of reset, both BL1 and the
runtime firmware (BL31 in AArch64, and BL32 in AArch32) will invoke errata
status reporting function, if one exists, for that type of CPU.</p>
<p>To report the status of each errata workaround, the function shall use the
assembler macro <code class="docutils literal notranslate"><span class="pre">report_errata</span></code>, passing it:</p>
<ul class="simple">
<li><p>The build option that enables the errata;</p></li>
<li><p>The name of the CPU: this must be the same identifier that CPU driver
registered itself with, using <code class="docutils literal notranslate"><span class="pre">declare_cpu_ops</span></code>;</p></li>
<li><p>And the errata identifier: the identifier must match what’s used in the
errata’s check function described above.</p></li>
</ul>
<p>The errata status reporting function will be called once per CPU type/errata
combination during the software’s active life time.</p>
<p>It’s expected that whenever an errata workaround is submitted to TF-A, the
errata reporting function is appropriately extended to report its status as
well.</p>
<p>Reporting the status of errata workaround is for informational purpose only; it
has no functional significance.</p>
</div>
</div>
<div class="section" id="memory-layout-of-bl-images">
<h2><span class="section-number">4.10. </span>Memory layout of BL images<a class="headerlink" href="#memory-layout-of-bl-images" title="Permalink to this headline">¶</a></h2>
<p>Each bootloader image can be divided in 2 parts:</p>
<ul class="simple">
<li><p>the static contents of the image. These are data actually stored in the
binary on the disk. In the ELF terminology, they are called <code class="docutils literal notranslate"><span class="pre">PROGBITS</span></code>
sections;</p></li>
<li><p>the run-time contents of the image. These are data that don’t occupy any
space in the binary on the disk. The ELF binary just contains some
metadata indicating where these data will be stored at run-time and the
corresponding sections need to be allocated and initialized at run-time.
In the ELF terminology, they are called <code class="docutils literal notranslate"><span class="pre">NOBITS</span></code> sections.</p></li>
</ul>
<p>All PROGBITS sections are grouped together at the beginning of the image,
followed by all NOBITS sections. This is true for all TF-A images and it is
governed by the linker scripts. This ensures that the raw binary images are
as small as possible. If a NOBITS section was inserted in between PROGBITS
sections then the resulting binary file would contain zero bytes in place of
this NOBITS section, making the image unnecessarily bigger. Smaller images
allow faster loading from the FIP to the main memory.</p>
<p>For BL31, a platform can specify an alternate location for NOBITS sections
(other than immediately following PROGBITS sections) by setting
<code class="docutils literal notranslate"><span class="pre">SEPARATE_NOBITS_REGION</span></code> to 1 and defining <code class="docutils literal notranslate"><span class="pre">BL31_NOBITS_BASE</span></code> and
<code class="docutils literal notranslate"><span class="pre">BL31_NOBITS_LIMIT</span></code>.</p>
<div class="section" id="linker-scripts-and-symbols">
<h3><span class="section-number">4.10.1. </span>Linker scripts and symbols<a class="headerlink" href="#linker-scripts-and-symbols" title="Permalink to this headline">¶</a></h3>
<p>Each bootloader stage image layout is described by its own linker script. The
linker scripts export some symbols into the program symbol table. Their values
correspond to particular addresses. TF-A code can refer to these symbols to
figure out the image memory layout.</p>
<p>Linker symbols follow the following naming convention in TF-A.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">__&lt;SECTION&gt;_START__</span></code></p>
<p>Start address of a given section named <code class="docutils literal notranslate"><span class="pre">&lt;SECTION&gt;</span></code>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">__&lt;SECTION&gt;_END__</span></code></p>
<p>End address of a given section named <code class="docutils literal notranslate"><span class="pre">&lt;SECTION&gt;</span></code>. If there is an alignment
constraint on the section’s end address then <code class="docutils literal notranslate"><span class="pre">__&lt;SECTION&gt;_END__</span></code> corresponds
to the end address of the section’s actual contents, rounded up to the right
boundary. Refer to the value of <code class="docutils literal notranslate"><span class="pre">__&lt;SECTION&gt;_UNALIGNED_END__</span></code> to know the
actual end address of the section’s contents.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">__&lt;SECTION&gt;_UNALIGNED_END__</span></code></p>
<p>End address of a given section named <code class="docutils literal notranslate"><span class="pre">&lt;SECTION&gt;</span></code> without any padding or
rounding up due to some alignment constraint.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">__&lt;SECTION&gt;_SIZE__</span></code></p>
<p>Size (in bytes) of a given section named <code class="docutils literal notranslate"><span class="pre">&lt;SECTION&gt;</span></code>. If there is an
alignment constraint on the section’s end address then <code class="docutils literal notranslate"><span class="pre">__&lt;SECTION&gt;_SIZE__</span></code>
corresponds to the size of the section’s actual contents, rounded up to the
right boundary. In other words, <code class="docutils literal notranslate"><span class="pre">__&lt;SECTION&gt;_SIZE__</span> <span class="pre">=</span> <span class="pre">__&lt;SECTION&gt;_END__</span> <span class="pre">-</span> <span class="pre">_&lt;SECTION&gt;_START__</span></code>. Refer to the value of <code class="docutils literal notranslate"><span class="pre">__&lt;SECTION&gt;_UNALIGNED_SIZE__</span></code>
to know the actual size of the section’s contents.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">__&lt;SECTION&gt;_UNALIGNED_SIZE__</span></code></p>
<p>Size (in bytes) of a given section named <code class="docutils literal notranslate"><span class="pre">&lt;SECTION&gt;</span></code> without any padding or
rounding up due to some alignment constraint. In other words,
<code class="docutils literal notranslate"><span class="pre">__&lt;SECTION&gt;_UNALIGNED_SIZE__</span> <span class="pre">=</span> <span class="pre">__&lt;SECTION&gt;_UNALIGNED_END__</span> <span class="pre">-</span> <span class="pre">__&lt;SECTION&gt;_START__</span></code>.</p>
</li>
</ul>
<p>Some of the linker symbols are mandatory as TF-A code relies on them to be
defined. They are listed in the following subsections. Some of them must be
provided for each bootloader stage and some are specific to a given bootloader
stage.</p>
<p>The linker scripts define some extra, optional symbols. They are not actually
used by any code but they help in understanding the bootloader images’ memory
layout as they are easy to spot in the link map files.</p>
<div class="section" id="common-linker-symbols">
<h4><span class="section-number">4.10.1.1. </span>Common linker symbols<a class="headerlink" href="#common-linker-symbols" title="Permalink to this headline">¶</a></h4>
<p>All BL images share the following requirements:</p>
<ul class="simple">
<li><p>The BSS section must be zero-initialised before executing any C code.</p></li>
<li><p>The coherent memory section (if enabled) must be zero-initialised as well.</p></li>
<li><p>The MMU setup code needs to know the extents of the coherent and read-only
memory regions to set the right memory attributes. When
<code class="docutils literal notranslate"><span class="pre">SEPARATE_CODE_AND_RODATA=1</span></code>, it needs to know more specifically how the
read-only memory region is divided between code and data.</p></li>
</ul>
<p>The following linker symbols are defined for this purpose:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">__BSS_START__</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__BSS_SIZE__</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__COHERENT_RAM_START__</span></code> Must be aligned on a page-size boundary.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__COHERENT_RAM_END__</span></code> Must be aligned on a page-size boundary.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__COHERENT_RAM_UNALIGNED_SIZE__</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__RO_START__</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__RO_END__</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__TEXT_START__</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__TEXT_END__</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__RODATA_START__</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__RODATA_END__</span></code></p></li>
</ul>
</div>
<div class="section" id="bl1-s-linker-symbols">
<h4><span class="section-number">4.10.1.2. </span>BL1’s linker symbols<a class="headerlink" href="#bl1-s-linker-symbols" title="Permalink to this headline">¶</a></h4>
<p>BL1 being the ROM image, it has additional requirements. BL1 resides in ROM and
it is entirely executed in place but it needs some read-write memory for its
mutable data. Its <code class="docutils literal notranslate"><span class="pre">.data</span></code> section (i.e. its allocated read-write data) must be
relocated from ROM to RAM before executing any C code.</p>
<p>The following additional linker symbols are defined for BL1:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">__BL1_ROM_END__</span></code> End address of BL1’s ROM contents, covering its code
and <code class="docutils literal notranslate"><span class="pre">.data</span></code> section in ROM.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__DATA_ROM_START__</span></code> Start address of the <code class="docutils literal notranslate"><span class="pre">.data</span></code> section in ROM. Must be
aligned on a 16-byte boundary.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__DATA_RAM_START__</span></code> Address in RAM where the <code class="docutils literal notranslate"><span class="pre">.data</span></code> section should be
copied over. Must be aligned on a 16-byte boundary.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__DATA_SIZE__</span></code> Size of the <code class="docutils literal notranslate"><span class="pre">.data</span></code> section (in ROM or RAM).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__BL1_RAM_START__</span></code> Start address of BL1 read-write data.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__BL1_RAM_END__</span></code> End address of BL1 read-write data.</p></li>
</ul>
</div>
</div>
<div class="section" id="how-to-choose-the-right-base-addresses-for-each-bootloader-stage-image">
<h3><span class="section-number">4.10.2. </span>How to choose the right base addresses for each bootloader stage image<a class="headerlink" href="#how-to-choose-the-right-base-addresses-for-each-bootloader-stage-image" title="Permalink to this headline">¶</a></h3>
<p>There is currently no support for dynamic image loading in TF-A. This means
that all bootloader images need to be linked against their ultimate runtime
locations and the base addresses of each image must be chosen carefully such
that images don’t overlap each other in an undesired way. As the code grows,
the base addresses might need adjustments to cope with the new memory layout.</p>
<p>The memory layout is completely specific to the platform and so there is no
general recipe for choosing the right base addresses for each bootloader image.
However, there are tools to aid in understanding the memory layout. These are
the link map files: <code class="docutils literal notranslate"><span class="pre">build/&lt;platform&gt;/&lt;build-type&gt;/bl&lt;x&gt;/bl&lt;x&gt;.map</span></code>, with <code class="docutils literal notranslate"><span class="pre">&lt;x&gt;</span></code>
being the stage bootloader. They provide a detailed view of the memory usage of
each image. Among other useful information, they provide the end address of
each image.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bl1.map</span></code> link map file provides <code class="docutils literal notranslate"><span class="pre">__BL1_RAM_END__</span></code> address.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bl2.map</span></code> link map file provides <code class="docutils literal notranslate"><span class="pre">__BL2_END__</span></code> address.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bl31.map</span></code> link map file provides <code class="docutils literal notranslate"><span class="pre">__BL31_END__</span></code> address.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bl32.map</span></code> link map file provides <code class="docutils literal notranslate"><span class="pre">__BL32_END__</span></code> address.</p></li>
</ul>
<p>For each bootloader image, the platform code must provide its start address
as well as a limit address that it must not overstep. The latter is used in the
linker scripts to check that the image doesn’t grow past that address. If that
happens, the linker will issue a message similar to the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">aarch64</span><span class="o">-</span><span class="n">none</span><span class="o">-</span><span class="n">elf</span><span class="o">-</span><span class="n">ld</span><span class="p">:</span> <span class="n">BLx</span> <span class="n">has</span> <span class="n">exceeded</span> <span class="n">its</span> <span class="n">limit</span><span class="o">.</span>
</pre></div>
</div>
<p>Additionally, if the platform memory layout implies some image overlaying like
on FVP, BL31 and TSP need to know the limit address that their PROGBITS
sections must not overstep. The platform code must provide those.</p>
<p>TF-A does not provide any mechanism to verify at boot time that the memory
to load a new image is free to prevent overwriting a previously loaded image.
The platform must specify the memory available in the system for all the
relevant BL images to be loaded.</p>
<p>For example, in the case of BL1 loading BL2, <code class="docutils literal notranslate"><span class="pre">bl1_plat_sec_mem_layout()</span></code> will
return the region defined by the platform where BL1 intends to load BL2. The
<code class="docutils literal notranslate"><span class="pre">load_image()</span></code> function performs bounds check for the image size based on the
base and maximum image size provided by the platforms. Platforms must take
this behaviour into account when defining the base/size for each of the images.</p>
<div class="section" id="memory-layout-on-arm-development-platforms">
<h4><span class="section-number">4.10.2.1. </span>Memory layout on Arm development platforms<a class="headerlink" href="#memory-layout-on-arm-development-platforms" title="Permalink to this headline">¶</a></h4>
<p>The following list describes the memory layout on the Arm development platforms:</p>
<ul>
<li><p>A 4KB page of shared memory is used for communication between Trusted
Firmware and the platform’s power controller. This is located at the base of
Trusted SRAM. The amount of Trusted SRAM available to load the bootloader
images is reduced by the size of the shared memory.</p>
<p>The shared memory is used to store the CPUs’ entrypoint mailbox. On Juno,
this is also used for the MHU payload when passing messages to and from the
SCP.</p>
</li>
<li><p>Another 4 KB page is reserved for passing memory layout between BL1 and BL2
and also the dynamic firmware configurations.</p></li>
<li><p>On FVP, BL1 is originally sitting in the Trusted ROM at address <code class="docutils literal notranslate"><span class="pre">0x0</span></code>. On
Juno, BL1 resides in flash memory at address <code class="docutils literal notranslate"><span class="pre">0x0BEC0000</span></code>. BL1 read-write
data are relocated to the top of Trusted SRAM at runtime.</p></li>
<li><p>BL2 is loaded below BL1 RW</p></li>
<li><p>EL3 Runtime Software, BL31 for AArch64 and BL32 for AArch32 (e.g. SP_MIN),
is loaded at the top of the Trusted SRAM, such that its NOBITS sections will
overwrite BL1 R/W data and BL2. This implies that BL1 global variables
remain valid only until execution reaches the EL3 Runtime Software entry
point during a cold boot.</p></li>
<li><p>On Juno, SCP_BL2 is loaded temporarily into the EL3 Runtime Software memory
region and transferred to the SCP before being overwritten by EL3 Runtime
Software.</p></li>
<li><p>BL32 (for AArch64) can be loaded in one of the following locations:</p>
<ul class="simple">
<li><p>Trusted SRAM</p></li>
<li><p>Trusted DRAM (FVP only)</p></li>
<li><p>Secure region of DRAM (top 16MB of DRAM configured by the TrustZone
controller)</p></li>
</ul>
<p>When BL32 (for AArch64) is loaded into Trusted SRAM, it is loaded below
BL31.</p>
</li>
</ul>
<p>The location of the BL32 image will result in different memory maps. This is
illustrated for both FVP and Juno in the following diagrams, using the TSP as
an example.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Loading the BL32 image in TZC secured DRAM doesn’t change the memory
layout of the other images in Trusted SRAM.</p>
</div>
<p>CONFIG section in memory layouts shown below contains:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">+--------------------+</span>
<span class="o">|</span><span class="n">bl2_mem_params_descs</span><span class="o">|</span>
<span class="o">|--------------------|</span>
<span class="o">|</span>     <span class="n">fw_configs</span>     <span class="o">|</span>
<span class="o">+--------------------+</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">bl2_mem_params_descs</span></code> contains parameters passed from BL2 to next the
BL image during boot.</p>
<p><code class="docutils literal notranslate"><span class="pre">fw_configs</span></code> includes soc_fw_config, tos_fw_config, tb_fw_config and fw_config.</p>
<p><strong>FVP with TSP in Trusted SRAM with firmware configs :</strong>
(These diagrams only cover the AArch64 case)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>               <span class="n">DRAM</span>
<span class="mh">0xffffffff</span> <span class="o">+----------+</span>
           <span class="p">:</span>          <span class="p">:</span>
           <span class="o">|----------|</span>
           <span class="o">|</span><span class="n">HW_CONFIG</span> <span class="o">|</span>
<span class="mh">0x83000000</span> <span class="o">|----------|</span>  <span class="p">(</span><span class="n">non</span><span class="o">-</span><span class="n">secure</span><span class="p">)</span>
           <span class="o">|</span>          <span class="o">|</span>
<span class="mh">0x80000000</span> <span class="o">+----------+</span>

           <span class="n">Trusted</span> <span class="n">SRAM</span>
<span class="mh">0x04040000</span> <span class="o">+----------+</span>  <span class="n">loaded</span> <span class="n">by</span> <span class="n">BL2</span>  <span class="o">+----------------+</span>
           <span class="o">|</span> <span class="n">BL1</span> <span class="p">(</span><span class="n">rw</span><span class="p">)</span> <span class="o">|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|</span>                <span class="o">|</span>
           <span class="o">|----------|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|</span>  <span class="n">BL31</span> <span class="n">NOBITS</span>   <span class="o">|</span>
           <span class="o">|</span>   <span class="n">BL2</span>    <span class="o">|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|</span>                <span class="o">|</span>
           <span class="o">|----------|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|----------------|</span>
           <span class="o">|</span>          <span class="o">|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|</span> <span class="n">BL31</span> <span class="n">PROGBITS</span>  <span class="o">|</span>
           <span class="o">|</span>          <span class="o">|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|----------------|</span>
           <span class="o">|</span>          <span class="o">|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|</span>     <span class="n">BL32</span>       <span class="o">|</span>
<span class="mh">0x04003000</span> <span class="o">+----------+</span>                 <span class="o">+----------------+</span>
           <span class="o">|</span>  <span class="n">CONFIG</span>  <span class="o">|</span>
<span class="mh">0x04001000</span> <span class="o">+----------+</span>
           <span class="o">|</span>  <span class="n">Shared</span>  <span class="o">|</span>
<span class="mh">0x04000000</span> <span class="o">+----------+</span>

           <span class="n">Trusted</span> <span class="n">ROM</span>
<span class="mh">0x04000000</span> <span class="o">+----------+</span>
           <span class="o">|</span> <span class="n">BL1</span> <span class="p">(</span><span class="n">ro</span><span class="p">)</span> <span class="o">|</span>
<span class="mh">0x00000000</span> <span class="o">+----------+</span>
</pre></div>
</div>
<p><strong>FVP with TSP in Trusted DRAM with firmware configs (default option):</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                 <span class="n">DRAM</span>
<span class="mh">0xffffffff</span> <span class="o">+--------------+</span>
           <span class="p">:</span>              <span class="p">:</span>
           <span class="o">|--------------|</span>
           <span class="o">|</span>  <span class="n">HW_CONFIG</span>   <span class="o">|</span>
<span class="mh">0x83000000</span> <span class="o">|--------------|</span>  <span class="p">(</span><span class="n">non</span><span class="o">-</span><span class="n">secure</span><span class="p">)</span>
           <span class="o">|</span>              <span class="o">|</span>
<span class="mh">0x80000000</span> <span class="o">+--------------+</span>

            <span class="n">Trusted</span> <span class="n">DRAM</span>
<span class="mh">0x08000000</span> <span class="o">+--------------+</span>
           <span class="o">|</span>     <span class="n">BL32</span>     <span class="o">|</span>
<span class="mh">0x06000000</span> <span class="o">+--------------+</span>

             <span class="n">Trusted</span> <span class="n">SRAM</span>
<span class="mh">0x04040000</span> <span class="o">+--------------+</span>  <span class="n">loaded</span> <span class="n">by</span> <span class="n">BL2</span>  <span class="o">+----------------+</span>
           <span class="o">|</span>   <span class="n">BL1</span> <span class="p">(</span><span class="n">rw</span><span class="p">)</span>   <span class="o">|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|</span>                <span class="o">|</span>
           <span class="o">|--------------|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|</span>  <span class="n">BL31</span> <span class="n">NOBITS</span>   <span class="o">|</span>
           <span class="o">|</span>     <span class="n">BL2</span>      <span class="o">|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|</span>                <span class="o">|</span>
           <span class="o">|--------------|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|----------------|</span>
           <span class="o">|</span>              <span class="o">|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|</span> <span class="n">BL31</span> <span class="n">PROGBITS</span>  <span class="o">|</span>
           <span class="o">|</span>              <span class="o">|</span>                 <span class="o">+----------------+</span>
<span class="mh">0x04003000</span> <span class="o">+--------------+</span>
           <span class="o">|</span>    <span class="n">CONFIG</span>    <span class="o">|</span>
<span class="mh">0x04001000</span> <span class="o">+--------------+</span>
           <span class="o">|</span>    <span class="n">Shared</span>    <span class="o">|</span>
<span class="mh">0x04000000</span> <span class="o">+--------------+</span>

             <span class="n">Trusted</span> <span class="n">ROM</span>
<span class="mh">0x04000000</span> <span class="o">+--------------+</span>
           <span class="o">|</span>   <span class="n">BL1</span> <span class="p">(</span><span class="n">ro</span><span class="p">)</span>   <span class="o">|</span>
<span class="mh">0x00000000</span> <span class="o">+--------------+</span>
</pre></div>
</div>
<p><strong>FVP with TSP in TZC-Secured DRAM with firmware configs :</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>               <span class="n">DRAM</span>
<span class="mh">0xffffffff</span> <span class="o">+----------+</span>
           <span class="o">|</span>  <span class="n">BL32</span>    <span class="o">|</span>  <span class="p">(</span><span class="n">secure</span><span class="p">)</span>
<span class="mh">0xff000000</span> <span class="o">+----------+</span>
           <span class="o">|</span>          <span class="o">|</span>
           <span class="o">|----------|</span>
           <span class="o">|</span><span class="n">HW_CONFIG</span> <span class="o">|</span>
<span class="mh">0x83000000</span> <span class="o">|----------|</span>  <span class="p">(</span><span class="n">non</span><span class="o">-</span><span class="n">secure</span><span class="p">)</span>
           <span class="o">|</span>          <span class="o">|</span>
<span class="mh">0x80000000</span> <span class="o">+----------+</span>

           <span class="n">Trusted</span> <span class="n">SRAM</span>
<span class="mh">0x04040000</span> <span class="o">+----------+</span>  <span class="n">loaded</span> <span class="n">by</span> <span class="n">BL2</span>  <span class="o">+----------------+</span>
           <span class="o">|</span> <span class="n">BL1</span> <span class="p">(</span><span class="n">rw</span><span class="p">)</span> <span class="o">|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|</span>                <span class="o">|</span>
           <span class="o">|----------|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|</span>  <span class="n">BL31</span> <span class="n">NOBITS</span>   <span class="o">|</span>
           <span class="o">|</span>   <span class="n">BL2</span>    <span class="o">|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|</span>                <span class="o">|</span>
           <span class="o">|----------|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|----------------|</span>
           <span class="o">|</span>          <span class="o">|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|</span> <span class="n">BL31</span> <span class="n">PROGBITS</span>  <span class="o">|</span>
           <span class="o">|</span>          <span class="o">|</span>                 <span class="o">+----------------+</span>
<span class="mh">0x04003000</span> <span class="o">+----------+</span>
           <span class="o">|</span>  <span class="n">CONFIG</span>  <span class="o">|</span>
<span class="mh">0x04001000</span> <span class="o">+----------+</span>
           <span class="o">|</span>  <span class="n">Shared</span>  <span class="o">|</span>
<span class="mh">0x04000000</span> <span class="o">+----------+</span>

           <span class="n">Trusted</span> <span class="n">ROM</span>
<span class="mh">0x04000000</span> <span class="o">+----------+</span>
           <span class="o">|</span> <span class="n">BL1</span> <span class="p">(</span><span class="n">ro</span><span class="p">)</span> <span class="o">|</span>
<span class="mh">0x00000000</span> <span class="o">+----------+</span>
</pre></div>
</div>
<p><strong>Juno with BL32 in Trusted SRAM :</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>              <span class="n">Flash0</span>
<span class="mh">0x0C000000</span> <span class="o">+----------+</span>
           <span class="p">:</span>          <span class="p">:</span>
<span class="mh">0x0BED0000</span> <span class="o">|----------|</span>
           <span class="o">|</span> <span class="n">BL1</span> <span class="p">(</span><span class="n">ro</span><span class="p">)</span> <span class="o">|</span>
<span class="mh">0x0BEC0000</span> <span class="o">|----------|</span>
           <span class="p">:</span>          <span class="p">:</span>
<span class="mh">0x08000000</span> <span class="o">+----------+</span>                  <span class="n">BL31</span> <span class="ow">is</span> <span class="n">loaded</span>
                                         <span class="n">after</span> <span class="n">SCP_BL2</span> <span class="n">has</span>
           <span class="n">Trusted</span> <span class="n">SRAM</span>                  <span class="n">been</span> <span class="n">sent</span> <span class="n">to</span> <span class="n">SCP</span>
<span class="mh">0x04040000</span> <span class="o">+----------+</span>  <span class="n">loaded</span> <span class="n">by</span> <span class="n">BL2</span>  <span class="o">+----------------+</span>
           <span class="o">|</span> <span class="n">BL1</span> <span class="p">(</span><span class="n">rw</span><span class="p">)</span> <span class="o">|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|</span>                <span class="o">|</span>
           <span class="o">|----------|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|</span>  <span class="n">BL31</span> <span class="n">NOBITS</span>   <span class="o">|</span>
           <span class="o">|</span>   <span class="n">BL2</span>    <span class="o">|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|</span>                <span class="o">|</span>
           <span class="o">|----------|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|----------------|</span>
           <span class="o">|</span> <span class="n">SCP_BL2</span>  <span class="o">|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|</span> <span class="n">BL31</span> <span class="n">PROGBITS</span>  <span class="o">|</span>
           <span class="o">|</span>          <span class="o">|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|----------------|</span>
           <span class="o">|</span>          <span class="o">|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|</span>     <span class="n">BL32</span>       <span class="o">|</span>
           <span class="o">|</span>          <span class="o">|</span>                 <span class="o">+----------------+</span>
           <span class="o">|</span>          <span class="o">|</span>
<span class="mh">0x04001000</span> <span class="o">+----------+</span>
           <span class="o">|</span>   <span class="n">MHU</span>    <span class="o">|</span>
<span class="mh">0x04000000</span> <span class="o">+----------+</span>
</pre></div>
</div>
<p><strong>Juno with BL32 in TZC-secured DRAM :</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>               <span class="n">DRAM</span>
<span class="mh">0xFFE00000</span> <span class="o">+----------+</span>
           <span class="o">|</span>  <span class="n">BL32</span>    <span class="o">|</span>  <span class="p">(</span><span class="n">secure</span><span class="p">)</span>
<span class="mh">0xFF000000</span> <span class="o">|----------|</span>
           <span class="o">|</span>          <span class="o">|</span>
           <span class="p">:</span>          <span class="p">:</span>  <span class="p">(</span><span class="n">non</span><span class="o">-</span><span class="n">secure</span><span class="p">)</span>
           <span class="o">|</span>          <span class="o">|</span>
<span class="mh">0x80000000</span> <span class="o">+----------+</span>

              <span class="n">Flash0</span>
<span class="mh">0x0C000000</span> <span class="o">+----------+</span>
           <span class="p">:</span>          <span class="p">:</span>
<span class="mh">0x0BED0000</span> <span class="o">|----------|</span>
           <span class="o">|</span> <span class="n">BL1</span> <span class="p">(</span><span class="n">ro</span><span class="p">)</span> <span class="o">|</span>
<span class="mh">0x0BEC0000</span> <span class="o">|----------|</span>
           <span class="p">:</span>          <span class="p">:</span>
<span class="mh">0x08000000</span> <span class="o">+----------+</span>                  <span class="n">BL31</span> <span class="ow">is</span> <span class="n">loaded</span>
                                         <span class="n">after</span> <span class="n">SCP_BL2</span> <span class="n">has</span>
           <span class="n">Trusted</span> <span class="n">SRAM</span>                  <span class="n">been</span> <span class="n">sent</span> <span class="n">to</span> <span class="n">SCP</span>
<span class="mh">0x04040000</span> <span class="o">+----------+</span>  <span class="n">loaded</span> <span class="n">by</span> <span class="n">BL2</span>  <span class="o">+----------------+</span>
           <span class="o">|</span> <span class="n">BL1</span> <span class="p">(</span><span class="n">rw</span><span class="p">)</span> <span class="o">|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|</span>                <span class="o">|</span>
           <span class="o">|----------|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|</span>  <span class="n">BL31</span> <span class="n">NOBITS</span>   <span class="o">|</span>
           <span class="o">|</span>   <span class="n">BL2</span>    <span class="o">|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|</span>                <span class="o">|</span>
           <span class="o">|----------|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|----------------|</span>
           <span class="o">|</span> <span class="n">SCP_BL2</span>  <span class="o">|</span>  <span class="o">&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span>  <span class="o">|</span> <span class="n">BL31</span> <span class="n">PROGBITS</span>  <span class="o">|</span>
           <span class="o">|</span>          <span class="o">|</span>                 <span class="o">+----------------+</span>
<span class="mh">0x04001000</span> <span class="o">+----------+</span>
           <span class="o">|</span>   <span class="n">MHU</span>    <span class="o">|</span>
<span class="mh">0x04000000</span> <span class="o">+----------+</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="firmware-image-package-fip">
<span id="firmware-design-fip"></span><h2><span class="section-number">4.11. </span>Firmware Image Package (FIP)<a class="headerlink" href="#firmware-image-package-fip" title="Permalink to this headline">¶</a></h2>
<p>Using a Firmware Image Package (FIP) allows for packing bootloader images (and
potentially other payloads) into a single archive that can be loaded by TF-A
from non-volatile platform storage. A driver to load images from a FIP has
been added to the storage layer and allows a package to be read from supported
platform storage. A tool to create Firmware Image Packages is also provided
and described below.</p>
<div class="section" id="firmware-image-package-layout">
<h3><span class="section-number">4.11.1. </span>Firmware Image Package layout<a class="headerlink" href="#firmware-image-package-layout" title="Permalink to this headline">¶</a></h3>
<p>The FIP layout consists of a table of contents (ToC) followed by payload data.
The ToC itself has a header followed by one or more table entries. The ToC is
terminated by an end marker entry, and since the size of the ToC is 0 bytes,
the offset equals the total size of the FIP file. All ToC entries describe some
payload data that has been appended to the end of the binary package. With the
information provided in the ToC entry the corresponding payload data can be
retrieved.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">------------------</span>
<span class="o">|</span> <span class="n">ToC</span> <span class="n">Header</span>     <span class="o">|</span>
<span class="o">|----------------|</span>
<span class="o">|</span> <span class="n">ToC</span> <span class="n">Entry</span> <span class="mi">0</span>    <span class="o">|</span>
<span class="o">|----------------|</span>
<span class="o">|</span> <span class="n">ToC</span> <span class="n">Entry</span> <span class="mi">1</span>    <span class="o">|</span>
<span class="o">|----------------|</span>
<span class="o">|</span> <span class="n">ToC</span> <span class="n">End</span> <span class="n">Marker</span> <span class="o">|</span>
<span class="o">|----------------|</span>
<span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span>     <span class="n">Data</span> <span class="mi">0</span>     <span class="o">|</span>
<span class="o">|</span>                <span class="o">|</span>
<span class="o">|----------------|</span>
<span class="o">|</span>                <span class="o">|</span>
<span class="o">|</span>     <span class="n">Data</span> <span class="mi">1</span>     <span class="o">|</span>
<span class="o">|</span>                <span class="o">|</span>
<span class="o">------------------</span>
</pre></div>
</div>
<p>The ToC header and entry formats are described in the header file
<code class="docutils literal notranslate"><span class="pre">include/tools_share/firmware_image_package.h</span></code>. This file is used by both the
tool and TF-A.</p>
<p>The ToC header has the following fields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`name`: The name of the ToC. This is currently used to validate the header.
`serial_number`: A non-zero number provided by the creation tool
`flags`: Flags associated with this data.
    Bits 0-31: Reserved
    Bits 32-47: Platform defined
    Bits 48-63: Reserved
</pre></div>
</div>
<p>A ToC entry has the following fields:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>`uuid`: All files are referred to by a pre-defined Universally Unique
    IDentifier [UUID] . The UUIDs are defined in
    `include/tools_share/firmware_image_package.h`. The platform translates
    the requested image name into the corresponding UUID when accessing the
    package.
`offset_address`: The offset address at which the corresponding payload data
    can be found. The offset is calculated from the ToC base address.
`size`: The size of the corresponding payload data in bytes.
`flags`: Flags associated with this entry. None are yet defined.
</pre></div>
</div>
</div>
<div class="section" id="firmware-image-package-creation-tool">
<h3><span class="section-number">4.11.2. </span>Firmware Image Package creation tool<a class="headerlink" href="#firmware-image-package-creation-tool" title="Permalink to this headline">¶</a></h3>
<p>The FIP creation tool can be used to pack specified images into a binary
package that can be loaded by TF-A from platform storage. The tool currently
only supports packing bootloader images. Additional image definitions can be
added to the tool as required.</p>
<p>The tool can be found in <code class="docutils literal notranslate"><span class="pre">tools/fiptool</span></code>.</p>
</div>
<div class="section" id="loading-from-a-firmware-image-package-fip">
<h3><span class="section-number">4.11.3. </span>Loading from a Firmware Image Package (FIP)<a class="headerlink" href="#loading-from-a-firmware-image-package-fip" title="Permalink to this headline">¶</a></h3>
<p>The Firmware Image Package (FIP) driver can load images from a binary package on
non-volatile platform storage. For the Arm development platforms, this is
currently NOR FLASH.</p>
<p>Bootloader images are loaded according to the platform policy as specified by
the function <code class="docutils literal notranslate"><span class="pre">plat_get_image_source()</span></code>. For the Arm development platforms, this
means the platform will attempt to load images from a Firmware Image Package
located at the start of NOR FLASH0.</p>
<p>The Arm development platforms’ policy is to only allow loading of a known set of
images. The platform policy can be modified to allow additional images.</p>
</div>
</div>
<div class="section" id="use-of-coherent-memory-in-tf-a">
<h2><span class="section-number">4.12. </span>Use of coherent memory in TF-A<a class="headerlink" href="#use-of-coherent-memory-in-tf-a" title="Permalink to this headline">¶</a></h2>
<p>There might be loss of coherency when physical memory with mismatched
shareability, cacheability and memory attributes is accessed by multiple CPUs
(refer to section B2.9 of <a class="reference external" href="https://developer.arm.com/docs/ddi0487/latest">Arm ARM</a> for more details). This possibility occurs
in TF-A during power up/down sequences when coherency, MMU and caches are
turned on/off incrementally.</p>
<p>TF-A defines coherent memory as a region of memory with Device nGnRE attributes
in the translation tables. The translation granule size in TF-A is 4KB. This
is the smallest possible size of the coherent memory region.</p>
<p>By default, all data structures which are susceptible to accesses with
mismatched attributes from various CPUs are allocated in a coherent memory
region (refer to section 2.1 of <a class="reference internal" href="../getting_started/porting-guide.html#porting-guide"><span class="std std-ref">Porting Guide</span></a>). The coherent memory
region accesses are Outer Shareable, non-cacheable and they can be accessed with
the Device nGnRE attributes when the MMU is turned on. Hence, at the expense of
at least an extra page of memory, TF-A is able to work around coherency issues
due to mismatched memory attributes.</p>
<p>The alternative to the above approach is to allocate the susceptible data
structures in Normal WriteBack WriteAllocate Inner shareable memory. This
approach requires the data structures to be designed so that it is possible to
work around the issue of mismatched memory attributes by performing software
cache maintenance on them.</p>
<div class="section" id="disabling-the-use-of-coherent-memory-in-tf-a">
<h3><span class="section-number">4.12.1. </span>Disabling the use of coherent memory in TF-A<a class="headerlink" href="#disabling-the-use-of-coherent-memory-in-tf-a" title="Permalink to this headline">¶</a></h3>
<p>It might be desirable to avoid the cost of allocating coherent memory on
platforms which are memory constrained. TF-A enables inclusion of coherent
memory in firmware images through the build flag <code class="docutils literal notranslate"><span class="pre">USE_COHERENT_MEM</span></code>.
This flag is enabled by default. It can be disabled to choose the second
approach described above.</p>
<p>The below sections analyze the data structures allocated in the coherent memory
region and the changes required to allocate them in normal memory.</p>
</div>
<div class="section" id="coherent-memory-usage-in-psci-implementation">
<h3><span class="section-number">4.12.2. </span>Coherent memory usage in PSCI implementation<a class="headerlink" href="#coherent-memory-usage-in-psci-implementation" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">psci_non_cpu_pd_nodes</span></code> data structure stores the platform’s power domain
tree information for state management of power domains. By default, this data
structure is allocated in the coherent memory region in TF-A because it can be
accessed by multiple CPUs, either with caches enabled or disabled.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="nc">non_cpu_pwr_domain_node</span> <span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">     * Index of the first CPU power domain node level 0 which has this node</span>
<span class="cm">     * as its parent.</span>
<span class="cm">     */</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cpu_start_idx</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">     * Number of CPU power domains which are siblings of the domain indexed</span>
<span class="cm">     * by &#39;cpu_start_idx&#39; i.e. all the domains in the range &#39;cpu_start_idx</span>
<span class="cm">     * -&gt; cpu_start_idx + ncpus&#39; have this node as their parent.</span>
<span class="cm">     */</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ncpus</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">     * Index of the parent power domain node.</span>
<span class="cm">     */</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">parent_node</span><span class="p">;</span>

    <span class="n">plat_local_state_t</span> <span class="n">local_state</span><span class="p">;</span>

    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">level</span><span class="p">;</span>

    <span class="cm">/* For indexing the psci_lock array*/</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">lock_index</span><span class="p">;</span>
<span class="p">}</span> <span class="n">non_cpu_pd_node_t</span><span class="p">;</span>
</pre></div>
</div>
<p>In order to move this data structure to normal memory, the use of each of its
fields must be analyzed. Fields like <code class="docutils literal notranslate"><span class="pre">cpu_start_idx</span></code>, <code class="docutils literal notranslate"><span class="pre">ncpus</span></code>, <code class="docutils literal notranslate"><span class="pre">parent_node</span></code>
<code class="docutils literal notranslate"><span class="pre">level</span></code> and <code class="docutils literal notranslate"><span class="pre">lock_index</span></code> are only written once during cold boot. Hence removing
them from coherent memory involves only doing a clean and invalidate of the
cache lines after these fields are written.</p>
<p>The field <code class="docutils literal notranslate"><span class="pre">local_state</span></code> can be concurrently accessed by multiple CPUs in
different cache states. A Lamport’s Bakery lock <code class="docutils literal notranslate"><span class="pre">psci_locks</span></code> is used to ensure
mutual exclusion to this field and a clean and invalidate is needed after it
is written.</p>
</div>
<div class="section" id="bakery-lock-data">
<h3><span class="section-number">4.12.3. </span>Bakery lock data<a class="headerlink" href="#bakery-lock-data" title="Permalink to this headline">¶</a></h3>
<p>The bakery lock data structure <code class="docutils literal notranslate"><span class="pre">bakery_lock_t</span></code> is allocated in coherent memory
and is accessed by multiple CPUs with mismatched attributes. <code class="docutils literal notranslate"><span class="pre">bakery_lock_t</span></code> is
defined as follows:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="nc">bakery_lock</span> <span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">     * The lock_data is a bit-field of 2 members:</span>
<span class="cm">     * Bit[0]       : choosing. This field is set when the CPU is</span>
<span class="cm">     *                choosing its bakery number.</span>
<span class="cm">     * Bits[1 - 15] : number. This is the bakery number allocated.</span>
<span class="cm">     */</span>
    <span class="k">volatile</span> <span class="kt">uint16_t</span> <span class="n">lock_data</span><span class="p">[</span><span class="n">BAKERY_LOCK_MAX_CPUS</span><span class="p">];</span>
<span class="p">}</span> <span class="n">bakery_lock_t</span><span class="p">;</span>
</pre></div>
</div>
<p>It is a characteristic of Lamport’s Bakery algorithm that the volatile per-CPU
fields can be read by all CPUs but only written to by the owning CPU.</p>
<p>Depending upon the data cache line size, the per-CPU fields of the
<code class="docutils literal notranslate"><span class="pre">bakery_lock_t</span></code> structure for multiple CPUs may exist on a single cache line.
These per-CPU fields can be read and written during lock contention by multiple
CPUs with mismatched memory attributes. Since these fields are a part of the
lock implementation, they do not have access to any other locking primitive to
safeguard against the resulting coherency issues. As a result, simple software
cache maintenance is not enough to allocate them in coherent memory. Consider
the following example.</p>
<p>CPU0 updates its per-CPU field with data cache enabled. This write updates a
local cache line which contains a copy of the fields for other CPUs as well. Now
CPU1 updates its per-CPU field of the <code class="docutils literal notranslate"><span class="pre">bakery_lock_t</span></code> structure with data cache
disabled. CPU1 then issues a DCIVAC operation to invalidate any stale copies of
its field in any other cache line in the system. This operation will invalidate
the update made by CPU0 as well.</p>
<p>To use bakery locks when <code class="docutils literal notranslate"><span class="pre">USE_COHERENT_MEM</span></code> is disabled, the lock data structure
has been redesigned. The changes utilise the characteristic of Lamport’s Bakery
algorithm mentioned earlier. The bakery_lock structure only allocates the memory
for a single CPU. The macro <code class="docutils literal notranslate"><span class="pre">DEFINE_BAKERY_LOCK</span></code> allocates all the bakery locks
needed for a CPU into a section <code class="docutils literal notranslate"><span class="pre">bakery_lock</span></code>. The linker allocates the memory
for other cores by using the total size allocated for the bakery_lock section
and multiplying it with (PLATFORM_CORE_COUNT - 1). This enables software to
perform software cache maintenance on the lock data structure without running
into coherency issues associated with mismatched attributes.</p>
<p>The bakery lock data structure <code class="docutils literal notranslate"><span class="pre">bakery_info_t</span></code> is defined for use when
<code class="docutils literal notranslate"><span class="pre">USE_COHERENT_MEM</span></code> is disabled as follows:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="nc">bakery_info</span> <span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">     * The lock_data is a bit-field of 2 members:</span>
<span class="cm">     * Bit[0]       : choosing. This field is set when the CPU is</span>
<span class="cm">     *                choosing its bakery number.</span>
<span class="cm">     * Bits[1 - 15] : number. This is the bakery number allocated.</span>
<span class="cm">     */</span>
     <span class="k">volatile</span> <span class="kt">uint16_t</span> <span class="n">lock_data</span><span class="p">;</span>
<span class="p">}</span> <span class="n">bakery_info_t</span><span class="p">;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">bakery_info_t</span></code> represents a single per-CPU field of one lock and
the combination of corresponding <code class="docutils literal notranslate"><span class="pre">bakery_info_t</span></code> structures for all CPUs in the
system represents the complete bakery lock. The view in memory for a system
with n bakery locks are:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>bakery_lock section start
|----------------|
| `bakery_info_t`| &lt;-- Lock_0 per-CPU field
|    Lock_0      |     for CPU0
|----------------|
| `bakery_info_t`| &lt;-- Lock_1 per-CPU field
|    Lock_1      |     for CPU0
|----------------|
| ....           |
|----------------|
| `bakery_info_t`| &lt;-- Lock_N per-CPU field
|    Lock_N      |     for CPU0
------------------
|    XXXXX       |
| Padding to     |
| next Cache WB  | &lt;--- Calculate PERCPU_BAKERY_LOCK_SIZE, allocate
|  Granule       |       continuous memory for remaining CPUs.
------------------
| `bakery_info_t`| &lt;-- Lock_0 per-CPU field
|    Lock_0      |     for CPU1
|----------------|
| `bakery_info_t`| &lt;-- Lock_1 per-CPU field
|    Lock_1      |     for CPU1
|----------------|
| ....           |
|----------------|
| `bakery_info_t`| &lt;-- Lock_N per-CPU field
|    Lock_N      |     for CPU1
------------------
|    XXXXX       |
| Padding to     |
| next Cache WB  |
|  Granule       |
------------------
</pre></div>
</div>
<p>Consider a system of 2 CPUs with ‘N’ bakery locks as shown above. For an
operation on Lock_N, the corresponding <code class="docutils literal notranslate"><span class="pre">bakery_info_t</span></code> in both CPU0 and CPU1
<code class="docutils literal notranslate"><span class="pre">bakery_lock</span></code> section need to be fetched and appropriate cache operations need
to be performed for each access.</p>
<p>On Arm Platforms, bakery locks are used in psci (<code class="docutils literal notranslate"><span class="pre">psci_locks</span></code>) and power controller
driver (<code class="docutils literal notranslate"><span class="pre">arm_lock</span></code>).</p>
</div>
<div class="section" id="non-functional-impact-of-removing-coherent-memory">
<h3><span class="section-number">4.12.4. </span>Non Functional Impact of removing coherent memory<a class="headerlink" href="#non-functional-impact-of-removing-coherent-memory" title="Permalink to this headline">¶</a></h3>
<p>Removal of the coherent memory region leads to the additional software overhead
of performing cache maintenance for the affected data structures. However, since
the memory where the data structures are allocated is cacheable, the overhead is
mostly mitigated by an increase in performance.</p>
<p>There is however a performance impact for bakery locks, due to:</p>
<ul class="simple">
<li><p>Additional cache maintenance operations, and</p></li>
<li><p>Multiple cache line reads for each lock operation, since the bakery locks
for each CPU are distributed across different cache lines.</p></li>
</ul>
<p>The implementation has been optimized to minimize this additional overhead.
Measurements indicate that when bakery locks are allocated in Normal memory, the
minimum latency of acquiring a lock is on an average 3-4 micro seconds whereas
in Device memory the same is 2 micro seconds. The measurements were done on the
Juno Arm development platform.</p>
<p>As mentioned earlier, almost a page of memory can be saved by disabling
<code class="docutils literal notranslate"><span class="pre">USE_COHERENT_MEM</span></code>. Each platform needs to consider these trade-offs to decide
whether coherent memory should be used. If a platform disables
<code class="docutils literal notranslate"><span class="pre">USE_COHERENT_MEM</span></code> and needs to use bakery locks in the porting layer, it can
optionally define macro <code class="docutils literal notranslate"><span class="pre">PLAT_PERCPU_BAKERY_LOCK_SIZE</span></code> (see the
<a class="reference internal" href="../getting_started/porting-guide.html#porting-guide"><span class="std std-ref">Porting Guide</span></a>). Refer to the reference platform code for examples.</p>
</div>
</div>
<div class="section" id="isolating-code-and-read-only-data-on-separate-memory-pages">
<h2><span class="section-number">4.13. </span>Isolating code and read-only data on separate memory pages<a class="headerlink" href="#isolating-code-and-read-only-data-on-separate-memory-pages" title="Permalink to this headline">¶</a></h2>
<p>In the Armv8-A VMSA, translation table entries include fields that define the
properties of the target memory region, such as its access permissions. The
smallest unit of memory that can be addressed by a translation table entry is
a memory page. Therefore, if software needs to set different permissions on two
memory regions then it needs to map them using different memory pages.</p>
<p>The default memory layout for each BL image is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|</span>        <span class="o">...</span>        <span class="o">|</span>
<span class="o">+-------------------+</span>
<span class="o">|</span>  <span class="n">Read</span><span class="o">-</span><span class="n">write</span> <span class="n">data</span>  <span class="o">|</span>
<span class="o">+-------------------+</span> <span class="n">Page</span> <span class="n">boundary</span>
<span class="o">|</span>     <span class="o">&lt;</span><span class="n">Padding</span><span class="o">&gt;</span>     <span class="o">|</span>
<span class="o">+-------------------+</span>
<span class="o">|</span> <span class="ne">Exception</span> <span class="n">vectors</span> <span class="o">|</span>
<span class="o">+-------------------+</span> <span class="mi">2</span> <span class="n">KB</span> <span class="n">boundary</span>
<span class="o">|</span>     <span class="o">&lt;</span><span class="n">Padding</span><span class="o">&gt;</span>     <span class="o">|</span>
<span class="o">+-------------------+</span>
<span class="o">|</span>  <span class="n">Read</span><span class="o">-</span><span class="n">only</span> <span class="n">data</span>   <span class="o">|</span>
<span class="o">+-------------------+</span>
<span class="o">|</span>       <span class="n">Code</span>        <span class="o">|</span>
<span class="o">+-------------------+</span> <span class="n">BLx_BASE</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The 2KB alignment for the exception vectors is an architectural
requirement.</p>
</div>
<p>The read-write data start on a new memory page so that they can be mapped with
read-write permissions, whereas the code and read-only data below are configured
as read-only.</p>
<p>However, the read-only data are not aligned on a page boundary. They are
contiguous to the code. Therefore, the end of the code section and the beginning
of the read-only data one might share a memory page. This forces both to be
mapped with the same memory attributes. As the code needs to be executable, this
means that the read-only data stored on the same memory page as the code are
executable as well. This could potentially be exploited as part of a security
attack.</p>
<p>TF provides the build flag <code class="docutils literal notranslate"><span class="pre">SEPARATE_CODE_AND_RODATA</span></code> to isolate the code and
read-only data on separate memory pages. This in turn allows independent control
of the access permissions for the code and read-only data. In this case,
platform code gets a finer-grained view of the image layout and can
appropriately map the code region as executable and the read-only data as
execute-never.</p>
<p>This has an impact on memory footprint, as padding bytes need to be introduced
between the code and read-only data to ensure the segregation of the two. To
limit the memory cost, this flag also changes the memory layout such that the
code and exception vectors are now contiguous, like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">|</span>        <span class="o">...</span>        <span class="o">|</span>
<span class="o">+-------------------+</span>
<span class="o">|</span>  <span class="n">Read</span><span class="o">-</span><span class="n">write</span> <span class="n">data</span>  <span class="o">|</span>
<span class="o">+-------------------+</span> <span class="n">Page</span> <span class="n">boundary</span>
<span class="o">|</span>     <span class="o">&lt;</span><span class="n">Padding</span><span class="o">&gt;</span>     <span class="o">|</span>
<span class="o">+-------------------+</span>
<span class="o">|</span>  <span class="n">Read</span><span class="o">-</span><span class="n">only</span> <span class="n">data</span>   <span class="o">|</span>
<span class="o">+-------------------+</span> <span class="n">Page</span> <span class="n">boundary</span>
<span class="o">|</span>     <span class="o">&lt;</span><span class="n">Padding</span><span class="o">&gt;</span>     <span class="o">|</span>
<span class="o">+-------------------+</span>
<span class="o">|</span> <span class="ne">Exception</span> <span class="n">vectors</span> <span class="o">|</span>
<span class="o">+-------------------+</span> <span class="mi">2</span> <span class="n">KB</span> <span class="n">boundary</span>
<span class="o">|</span>     <span class="o">&lt;</span><span class="n">Padding</span><span class="o">&gt;</span>     <span class="o">|</span>
<span class="o">+-------------------+</span>
<span class="o">|</span>       <span class="n">Code</span>        <span class="o">|</span>
<span class="o">+-------------------+</span> <span class="n">BLx_BASE</span>
</pre></div>
</div>
<p>With this more condensed memory layout, the separation of read-only data will
add zero or one page to the memory footprint of each BL image. Each platform
should consider the trade-off between memory footprint and security.</p>
<p>This build flag is disabled by default, minimising memory footprint. On Arm
platforms, it is enabled.</p>
</div>
<div class="section" id="publish-and-subscribe-framework">
<h2><span class="section-number">4.14. </span>Publish and Subscribe Framework<a class="headerlink" href="#publish-and-subscribe-framework" title="Permalink to this headline">¶</a></h2>
<p>The Publish and Subscribe Framework allows EL3 components to define and publish
events, to which other EL3 components can subscribe.</p>
<p>The following macros are provided by the framework:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">REGISTER_PUBSUB_EVENT(event)</span></code>: Defines an event, and takes one argument,
the event name, which must be a valid C identifier. All calls to
<code class="docutils literal notranslate"><span class="pre">REGISTER_PUBSUB_EVENT</span></code> macro must be placed in the file
<code class="docutils literal notranslate"><span class="pre">pubsub_events.h</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PUBLISH_EVENT_ARG(event,</span> <span class="pre">arg)</span></code>: Publishes a defined event, by iterating
subscribed handlers and calling them in turn. The handlers will be passed the
parameter <code class="docutils literal notranslate"><span class="pre">arg</span></code>. The expected use-case is to broadcast an event.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">PUBLISH_EVENT(event)</span></code>: Like <code class="docutils literal notranslate"><span class="pre">PUBLISH_EVENT_ARG</span></code>, except that the value
<code class="docutils literal notranslate"><span class="pre">NULL</span></code> is passed to subscribed handlers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">SUBSCRIBE_TO_EVENT(event,</span> <span class="pre">handler)</span></code>: Registers the <code class="docutils literal notranslate"><span class="pre">handler</span></code> to
subscribe to <code class="docutils literal notranslate"><span class="pre">event</span></code>. The handler will be executed whenever the <code class="docutils literal notranslate"><span class="pre">event</span></code>
is published.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">for_each_subscriber(event,</span> <span class="pre">subscriber)</span></code>: Iterates through all handlers
subscribed for <code class="docutils literal notranslate"><span class="pre">event</span></code>. <code class="docutils literal notranslate"><span class="pre">subscriber</span></code> must be a local variable of type
<code class="docutils literal notranslate"><span class="pre">pubsub_cb_t</span> <span class="pre">*</span></code>, and will point to each subscribed handler in turn during
iteration. This macro can be used for those patterns that none of the
<code class="docutils literal notranslate"><span class="pre">PUBLISH_EVENT_*()</span></code> macros cover.</p></li>
</ul>
<p>Publishing an event that wasn’t defined using <code class="docutils literal notranslate"><span class="pre">REGISTER_PUBSUB_EVENT</span></code> will
result in build error. Subscribing to an undefined event however won’t.</p>
<p>Subscribed handlers must be of type <code class="docutils literal notranslate"><span class="pre">pubsub_cb_t</span></code>, with following function
signature:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span> <span class="kt">void</span><span class="o">*</span> <span class="p">(</span><span class="o">*</span><span class="n">pubsub_cb_t</span><span class="p">)(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">);</span>
</pre></div>
</div>
<p>There may be arbitrary number of handlers registered to the same event. The
order in which subscribed handlers are notified when that event is published is
not defined. Subscribed handlers may be executed in any order; handlers should
not assume any relative ordering amongst them.</p>
<p>Publishing an event on a PE will result in subscribed handlers executing on that
PE only; it won’t cause handlers to execute on a different PE.</p>
<p>Note that publishing an event on a PE blocks until all the subscribed handlers
finish executing on the PE.</p>
<p>TF-A generic code publishes and subscribes to some events within. Platform
ports are discouraged from subscribing to them. These events may be withdrawn,
renamed, or have their semantics altered in the future. Platforms may however
register, publish, and subscribe to platform-specific events.</p>
<div class="section" id="publish-and-subscribe-example">
<h3><span class="section-number">4.14.1. </span>Publish and Subscribe Example<a class="headerlink" href="#publish-and-subscribe-example" title="Permalink to this headline">¶</a></h3>
<p>A publisher that wants to publish event <code class="docutils literal notranslate"><span class="pre">foo</span></code> would:</p>
<ul>
<li><p>Define the event <code class="docutils literal notranslate"><span class="pre">foo</span></code> in the <code class="docutils literal notranslate"><span class="pre">pubsub_events.h</span></code>.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">REGISTER_PUBSUB_EVENT</span><span class="p">(</span><span class="n">foo</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p>Depending on the nature of event, use one of <code class="docutils literal notranslate"><span class="pre">PUBLISH_EVENT_*()</span></code> macros to
publish the event at the appropriate path and time of execution.</p></li>
</ul>
<p>A subscriber that wants to subscribe to event <code class="docutils literal notranslate"><span class="pre">foo</span></code> published above would
implement:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span> <span class="o">*</span><span class="nf">foo_handler</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
     <span class="kt">void</span> <span class="o">*</span><span class="n">result</span><span class="p">;</span>

     <span class="cm">/* Do handling ... */</span>

     <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">SUBSCRIBE_TO_EVENT</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">foo_handler</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="reclaiming-the-bl31-initialization-code">
<h3><span class="section-number">4.14.2. </span>Reclaiming the BL31 initialization code<a class="headerlink" href="#reclaiming-the-bl31-initialization-code" title="Permalink to this headline">¶</a></h3>
<p>A significant amount of the code used for the initialization of BL31 is never
needed again after boot time. In order to reduce the runtime memory
footprint, the memory used for this code can be reclaimed after initialization
has finished and be used for runtime data.</p>
<p>The build option <code class="docutils literal notranslate"><span class="pre">RECLAIM_INIT_CODE</span></code> can be set to mark this boot time code
with a <code class="docutils literal notranslate"><span class="pre">.text.init.*</span></code> attribute which can be filtered and placed suitably
within the BL image for later reclamation by the platform. The platform can
specify the filter and the memory region for this init section in BL31 via the
plat.ld.S linker script. For example, on the FVP, this section is placed
overlapping the secondary CPU stacks so that after the cold boot is done, this
memory can be reclaimed for the stacks. The init memory section is initially
mapped with <code class="docutils literal notranslate"><span class="pre">RO</span></code>, <code class="docutils literal notranslate"><span class="pre">EXECUTE</span></code> attributes. After BL31 initialization has
completed, the FVP changes the attributes of this section to <code class="docutils literal notranslate"><span class="pre">RW</span></code>,
<code class="docutils literal notranslate"><span class="pre">EXECUTE_NEVER</span></code> allowing it to be used for runtime data. The memory attributes
are changed within the <code class="docutils literal notranslate"><span class="pre">bl31_plat_runtime_setup</span></code> platform hook. The init
section section can be reclaimed for any data which is accessed after cold
boot initialization and it is upto the platform to make the decision.</p>
</div>
</div>
<div class="section" id="performance-measurement-framework">
<span id="firmware-design-pmf"></span><h2><span class="section-number">4.15. </span>Performance Measurement Framework<a class="headerlink" href="#performance-measurement-framework" title="Permalink to this headline">¶</a></h2>
<p>The Performance Measurement Framework (PMF) facilitates collection of
timestamps by registered services and provides interfaces to retrieve them
from within TF-A. A platform can choose to expose appropriate SMCs to
retrieve these collected timestamps.</p>
<p>By default, the global physical counter is used for the timestamp
value and is read via <code class="docutils literal notranslate"><span class="pre">CNTPCT_EL0</span></code>. The framework allows to retrieve
timestamps captured by other CPUs.</p>
<div class="section" id="timestamp-identifier-format">
<h3><span class="section-number">4.15.1. </span>Timestamp identifier format<a class="headerlink" href="#timestamp-identifier-format" title="Permalink to this headline">¶</a></h3>
<p>A PMF timestamp is uniquely identified across the system via the
timestamp ID or <code class="docutils literal notranslate"><span class="pre">tid</span></code>. The <code class="docutils literal notranslate"><span class="pre">tid</span></code> is composed as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Bits</span> <span class="mi">0</span><span class="o">-</span><span class="mi">7</span><span class="p">:</span> <span class="n">The</span> <span class="n">local</span> <span class="n">timestamp</span> <span class="n">identifier</span><span class="o">.</span>
<span class="n">Bits</span> <span class="mi">8</span><span class="o">-</span><span class="mi">9</span><span class="p">:</span> <span class="n">Reserved</span><span class="o">.</span>
<span class="n">Bits</span> <span class="mi">10</span><span class="o">-</span><span class="mi">15</span><span class="p">:</span> <span class="n">The</span> <span class="n">service</span> <span class="n">identifier</span><span class="o">.</span>
<span class="n">Bits</span> <span class="mi">16</span><span class="o">-</span><span class="mi">31</span><span class="p">:</span> <span class="n">Reserved</span><span class="o">.</span>
</pre></div>
</div>
<ol class="arabic simple">
<li><p>The service identifier. Each PMF service is identified by a
service name and a service identifier. Both the service name and
identifier are unique within the system as a whole.</p></li>
<li><p>The local timestamp identifier. This identifier is unique within a given
service.</p></li>
</ol>
</div>
<div class="section" id="registering-a-pmf-service">
<h3><span class="section-number">4.15.2. </span>Registering a PMF service<a class="headerlink" href="#registering-a-pmf-service" title="Permalink to this headline">¶</a></h3>
<p>To register a PMF service, the <code class="docutils literal notranslate"><span class="pre">PMF_REGISTER_SERVICE()</span></code> macro from <code class="docutils literal notranslate"><span class="pre">pmf.h</span></code>
is used. The arguments required are the service name, the service ID,
the total number of local timestamps to be captured and a set of flags.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">flags</span></code> field can be specified as a bitwise-OR of the following values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PMF_STORE_ENABLE</span><span class="p">:</span> <span class="n">The</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="n">stored</span> <span class="ow">in</span> <span class="n">memory</span> <span class="k">for</span> <span class="n">later</span> <span class="n">retrieval</span><span class="o">.</span>
<span class="n">PMF_DUMP_ENABLE</span><span class="p">:</span> <span class="n">The</span> <span class="n">timestamp</span> <span class="ow">is</span> <span class="n">dumped</span> <span class="n">on</span> <span class="n">the</span> <span class="n">serial</span> <span class="n">console</span><span class="o">.</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">PMF_REGISTER_SERVICE()</span></code> reserves memory to store captured
timestamps in a PMF specific linker section at build time.
Additionally, it defines necessary functions to capture and
retrieve a particular timestamp for the given service at runtime.</p>
<p>The macro <code class="docutils literal notranslate"><span class="pre">PMF_REGISTER_SERVICE()</span></code> only enables capturing PMF timestamps
from within TF-A. In order to retrieve timestamps from outside of TF-A, the
<code class="docutils literal notranslate"><span class="pre">PMF_REGISTER_SERVICE_SMC()</span></code> macro must be used instead. This macro
accepts the same set of arguments as the <code class="docutils literal notranslate"><span class="pre">PMF_REGISTER_SERVICE()</span></code>
macro but additionally supports retrieving timestamps using SMCs.</p>
</div>
<div class="section" id="capturing-a-timestamp">
<h3><span class="section-number">4.15.3. </span>Capturing a timestamp<a class="headerlink" href="#capturing-a-timestamp" title="Permalink to this headline">¶</a></h3>
<p>PMF timestamps are stored in a per-service timestamp region. On a
system with multiple CPUs, each timestamp is captured and stored
in a per-CPU cache line aligned memory region.</p>
<p>Having registered the service, the <code class="docutils literal notranslate"><span class="pre">PMF_CAPTURE_TIMESTAMP()</span></code> macro can be
used to capture a timestamp at the location where it is used. The macro
takes the service name, a local timestamp identifier and a flag as arguments.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">flags</span></code> field argument can be zero, or <code class="docutils literal notranslate"><span class="pre">PMF_CACHE_MAINT</span></code> which
instructs PMF to do cache maintenance following the capture. Cache
maintenance is required if any of the service’s timestamps are captured
with data cache disabled.</p>
<p>To capture a timestamp in assembly code, the caller should use
<code class="docutils literal notranslate"><span class="pre">pmf_calc_timestamp_addr</span></code> macro (defined in <code class="docutils literal notranslate"><span class="pre">pmf_asm_macros.S</span></code>) to
calculate the address of where the timestamp would be stored. The
caller should then read <code class="docutils literal notranslate"><span class="pre">CNTPCT_EL0</span></code> register to obtain the timestamp
and store it at the determined address for later retrieval.</p>
</div>
<div class="section" id="retrieving-a-timestamp">
<h3><span class="section-number">4.15.4. </span>Retrieving a timestamp<a class="headerlink" href="#retrieving-a-timestamp" title="Permalink to this headline">¶</a></h3>
<p>From within TF-A, timestamps for individual CPUs can be retrieved using either
<code class="docutils literal notranslate"><span class="pre">PMF_GET_TIMESTAMP_BY_MPIDR()</span></code> or <code class="docutils literal notranslate"><span class="pre">PMF_GET_TIMESTAMP_BY_INDEX()</span></code> macros.
These macros accept the CPU’s MPIDR value, or its ordinal position
respectively.</p>
<p>From outside TF-A, timestamps for individual CPUs can be retrieved by calling
into <code class="docutils literal notranslate"><span class="pre">pmf_smc_handler()</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Interface : pmf_smc_handler()
Argument  : unsigned int smc_fid, u_register_t x1,
            u_register_t x2, u_register_t x3,
            u_register_t x4, void *cookie,
            void *handle, u_register_t flags
Return    : uintptr_t

smc_fid: Holds the SMC identifier which is either `PMF_SMC_GET_TIMESTAMP_32`
    when the caller of the SMC is running in AArch32 mode
    or `PMF_SMC_GET_TIMESTAMP_64` when the caller is running in AArch64 mode.
x1: Timestamp identifier.
x2: The `mpidr` of the CPU for which the timestamp has to be retrieved.
    This can be the `mpidr` of a different core to the one initiating
    the SMC.  In that case, service specific cache maintenance may be
    required to ensure the updated copy of the timestamp is returned.
x3: A flags value that is either 0 or `PMF_CACHE_MAINT`.  If
    `PMF_CACHE_MAINT` is passed, then the PMF code will perform a
    cache invalidate before reading the timestamp.  This ensures
    an updated copy is returned.
</pre></div>
</div>
<p>The remaining arguments, <code class="docutils literal notranslate"><span class="pre">x4</span></code>, <code class="docutils literal notranslate"><span class="pre">cookie</span></code>, <code class="docutils literal notranslate"><span class="pre">handle</span></code> and <code class="docutils literal notranslate"><span class="pre">flags</span></code> are unused
in this implementation.</p>
</div>
<div class="section" id="pmf-code-structure">
<h3><span class="section-number">4.15.5. </span>PMF code structure<a class="headerlink" href="#pmf-code-structure" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pmf_main.c</span></code> consists of core functions that implement service registration,
initialization, storing, dumping and retrieving timestamps.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pmf_smc.c</span></code> contains the SMC handling for registered PMF services.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pmf.h</span></code> contains the public interface to Performance Measurement Framework.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pmf_asm_macros.S</span></code> consists of macros to facilitate capturing timestamps in
assembly code.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pmf_helpers.h</span></code> is an internal header used by <code class="docutils literal notranslate"><span class="pre">pmf.h</span></code>.</p></li>
</ol>
</div>
</div>
<div class="section" id="armv8-a-architecture-extensions">
<h2><span class="section-number">4.16. </span>Armv8-A Architecture Extensions<a class="headerlink" href="#armv8-a-architecture-extensions" title="Permalink to this headline">¶</a></h2>
<p>TF-A makes use of Armv8-A Architecture Extensions where applicable. This
section lists the usage of Architecture Extensions, and build flags
controlling them.</p>
<p>In general, and unless individually mentioned, the build options
<code class="docutils literal notranslate"><span class="pre">ARM_ARCH_MAJOR</span></code> and <code class="docutils literal notranslate"><span class="pre">ARM_ARCH_MINOR</span></code> select the Architecture Extension to
target when building TF-A. Subsequent Arm Architecture Extensions are backward
compatible with previous versions.</p>
<p>The build system only requires that <code class="docutils literal notranslate"><span class="pre">ARM_ARCH_MAJOR</span></code> and <code class="docutils literal notranslate"><span class="pre">ARM_ARCH_MINOR</span></code> have a
valid numeric value. These build options only control whether or not
Architecture Extension-specific code is included in the build. Otherwise, TF-A
targets the base Armv8.0-A architecture; i.e. as if <code class="docutils literal notranslate"><span class="pre">ARM_ARCH_MAJOR</span></code> == 8
and <code class="docutils literal notranslate"><span class="pre">ARM_ARCH_MINOR</span></code> == 0, which are also their respective default values.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference internal" href="../getting_started/build-options.html#build-options"><span class="std std-ref">Build Options</span></a></p>
</div>
<p>For details on the Architecture Extension and available features, please refer
to the respective Architecture Extension Supplement.</p>
<div class="section" id="armv8-1-a">
<h3><span class="section-number">4.16.1. </span>Armv8.1-A<a class="headerlink" href="#armv8-1-a" title="Permalink to this headline">¶</a></h3>
<p>This Architecture Extension is targeted when <code class="docutils literal notranslate"><span class="pre">ARM_ARCH_MAJOR</span></code> &gt;= 8, or when
<code class="docutils literal notranslate"><span class="pre">ARM_ARCH_MAJOR</span></code> == 8 and <code class="docutils literal notranslate"><span class="pre">ARM_ARCH_MINOR</span></code> &gt;= 1.</p>
<ul class="simple">
<li><p>By default, a load-/store-exclusive instruction pair is used to implement
spinlocks. The <code class="docutils literal notranslate"><span class="pre">USE_SPINLOCK_CAS</span></code> build option when set to 1 selects the
spinlock implementation using the ARMv8.1-LSE Compare and Swap instruction.
Notice this instruction is only available in AArch64 execution state, so
the option is only available to AArch64 builds.</p></li>
</ul>
</div>
<div class="section" id="armv8-2-a">
<h3><span class="section-number">4.16.2. </span>Armv8.2-A<a class="headerlink" href="#armv8-2-a" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>The presence of ARMv8.2-TTCNP is detected at runtime. When it is present, the
Common not Private (TTBRn_ELx.CnP) bit is enabled to indicate that multiple
Processing Elements in the same Inner Shareable domain use the same
translation table entries for a given stage of translation for a particular
translation regime.</p></li>
</ul>
</div>
<div class="section" id="armv8-3-a">
<h3><span class="section-number">4.16.3. </span>Armv8.3-A<a class="headerlink" href="#armv8-3-a" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>Pointer authentication features of Armv8.3-A are unconditionally enabled in
the Non-secure world so that lower ELs are allowed to use them without
causing a trap to EL3.</p>
<p>In order to enable the Secure world to use it, <code class="docutils literal notranslate"><span class="pre">CTX_INCLUDE_PAUTH_REGS</span></code>
must be set to 1. This will add all pointer authentication system registers
to the context that is saved when doing a world switch.</p>
<p>The TF-A itself has support for pointer authentication at runtime
that can be enabled by setting <code class="docutils literal notranslate"><span class="pre">BRANCH_PROTECTION</span></code> option to non-zero and
<code class="docutils literal notranslate"><span class="pre">CTX_INCLUDE_PAUTH_REGS</span></code> to 1. This enables pointer authentication in BL1,
BL2, BL31, and the TSP if it is used.</p>
<p>These options are experimental features.</p>
<p>Note that Pointer Authentication is enabled for Non-secure world irrespective
of the value of these build flags if the CPU supports it.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">ARM_ARCH_MAJOR</span> <span class="pre">==</span> <span class="pre">8</span></code> and <code class="docutils literal notranslate"><span class="pre">ARM_ARCH_MINOR</span> <span class="pre">&gt;=</span> <span class="pre">3</span></code> the code footprint of
enabling PAuth is lower because the compiler will use the optimized
PAuth instructions rather than the backwards-compatible ones.</p>
</li>
</ul>
</div>
<div class="section" id="armv8-5-a">
<h3><span class="section-number">4.16.4. </span>Armv8.5-A<a class="headerlink" href="#armv8-5-a" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Branch Target Identification feature is selected by <code class="docutils literal notranslate"><span class="pre">BRANCH_PROTECTION</span></code>
option set to 1. This option defaults to 0 and this is an experimental
feature.</p></li>
<li><p>Memory Tagging Extension feature is unconditionally enabled for both worlds
(at EL0 and S-EL0) if it is only supported at EL0. If instead it is
implemented at all ELs, it is unconditionally enabled for only the normal
world. To enable it for the secure world as well, the build option
<code class="docutils literal notranslate"><span class="pre">CTX_INCLUDE_MTE_REGS</span></code> is required. If the hardware does not implement
MTE support at all, it is always disabled, no matter what build options
are used.</p></li>
</ul>
</div>
<div class="section" id="armv7-a">
<h3><span class="section-number">4.16.5. </span>Armv7-A<a class="headerlink" href="#armv7-a" title="Permalink to this headline">¶</a></h3>
<p>This Architecture Extension is targeted when <code class="docutils literal notranslate"><span class="pre">ARM_ARCH_MAJOR</span></code> == 7.</p>
<p>There are several Armv7-A extensions available. Obviously the TrustZone
extension is mandatory to support the TF-A bootloader and runtime services.</p>
<p>Platform implementing an Armv7-A system can to define from its target
Cortex-A architecture through <code class="docutils literal notranslate"><span class="pre">ARM_CORTEX_A&lt;X&gt;</span> <span class="pre">=</span> <span class="pre">yes</span></code> in their
<code class="docutils literal notranslate"><span class="pre">platform.mk</span></code> script. For example <code class="docutils literal notranslate"><span class="pre">ARM_CORTEX_A15=yes</span></code> for a
Cortex-A15 target.</p>
<p>Platform can also set <code class="docutils literal notranslate"><span class="pre">ARM_WITH_NEON=yes</span></code> to enable neon support.
Note that using neon at runtime has constraints on non secure world context.
TF-A does not yet provide VFP context management.</p>
<p>Directive <code class="docutils literal notranslate"><span class="pre">ARM_CORTEX_A&lt;x&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">ARM_WITH_NEON</span></code> are used to set
the toolchain  target architecture directive.</p>
<p>Platform may choose to not define straight the toolchain target architecture
directive by defining <code class="docutils literal notranslate"><span class="pre">MARCH32_DIRECTIVE</span></code>.
I.e:</p>
<div class="highlight-make notranslate"><div class="highlight"><pre><span></span><span class="nv">MARCH32_DIRECTIVE</span> <span class="o">:=</span> -mach<span class="o">=</span>armv7-a
</pre></div>
</div>
</div>
</div>
<div class="section" id="code-structure">
<h2><span class="section-number">4.17. </span>Code Structure<a class="headerlink" href="#code-structure" title="Permalink to this headline">¶</a></h2>
<p>TF-A code is logically divided between the three boot loader stages mentioned
in the previous sections. The code is also divided into the following
categories (present as directories in the source code):</p>
<ul class="simple">
<li><p><strong>Platform specific.</strong> Choice of architecture specific code depends upon
the platform.</p></li>
<li><p><strong>Common code.</strong> This is platform and architecture agnostic code.</p></li>
<li><p><strong>Library code.</strong> This code comprises of functionality commonly used by all
other code. The PSCI implementation and other EL3 runtime frameworks reside
as Library components.</p></li>
<li><p><strong>Stage specific.</strong> Code specific to a boot stage.</p></li>
<li><p><strong>Drivers.</strong></p></li>
<li><p><strong>Services.</strong> EL3 runtime services (eg: SPD). Specific SPD services
reside in the <code class="docutils literal notranslate"><span class="pre">services/spd</span></code> directory (e.g. <code class="docutils literal notranslate"><span class="pre">services/spd/tspd</span></code>).</p></li>
</ul>
<p>Each boot loader stage uses code from one or more of the above mentioned
categories. Based upon the above, the code layout looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Directory    Used by BL1?    Used by BL2?    Used by BL31?
bl1          Yes             No              No
bl2          No              Yes             No
bl31         No              No              Yes
plat         Yes             Yes             Yes
drivers      Yes             No              Yes
common       Yes             Yes             Yes
lib          Yes             Yes             Yes
services     No              No              Yes
</pre></div>
</div>
<p>The build system provides a non configurable build option IMAGE_BLx for each
boot loader stage (where x = BL stage). e.g. for BL1 , IMAGE_BL1 will be
defined by the build system. This enables TF-A to compile certain code only
for specific boot loader stages</p>
<p>All assembler files have the <code class="docutils literal notranslate"><span class="pre">.S</span></code> extension. The linker source files for each
boot stage have the extension <code class="docutils literal notranslate"><span class="pre">.ld.S</span></code>. These are processed by GCC to create the
linker scripts which have the extension <code class="docutils literal notranslate"><span class="pre">.ld</span></code>.</p>
<p>FDTs provide a description of the hardware platform and are used by the Linux
kernel at boot time. These can be found in the <code class="docutils literal notranslate"><span class="pre">fdts</span></code> directory.</p>
<p class="rubric">References</p>
<ul class="simple">
<li><p><a class="reference external" href="https://developer.arm.com/docs/den0006/latest/trusted-board-boot-requirements-client-tbbr-client-armv8-a">Trusted Board Boot Requirements CLIENT (TBBR-CLIENT) Armv8-A (ARM DEN0006D)</a></p></li>
<li><p><a class="reference external" href="http://infocenter.arm.com/help/topic/com.arm.doc.den0022d/Power_State_Coordination_Interface_PDD_v1_1_DEN0022D.pdf">Power State Coordination Interface PDD</a></p></li>
<li><p><a class="reference external" href="https://developer.arm.com/docs/den0028/latest">SMC Calling Convention</a></p></li>
<li><p><a class="reference internal" href="interrupt-framework-design.html#interrupt-management-framework"><span class="std std-ref">Interrupt Management Framework</span></a></p></li>
</ul>
<hr class="docutils" />
<p><em>Copyright (c) 2013-2020, Arm Limited and Contributors. All rights reserved.</em></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="interrupt-framework-design.html" class="btn btn-neutral float-right" title="5. Interrupt Management Framework" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="cpu-specific-build-macros.html" class="btn btn-neutral float-left" title="3. Arm CPU Specific Build Macros" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>