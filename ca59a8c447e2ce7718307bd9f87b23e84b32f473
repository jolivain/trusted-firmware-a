{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "9c3bb4e9_ab027806",
        "filename": "include/lib/el3_runtime/aarch64/context.h",
        "patchSetId": 12
      },
      "lineNbr": 66,
      "author": {
        "id": 1000102
      },
      "writtenOn": "2023-10-12T12:02:00Z",
      "side": 1,
      "message": "Comment removed by: Manish Pandey; Reason: d",
      "range": {
        "startLine": 66,
        "startChar": 0,
        "endLine": 66,
        "endChar": 30
      },
      "revId": "ca59a8c447e2ce7718307bd9f87b23e84b32f473",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "89a090b3_17b79615",
        "filename": "lib/el3_runtime/aarch64/context.S",
        "patchSetId": 12
      },
      "lineNbr": 591,
      "author": {
        "id": 1000102
      },
      "writtenOn": "2023-10-12T12:02:00Z",
      "side": 1,
      "message": "Comment removed by: Manish Pandey; Reason: not needed",
      "range": {
        "startLine": 578,
        "startChar": 0,
        "endLine": 591,
        "endChar": 0
      },
      "revId": "ca59a8c447e2ce7718307bd9f87b23e84b32f473",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "316401ca_4e65cf94",
        "filename": "lib/el3_runtime/aarch64/context.S",
        "patchSetId": 12
      },
      "lineNbr": 591,
      "author": {
        "id": 1000102
      },
      "writtenOn": "2023-10-13T12:44:30Z",
      "side": 1,
      "message": "I have come up with other solution, if FEAT_MPAM is present it resets to \n0x40000000 value (trap enabled). And in the context_setup_common we zeromem MPAM3_EL3 register in storage and update it with MPAM3_EL3 value which is (0x400...). For NS context setup we enable MPAM and disable the trap so the value is (0x80000000). So in every situation the storage value of MPMA3_El3 is going to be non-zero if feature is present or zero if feature is not present. So using the storage value we can figure out if the feature is present or not.\n\nSo the code would be \nIMAGE_BL31\nldr x17, [sp, #CTX_EL3STATE_OFFSET + CTX_MPAM3_EL3]\ncbz x17, mpam_not_present\nmsr mpam3_el3, x17\n\nmpam_not_present:\n#if IMAGE_BL31 \u0026\u0026 DYNAMIC_WORKAROUND_CVE_2018_3639",
      "parentUuid": "89a090b3_17b79615",
      "range": {
        "startLine": 578,
        "startChar": 0,
        "endLine": 591,
        "endChar": 0
      },
      "revId": "ca59a8c447e2ce7718307bd9f87b23e84b32f473",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "eb6f2a2d_b86f0fe8",
        "filename": "lib/el3_runtime/aarch64/context.S",
        "patchSetId": 12
      },
      "lineNbr": 591,
      "author": {
        "id": 1000102
      },
      "writtenOn": "2023-10-13T15:07:17Z",
      "side": 1,
      "message": "This is the other solutin\n\nThe other option is use something like what DIT has done lib/el3_runtime/aarch64/context.S #\n\nCheck for the GP register which you can use\n#if ENABLE_FEAT_MPAM \u003d\u003d 2\n        mrs     x8, id_aa64pfr0_el1\n        and     x8, x8, #(ID_AA64PFR0_MPAM_MASK \u003c\u003c ID_AA64PFR0_MPAM_SHIFT)\n        mrs     x7, id_aa64pfr1_el1\n        and     x7, x7, #(ID_AA64PFR1_MPAM_FRAC_MASK \u003c\u003c ID_AA64PFR1_MPAM_FRAC_SHIFT)\n        add     x7, x7, x8\n        cbz     x7, no_mmap\n#endif\n        access mpma3_el3\nno_mpam:",
      "parentUuid": "316401ca_4e65cf94",
      "range": {
        "startLine": 578,
        "startChar": 0,
        "endLine": 591,
        "endChar": 0
      },
      "revId": "ca59a8c447e2ce7718307bd9f87b23e84b32f473",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0b581344_f8f05e2a",
        "filename": "lib/el3_runtime/aarch64/context.S",
        "patchSetId": 12
      },
      "lineNbr": 591,
      "author": {
        "id": 1000660
      },
      "writtenOn": "2023-10-13T17:34:53Z",
      "side": 1,
      "message": "Verified the 1st part in this comment, storage value of MPAM_EL3 in context ( is either 0x40000000 or 0x80000000), when feature is present.",
      "parentUuid": "eb6f2a2d_b86f0fe8",
      "range": {
        "startLine": 578,
        "startChar": 0,
        "endLine": 591,
        "endChar": 0
      },
      "revId": "ca59a8c447e2ce7718307bd9f87b23e84b32f473",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "74df29c5_0669cd2d",
        "filename": "lib/el3_runtime/aarch64/context.S",
        "patchSetId": 12
      },
      "lineNbr": 591,
      "author": {
        "id": 1000803
      },
      "writtenOn": "2023-10-17T14:28:00Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "0b581344_f8f05e2a",
      "range": {
        "startLine": 578,
        "startChar": 0,
        "endLine": 591,
        "endChar": 0
      },
      "revId": "ca59a8c447e2ce7718307bd9f87b23e84b32f473",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1e3b0492_3c3e37c5",
        "filename": "lib/el3_runtime/aarch64/context_mgmt.c",
        "patchSetId": 12
      },
      "lineNbr": 488,
      "author": {
        "id": 1000102
      },
      "writtenOn": "2023-10-12T12:02:00Z",
      "side": 1,
      "message": "Comment removed by: Manish Pandey; Reason: not needed",
      "range": {
        "startLine": 485,
        "startChar": 0,
        "endLine": 488,
        "endChar": 2
      },
      "revId": "ca59a8c447e2ce7718307bd9f87b23e84b32f473",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "92407806_20d5bb24",
        "filename": "lib/el3_runtime/aarch64/context_mgmt.c",
        "patchSetId": 12
      },
      "lineNbr": 627,
      "author": {
        "id": 1000102
      },
      "writtenOn": "2023-10-12T12:02:00Z",
      "side": 1,
      "message": "Comment removed by: Manish Pandey; Reason: d",
      "range": {
        "startLine": 625,
        "startChar": 0,
        "endLine": 627,
        "endChar": 2
      },
      "revId": "ca59a8c447e2ce7718307bd9f87b23e84b32f473",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8ac74f57_b96a4572",
        "filename": "lib/el3_runtime/aarch64/context_mgmt.c",
        "patchSetId": 12
      },
      "lineNbr": 916,
      "author": {
        "id": 1000102
      },
      "writtenOn": "2023-10-12T12:02:00Z",
      "side": 1,
      "message": "Comment removed by: Manish Pandey; Reason: d",
      "revId": "ca59a8c447e2ce7718307bd9f87b23e84b32f473",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d73cf0a8_b42b8899",
        "filename": "lib/extensions/mpam/mpam.c",
        "patchSetId": 12
      },
      "lineNbr": 18,
      "author": {
        "id": 1000102
      },
      "writtenOn": "2023-10-12T12:02:00Z",
      "side": 1,
      "message": "Comment removed by: Manish Pandey; Reason: d",
      "range": {
        "startLine": 18,
        "startChar": 1,
        "endLine": 18,
        "endChar": 68
      },
      "revId": "ca59a8c447e2ce7718307bd9f87b23e84b32f473",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2cc71741_4ec48e74",
        "filename": "make_helpers/arch_features.mk",
        "patchSetId": 12
      },
      "lineNbr": 217,
      "author": {
        "id": 1000102
      },
      "writtenOn": "2023-10-12T12:02:00Z",
      "side": 1,
      "message": "Change this to 2 same as SPE_FOR_NS",
      "range": {
        "startLine": 217,
        "startChar": 22,
        "endLine": 217,
        "endChar": 23
      },
      "revId": "ca59a8c447e2ce7718307bd9f87b23e84b32f473",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c00c7e4d_afef57eb",
        "filename": "make_helpers/arch_features.mk",
        "patchSetId": 12
      },
      "lineNbr": 217,
      "author": {
        "id": 1000803
      },
      "writtenOn": "2023-10-17T14:28:00Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "2cc71741_4ec48e74",
      "range": {
        "startLine": 217,
        "startChar": 22,
        "endLine": 217,
        "endChar": 23
      },
      "revId": "ca59a8c447e2ce7718307bd9f87b23e84b32f473",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    }
  ]
}