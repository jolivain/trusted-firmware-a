{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "eb734f8c_c2444a49",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2023-04-12T06:43:38Z",
      "side": 1,
      "message": "If this targets OP-TEE why not implementing the service in the opteed SPD?\nUnless coreboot doesn\u0027t build along with TF-A SPD?\n\nAlso you should know the FF-A standard introduces a logging ABI.\nI appreciate a legacy implementation may be far from considering to adopt FF-A, but I thought fair mentioning here, as it seems we want to implement an adhoc solution vs a standard, which doesn\u0027t help defragmenting sw solutions.",
      "revId": "bfef2a145c96df0abe2904ca0a745e0441f782fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3d7edcb9_5c975539",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1000962
      },
      "writtenOn": "2023-04-12T18:34:16Z",
      "side": 1,
      "message": "Sounds reasonable to move it into the opteed code for the SPD.\n\nJens, Are you OK with that? I\u0027d then just create a new fid for that call in the TOS range somwhere.",
      "parentUuid": "eb734f8c_c2444a49",
      "revId": "bfef2a145c96df0abe2904ca0a745e0441f782fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "65284ebf_d0279527",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1000120
      },
      "writtenOn": "2023-04-13T06:10:19Z",
      "side": 1,
      "message": "This is not used in upstream OP-TEE, but rather in some fork.\nI don\u0027t consider OPTEED to be part of a legacy implementation.",
      "parentUuid": "3d7edcb9_5c975539",
      "revId": "bfef2a145c96df0abe2904ca0a745e0441f782fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0f2a0b7e_ee8bd319",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1000962
      },
      "writtenOn": "2023-04-13T17:46:32Z",
      "side": 1,
      "message": "Jens,\n\nI do plan to upstream to OP-TEE the support for using cbmem console logging and not just carry that in a fork on our end.  But I figured I should get this dependency upstreamed first before I do that. It\u0027s just another console implementation in OP-TEE.",
      "parentUuid": "65284ebf_d0279527",
      "revId": "bfef2a145c96df0abe2904ca0a745e0441f782fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "823f6f80_7f735dba",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1000060
      },
      "writtenOn": "2023-04-14T00:04:11Z",
      "side": 1,
      "message": "\u003e If this targets OP-TEE why not implementing the service in the opteed SPD?\n\nIn general this log format is not OP-TEE-specific and I think it\u0027s perfectly possible that other TOSes running on coreboot-based systems might want to use this SMC in the future as well, so I think standardizing an FID that can be shared across different TOSes would be better. However, since there\u0027s currently no good way to do that (see my email https://lists.trustedfirmware.org/archives/list/tf-a@lists.trustedfirmware.org/thread/OFD2HP57V3R5BAB5ETZND5WEUPR5ETLD/), if we can\u0027t find a better way then I agree the OP-TEE SPD is probably the best place to put this for now.\n\n\u003e Also you should know the FF-A standard introduces a logging ABI.\n\nSo if I\u0027m reading that spec right this would be an SMC offered by BL31 that is called by OP-TEE whenever it wants to log a new line? Is there actually code implementing this interface in TF-A today? I would be a bit worried about the performance impact of requiring a separate SMC context switch for each log messsage, particularly since it looks like the SMC is passing characters entirely through registers, so long lines would have to be split at every 40 characters and require even more SMC round trips to log.\n\n\u003e as it seems we want to implement an adhoc solution vs a standard, which doesn\u0027t help defragmenting sw solutions.\n\nNote that the CBMEM console log itself is not just a random \"adhoc\" solution, it has been used by coreboot for decades and support for it has been implemented in many other firmware projects (e.g. U-Boot, GRUB, TianoCore, there\u0027s also a driver in Linux for it, etc.). This SMC is just about communicating the buffer address to OP-TEE. It\u0027s really more of a mechanism to pass a parameter to the TOS on initialization rather than a real runtime service, but we didn\u0027t find a better mechanism in OP-TEE to pass in information like this so this seemed to be the best choice.",
      "parentUuid": "0f2a0b7e_ee8bd319",
      "revId": "bfef2a145c96df0abe2904ca0a745e0441f782fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a88e9e8c_c1be4b21",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2023-04-14T13:49:14Z",
      "side": 1,
      "message": "\u003e I think it\u0027s perfectly possible that other TOSes running on coreboot-based systems might want to use this SMC\nOk, I see. So that\u0027s related to TF-A + coreboot integration with any TOS on top.\n\n\u003e Is there actually code implementing this interface in TF-A today? \nThis is fresh from the FF-A v1.2 ALP0 spec so not widely deployed yet.\nThis exists in the SEL2 SPMC (https://git.trustedfirmware.org/hafnium/hafnium.git/tree/src/api.c#n4334), and soon in EL3 SPMC firmware.\n\n\u003e Note that the CBMEM console log itself is not just a random \"adhoc\" solution,\nSure, sorry for the confusion, in my mind I was thinking of the way of passing the buffer address by a new SMC, as an adhoc solution.\nI believe Manish\u0027 proposal about using the firmware handoff protocol (or mine about using the FF-A boot protocol!) is a fair alternate idea.",
      "parentUuid": "823f6f80_7f735dba",
      "revId": "bfef2a145c96df0abe2904ca0a745e0441f782fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9658657d_902bf54d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1000120
      },
      "writtenOn": "2023-04-14T14:20:33Z",
      "side": 1,
      "message": "If you have device tree bindings for this it could be an option to pass it via a DTB.",
      "parentUuid": "823f6f80_7f735dba",
      "revId": "bfef2a145c96df0abe2904ca0a745e0441f782fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4b58bf59_14f6df63",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1000962
      },
      "writtenOn": "2023-04-18T19:02:00Z",
      "side": 1,
      "message": "Jens,\n\nWe were discussing this internally, and we think a DTB may be the best way to go. There\u0027s also going to be two more pieces of information specific to ChromeOS which we are going to need to pass from TF-A into OP-TEE as well (relating to Widevine root of trust and the secure counter, we\u0027ll upstream that later...but I want to be sure we have a path for that as well).\n\nCurrent thinking is that we would dynamically create a DTB within TF-A that contains just these 3 pieces of information. We can\u0027t pre-create the DTB because none of the 3 pieces of information are known beforehand.  I\u0027d be adding code into opteed which generates the DTB when loading OP-TEE via an SMC call, store that in secure memory and pass that DT address to OP-TEE during OP-TEE startup using the existing mechanism for that.\n\nDoes this sound acceptable to you?",
      "parentUuid": "9658657d_902bf54d",
      "revId": "bfef2a145c96df0abe2904ca0a745e0441f782fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c3145e84_c4379314",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1000120
      },
      "writtenOn": "2023-04-19T06:27:31Z",
      "side": 1,
      "message": "If possible I believe that creating the DTB in BL2 instead is preferable, but if it has to be done later I guess OPTEED in BL31 should be OK too.\n\nIt is also preferable if the bindings already are defined in the kernel since we don\u0027t want to maintain downstream device tree bindings.",
      "parentUuid": "4b58bf59_14f6df63",
      "revId": "bfef2a145c96df0abe2904ca0a745e0441f782fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "034feaa2_703e3772",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1000962
      },
      "writtenOn": "2023-04-19T21:11:08Z",
      "side": 1,
      "message": "I\u0027m still determining if we can get it from BL2 or not...but it would be good to not have to pass the whole coreboot table to OP-TEE for it to parse and just give it the CBMEM console address instead. What do you think about just doing something like this for the device tree? (I\u0027m just learning about them, but from the docs I read today...this looks like it would be acceptable)\n\nchosen {\n  tf-a,cbmem_console \u003d 0xffffde00\n}",
      "parentUuid": "c3145e84_c4379314",
      "revId": "bfef2a145c96df0abe2904ca0a745e0441f782fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ed2b5493_f912f16d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1000120
      },
      "writtenOn": "2023-04-20T06:03:18Z",
      "side": 1,
      "message": "We should be careful to not invent new bindings unless necessary. Might it be possible to generate a reduced coreboot table if the full one is too large?",
      "parentUuid": "034feaa2_703e3772",
      "revId": "bfef2a145c96df0abe2904ca0a745e0441f782fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "0065f758_83693916",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1000962
      },
      "writtenOn": "2023-04-20T22:04:33Z",
      "side": 1,
      "message": "OK, new version uploaded that uses device tree bindings instead, matching the one for coreboot in the Linux kernel.",
      "parentUuid": "ed2b5493_f912f16d",
      "revId": "bfef2a145c96df0abe2904ca0a745e0441f782fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    }
  ]
}