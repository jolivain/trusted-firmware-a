{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "206fa22e_2a651753",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000103
      },
      "writtenOn": "2024-01-30T10:00:14Z",
      "side": 1,
      "message": "Minor comment",
      "revId": "9fe39b200cd8710a460c30b91b4ae8145dba74fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f4bf4071_0bb240f6",
        "filename": "plat/st/common/bl2_io_storage.c",
        "patchSetId": 2
      },
      "lineNbr": 628,
      "author": {
        "id": 1000269
      },
      "writtenOn": "2024-02-06T10:29:47Z",
      "side": 1,
      "message": "Would be better to explicitly use the valid IDs (IMHO):\n\n    switch (mdata-\u003ebank_state[i]) {\n    case FWU_VALID_BANK_STATE:\n    case FWU_ACCEPTED_BANK_STATE:    \n        return i;\n    default:\n        break;\n    }",
      "range": {
        "startLine": 628,
        "startChar": 0,
        "endLine": 628,
        "endChar": 55
      },
      "revId": "9fe39b200cd8710a460c30b91b4ae8145dba74fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "487b9a87_127b5cc6",
        "filename": "plat/st/common/bl2_io_storage.c",
        "patchSetId": 2
      },
      "lineNbr": 628,
      "author": {
        "id": 1000661
      },
      "writtenOn": "2024-02-07T14:10:05Z",
      "side": 1,
      "message": "\u003e Would be better to explicitly use the valid IDs (IMHO):\n\u003e \n\u003e     switch (mdata-\u003ebank_state[i]) {\n\u003e     case FWU_VALID_BANK_STATE:\n\u003e     case FWU_ACCEPTED_BANK_STATE:    \n\u003e         return i;\n\u003e     default:\n\u003e         break;\n\u003e     }\n\nhi Etienne,\nI would prefer having two for loops. The first loop checks for the presence of any Accepted bank. If that fails, we then check for the presence of a Valid bank. So the idea is that we first try to boot the platform in an accepted state. The attempt to boot from a valid bank should be a fail-safe(better than platform not booting).\n\nExplaining it here just for the sake of record.",
      "parentUuid": "f4bf4071_0bb240f6",
      "range": {
        "startLine": 628,
        "startChar": 0,
        "endLine": 628,
        "endChar": 55
      },
      "revId": "9fe39b200cd8710a460c30b91b4ae8145dba74fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "388e60f3_97ad334a",
        "filename": "plat/st/common/bl2_io_storage.c",
        "patchSetId": 2
      },
      "lineNbr": 654,
      "author": {
        "id": 1000269
      },
      "writtenOn": "2024-02-06T10:29:47Z",
      "side": 1,
      "message": "As this is not expected, I think a error trace message is welcome.\n\nFollowing the discussion thread right below, it would be better to start attempting to use the previous_active_index, and fallback to the first valid bank if none of the active and previous-active bank relate to invalid bank states.",
      "range": {
        "startLine": 654,
        "startChar": 0,
        "endLine": 654,
        "endChar": 35
      },
      "revId": "9fe39b200cd8710a460c30b91b4ae8145dba74fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "2bc1a379_d400fd30",
        "filename": "plat/st/common/bl2_io_storage.c",
        "patchSetId": 2
      },
      "lineNbr": 654,
      "author": {
        "id": 1000661
      },
      "writtenOn": "2024-02-07T12:15:10Z",
      "side": 1,
      "message": "Acknowledged. But also note that based on my discussion with Manish, I am planning to add this as an API in the common fwu.c driver file. A platform which wants to implement it\u0027s own policy can define a separate function.",
      "parentUuid": "388e60f3_97ad334a",
      "range": {
        "startLine": 654,
        "startChar": 0,
        "endLine": 654,
        "endChar": 35
      },
      "revId": "9fe39b200cd8710a460c30b91b4ae8145dba74fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "53061c78_00c88376",
        "filename": "plat/st/common/bl2_io_storage.c",
        "patchSetId": 2
      },
      "lineNbr": 662,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2024-02-01T10:50:42Z",
      "side": 1,
      "message": "I\u0027m a bit uncertain about this. Just because the bank is considered valid doesn\u0027t necessarily guarantee its acceptance. If we switch in this direction, there\u0027s no assurance that it will still function as expected. I think the intended course is to revert back to the \u0027valid, accepted\u0027 bank instead right?\n\nAs per specification-\n\n```\nprevious_active_index: integer indicating which firmware bank was active prior to the last successful update\nto the Firmware Store\n```",
      "range": {
        "startLine": 662,
        "startChar": 15,
        "endLine": 662,
        "endChar": 36
      },
      "revId": "9fe39b200cd8710a460c30b91b4ae8145dba74fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "323857d6_632df5ca",
        "filename": "plat/st/common/bl2_io_storage.c",
        "patchSetId": 2
      },
      "lineNbr": 662,
      "author": {
        "id": 1000661
      },
      "writtenOn": "2024-02-01T11:12:46Z",
      "side": 1,
      "message": "\u003e I\u0027m a bit uncertain about this. Just because the bank is considered valid doesn\u0027t necessarily guarantee its acceptance. If we switch in this direction, there\u0027s no assurance that it will still function as expected. I think the intended course is to revert back to the \u0027valid, accepted\u0027 bank instead right?\n\nYes, I do understand your point. The reason I kept this logic is to allow the platform to boot in absence of any other alternative Accepted bank. What I think can be done is to first check for any Accepted banks(maybe start with previous_active_bank), and if none are found, then try to boot the platform with a Valid bank.\n\nIdeally, this scenario should not play out. It is just ensuring that the platform is allowed to boot from a Valid bank(this is assuming that all other checks pass, like rollback protection etc).\n \n\u003e \n\u003e As per specification-\n\u003e \n\u003e ```\n\u003e previous_active_index: integer indicating which firmware bank was active prior to the last successful update\n\u003e to the Firmware Store\n\u003e ```\n\nTrue. But a platform may have more than 2 banks, and in such a scenario, it may want to try and boot from any alternate bank. But I do agree that we can first try to boot from an Accepted bank, and then try a boot from a Valid bank in case of no other alternative. What do you think?",
      "parentUuid": "53061c78_00c88376",
      "range": {
        "startLine": 662,
        "startChar": 15,
        "endLine": 662,
        "endChar": 36
      },
      "revId": "9fe39b200cd8710a460c30b91b4ae8145dba74fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "61c8f6b2_eb816f5f",
        "filename": "plat/st/common/bl2_io_storage.c",
        "patchSetId": 2
      },
      "lineNbr": 662,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2024-02-01T13:10:05Z",
      "side": 1,
      "message": "Ack, agree!",
      "parentUuid": "323857d6_632df5ca",
      "range": {
        "startLine": 662,
        "startChar": 15,
        "endLine": 662,
        "endChar": 36
      },
      "revId": "9fe39b200cd8710a460c30b91b4ae8145dba74fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b1829480_45d260a1",
        "filename": "plat/st/common/bl2_io_storage.c",
        "patchSetId": 2
      },
      "lineNbr": 662,
      "author": {
        "id": 1000269
      },
      "writtenOn": "2024-02-06T10:29:47Z",
      "side": 1,
      "message": "I also think your description (Sughosh) makes sense, assuming you start by first using the previous_active_index if it relates to a valid bank state.",
      "parentUuid": "61c8f6b2_eb816f5f",
      "range": {
        "startLine": 662,
        "startChar": 15,
        "endLine": 662,
        "endChar": 36
      },
      "revId": "9fe39b200cd8710a460c30b91b4ae8145dba74fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "900c9cb5_624afbed",
        "filename": "plat/st/common/bl2_io_storage.c",
        "patchSetId": 2
      },
      "lineNbr": 662,
      "author": {
        "id": 1000661
      },
      "writtenOn": "2024-02-07T12:15:10Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "b1829480_45d260a1",
      "range": {
        "startLine": 662,
        "startChar": 15,
        "endLine": 662,
        "endChar": 36
      },
      "revId": "9fe39b200cd8710a460c30b91b4ae8145dba74fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e5aff199_0b88a522",
        "filename": "plat/st/common/bl2_io_storage.c",
        "patchSetId": 2
      },
      "lineNbr": 698,
      "author": {
        "id": 1000103
      },
      "writtenOn": "2024-01-30T10:00:14Z",
      "side": 1,
      "message": "In the commit message you say it is a debug trace. It should be changed to VERBOSE then? Or do you think it is worth having this trace at each boot?",
      "range": {
        "startLine": 698,
        "startChar": 1,
        "endLine": 698,
        "endChar": 5
      },
      "revId": "9fe39b200cd8710a460c30b91b4ae8145dba74fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "66586280_72a2687a",
        "filename": "plat/st/common/bl2_io_storage.c",
        "patchSetId": 2
      },
      "lineNbr": 698,
      "author": {
        "id": 1000661
      },
      "writtenOn": "2024-01-31T09:28:59Z",
      "side": 1,
      "message": "I think a VERBOSE should be fine. As for having this trace on every boot, I guess that can be skipped? But I don\u0027t have a strong opinion on this, as a platform owner, maybe you can suggest if this should be kept for every boot.",
      "parentUuid": "e5aff199_0b88a522",
      "range": {
        "startLine": 698,
        "startChar": 1,
        "endLine": 698,
        "endChar": 5
      },
      "revId": "9fe39b200cd8710a460c30b91b4ae8145dba74fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ba7b80e9_8c06e495",
        "filename": "plat/st/common/bl2_io_storage.c",
        "patchSetId": 2
      },
      "lineNbr": 698,
      "author": {
        "id": 1000103
      },
      "writtenOn": "2024-01-31T09:34:34Z",
      "side": 1,
      "message": "VERBOSE should be used here.",
      "parentUuid": "66586280_72a2687a",
      "range": {
        "startLine": 698,
        "startChar": 1,
        "endLine": 698,
        "endChar": 5
      },
      "revId": "9fe39b200cd8710a460c30b91b4ae8145dba74fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e6b316a4_1f3da2e1",
        "filename": "plat/st/common/bl2_io_storage.c",
        "patchSetId": 2
      },
      "lineNbr": 698,
      "author": {
        "id": 1000661
      },
      "writtenOn": "2024-01-31T10:52:18Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "ba7b80e9_8c06e495",
      "range": {
        "startLine": 698,
        "startChar": 1,
        "endLine": 698,
        "endChar": 5
      },
      "revId": "9fe39b200cd8710a460c30b91b4ae8145dba74fb",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    }
  ]
}