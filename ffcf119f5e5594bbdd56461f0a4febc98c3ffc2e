{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "85a738ec_11d815d4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000486
      },
      "writtenOn": "2023-10-17T14:14:10Z",
      "side": 1,
      "message": "also note: firewalls will be reconfigurable as well. that is provided as x509 extension for tfa image signage -\u003e https://lore.kernel.org/all/20231011-binman-firewalling-v4-0-a08085d300e9@ti.com/",
      "revId": "ffcf119f5e5594bbdd56461f0a4febc98c3ffc2e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dfebf63d_93cdd15f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000106
      },
      "writtenOn": "2023-10-18T17:00:22Z",
      "side": 1,
      "message": "Right, so R5 SPL will not be allowed to restore BL31 into SRAM. TFA will need to be reloaded using the same method it was loaded at boot (using ROM/TIFS from image with x509 cert). TFA will then have to be started on the warm boot path and it will have to restore its own context.\n\nThe point of TFA being in SRAM is performance and for us security. If you copy out to DDR and back with no encryption/authentication you lose that. The easier method would be to have just had TFA run out of DDR in the first place here.",
      "parentUuid": "85a738ec_11d815d4",
      "revId": "ffcf119f5e5594bbdd56461f0a4febc98c3ffc2e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "237132c8_56465fdd",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1001132
      },
      "writtenOn": "2023-10-25T13:10:35Z",
      "side": 1,
      "message": "It\u0027s only true for HS devices.\nGP devices are not impacted by the firewall configurations.\nIn a first time we only support suspend to ram for GP devices.\n\nMaybe we could check if it\u0027s a GP device before to make the copy.",
      "parentUuid": "dfebf63d_93cdd15f",
      "revId": "ffcf119f5e5594bbdd56461f0a4febc98c3ffc2e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "87420303_9edcb073",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000486
      },
      "writtenOn": "2023-10-25T20:04:30Z",
      "side": 1,
      "message": "What do you mean? GP devices also have firewalls (they are\u0027nt configured in \"deny everything mode by default\" - but yes it is there - the \"deny everything by default\" happens by default on HS-SE devices. We just are working to configure them to protect TFA and OPTEE on all variants of SoCs - been a journey.. getting there..",
      "parentUuid": "237132c8_56465fdd",
      "revId": "ffcf119f5e5594bbdd56461f0a4febc98c3ffc2e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "db2a330a_4bcada73",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1001132
      },
      "writtenOn": "2023-10-26T08:22:28Z",
      "side": 1,
      "message": "I tested the series you pointed me on a GP device, and R5 SPL was still able to restore TFA in SRAM.",
      "parentUuid": "87420303_9edcb073",
      "revId": "ffcf119f5e5594bbdd56461f0a4febc98c3ffc2e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "57627b16_86d59fc1",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 1000486
      },
      "writtenOn": "2023-10-26T11:42:40Z",
      "side": 1,
      "message": "That is because it is a WIP and we have\u0027nt setup the firewalls yet - the approach we are taking here will get in the way when we do attempt to protect TFA and OPTEE.\nWithout doing that protection, we can not remove:\n\"I/TC: WARNING: This OP-TEE configuration might be insecure!\" warning from OPTEE.",
      "parentUuid": "db2a330a_4bcada73",
      "revId": "ffcf119f5e5594bbdd56461f0a4febc98c3ffc2e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "11f613bd_929f6a53",
        "filename": "plat/ti/k3/common/k3_psci.c",
        "patchSetId": 5
      },
      "lineNbr": 251,
      "author": {
        "id": 1000486
      },
      "writtenOn": "2023-10-17T14:12:29Z",
      "side": 1,
      "message": "in AM62x, TFA runs in DDR! so do this based on flag context. I understand that J* devices SRAM is where TFA runs, but again, it is PIE at the moment, there are customers who have set the MSMC SRAM size as 0 (it is permitted) and run TFA in DDR.",
      "revId": "ffcf119f5e5594bbdd56461f0a4febc98c3ffc2e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "24246521_27eb2f16",
        "filename": "plat/ti/k3/common/k3_psci.c",
        "patchSetId": 5
      },
      "lineNbr": 251,
      "author": {
        "id": 1001132
      },
      "writtenOn": "2023-10-25T13:10:35Z",
      "side": 1,
      "message": "Ok we set the memcpy only for J7200.\n\nThe default configuration for J7200 is to have TFA running in SRAM.\nThere is no impact to do the copy even if TFA is running in DRAM.\n\nIt could be an improvement (detect that TF-A is running in DRAM, so no need to save it) in the future.",
      "parentUuid": "11f613bd_929f6a53",
      "revId": "ffcf119f5e5594bbdd56461f0a4febc98c3ffc2e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "00f4b635_80ed75fa",
        "filename": "plat/ti/k3/common/k3_psci.c",
        "patchSetId": 5
      },
      "lineNbr": 251,
      "author": {
        "id": 1000486
      },
      "writtenOn": "2023-10-25T20:04:30Z",
      "side": 1,
      "message": "I am not hung up on J7200 or not. for me this problem runs across the board - we have people running from DDR, from SRAM etc.. point is: TFA should push the context (such as GIC) inside it\u0027s own memory space. once the CPUs are down, system manager is the best person to make a choice to move the SRAM content to external storage in a \"secure manner\" as appropriate. - but that is just my view point. I just dont like to see code that will break known users.",
      "parentUuid": "24246521_27eb2f16",
      "revId": "ffcf119f5e5594bbdd56461f0a4febc98c3ffc2e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b64716d0_a03ffc9f",
        "filename": "plat/ti/k3/common/k3_psci.c",
        "patchSetId": 5
      },
      "lineNbr": 251,
      "author": {
        "id": 1001144
      },
      "writtenOn": "2023-10-26T07:38:18Z",
      "side": 1,
      "message": "It is our goal for the midterm to support more SoCs and have a more global solution. However, trying to achieve full support from day one doesn\u0027t seem like a good approach. I believe that working incrementally is a much better strategy and will ultimately yield better and faster results in the long term. Restricting support for S2R to J7200 is a way to prevent regression because, as of now, there is no S2R on this platform, and S2R has to be specifically selected. As a second step, we can explore how to store only the context and restore it from TF-A loaded from the boot media.",
      "parentUuid": "00f4b635_80ed75fa",
      "revId": "ffcf119f5e5594bbdd56461f0a4febc98c3ffc2e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b680967a_fa324cd8",
        "filename": "plat/ti/k3/common/k3_psci.c",
        "patchSetId": 5
      },
      "lineNbr": 251,
      "author": {
        "id": 1000486
      },
      "writtenOn": "2023-10-26T11:42:40Z",
      "side": 1,
      "message": "I am OK for incremental support, BUT I am not OK for breaking existing usage model - which for me, this does - PIE will need to be always functional as we add new features.",
      "parentUuid": "b64716d0_a03ffc9f",
      "revId": "ffcf119f5e5594bbdd56461f0a4febc98c3ffc2e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cc976287_dc8668c7",
        "filename": "plat/ti/k3/common/k3_psci.c",
        "patchSetId": 5
      },
      "lineNbr": 251,
      "author": {
        "id": 1001144
      },
      "writtenOn": "2023-10-26T12:39:12Z",
      "side": 1,
      "message": "Good we make progress then. The last issue being PIE. Regarding PIE, just to be clear, are you talking about Position Independent Executable? If that\u0027s the case, then TFA can still be run from anywhere. The only absolute address added is where to store the TFA context. Indeed, it can\u0027t be just anywhere, as it has to reside in DDR because any other memory location would result in data loss. As for the memory location, we need to have a fixed address in order to be able to restore it during a resume, and we also need to share its location with other components of the system to ensure that no one else will write to it. I don\u0027t see how a regression could be introduced, as this region is only used when K3_PM_SYSTEM_SUSPEND is enabled for the j7200. Finally, there are already some region of the memory where we can put TFA such as the location of the DM firmware.",
      "parentUuid": "b680967a_fa324cd8",
      "revId": "ffcf119f5e5594bbdd56461f0a4febc98c3ffc2e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c2644c78_38de7786",
        "filename": "plat/ti/k3/common/k3_psci.c",
        "patchSetId": 5
      },
      "lineNbr": 251,
      "author": {
        "id": 1000106
      },
      "writtenOn": "2023-10-26T15:29:05Z",
      "side": 1,
      "message": "Don\u0027t rely on K3_PM_SYSTEM_SUSPEND, as a compile time option it is going away. It was a temp solution until we had the API to query the firmware if suspend is supported on a given platform at runtime. See https://review.trustedfirmware.org/c/TF-A/trusted-firmware-a/+/24004\n\nAlso I have firewalls protecting TFA/OPTEE on both GP and HS. And this will be getting rolled out to everyone here soon. SPL will *not* be able to restore TFA back into SRAM like you do here after that point. SPL cannot be trusted, TFA must be saved and restored by a secure entity. On J7200 this could either be DMSC or TFA itself. For TFA itself you would have to reload a fresh copy using the normal methods (certificate loading) and then TFA will detect that it is on a resume path in early start and reload its old context (which should just be just the data area, code/rodata sections should be read-only and will be the same).\n\nLastly, the area in DDR you save this to cannot be hard-coded here, not because of PIE (I think we are confusing topics here), but because we cannot be sure that memory is firewalled and reserved from other users. You will have to communicate the chosen area to U-Boot/Linux (via DT carveout) and also ensure it is firewalled (using the certificate that wraps TFA). In which case this can be set a build time by the system integrator, if you make this location a build time option it would be more acceptable (I\u0027m still not 100% onboard here, but much better than hard-coded).",
      "parentUuid": "cc976287_dc8668c7",
      "revId": "ffcf119f5e5594bbdd56461f0a4febc98c3ffc2e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "725bead1_acd72586",
        "filename": "plat/ti/k3/common/k3_psci.c",
        "patchSetId": 5
      },
      "lineNbr": 251,
      "author": {
        "id": 1000486
      },
      "writtenOn": "2023-10-27T12:31:07Z",
      "side": 1,
      "message": "PIE \u003d Position Independent executable. Yes build time is way better an option than hardcoding - the reason I bring in PIE is because - customers move the location of TFA based on their needs. I dont want a proliferation of board files.\n\nAnother reason I dont like this approach of using SRAM is insecure storage to DDR - entire reason to run TFA in SRAM was to provide some level of security for TFA. if we did\u0027nt want that and are willing to run TFA from DDR, then we dont need all the LPM_SAVE stuff anyways (it is already running from DDR). If we are strongly going down this road - it MUST be a compile switch isolated - I am not sure which customers will prefer this approach, but i think it is broken - when running TFA from SRAM should be the responsibility of another entity to encrypt and store to DDR in a secure location. Again - we need to ensure firewalls are properly configured as well.",
      "parentUuid": "c2644c78_38de7786",
      "revId": "ffcf119f5e5594bbdd56461f0a4febc98c3ffc2e",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    }
  ]
}