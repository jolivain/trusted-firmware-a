{
  "comments": [
    {
      "key": {
        "uuid": "ce61de70_673ed355",
        "filename": "plat/arm/css/sgi/sgi_ras.c",
        "patchSetId": 2
      },
      "lineNbr": 148,
      "author": {
        "id": 1000114
      },
      "writtenOn": "2020-12-19T17:16:16Z",
      "side": 1,
      "message": "are we sure this is needed? sdei_dispatch_event restores the NS context, if an event is indeed dispatched. I think what is needed is to check the return code from sdei_dispatch_event. Seems to me like there is some weird interrupt sequence happening causing sdei_dispatch_event to fail and not restoring NS context.",
      "revId": "6ba66a1b0486e044681763f632bb5df154f26314",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5af03cf6_e652a13c",
        "filename": "plat/arm/css/sgi/sgi_ras.c",
        "patchSetId": 2
      },
      "lineNbr": 148,
      "author": {
        "id": 1000464
      },
      "writtenOn": "2020-12-28T03:14:04Z",
      "side": 1,
      "message": "Some cases sdei_dispatch_event will return fail, ras event happen before kernel register sdei handle, for example ras event happen at uefi shell of kernel boot early phase.",
      "parentUuid": "ce61de70_673ed355",
      "revId": "6ba66a1b0486e044681763f632bb5df154f26314",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7c6e9359_ee42022f",
        "filename": "plat/arm/css/sgi/sgi_ras.c",
        "patchSetId": 2
      },
      "lineNbr": 148,
      "author": {
        "id": 1000114
      },
      "writtenOn": "2020-12-28T16:04:38Z",
      "side": 1,
      "message": "Thanks for the explanation. If that is the case, we need to use specific error codes to delineate failures due to not having an SDEI handler and failures that happen for other reasons. We are masking possible real issues by forcibly restoring the ns context and not checking the return code of sdei_dispatch_event. A future reader of the code will not be able to understand why the NS context is restored here as well as in sdei_event_dispatch..\n\nDo you know which part of sdei_dispatch_event code fails during early boot phase that causes the issue described in your commit message?",
      "parentUuid": "5af03cf6_e652a13c",
      "revId": "6ba66a1b0486e044681763f632bb5df154f26314",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "34f83f6a_3b326685",
        "filename": "plat/arm/css/sgi/sgi_ras.c",
        "patchSetId": 2
      },
      "lineNbr": 148,
      "author": {
        "id": 1000464
      },
      "writtenOn": "2020-12-29T10:04:09Z",
      "side": 1,
      "message": "It will return from sdei_dispatch_event():\n\t/* Can\u0027t dispatch if events are masked on this PE */\n\tstate \u003d sdei_get_this_pe_state();\n\tif (state-\u003epe_masked)\n\t\treturn -1;",
      "parentUuid": "7c6e9359_ee42022f",
      "revId": "6ba66a1b0486e044681763f632bb5df154f26314",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda",
      "unresolved": true
    }
  ]
}