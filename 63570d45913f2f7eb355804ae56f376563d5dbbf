{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "5a8167b1_b8a92262",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000114
      },
      "writtenOn": "2021-04-19T19:03:37Z",
      "side": 1,
      "message": "How? seems like this is only possible if the CoT somehow had NV Counter update before signature? is that correct?",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 62
      },
      "revId": "63570d45913f2f7eb355804ae56f376563d5dbbf",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "128eea84_5b14e742",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-04-19T20:04:22Z",
      "side": 1,
      "message": "Yes, there is possibility that platforms comes up with CoT where NV counter auth method get specified first and signature auth method later. for e.g. as below:\n\n.img_auth_methods \u003d (const auth_method_desc_t[AUTH_METHOD_NUM]) {                \n  [0]\u003d{\n        .type \u003d AUTH_METHOD_NV_CTR,                        \n        .param.nv_ctr \u003d {                                \n                       .cert_nv_ctr \u003d \u0026non_trusted_nv_ctr,                                \n                       .plat_nv_ctr \u003d \u0026non_trusted_nv_ctr                        \n  },   \n  [1]\u003d{                                                                                                        \n        .type \u003d AUTH_METHOD_SIG,                                                                                      \n        .param.sig \u003d {\n                        .pk \u003d \u0026nt_fw_content_pk,\n                        .sig \u003d \u0026sig,                                \n                        .alg \u003d \u0026sig_alg,                                \n                        .data \u003d \u0026raw_data   \n        }               \n  }\n}",
      "parentUuid": "5a8167b1_b8a92262",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 62
      },
      "revId": "63570d45913f2f7eb355804ae56f376563d5dbbf",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dce05b3f_74a6b4b4",
        "filename": "drivers/auth/auth_mod.c",
        "patchSetId": 1
      },
      "lineNbr": 386,
      "author": {
        "id": 1000114
      },
      "writtenOn": "2021-04-19T19:03:37Z",
      "side": 1,
      "message": "Where are we checking that the signature verification is done? Do we need a flag that is set to ensure that signature verification is done before auth_nvctr below?",
      "range": {
        "startLine": 384,
        "startChar": 6,
        "endLine": 386,
        "endChar": 37
      },
      "revId": "63570d45913f2f7eb355804ae56f376563d5dbbf",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4e4a84be_34bd1a25",
        "filename": "drivers/auth/auth_mod.c",
        "patchSetId": 1
      },
      "lineNbr": 386,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-04-19T20:04:22Z",
      "side": 1,
      "message": "If the signature verification gets failed, we return at line no.395, so explicit check for signature verification done is not required with the assumption CoT certificate always with signature and NV counter authentication method, but I can think now malformed CoT may come up with only NV counter method, and then it is must to do signature done check before processing NV counter check \u0026 update.\nPlease let me know, what do you think?",
      "parentUuid": "dce05b3f_74a6b4b4",
      "range": {
        "startLine": 384,
        "startChar": 6,
        "endLine": 386,
        "endChar": 37
      },
      "revId": "63570d45913f2f7eb355804ae56f376563d5dbbf",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f7b44e59_bd095d3b",
        "filename": "drivers/auth/auth_mod.c",
        "patchSetId": 1
      },
      "lineNbr": 386,
      "author": {
        "id": 1000114
      },
      "writtenOn": "2021-04-19T21:11:31Z",
      "side": 1,
      "message": "correct. this was pretty much the situation i had in my mind. This problem is really caused by a malformed CoT that puts NVCTR before signature check. And if that can happen, i think it is plausible that we may come up with a CoT that only has NV counter method. It appears that we are coming up with a set of rules for a valid CoT and we should potentially have a function to validate the CoT with these rules, such as NV CTR check cannot be before signature verif or that a CoT cannot only contain nvctr.",
      "parentUuid": "4e4a84be_34bd1a25",
      "range": {
        "startLine": 384,
        "startChar": 6,
        "endLine": 386,
        "endChar": 37
      },
      "revId": "63570d45913f2f7eb355804ae56f376563d5dbbf",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8a4a95d7_d9e7af66",
        "filename": "drivers/auth/auth_mod.c",
        "patchSetId": 1
      },
      "lineNbr": 386,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-04-19T22:09:10Z",
      "side": 1,
      "message": "\u003e correct. this was pretty much the situation i had in my mind. This problem is really caused by a malformed CoT that puts NVCTR before signature check. \nThis is not CoT malformed case, it is quite legal that some platform puts NVCTR check before the signature in CoT, and expect authentication driver should handle the signature authentication first, and then NVCTR check. Implementation did in this patch hold true for this case.\n\n\u003e And if that can happen, i think it is plausible that we may come up with a CoT that only has NV counter method. It appears that we are coming up with a set of rules for a valid CoT and we should potentially have a function to validate the CoT with these rules, such as NV CTR check cannot be before signature verif or that a CoT cannot only contain nvctr.\n\nOn second thought, I think platform may not want to do the signature authentication, but want to go ahead with NV counter check and update (Though not recommended, but some platform may chose it that way.).\nAlso as a side note, \u0027AUTH_METHOD_NONE\u0027 marked as a valid case  in \u0027drivers/auth/auth_mod.c\u0027, so if some certificate comes up with \u0027AUTH_METHOD_NONE\u0027 as first method, and NV counter method later, then we still end up in NV counter check and update.\n\nIntention of this patch, if there is signature method specified in CoT, then do the signature verification first (as platform looking for trusted data), and then do the rest later, as in here NV counter check and update. This is what I think, but I may be wrong. Like to know more from you and what other thinks about this.",
      "parentUuid": "f7b44e59_bd095d3b",
      "range": {
        "startLine": 384,
        "startChar": 6,
        "endLine": 386,
        "endChar": 37
      },
      "revId": "63570d45913f2f7eb355804ae56f376563d5dbbf",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    }
  ]
}