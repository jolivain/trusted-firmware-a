{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "3ff3f240_4ae60649",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2022-06-14T13:22:34Z",
      "side": 1,
      "message": "I would like to see a new CI test to exercise this config - measured boot + SPM. Is there already such a patch available?",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 52
      },
      "revId": "e637a5e19da72599229fd2c70e793c123aaf14ca",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fee69fa4_7338887c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2022-06-15T07:26:52Z",
      "side": 1,
      "message": "That would be SPMC\u003dOP-TEE to start with.\nHafnium doesn\u0027t support this configuration.",
      "parentUuid": "3ff3f240_4ae60649",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 52
      },
      "revId": "e637a5e19da72599229fd2c70e793c123aaf14ca",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c08cd207_30fb2085",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2022-06-15T08:04:55Z",
      "side": 1,
      "message": "I agree that a config with SPMC\u003dOP-TEE would be the most valuable because OP-TEE supports retrieving the event log so we can have a proper test checking the values of these measurements.\n\nHowever, I still see some value in a boot test with Hafnium, simply because this patch makes it now possible to boot a software stack with Hafnium and measured boot support. Previously this would have hit an assertion. IIUC, Hafnium in this config simply won\u0027t do anything with the measurements held in the event log so we cannot check the values of these measurements.\n\nSo ideally I would like both configs to be added in the CI.",
      "parentUuid": "fee69fa4_7338887c",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 52
      },
      "revId": "e637a5e19da72599229fd2c70e793c123aaf14ca",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "71ecded1_9614a3a1",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 1000018
      },
      "writtenOn": "2022-06-15T09:31:43Z",
      "side": 1,
      "message": "\"OP-TEE supports retrieving the event log so we can have a proper test checking the values of these measurements\"\nI think that would mean enabling TS tests in the HF CI. I am unsure if the TA based solution would work with SPMC enabled in OP-TEE, that is something we are not looking at.",
      "parentUuid": "c08cd207_30fb2085",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 52
      },
      "revId": "e637a5e19da72599229fd2c70e793c123aaf14ca",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6f3e3f3e_d5dd36f8",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2022-06-16T08:24:44Z",
      "side": 1,
      "message": "I am curious about the test case being tested with this patch. Recently, Olivier posted a patch to add the Event Log node to the SPMC manifest [1]. Is this patch dependent on [1] then? \nIf yes, then I would like to know how the Event Log address is provided to OP-TEE via the SPMC manifest. \n\n[1]: https://review.trustedfirmware.org/c/TF-A/trusted-firmware-a/+/15505",
      "parentUuid": "71ecded1_9614a3a1",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 52
      },
      "revId": "e637a5e19da72599229fd2c70e793c123aaf14ca",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "78f25523_33bfb428",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 10,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2022-06-16T08:25:01Z",
      "side": 1,
      "message": "OK. It sounds to me like it will be complicated to have a solid testing story for measured boot using OP-TEE or Hafnium at this stage. And by solid, I mean something that checks the correctness of the measurement.\n\nInstead, Olivier has added a boot test with measured boot and Hafnium [1]. I think that\u0027s good enough for the purpose of this patch, as it will make sure that we no longer hit any assertion/error in TF-A when enabling measured boot.\n\nSo consider my original comment about CI testing resolved.\n\n[1] https://review.trustedfirmware.org/c/ci/tf-a-ci-scripts/+/15504",
      "parentUuid": "71ecded1_9614a3a1",
      "range": {
        "startLine": 9,
        "startChar": 0,
        "endLine": 10,
        "endChar": 52
      },
      "revId": "e637a5e19da72599229fd2c70e793c123aaf14ca",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "313f58f2_116eb51d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 11,
      "author": {
        "id": 1000018
      },
      "writtenOn": "2022-06-15T09:31:43Z",
      "side": 1,
      "message": "Are there any plans to add measured boot support to HF? When TC updates the TS S-EL0 SPs, Initial Attestation SP may need to be enabled and that depends on measured boot. Not sure if there are such plans for TC.\nMoreover the OP-TEE as an S-EL1 SP use-case with the TA based measured boot enablement could be tested then. Again not sure if there is interest from OP-TEE side.",
      "revId": "e637a5e19da72599229fd2c70e793c123aaf14ca",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9ad376e9_74e72ce2",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 11,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2022-06-15T10:33:47Z",
      "side": 1,
      "message": "Hi George,\n\u003e Are there any plans to add measured boot support to HF?\nNo, it\u0027s not in the plans (even if I appreciate there may be an interest in particular to Infra).\n\u003e When TC updates the TS S-EL0 SPs, Initial Attestation SP may need to be enabled and that depends on measured boot. Not sure if there are such plans for TC.\nIndeed. Though I believe this has to be officially queried to Matteo.",
      "parentUuid": "313f58f2_116eb51d",
      "revId": "e637a5e19da72599229fd2c70e793c123aaf14ca",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5dc98a16_835b99cb",
        "filename": "/COMMIT_MSG",
        "patchSetId": 3
      },
      "lineNbr": 11,
      "author": {
        "id": 1000018
      },
      "writtenOn": "2022-06-20T07:40:12Z",
      "side": 1,
      "message": "Ok, thanks!",
      "parentUuid": "9ad376e9_74e72ce2",
      "revId": "e637a5e19da72599229fd2c70e793c123aaf14ca",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5b4f46bd_3a56d6d4",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2022-06-14T13:22:34Z",
      "side": 1,
      "message": "I would like to see",
      "revId": "e637a5e19da72599229fd2c70e793c123aaf14ca",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "edf39ae2_739464d3",
        "filename": "include/drivers/measured_boot/event_log/event_log.h",
        "patchSetId": 3
      },
      "lineNbr": 81,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2022-06-14T13:22:34Z",
      "side": 1,
      "message": "Looking at the Arm Server Base Security Guide, I think secure partitions would fall under the \"Secure EL0 runtime component\" category, in which case the measurements strings should be of the form \"SECURE_RT_EL0_%s\". How about SECURE_RT_EL0_SP0, SECURE_RT_EL0_SP1, and so on?",
      "range": {
        "startLine": 81,
        "startChar": 26,
        "endLine": 81,
        "endChar": 31
      },
      "revId": "e637a5e19da72599229fd2c70e793c123aaf14ca",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c5fc8cae_1e936b38",
        "filename": "include/drivers/measured_boot/event_log/event_log.h",
        "patchSetId": 3
      },
      "lineNbr": 81,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2022-06-15T07:26:52Z",
      "side": 1,
      "message": "I believe this change will make it common to OP-TEE or Hafnium used as a SPMC.\nOP-TEE manages S-EL0 partitions.\nHafnium manages S-EL0 and S-EL1 partitions.\nI suspect such string wouldn\u0027t be accurate for the latter with EL0 in the name?",
      "parentUuid": "edf39ae2_739464d3",
      "range": {
        "startLine": 81,
        "startChar": 26,
        "endLine": 81,
        "endChar": 31
      },
      "revId": "e637a5e19da72599229fd2c70e793c123aaf14ca",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "511d9a20_f283bbbc",
        "filename": "include/drivers/measured_boot/event_log/event_log.h",
        "patchSetId": 3
      },
      "lineNbr": 81,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2022-06-15T08:04:55Z",
      "side": 1,
      "message": "OK fair enough. Then I suppose we can stick to the names originally proposed in this patch.",
      "parentUuid": "c5fc8cae_1e936b38",
      "range": {
        "startLine": 81,
        "startChar": 26,
        "endLine": 81,
        "endChar": 31
      },
      "revId": "e637a5e19da72599229fd2c70e793c123aaf14ca",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6598597f_2ac8d707",
        "filename": "include/drivers/measured_boot/event_log/event_log.h",
        "patchSetId": 3
      },
      "lineNbr": 81,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2022-06-15T10:33:47Z",
      "side": 1,
      "message": "Scratch that. Now you say it, I see value using standard event strings.\nFrom the SBSG I see the event string is qualified by its EL:\nSECURE_RT_EL0_%s\nSECURE_RT_EL1_%s\nSECURE_RT_EL2_%s\nSECURE_RT_EL3_%s\n\nSo ideally,\nBL32 would use SECURE_RT_EL2_BL32 when Hafnium is used (SECURE_RT_EL1_BL32 for OP-TEE).\nSecure partitions SECURE_RT_EL0_SP1 or SECURE_RT_EL1_SP1\n\nAlthough I admit the EL information is not necessarily easy to extract and requires more thinking (can be a future improvement).\n\nFor the Hafnium case, the most common usage for measured boot in Infra would be with SEL0 partitions. So eventually we could use SECURE_RT_EL0_%s to start with.",
      "parentUuid": "511d9a20_f283bbbc",
      "range": {
        "startLine": 81,
        "startChar": 26,
        "endLine": 81,
        "endChar": 31
      },
      "revId": "e637a5e19da72599229fd2c70e793c123aaf14ca",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5b2afc7c_92ea2e5c",
        "filename": "include/drivers/measured_boot/event_log/event_log.h",
        "patchSetId": 3
      },
      "lineNbr": 81,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2022-06-16T08:04:44Z",
      "side": 1,
      "message": "\u003e BL32 would use SECURE_RT_EL2_BL32 when Hafnium is used (SECURE_RT_EL1_BL32 for OP-TEE).\n\nI think we\u0027d rather use SECURE_RT_EL2_HAFNIUM / SECURE_RT_EL1_OPTEE. In fact the latter is already defined above. We could extend the #if chain starting at line 58 with:\n\n #if defined(SPD_spmd)\n   #define EVLOG_BL32_STRING\t\t\"SECURE_RT_EL2_HAFNIUM\"\n\nBut then again the problem is that it does not cover S-EL1 Hafnium... And when OPTEE is the SPMC, I guess it requires TF-A to be compiled with SPD\u003dspmd as well, is that right?\n\n\u003e For the Hafnium case, the most common usage for measured boot in Infra would be with SEL0 partitions. So eventually we could use SECURE_RT_EL0_%s to start with.\n\nSounds like a plan to me!",
      "parentUuid": "6598597f_2ac8d707",
      "range": {
        "startLine": 81,
        "startChar": 26,
        "endLine": 81,
        "endChar": 31
      },
      "revId": "e637a5e19da72599229fd2c70e793c123aaf14ca",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "400d0dcb_829745e1",
        "filename": "include/drivers/measured_boot/event_log/event_log.h",
        "patchSetId": 3
      },
      "lineNbr": 81,
      "author": {
        "id": 1000159
      },
      "writtenOn": "2022-06-22T10:48:44Z",
      "side": 1,
      "message": "Should we start with SECURE_RT_EL0_SP0 or SECURE_RT_EL0_SP1? It sounds reasonable to start indexing from zero, however it would be misleading to pair SECURE_RT_EL0_SP0 with SP_PKG1_ID.",
      "parentUuid": "5b2afc7c_92ea2e5c",
      "range": {
        "startLine": 81,
        "startChar": 26,
        "endLine": 81,
        "endChar": 31
      },
      "revId": "e637a5e19da72599229fd2c70e793c123aaf14ca",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3b0e321a_10e63f53",
        "filename": "include/drivers/measured_boot/event_log/event_log.h",
        "patchSetId": 3
      },
      "lineNbr": 81,
      "author": {
        "id": 1000114
      },
      "writtenOn": "2022-06-25T22:18:59Z",
      "side": 1,
      "message": "Sorry to chime in late. I dont think the EL information should matter. If an SP is FFA compliant, does it really doesnt matter whether it is running in SEL0 or SEL1 since in theory an SEL0 FFA SP could work with a SPMC provided SEL1 shim. The same SP can be portable across OPTEE and Hafnium SPMCs for example and need to change BL31/EL3 code for it seems odd?\nSPs need not be tied to the SPMC, and whether the SPMC is hafnium or optee should be captured in the measurement of the SPMC binary itself so not sure i understand why this qualification is required. Same with whether the SP is running in EL0 or EL1. The binary itself will be different or could be reflected in some other configuration measurement.\nLet me know if i\u0027m missing something.",
      "parentUuid": "400d0dcb_829745e1",
      "range": {
        "startLine": 81,
        "startChar": 26,
        "endLine": 81,
        "endChar": 31
      },
      "revId": "e637a5e19da72599229fd2c70e793c123aaf14ca",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "969b3b0e_27849ac1",
        "filename": "include/drivers/measured_boot/event_log/event_log.h",
        "patchSetId": 3
      },
      "lineNbr": 81,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2022-06-27T13:34:39Z",
      "side": 1,
      "message": "Hi Raghu,\n\nWe\u0027ve been trying to follow Arm\u0027s SBSG spec (see section 2.4 TPM 2.0 Integration and Measured Boot), which provides recommended strings for the event data that are used for Secure world firmware components. These recommended strings make the EL information appear in the image name.\n\nI think we\u0027ve not considered challenging whether that made sense or not. I guess this should be discussed further with the SBSG spec owners, and/or we could choose to diverge from these recommendations in TF-A implementation.\n\nI guess this all comes down to what information we want to capture along side a measurement. Naively I would think that the EL information does matter for a SP measurement because it is part of the nature of this SP. I imagine (but please correct me if I am wrong!) that SPs typically are meant to run at either S-EL0 or S-EL1, in which case their EL sounds like a property that defines them. Or do we actually have SPs which probe the exception level they are running into and adapt to either case?\n\nI think the root cause of our issues here is that, essentially the SP\u0027s exception level is related to the *execution* environment of the SP ; yet, it is embedded into TF-A BL2 which is just a loader and so it does not know about the execution environment of the images it loads. So I think this information is misplaced. Worse, it is currently statically hard-coded, which means that if a S-EL0 partition was to be replaced by a S-EL1 partition in the FIP, BL2 would need to be recompiled, which sounds wrong to me! I am not sure how to best address this, though...\n\nRegarding embedding the SPMC information in the SP measurement, I think there\u0027s been a misunderstanding. I completely agree with you, \"SPs need not be tied to the SPMC, and whether the SPMC is hafnium or optee should be captured in the measurement of the SPMC binary\". SECURE_RT_EL2_HAFNIUM / SECURE_RT_EL1_OPTEE were proposed as the strings describing the SPMC, not the SPs.",
      "parentUuid": "3b0e321a_10e63f53",
      "range": {
        "startLine": 81,
        "startChar": 26,
        "endLine": 81,
        "endChar": 31
      },
      "revId": "e637a5e19da72599229fd2c70e793c123aaf14ca",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "aff640a8_3e22d235",
        "filename": "plat/arm/board/fvp/fvp_bl2_measured_boot.c",
        "patchSetId": 3
      },
      "lineNbr": 35,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2022-06-14T13:22:34Z",
      "side": 1,
      "message": "Arguably we don\u0027t need this #if defined. We could add entries for secure partitions regardless of SPMD availability. This array only describes the superset of images we support measuring. There is no requirement that they must all be present. For example, notice the BL32_EXTRAn_IMAGE_ID entries above, AFAIU these are only present when using OP-TEE but we did not bother guarding them under some preprocessor condition.\n\nEven though this will unecessarily increase the size of the array for systems that don\u0027t use SPMD/SPs, I would be leaning towards removing this line, as I think #ifdefs are bad from a codebase maintainance perspective.",
      "range": {
        "startLine": 35,
        "startChar": 0,
        "endLine": 35,
        "endChar": 21
      },
      "revId": "e637a5e19da72599229fd2c70e793c123aaf14ca",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d2e28c36_0ee24df5",
        "filename": "plat/arm/board/fvp/fvp_bl2_measured_boot.c",
        "patchSetId": 3
      },
      "lineNbr": 35,
      "author": {
        "id": 1000159
      },
      "writtenOn": "2022-06-22T10:48:44Z",
      "side": 1,
      "message": "I\u0027ve added the #if because SP_PKGx_IDs are defined under the same condition in include/common/tbbr/tbbr_img_def.h.",
      "parentUuid": "aff640a8_3e22d235",
      "range": {
        "startLine": 35,
        "startChar": 0,
        "endLine": 35,
        "endChar": 21
      },
      "revId": "e637a5e19da72599229fd2c70e793c123aaf14ca",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d7bd0e52_4fc49514",
        "filename": "plat/arm/board/fvp/fvp_bl2_measured_boot.c",
        "patchSetId": 3
      },
      "lineNbr": 35,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2022-06-29T08:50:34Z",
      "side": 1,
      "message": "Fair point! Thanks for providing the rationale.",
      "parentUuid": "d2e28c36_0ee24df5",
      "range": {
        "startLine": 35,
        "startChar": 0,
        "endLine": 35,
        "endChar": 21
      },
      "revId": "e637a5e19da72599229fd2c70e793c123aaf14ca",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    }
  ]
}