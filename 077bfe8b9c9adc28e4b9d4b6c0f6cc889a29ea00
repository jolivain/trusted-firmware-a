{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "fa451cb4_e8b70bfd",
        "filename": "drivers/fwu/fwu.c",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2021-06-24T14:24:25Z",
      "side": 1,
      "message": "Have you considered merging fwu.c and fwu_metadata.c files? What is the reason for splitting the functions across these 2 files? Neither of them seems too big to me to require a split (but that\u0027s a subjective opinion I guess).\n\nOne advantage I see in having the implementation self-contained within a single file is it would allow to make some of the global variables static.",
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "81f87c14_a99021a4",
        "filename": "drivers/fwu/fwu.c",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-25T06:04:44Z",
      "side": 1,
      "message": "I just splitted this file for readability to cover all FWU metadata image load functionality in one file, other file to add all exported function definitions.\n\nAs per your comments, seeing some advantage in making a single file. Let me club both files, will think about splitting of these in future, depend upon any new functionalities get added.",
      "parentUuid": "fa451cb4_e8b70bfd",
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "82c42afe_d9a5df46",
        "filename": "drivers/fwu/fwu.c",
        "patchSetId": 7
      },
      "lineNbr": 0,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-28T10:09:37Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "81f87c14_a99021a4",
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "58b1abd6_eff47be1",
        "filename": "drivers/fwu/fwu.c",
        "patchSetId": 7
      },
      "lineNbr": 19,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2021-06-24T14:24:25Z",
      "side": 1,
      "message": "(nit) I don\u0027t think it\u0027s particularly useful to repeat the function name in the doc, it\u0027s right below.",
      "range": {
        "startLine": 19,
        "startChar": 3,
        "endLine": 19,
        "endChar": 26
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b2d086b9_9744ea32",
        "filename": "drivers/fwu/fwu.c",
        "patchSetId": 7
      },
      "lineNbr": 19,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-25T06:04:44Z",
      "side": 1,
      "message": "Agree about name duplication, I will remove function names from all function header in this patch series.\n\nI think there is no certain rule in TF-A for function header, we need to develop one to look every function header consistent.",
      "parentUuid": "58b1abd6_eff47be1",
      "range": {
        "startLine": 19,
        "startChar": 3,
        "endLine": 19,
        "endChar": 26
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3a8847c2_2759e95e",
        "filename": "drivers/fwu/fwu.c",
        "patchSetId": 7
      },
      "lineNbr": 19,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2021-06-30T08:59:24Z",
      "side": 1,
      "message": "\u003e I think there is no certain rule in TF-A for function header, we need to develop one to look every function header consistent.\n\nYes indeed, we could propose something in the coding guidelines.",
      "parentUuid": "b2d086b9_9744ea32",
      "range": {
        "startLine": 19,
        "startChar": 3,
        "endLine": 19,
        "endChar": 26
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "061865ff_1168fb43",
        "filename": "drivers/fwu/fwu.c",
        "patchSetId": 7
      },
      "lineNbr": 21,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2021-06-24T14:24:25Z",
      "side": 1,
      "message": "(minor) Remove one \u0027the\u0027, there\u0027s 2 of them.",
      "range": {
        "startLine": 21,
        "startChar": 62,
        "endLine": 21,
        "endChar": 65
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ab2ff88c_ec9e848c",
        "filename": "drivers/fwu/fwu.c",
        "patchSetId": 7
      },
      "lineNbr": 21,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-25T06:04:44Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "061865ff_1168fb43",
      "range": {
        "startLine": 21,
        "startChar": 62,
        "endLine": 21,
        "endChar": 65
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ce0120e2_659c8dbe",
        "filename": "drivers/fwu/fwu.c",
        "patchSetId": 7
      },
      "lineNbr": 21,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-28T10:09:37Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ab2ff88c_ec9e848c",
      "range": {
        "startLine": 21,
        "startChar": 62,
        "endLine": 21,
        "endChar": 65
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f0ea630a_d3ba13c7",
        "filename": "drivers/fwu/fwu.c",
        "patchSetId": 7
      },
      "lineNbr": 42,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2021-06-24T14:24:25Z",
      "side": 1,
      "message": "I think panic() is not the right behaviour in this case. My understanding is that the condition for hitting this error case is if fwu_init() has not been called before this point, which sounds like a programming error to me. Thus, it should be handled through an assert().",
      "range": {
        "startLine": 42,
        "startChar": 2,
        "endLine": 42,
        "endChar": 10
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e29f9a1f_66913577",
        "filename": "drivers/fwu/fwu.c",
        "patchSetId": 7
      },
      "lineNbr": 42,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-28T10:09:37Z",
      "side": 1,
      "message": "Yes, make sense to put assert here.",
      "parentUuid": "f0ea630a_d3ba13c7",
      "range": {
        "startLine": 42,
        "startChar": 2,
        "endLine": 42,
        "endChar": 10
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2fef642a_b2d5803e",
        "filename": "drivers/fwu/fwu.mk",
        "patchSetId": 7
      },
      "lineNbr": 12,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2021-06-24T14:24:25Z",
      "side": 1,
      "message": "This line reminds me of one limitation we have, which is that BL2 is not updatable using the PSA FWU scheme. If we\u0027re using the spec terminology, I guess this means that BL2 is not part of the protocol-updatable images. If BL2 needs to be updated, this has to be done through another mechanism.\n\nHas this been called out somewhere in the documentation? I think it\u0027s worth mentioning to bridge the gap between the spec and how this maps to TF-A firmware stages.\n\nThis does not have to be done as part of this patch, I\u0027d rather have it in the documentation patch.",
      "range": {
        "startLine": 12,
        "startChar": 0,
        "endLine": 12,
        "endChar": 29
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cbbc56c7_b7964801",
        "filename": "drivers/fwu/fwu.mk",
        "patchSetId": 7
      },
      "lineNbr": 12,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-25T06:04:44Z",
      "side": 1,
      "message": "Agree, I will update the documentation to mention this explicitly.",
      "parentUuid": "2fef642a_b2d5803e",
      "range": {
        "startLine": 12,
        "startChar": 0,
        "endLine": 12,
        "endChar": 29
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ff2df253_8e1888a4",
        "filename": "drivers/fwu/fwu.mk",
        "patchSetId": 7
      },
      "lineNbr": 12,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-28T10:09:37Z",
      "side": 1,
      "message": "Done, added this in the documentation patch.",
      "parentUuid": "cbbc56c7_b7964801",
      "range": {
        "startLine": 12,
        "startChar": 0,
        "endLine": 12,
        "endChar": 29
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "70943796_2b372501",
        "filename": "drivers/fwu/fwu_metadata.c",
        "patchSetId": 7
      },
      "lineNbr": 19,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2021-06-24T14:24:25Z",
      "side": 1,
      "message": "Could you please add a comment to explain the concerns that justified introducing this?\n\nOr perhaps better, move it to fwu_metadata_crc_check(), just above the call to hw_crc32(), which would tell people that the 2 lines are related. Then perhaps we don\u0027t need a comment, or at least a shorter one.",
      "range": {
        "startLine": 18,
        "startChar": 0,
        "endLine": 19,
        "endChar": 43
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1a66f4e8_310ac505",
        "filename": "drivers/fwu/fwu_metadata.c",
        "patchSetId": 7
      },
      "lineNbr": 19,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-25T06:04:44Z",
      "side": 1,
      "message": "Ack, I will prefer to retain CASSERT here only (to be inlined with other CASSERTs used in TF-A code) with appropriate comment.",
      "parentUuid": "70943796_2b372501",
      "range": {
        "startLine": 18,
        "startChar": 0,
        "endLine": 19,
        "endChar": 43
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5b75a5f7_f095ae6a",
        "filename": "drivers/fwu/fwu_metadata.c",
        "patchSetId": 7
      },
      "lineNbr": 19,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-28T10:09:37Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "1a66f4e8_310ac505",
      "range": {
        "startLine": 18,
        "startChar": 0,
        "endLine": 19,
        "endChar": 43
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1795fc8b_2180c0da",
        "filename": "drivers/fwu/fwu_metadata.c",
        "patchSetId": 7
      },
      "lineNbr": 64,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2021-06-24T14:24:25Z",
      "side": 1,
      "message": "Would it make sense to be more explicit and reference the exact macro names (instead of plain English)? i.e. FWU_METADATA_IMAGE_ID / BKUP_FWU_METADATA_IMAGE_ID",
      "range": {
        "startLine": 64,
        "startChar": 36,
        "endLine": 64,
        "endChar": 62
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "28155d60_0ee15b85",
        "filename": "drivers/fwu/fwu_metadata.c",
        "patchSetId": 7
      },
      "lineNbr": 64,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-25T06:04:44Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "1795fc8b_2180c0da",
      "range": {
        "startLine": 64,
        "startChar": 36,
        "endLine": 64,
        "endChar": 62
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ac51648d_a8614c30",
        "filename": "drivers/fwu/fwu_metadata.c",
        "patchSetId": 7
      },
      "lineNbr": 64,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-28T10:09:37Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "28155d60_0ee15b85",
      "range": {
        "startLine": 64,
        "startChar": 36,
        "endLine": 64,
        "endChar": 62
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a86b57db_bad9f962",
        "filename": "drivers/fwu/fwu_metadata.c",
        "patchSetId": 7
      },
      "lineNbr": 78,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2021-06-24T14:24:25Z",
      "side": 1,
      "message": "Might as well return the error code from plat_set_fwu_metadata_image_source(), as we have this information at hand? It might provide more specific information to the caller. Perhaps in the future, when fwu_init() calls plat_error_handler() instead of panic(), it can pass this error code to plat_error_handler(), which might be able to take better decisions based on this value.",
      "range": {
        "startLine": 78,
        "startChar": 2,
        "endLine": 78,
        "endChar": 12
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "374e115f_da89b20d",
        "filename": "drivers/fwu/fwu_metadata.c",
        "patchSetId": 7
      },
      "lineNbr": 78,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-25T06:04:44Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "a86b57db_bad9f962",
      "range": {
        "startLine": 78,
        "startChar": 2,
        "endLine": 78,
        "endChar": 12
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4ea9223a_05796ff5",
        "filename": "drivers/fwu/fwu_metadata.c",
        "patchSetId": 7
      },
      "lineNbr": 78,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-28T10:09:37Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "374e115f_da89b20d",
      "range": {
        "startLine": 78,
        "startChar": 2,
        "endLine": 78,
        "endChar": 12
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9510da20_9360d6a0",
        "filename": "drivers/fwu/fwu_metadata.c",
        "patchSetId": 7
      },
      "lineNbr": 81,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2021-06-24T14:24:25Z",
      "side": 1,
      "message": "We first call plat_set_fwu_metadata_image_source(), which updates the I/O policy for this image. Then we call plat_get_image_source(), which will retrieve the policy information we\u0027ve just set. It seems like a waste to me, can\u0027t plat_set_fwu_metadata_image_source() directly return the policy information we need? Or does it make not sense? I must admit my I/O layer knowledge is not that good so it\u0027s very possible I am missing some obvious reasons why it has to be designed in that way.\n\nLooking at plat_get_image_source() for Arm platforms, I see this is doing 2 things in addition to retrieving the policy information:\n\n1) Checking the policy (through the check() callback)\n2) Trying out an alternative image source in case this one does not pass the checks.\n\n1) might be needed (?) but 2) seems inappropriate to me. In the case of PSA FWU, do we really want to use something else than the partition information we set up through plat_set_fwu_metadata_image_source()?",
      "range": {
        "startLine": 81,
        "startChar": 10,
        "endLine": 81,
        "endChar": 31
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f0d864ee_e3a3abfb",
        "filename": "drivers/fwu/fwu_metadata.c",
        "patchSetId": 7
      },
      "lineNbr": 81,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-25T06:04:44Z",
      "side": 1,
      "message": "I prefer to remove \u0027plat_get_image_source\u0027 call to avoid un-necessary complexities, and use \u0027plat_set_fwu_metadata_image_source\u0027 function to return back \u0027dev_handle\u0027 and \u0027image_spec\u0027.",
      "parentUuid": "9510da20_9360d6a0",
      "range": {
        "startLine": 81,
        "startChar": 10,
        "endLine": 81,
        "endChar": 31
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "870f4026_a8392eae",
        "filename": "drivers/fwu/fwu_metadata.c",
        "patchSetId": 7
      },
      "lineNbr": 81,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-28T10:09:37Z",
      "side": 1,
      "message": "\u0027plat_set_fwu_metadata_image_source\u0027 update up I/O policy information mainly for image specification. In Arm platform, this function retrieves partition information of \u0027FWU metadata\u0027 (offset inside NV storage and size), and then use this information to update image specification.\nI modified this API \u0027plat_set_fwu_metadata_image_source\u0027 now to set the image specification, and also return \u0027dev_handle\u0027 and \u0027image_spec\u0027 of requested metadata image.\n\nIMO, we should update \u0027load_auth_image\u0027 that provides an opportunity to load the image from the next boot source that will not work as per FWU specification.\nThis function nobody is using as of now, but it will cause a problem if partners start using this function along with FWU implementation. I prefer to have a separate do...while loop for FWU implementation as below:\n\n  #if PSA_FWU_SUPPORT\n\tdo {\n\t\terr \u003d load_auth_image_internal(image_id, image_data);\n\t} while (err !\u003d 0);\n  #else\n\tdo {\n\t\terr \u003d load_auth_image_internal(image_id, image_data);\n\t} while ((err !\u003d 0) \u0026\u0026 (plat_try_next_boot_source() !\u003d 0));\n  #endif /* PSA_FWU_SUPPORT */ \n\nLet me know what do you think about this accordingly will update the code?",
      "parentUuid": "f0d864ee_e3a3abfb",
      "range": {
        "startLine": 81,
        "startChar": 10,
        "endLine": 81,
        "endChar": 31
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "38cd2a56_371f1cbb",
        "filename": "drivers/fwu/fwu_metadata.c",
        "patchSetId": 7
      },
      "lineNbr": 81,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2021-06-30T08:59:24Z",
      "side": 1,
      "message": "\u003e IMO, we should update \u0027load_auth_image\u0027 that provides an opportunity to load the image from the next boot source that will not work as per FWU specification.\n\u003e This function nobody is using as of now, but it will cause a problem if partners start using this function along with FWU implementation.\n\nWhen you say that nobody is using this function, which function are you referring to? plat_try_next_boot_source()? If yes then I agree that no upstream platform uses it right now but I suspect there might be downstream users. The reason I am saying that is, this feature was requested by Broadcom a few years ago. If they requested it then they\u0027re probably relying on it. This Github pull request has all the details:\n\n https://github.com/ARM-software/arm-trusted-firmware/pull/868\n\n\u003e I prefer to have a separate do...while loop for FWU implementation as below:\n\u003e \n\u003e   #if PSA_FWU_SUPPORT\n\u003e \tdo {\n\u003e \t\terr \u003d load_auth_image_internal(image_id, image_data);\n\u003e \t} while (err !\u003d 0);\n\u003e   #else\n\u003e \tdo {\n\u003e \t\terr \u003d load_auth_image_internal(image_id, image_data);\n\u003e \t} while ((err !\u003d 0) \u0026\u0026 (plat_try_next_boot_source() !\u003d 0));\n\u003e   #endif /* PSA_FWU_SUPPORT */ \n\u003e \n\u003e Let me know what do you think about this accordingly will update the code?\n\nLet me first check my understanding with you. When PSA FWU support is disabled,\nplat_try_next_boot_source() provides a mean to try and load an image from a different boot source, in case the previous one did not work. For example, the platform layer might indicate that we should first attempt to load the image from NAND flash and if we find out that the image there is not valid, then fall back to eMMC.\n\nThe reason why we would like to bypass this boot redundancy feature in the case of PSA FWU is because the way we load images in this case looks completely different. The FWU metadata dictates where the images should come from. In particular, struct fwu_image_entry has a location_uuid field, which effectively indicates the boot source. Thus, we don\u0027t want plat_try_next_boot_source() to overwrite this decision.\n\nHow would we implement boot redundancy in the PSA FWU scheme then? Would each boot source be represented as a different firmware bank? That would mean that firmware banks may be stored on different boot sources. For example, one firmware bank on NAND flash, another one on eMMC, yet another one on USB...\n\nDoes that make sense?",
      "parentUuid": "870f4026_a8392eae",
      "range": {
        "startLine": 81,
        "startChar": 10,
        "endLine": 81,
        "endChar": 31
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "36dd09ab_ecec7da6",
        "filename": "drivers/fwu/fwu_metadata.c",
        "patchSetId": 7
      },
      "lineNbr": 107,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2021-06-24T14:24:25Z",
      "side": 1,
      "message": "Should that rather be image_id? The caller might pass BKUP_FWU_METADATA_IMAGE_ID, right?",
      "range": {
        "startLine": 107,
        "startChar": 8,
        "endLine": 107,
        "endChar": 29
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "09fd9bd3_7d0d1bf2",
        "filename": "drivers/fwu/fwu_metadata.c",
        "patchSetId": 7
      },
      "lineNbr": 107,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-25T06:04:44Z",
      "side": 1,
      "message": "Ack, somehow I missed to change this to image_id after restructuring the code.",
      "parentUuid": "36dd09ab_ecec7da6",
      "range": {
        "startLine": 107,
        "startChar": 8,
        "endLine": 107,
        "endChar": 29
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4686e25f_b96e1ad3",
        "filename": "drivers/fwu/fwu_metadata.c",
        "patchSetId": 7
      },
      "lineNbr": 107,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-28T10:09:37Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "09fd9bd3_7d0d1bf2",
      "range": {
        "startLine": 107,
        "startChar": 8,
        "endLine": 107,
        "endChar": 29
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d201e585_5682a3ed",
        "filename": "drivers/fwu/fwu_metadata.c",
        "patchSetId": 7
      },
      "lineNbr": 128,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2021-06-24T14:24:25Z",
      "side": 1,
      "message": "My I/O layer knowledge is a bit rusty, can you remind me who is calling the companion io_dev_open()? Is it plat_get_image_source() or io_open()? If it\u0027s the former then we will have to introduce a new goto label and make io_open() error handling code jump to it.",
      "range": {
        "startLine": 128,
        "startChar": 1,
        "endLine": 128,
        "endChar": 32
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "976c7d23_56f17600",
        "filename": "drivers/fwu/fwu_metadata.c",
        "patchSetId": 7
      },
      "lineNbr": 128,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-25T06:04:44Z",
      "side": 1,
      "message": "io_dev_open() gets called from \u0027arm_io_setup()\u0027 during \u0027arm_bl2_early_platform_setup\u0027. It is neither gets called from plat_get_image_source() nor from io_open().\n\u0027io_dev_close()\u0027 this function simply return without doing anything as of now, and I added here only for completeness [1]. There is \u0027ToDo\u0027 to clean up the resources, but that is not in scope of this change.\n\n[1]: https://git.trustedfirmware.org/TF-A/trusted-firmware-a.git/tree/drivers/io/io_memmap.c#n92",
      "parentUuid": "d201e585_5682a3ed",
      "range": {
        "startLine": 128,
        "startChar": 1,
        "endLine": 128,
        "endChar": 32
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "10ba9283_ed28e139",
        "filename": "drivers/fwu/fwu_metadata.c",
        "patchSetId": 7
      },
      "lineNbr": 128,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-25T17:00:01Z",
      "side": 1,
      "message": "My previous comment was solely regarding the Arm platform. Other platforms calls \u0027io_dev_open\u0027 during setup phase only same as Arm platforms, but preferred not to close the device.\n\nAs this is common code, I prefer to remove \u0027io_dev_close\u0027 call.",
      "parentUuid": "976c7d23_56f17600",
      "range": {
        "startLine": 128,
        "startChar": 1,
        "endLine": 128,
        "endChar": 32
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3b68bd36_3985f7d3",
        "filename": "drivers/fwu/fwu_metadata.c",
        "patchSetId": 7
      },
      "lineNbr": 128,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-28T10:09:37Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "10ba9283_ed28e139",
      "range": {
        "startLine": 128,
        "startChar": 1,
        "endLine": 128,
        "endChar": 32
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "975ec31f_e2f1319c",
        "filename": "drivers/fwu/fwu_private.h",
        "patchSetId": 7
      },
      "lineNbr": 10,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2021-06-24T14:24:25Z",
      "side": 1,
      "message": "From a quick git grep, it looks like this variable is only used by drivers/fwu/fwu.c. If this is right, this should not be exported as a global variable (even in a private header file) but rather keep it as a static variable within fwu.c.",
      "range": {
        "startLine": 10,
        "startChar": 0,
        "endLine": 10,
        "endChar": 31
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b1b4bf69_07ff4bbc",
        "filename": "drivers/fwu/fwu_private.h",
        "patchSetId": 7
      },
      "lineNbr": 10,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-25T06:04:44Z",
      "side": 1,
      "message": "Agree, will put this as a static.",
      "parentUuid": "975ec31f_e2f1319c",
      "range": {
        "startLine": 10,
        "startChar": 0,
        "endLine": 10,
        "endChar": 31
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ec844713_2c505a4d",
        "filename": "drivers/fwu/fwu_private.h",
        "patchSetId": 7
      },
      "lineNbr": 10,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-28T10:09:37Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b1b4bf69_07ff4bbc",
      "range": {
        "startLine": 10,
        "startChar": 0,
        "endLine": 10,
        "endChar": 31
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f8fc4bd9_39249ef8",
        "filename": "drivers/fwu/fwu_private.h",
        "patchSetId": 7
      },
      "lineNbr": 11,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2021-06-24T14:24:25Z",
      "side": 1,
      "message": "We should include the header file that provides struct fwu_metadata type definition.\n\nAnd also stdbool.h.",
      "range": {
        "startLine": 11,
        "startChar": 7,
        "endLine": 11,
        "endChar": 26
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1e3f9bb6_b5a97f21",
        "filename": "drivers/fwu/fwu_private.h",
        "patchSetId": 7
      },
      "lineNbr": 11,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2021-06-24T14:24:25Z",
      "side": 1,
      "message": "\u0027metadata\u0027 sounds too generic for a global variable, the risk of name clashing is too high. I would have suggested fwu_metadata but unfortunately I think MISRA rules forbid using the same identifiers for a variable and a type (although C consider them as separate name spaces). I don\u0027t have good suggestions right now, I\u0027ll give it some more thoughts...",
      "range": {
        "startLine": 11,
        "startChar": 27,
        "endLine": 11,
        "endChar": 35
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6766251e_9aed69bd",
        "filename": "drivers/fwu/fwu_private.h",
        "patchSetId": 7
      },
      "lineNbr": 11,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-25T06:04:44Z",
      "side": 1,
      "message": "agree for stdbool.h, fwu_metadata.h header inclusion.\nbut I did not see any issue though as this header gets included in C file along with std*.h and fwu_metadata.h file.\nAnyways, as we discussed, will remove this header.",
      "parentUuid": "f8fc4bd9_39249ef8",
      "range": {
        "startLine": 11,
        "startChar": 7,
        "endLine": 11,
        "endChar": 26
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fdf3a68f_f6f83935",
        "filename": "drivers/fwu/fwu_private.h",
        "patchSetId": 7
      },
      "lineNbr": 11,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-25T06:04:44Z",
      "side": 1,
      "message": "As per your last comment, we decided to put \u0027metadata\u0027 as variable name instead of \u0027g_fwu_metadata\u0027. Agree \u0027metadata\u0027 looks quite generic name, but its usage are local to FWU module. (if I make this as static variable). still you think we need to change its name?",
      "parentUuid": "1e3f9bb6_b5a97f21",
      "range": {
        "startLine": 11,
        "startChar": 27,
        "endLine": 11,
        "endChar": 35
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8bd638b9_ee77610f",
        "filename": "drivers/fwu/fwu_private.h",
        "patchSetId": 7
      },
      "lineNbr": 11,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-28T10:09:37Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6766251e_9aed69bd",
      "range": {
        "startLine": 11,
        "startChar": 7,
        "endLine": 11,
        "endChar": 26
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "82bce719_901c5abd",
        "filename": "drivers/fwu/fwu_private.h",
        "patchSetId": 7
      },
      "lineNbr": 11,
      "author": {
        "id": 1000328
      },
      "writtenOn": "2021-06-28T10:09:37Z",
      "side": 1,
      "message": "I retained \u0027metadata\u0027 name only until we decide other name for this variable.",
      "parentUuid": "fdf3a68f_f6f83935",
      "range": {
        "startLine": 11,
        "startChar": 27,
        "endLine": 11,
        "endChar": 35
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "be57d380_cf5aaf8c",
        "filename": "drivers/fwu/fwu_private.h",
        "patchSetId": 7
      },
      "lineNbr": 11,
      "author": {
        "id": 1000043
      },
      "writtenOn": "2021-06-30T08:59:24Z",
      "side": 1,
      "message": "I think \u0027metadata\u0027 name is fine now that it is a static variable (as opposed to a global one).",
      "parentUuid": "82bce719_901c5abd",
      "range": {
        "startLine": 11,
        "startChar": 27,
        "endLine": 11,
        "endChar": 35
      },
      "revId": "077bfe8b9c9adc28e4b9d4b6c0f6cc889a29ea00",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    }
  ]
}