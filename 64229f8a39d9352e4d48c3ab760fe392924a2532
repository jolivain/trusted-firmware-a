{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "a1a2ce70_c34ab4ef",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 22,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2021-04-01T09:45:05Z",
      "side": 1,
      "message": "More context to the commit message will be useful , like \"there is a NS and S version of the EL2 timer registers and hence saving and restoring them from EL3 is not needed\"..",
      "revId": "64229f8a39d9352e4d48c3ab760fe392924a2532",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "463c6342_fdda4366",
        "filename": "lib/el3_runtime/aarch64/context.S",
        "patchSetId": 1
      },
      "lineNbr": 56,
      "author": {
        "id": 1000105
      },
      "writtenOn": "2021-04-01T12:11:40Z",
      "side": 1,
      "message": "Do we need to save/restore CNTVOFF_EL2?",
      "revId": "64229f8a39d9352e4d48c3ab760fe392924a2532",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "eabb5bd1_d10f2802",
        "filename": "lib/el3_runtime/aarch64/context.S",
        "patchSetId": 1
      },
      "lineNbr": 56,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2021-04-01T12:29:05Z",
      "side": 1,
      "message": "This is a valid question provided this would normally be updated by a Hypervisor VM save/restore sequence (in secure or normal worlds). Although this register is not banked in HW so isn\u0027t there a possibility to leak some timing information from S to NS (or either way?)",
      "parentUuid": "463c6342_fdda4366",
      "revId": "64229f8a39d9352e4d48c3ab760fe392924a2532",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "22cf4194_5c9ddb99",
        "filename": "lib/el3_runtime/aarch64/context.S",
        "patchSetId": 1
      },
      "lineNbr": 56,
      "author": {
        "id": 1000279
      },
      "writtenOn": "2021-04-01T12:30:57Z",
      "side": 1,
      "message": "I haven\u0027t checked all the register, but looking at the documentation I don\u0027t see why it should not be. There is no world-specific counterpart and it is used in a both worlds (currently set to 0). Why do you think it should not be saved/restored?",
      "parentUuid": "463c6342_fdda4366",
      "revId": "64229f8a39d9352e4d48c3ab760fe392924a2532",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3adfb8fd_49c6e6bd",
        "filename": "lib/el3_runtime/aarch64/context.S",
        "patchSetId": 1
      },
      "lineNbr": 56,
      "author": {
        "id": 1000105
      },
      "writtenOn": "2021-04-01T12:49:24Z",
      "side": 1,
      "message": "Why is saving/restoring registers effected by this patch causing the problem, as EL3 doesn\u0027t change their values?",
      "parentUuid": "22cf4194_5c9ddb99",
      "revId": "64229f8a39d9352e4d48c3ab760fe392924a2532",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "062d42b2_eb3b8e56",
        "filename": "lib/el3_runtime/aarch64/context.S",
        "patchSetId": 1
      },
      "lineNbr": 56,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2021-04-01T13:30:48Z",
      "side": 1,
      "message": "For example the CNTHV timer registers might be programmed in the normal world to expect a timer interrupt firing at a later time. For the following scenario where NS calls a secure service in a secure partition:\n\n1. from NS to SPMD, save non-secure CNTV_TVAL (it has a timestamp value X0)\n2. restore secure CNTV_TVAL value Y0\n3. enter SPMC and/or a secure partition\n4. back to SPMD save secure CNTV_TVAL value Y1\n5. restore non-secure CNTV_TVAL X0\n\nBetween steps 1 and 5 counter is still supposed to run so from the perspective of the normal world it happens as if no time had elapsed during the secure world execution. On complex scenarios (e.g. xtest calling OP-TEE on top of Hafnium), linux warns about rcu stalls and cores lagging behind (sometimes hangs) when it does its scheduler housekeeping.\nBy applying those errors/hangs are gone.\nTo put it short, secure side is not meant to touch NS timers.\nSecure world shall use its own timer resources which are banked secure in HW (and hence not accessible to normal world).",
      "parentUuid": "3adfb8fd_49c6e6bd",
      "revId": "64229f8a39d9352e4d48c3ab760fe392924a2532",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dfe747c7_06689194",
        "filename": "lib/el3_runtime/aarch64/context.S",
        "patchSetId": 1
      },
      "lineNbr": 56,
      "author": {
        "id": 1000228
      },
      "writtenOn": "2021-04-01T13:35:11Z",
      "side": 1,
      "message": "Btw there are other problems like which entity owns the CNTV interrupt. If configured as non-secure, there is no simple way to toggle it secure on world switch and keep the time information consistent.",
      "parentUuid": "062d42b2_eb3b8e56",
      "revId": "64229f8a39d9352e4d48c3ab760fe392924a2532",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "059a471d_273a2d6c",
        "filename": "lib/el3_runtime/aarch64/context.S",
        "patchSetId": 1
      },
      "lineNbr": 330,
      "author": {
        "id": 1000105
      },
      "writtenOn": "2021-04-01T12:11:40Z",
      "side": 1,
      "message": "Do we need to save/restore CNTPOFF_EL2?",
      "revId": "64229f8a39d9352e4d48c3ab760fe392924a2532",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    }
  ]
}