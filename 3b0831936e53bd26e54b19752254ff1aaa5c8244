{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "4d51cddd_c8f7ffbf",
        "filename": "lib/extensions/spe/spe.c",
        "patchSetId": 20
      },
      "lineNbr": 137,
      "author": {
        "id": 1000750
      },
      "writtenOn": "2023-10-30T21:01:25Z",
      "side": 1,
      "message": "Hi Jayanth, \nIt\u0027s not clear to me why you need to save the core state into a context structure in memory, since the suspend (standby/retention) mode preserves the core state. In case it is still necessary, can you please add a comment to explain why it is?",
      "range": {
        "startLine": 100,
        "startChar": 0,
        "endLine": 137,
        "endChar": 69
      },
      "revId": "3b0831936e53bd26e54b19752254ff1aaa5c8244",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ee3ce7ce_ca797c24",
        "filename": "lib/extensions/spe/spe.c",
        "patchSetId": 20
      },
      "lineNbr": 137,
      "author": {
        "id": 1000660
      },
      "writtenOn": "2023-10-31T16:45:52Z",
      "side": 1,
      "message": "Discussed offline.",
      "parentUuid": "4d51cddd_c8f7ffbf",
      "range": {
        "startLine": 100,
        "startChar": 0,
        "endLine": 137,
        "endChar": 69
      },
      "revId": "3b0831936e53bd26e54b19752254ff1aaa5c8244",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9e6bd3d1_87d66daa",
        "filename": "lib/extensions/spe/spe.c",
        "patchSetId": 20
      },
      "lineNbr": 137,
      "author": {
        "id": 1000660
      },
      "writtenOn": "2023-10-31T16:46:03Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "ee3ce7ce_ca797c24",
      "range": {
        "startLine": 100,
        "startChar": 0,
        "endLine": 137,
        "endChar": 69
      },
      "revId": "3b0831936e53bd26e54b19752254ff1aaa5c8244",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f2093140_bbb2a79b",
        "filename": "lib/extensions/spe/spe.c",
        "patchSetId": 20
      },
      "lineNbr": 137,
      "author": {
        "id": 1000750
      },
      "writtenOn": "2024-01-09T19:30:04Z",
      "side": 1,
      "message": "@Jayanth, as discussed recently, maybe now it\u0027s a good time to revive this comment. It would be good to know what others have to say regarding this too. Thanks.",
      "parentUuid": "9e6bd3d1_87d66daa",
      "range": {
        "startLine": 100,
        "startChar": 0,
        "endLine": 137,
        "endChar": 69
      },
      "revId": "3b0831936e53bd26e54b19752254ff1aaa5c8244",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "85a24f49_3fb31628",
        "filename": "lib/extensions/spe/spe.c",
        "patchSetId": 20
      },
      "lineNbr": 137,
      "author": {
        "id": 1000750
      },
      "writtenOn": "2024-02-01T22:35:31Z",
      "side": 1,
      "message": "I think that, given the fact that the state is not preserved during suspend, we can keep the context save/restore for pmblimitr_el1. \n\nNow, it is not clear to me why we are having this behavior (not getting the state preserved). This is what is in the ARM-ARM:\n\n----\nStandby\n(...)\nThe **PE preserves the PE state**, including the debug logic state. Changing from standby to normal operation does not involve a reset of the PE. \n\nRetention\nThe OS takes some measures, including IMPLEMENTATION DEFINED code sequences and registers, to reduce energy consumption. **The PE state, including debug settings, is preserved in low-power structures**, allowing the Core power domain to be at least partially turned off.\n\n----\n\n\nFor Standby, it is very straightforward, but for Retention, it doesn\u0027t explicitly say who saves the PE state in low-power structures (HW vs SW). Also, not sure of which one of the states the FVP switches to in your tests.\n\nPlease let me know your thoughts. I am OK to give my vote to the patch as it is anyway.",
      "parentUuid": "f2093140_bbb2a79b",
      "range": {
        "startLine": 100,
        "startChar": 0,
        "endLine": 137,
        "endChar": 69
      },
      "revId": "3b0831936e53bd26e54b19752254ff1aaa5c8244",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "46b46629_74e75186",
        "filename": "lib/extensions/spe/spe.c",
        "patchSetId": 20
      },
      "lineNbr": 137,
      "author": {
        "id": 1000744
      },
      "writtenOn": "2024-02-02T17:31:41Z",
      "side": 1,
      "message": "Perhaps I\u0027m missing something here but isn\u0027t this context only intended to be saved/restored on the powerdown path. From my reading, and yours I think, this makes no guarantees about core state being preserved. The PSCI spec is pretty clear on this point:\n___\n\nPower-down: In this state the core is powered off. Software on the device needs to **save all core state**, so that it can be preserved over the powerdown. Changing from\npowerdown to running operation must include:\n\n* A reset of the core, after the power has been restored.\n* Restoring the saved core state.\n___",
      "parentUuid": "85a24f49_3fb31628",
      "range": {
        "startLine": 100,
        "startChar": 0,
        "endLine": 137,
        "endChar": 69
      },
      "revId": "3b0831936e53bd26e54b19752254ff1aaa5c8244",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0567883b_d4ce795e",
        "filename": "lib/extensions/spe/spe.c",
        "patchSetId": 20
      },
      "lineNbr": 137,
      "author": {
        "id": 1000750
      },
      "writtenOn": "2024-02-02T20:09:14Z",
      "side": 1,
      "message": "I think that saving context for powerdown would require permanent storage, but correct me if I\u0027m wrong. With Jayanth\u0027s approach, the context is saved upon suspend or powerdown, but the data is lost on powerdown.",
      "parentUuid": "46b46629_74e75186",
      "range": {
        "startLine": 100,
        "startChar": 0,
        "endLine": 137,
        "endChar": 69
      },
      "revId": "3b0831936e53bd26e54b19752254ff1aaa5c8244",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "22b16557_564bb6af",
        "filename": "lib/extensions/spe/spe.c",
        "patchSetId": 20
      },
      "lineNbr": 137,
      "author": {
        "id": 1000660
      },
      "writtenOn": "2024-02-02T20:27:39Z",
      "side": 1,
      "message": "In my understanding, we have two paths here.\nOn the offline path, the core is shut down and the other is suspend-resume (wakeup based on IRQ).\nRegarding the testing, so far, we were worried about the second path, whether this saving and restoring was essential in the second case(suspend-resume/ which happens via suspend-to-powerdown start and finish), This was clarified as part of the testing I posted recently.\n\nFurther, we follow a similar approach for AMU counters testing as well. I haven\u0027t deviated from anything here. I referred to the same routines, and ensured it.\n\n\nI have rebased my patches on the latest change for arm-FPGA platform to avoid BL31 memory footprint size. It\u0027s passing now.",
      "parentUuid": "0567883b_d4ce795e",
      "range": {
        "startLine": 100,
        "startChar": 0,
        "endLine": 137,
        "endChar": 69
      },
      "revId": "3b0831936e53bd26e54b19752254ff1aaa5c8244",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "64bf1520_831b286a",
        "filename": "lib/extensions/spe/spe.c",
        "patchSetId": 20
      },
      "lineNbr": 137,
      "author": {
        "id": 1000744
      },
      "writtenOn": "2024-02-05T17:08:16Z",
      "side": 1,
      "message": "\u003e I think that saving context for powerdown would require permanent storage, but correct me if I\u0027m wrong.\n\nCould you elaborate on what you mean by permanent storage, isn\u0027t that what we are doing here [1]? \n\n[1] https://review.trustedfirmware.org/c/TF-A/trusted-firmware-a/+/22500/29/lib/extensions/spe/spe.c#108",
      "parentUuid": "22b16557_564bb6af",
      "range": {
        "startLine": 100,
        "startChar": 0,
        "endLine": 137,
        "endChar": 69
      },
      "revId": "3b0831936e53bd26e54b19752254ff1aaa5c8244",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6651f263_38dd5314",
        "filename": "lib/extensions/spe/spe.c",
        "patchSetId": 20
      },
      "lineNbr": 137,
      "author": {
        "id": 1000750
      },
      "writtenOn": "2024-02-05T19:48:00Z",
      "side": 1,
      "message": "NVM. I was thinking on the case in which all cores are powered down, but it wouldn\u0027t make much sense to save that context in that case. I think this approach is OK for powerdown (and for suspend, given the results of the tests).",
      "parentUuid": "64bf1520_831b286a",
      "range": {
        "startLine": 100,
        "startChar": 0,
        "endLine": 137,
        "endChar": 69
      },
      "revId": "3b0831936e53bd26e54b19752254ff1aaa5c8244",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    }
  ]
}